(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{1193:function(module,__webpack_exports__,__webpack_require__){"use strict";var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__),faker__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7),faker__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(faker__WEBPACK_IMPORTED_MODULE_1__),pouchdb__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(37),pouchdb_find__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(131),pouchdb_quick_search__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(130),pouchdb_quick_search__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(pouchdb_quick_search__WEBPACK_IMPORTED_MODULE_4__);pouchdb__WEBPACK_IMPORTED_MODULE_2__.a.plugin(pouchdb_find__WEBPACK_IMPORTED_MODULE_3__.a),pouchdb__WEBPACK_IMPORTED_MODULE_2__.a.plugin(pouchdb_quick_search__WEBPACK_IMPORTED_MODULE_4___default.a);var cu=window.cu,ub={ctx:{},serialize:function(t){return lodash__WEBPACK_IMPORTED_MODULE_0___default.a.cloneDeepWith(t,function(t){if(lodash__WEBPACK_IMPORTED_MODULE_0___default.a.isFunction(t))return{TYPE:"FN",body:t.toString()}})},deserialize:function deserialize(obj){var item=lodash__WEBPACK_IMPORTED_MODULE_0___default.a.cloneDeepWith(obj,function(value){if(value&&"FN"==value.TYPE){var fn;try{eval("fn="+value.body)}catch(e){}return fn}});return item},save:function(t,e){var n=this.ctx.db,a=this.serialize(t);return a.uid||(a.uid=e||a.id||this.generateUid()),a._id||(a._id=a.uid),n.get(a._id).then(function(t){var e=t.rev,i=t._rev;return a.rev=e,a._rev=i,n.put(a).then(function(t){})}).catch(function(t){return n.put(a)})},load:function(t){var e=this;return this.ctx.db.get(t).catch(function(t){return null}).then(function(t){return t&&(t=e.deserialize(t)),t})},generateUid:function(){return this.cfg.state.nextId++,this.cfg.state.prefix+"_"+this.cfg.state.nextId},init:function(t){var e={db:new pouchdb__WEBPACK_IMPORTED_MODULE_2__.a(t,{auto_compaction:!0}),state:{prefix:(new Date).getTime().toString()+"_"+Math.random().toString(),nextId:0,id:"state"}},n=Object.create(this);return n.ctx=e,n.load("state").then(function(t){t?n.ctx.state=t:n.save(n.ctx.state)}),n},destroy:function(){this.ctx.db.destroy().then(function(){alert("done cleanup")})},loadfilter:function(t,e,n){return this.ctx.db.find({selector:t})},partialTextSearch:function(t){return this.ctx.db.query(function(t,e){t.text&&t.text.split(/\s+/g).filter(function(t){return t.length>2}).forEach(function(n){e(n,{type:t.type,map:t.mapId,parent:t.parentId,test:"salut"})})},{startKey:t,endKey:t+"\0"})},searchText:function(t){return this.ctx.db.search({query:t,fields:["title","text"],include_docs:!0,highlighting:!0})},loadFromIndex:function(t,e,n,a,i){var r=this.ctx.db;t[e]||(t[e]={$gt:null});var s=[lodash__WEBPACK_IMPORTED_MODULE_0___default.a.set({},e,n?"desc":"asc")];return r.createIndex({index:{fields:i}}).then(function(t){return t.name}).then(function(e){return r.find({selector:t,limit:a,sort:s}).then(function(t){return t.docs})})}},test=function(t){t.obj=ub.serialize({x:function(){},y:"test"}),t.obj2=ub.deserialize(t.obj),ub.init("testdb")};cu.db={run:function(t){return ub.init(t)},def:"\n    ",debug:{ub:ub}}},1213:function(t,e){},1215:function(t,e){},1248:function(t,e){},1249:function(t,e){},1304:function(module,__webpack_exports__,__webpack_require__){"use strict";var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__),cu=window.cu,ub={ctx:{tb:{}},run:function(t,e,n){var a=(t=lodash__WEBPACK_IMPORTED_MODULE_0___default.a.cloneDeep(t)).mold.tpl;return this.applyOps(t.mold.ops,a,e,n),a.props&&(a.props.tplid=t.uid),a},applyOps:function applyOps(ops,obj,data,getter){for(var get=getter||lodash__WEBPACK_IMPORTED_MODULE_0___default.a.get,newOps=[],i=0;i<ops.length;i++){var op=ops[i];if("value"==op.type){var value=get(data,op.action,op,newOps);lodash__WEBPACK_IMPORTED_MODULE_0___default.a.set(obj,op.path,value)}else if("computedValue"==op.type){var _value=op.value;lodash__WEBPACK_IMPORTED_MODULE_0___default.a.set(obj,op.path,_value)}else if("concat"==op.type){var _value2=get(obj,op.path,op,newOps).join("");lodash__WEBPACK_IMPORTED_MODULE_0___default.a.set(obj,op.path,_value2)}else if("pathSet"==op.type){var _value3=get(obj,op.path,op,newOps);lodash__WEBPACK_IMPORTED_MODULE_0___default.a.set(obj,_value3.PATH,_value3.VALUE),lodash__WEBPACK_IMPORTED_MODULE_0___default.a.unset(obj,op.path)}else if("makeFunction"==op.type){var body=get(obj,op.path,op,newOps).join("");try{var fn=void 0;eval("fn="+body),lodash__WEBPACK_IMPORTED_MODULE_0___default.a.set(obj,op.path,fn)}catch(e){console.error("makeFunction::"+body)}}}newOps.length&&this.applyOps(newOps,obj,data,getter)}},inputs={data:{"#color":12,"#handle":"handle","#test2":"test2","#test1":"test1","#title":"title it is"}},test=function(t){var e=cu.tests.get("mold.x");if(!e)return"pending";var n=ub.run(e,inputs.data);t.value=n,t.mold=e,cu.tests.pin("reactTree",n)};cu.reactAssembler={run:function(t,e,n){return ub.run(t,e,n)},init:function(){},def:"\n    ",debug:{ub:ub}},cu.moldAssembler=cu.reactAssembler},1312:function(t,e,n){"use strict";n.r(e);var a=n(3),i=n.n(a),r=n(127),s=n.n(r),o=(n(137),n(14)),l=n(15),u=n(18),c=n(16),d=n(17),p=(n(76),n(77),n(20)),h=n(128);n(140);n(142);a.Component;var f=n(0),v=n.n(f),m=n(5),g=n.n(m),b=(n(50),n(41),window.DataManager),w={setup:function(){var t=this;this.isInitialized||(g()("body").on("keydown",function(e){t.handleKey(e)}),b.setTrigger("keyboardShortcuts.layout","kbdManager",{run:function(){t.load()}}),this.load())},load:function(){var t=b.getValue("keyboardShortcuts.layout");this.layout=t||{}},handleKey:function(t){var e=[];t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),t.shiftKey&&e.push("shift"),e.push(t.key.toLowerCase());var n=e.join("+");if(this.layout[n])return this.run(this.layout[n],n)},run:function(t,e){return v.a.isFunction(t)?t(e,t):t.run?t.run(e,t):void 0}};w.setup();var _={init:function(t){var e=Object.create(this);return e.DataManager=t,e.wallet={timers:{}},e},wallet:{timers:{}},start:function(t,e,n){var a=this;this.wallet.timers[t]&&window.clearTimeout(this.wallet.timers[t]);var i=window.setTimeout(function(){a.cancel(t),e(t,e,n)},n);this.wallet.timers[t]=i;var r=new Date;this.DataManager.set("TimerManager.timer."+t,{start:r.getTime(),end:r.getTime()+n})},cancel:function(t){this.wallet.timers[t]&&window.clearTimeout(this.wallet.timers[t]),delete this.wallet.timers[t],this.DataManager.set("TimerManager.timer."+t,"")}},y=(n(37),n(38)),x=n.n(y),k=n(7),O=n.n(k),I={};window.cu=I;var P=I,C=window.cu,T={};T.db={saveItems:function(t,e){var n=v.a.isArray(t.items)?t.items:[t.items];e.tb.db.saveItems(C.uids.run(),n)},loadItem:function(t,e){var n;t.append&&e.data[t.append]&&(n=e.data[t.append]),e.tb.db.loadItems([t.id],n).then(function(n){e.cancel||(t.append&&e.actions.appendById({path:t.append,value:n},e),t.pin&&e.actions.setValue({path:t.pin,value:n[0]},e))})},loadItems:function(t,e){var n,a=v.a.isArray(t.ids)?t.ids:Object.keys(t.ids);t.append&&e.data[t.append]&&(n=e.data[t.append]),e.tb.db.loadItems(a,n).then(function(n){e.cancel||(t.append&&e.actions.appendById({path:t.append,value:n},e),t.pin&&e.actions.setValue({path:t.pin,value:n},e))})},loadFromIndex:function(t,e){e.tb.db.loadFromIndex(t).then(function(n){e.cancel||(t.append&&e.actions.appendById({path:t.append,value:n},e),t.pin&&e.actions.setValue({path:t.pin,value:n},e))})},searchItems:function(t,e){var n=t.filter;e.tb.db.loadFilter(n).then(function(n){var a=n.docs;e.cancel||(console.log("filter items",a),t.append&&e.actions.appendById({path:t.append,value:a},e),t.pin&&e.actions.setValue({path:t.pin,value:a},e))})},searchText:function(t,e){this.tb.db.searchText(t.text).then(function(n){e.cancel||t.pin&&e.actions.setValue({path:t.pin,value:n},e)})}},T.core={triggerRerun:function(t,e){e.running?e.shouldRerun=!0:e.actions.runAllOps({},e)},prepareOp:function(t,e){var n={src:{}};for(var a in t.input)if("type"==a)n.type=t.input[a];else if(v.a.isString(t.input[a])){n.src[a]=t.input[a];var i=e.actions.getValue(t.input[a],e);if(void 0===i){if(!t.partial)return null;n.missing||(n.missing=[]),n.missing.push(a)}else n[a]=i}else n[a]=t.input[a];for(var a in t)"input"!=a&&(n[a]=t[a]);return n.OP=t,n},runOp:function(t,e){t.uid||(t.uid=e.actions.getUid("",e));var n=e.actions.prepareOp(t,e);return null===n?"notcomplete":(n.name&&(n.pin=n.name),e.actions[n.type]||console.error({v:e,args:n,op:t}),"notcomplete"===e.actions[n.type](n,e)?"notcomplete":void 0)},getUid:function(t,e){return e.master.state.nextId++,"op_"+e.master.state.nextId},opIsDone:function(t,e){return!t.partial&&(!!t.pin&&void 0!==v.a.get(e.data,t.pin))},runAllOps:function(t,e){for(var n in e.ncOps=[],e.running=!0,e.shouldRerun=!1,e.ops){var a=e.ops[n];if(!e.actions.opIsDone(a,e))"notcomplete"===e.actions.runOp(a,e)?e.ncOps.push(a):e.shouldRerun=!0}e.ops=e.ncOps,e.running=!1,e.shouldRerun?(e.shouldRerun=!1,this.runAllOps(t,e)):0==e.ncOps.length&&e.actions.checkGuards({path:"DONE"},e)}},T.values={pinTo:function(t,e,n){t.pin&&n.actions.setValue({path:t.pin,value:e},n)},staticValue:function(t,e){e.actions.pinTo(t,t.value,e)},getValue:function(t,e){return e.privat?this.getFromPrivate(t,e):e.prefix?this.getValueWithPrefix(t,e):v.a.get(e.data,t)},getFromPrivate:function(t,e){var n=v.a.get(e.privat,t);return void 0!=n?n:e.prefix?this.getValueWithPrefix(t,e):v.a.get(e.data,t)},getValueWithPrefix:function(t,e){var n=v.a.get(e.data,e.prefix+"."+t);return void 0===n&&(n=v.a.get(e.data,t)),n},checkGuards:function(t,e){var n;((n=e.triggers[t.path])&&(v.a.isArray(n)||(n=[n]),n.forEach(function(n){v.a.isFunction(n)?n(t.path,t.value,t.isPartial,e):n.run&&n.run(t.path,t.value,t.isPartial,e)})),e.guards)&&((n=e.guards[t.path])&&(v.a.isArray(n)||(n=[n]),n.forEach(function(n){v.a.isFunction(n)?n(t.path,t.value,t.isPartial,e):n.run&&n.run(t.path,t.value,t.isPartial,e)})))},setValue:function(t,e){var n=t.path;e.privat?v.a.set(e.privat,n,t.value):(e.prefix&&(n=e.prefix+"."+t.path),v.a.set(e.data,n,t.value)),this.checkGuards(t,e),t.isPartial||e.actions.triggerRerun({},e)},appendById:function(t,e){var n=v.a.get(e.data,t.path);n||(n={},v.a.set(e.data,t.path,n));var a=t.value;for(var i in a)if(a[i]){var r=a[i].id;n[r]||(n[r]=a[i])}t.isPartial||e.actions.triggerRerun({},e)}},T.generic={log:function(t,e){var n={};for(var a in t.OP.input)n[a]=t[a];console.log("log",n,e)},fn:function(t,e){if(t.fn){var n;if("notcomplete"===(n=t.fn.run?t.fn.run(t,e):t.fn(t,e)))return n;t.pin&&e.actions.setValue({path:t.pin,value:n},e)}},assembleObj:function(t,e){var n={};for(var a in t.OP.input)n[a]=t[a];if(t.partial&&t.pin&&t.missing){if(e.opState[t.uid]||(e.opState[t.uid]={missing:[]}),n.partial=!0,v.a.isEqual(t.missing,e.opState[t.uid].missing))return"notcomplete";e.opState[t.uid].missing=t.missing,e.actions.setValue({path:t.pin,value:n,isPartial:!!t.missing&&"skipRerun"},e)}else t.pin&&!t.missing&&e.actions.setValue({path:t.pin,value:n},e);if(t.missing)return"notcomplete"}},T.tpls={listTemplate:function(t,e){var n=[];for(var a in t.list){var i=C.moldAssembler.run(t.tpl,t.list[a]);n.push(i)}return t.pin&&e.actions.setValue({path:t.pin,value:n},e),n},useTpl:function(t,e){var n=!1,a=C.moldAssembler.run(t.tpl,t,function(t,a){var i=v.a.get(t,a);return void 0===i&&(i=v.a.get(e.data,a)),void 0===i&&(i="",n=!0),i});return t.pin&&e.actions.setValue({path:t.pin,value:a,isPartial:n},e),a}};var A={makeTriggers:function(t){var e={};for(var n in t)e[n]=this.makeTrigger(n,t[n]);return e},makeTrigger:function(t,e){var n=e.tb,a=e.name;return function(t,e,i,r){console.log("should trigger",{tb:n,name:a,result:e,partial:i}),r.master.tb[n].trigger(a,e,i)}}},j={setup:function(t){var e=Object.create(this);return e.ctx={actions:{},opsCollection:t.opsCollection||{},data:t.data||{},triggers:{},valuesChain:{}},e.state={nextId:1,open:{}},e.tb=t.tb||{},e.addTriggers(t.triggers),e.addActionsCollection(T),t.actions&&e.addActionsCollection(t.actions),t.ops&&e.addMainOps(t.ops),t.guards&&e.addTriggers(A.makeTriggers(t.guards)),t.valuesChain&&e.addValuesChains(t.valuesChain),e},addValuesChains:function(t){for(var e in t){var n=t[e];v.a.isString(n.unset)&&(n.unset=n.unset.split(",")),this.ctx.valuesChain[e]=n}},addActionsCollection:function(t,e){for(var n in t)v.a.isString(t[n])&&this.fetchCollection(t,n,t[n]);for(var n in t)this.addActions(t[n],Object.assign({},e,{slot:n}))},fetchCollection:function(t,e,n){var a=v.a.cloneDeep(C.DataManager.getValue(n));if(a.isCollection){for(var i in v.a.unset(t,e),delete a.isCollection,a)v.a.isString(a[i])&&this.fetchCollection(a,i,a[i]);v.a.merge(t,a)}else t[i]=a},addActions:function(t,e){var n=function(t){return function(e,n){return t.run(e,n)}};for(var a in t){var i=t[a];i.run&&(i=n(i)),this.ctx.actions[a]=i}},addOps:function(t,e){this.ctx.opsCollection[t]=e},addMainOps:function(t){this.addOps("main",t)},addTriggers:function(t){for(var e in t){var n=t[e];v.a.isArray(n)||(n=[n]),this.ctx.triggers[e]&&(n=this.ctx.triggers[e].concat(n)),this.ctx.triggers[e]=n}},run:function(t,e,n,a){t=t||"main",e&&this.changeData(e);var i=this.ctx.opsCollection[t];if(i){var r=this.getOpen(t);r.ops=i,delete r.guards,n&&(r.guards=n),v.a.merge(r,a),a&&a.privat?r.privat=a.privat:delete r.privat,this.ctx.actions.runAllOps({},r)}},getOpen:function(t){if(this.state.open[t])return this.state.open[t];var e={master:this,data:this.ctx.data,actions:this.ctx.actions,tb:this.tb,triggers:this.ctx.triggers};return this.state.open[t]=e,e},cancel:function(t){this.state.open[t].cancel=!0,delete this.state.open[t]},changeData:function(t){for(var e in t)this.ctx.valuesChain[e]&&this.applyValuesChain(e,t[e],this.ctx.valuesChain[e]);for(var e in t){var n=e,a=t[e];null===a?v.a.unset(this.ctx.data,n):v.a.set(this.ctx.data,n,a)}},applyValuesChain:function(t,e,n){var a=this,i=n.unset;if(i&&i.forEach(function(t){return v.a.unset(a.ctx.data,t)}),n.reset)for(var r in n.reset)this.ctx.data[r]=n.reset[r].value}};C.actionFlow={setup:function(t){return j.setup(t)},setupFlow:function(t){var e=this;v.a.merge(this,t),this.actionsFlow=C.actionFlow.setup(this),this.run=function(t,n,a,i){e.actionsFlow.run(t,n,a,i)},this.actionsFlow.run("setup"),console.log("actionFlow",this)},run:function(){},def:"\n    ",debug:{ub:j}};var S=n(129),M=n.n(S),D=window.cu,V={getRandomFn:function(t){var e=0;for(var n in t)e+=t.charCodeAt(n)*n;return function(){var t=1e4*Math.sin(e++);return t-Math.floor(t)}},getBrand:function(t){var e=this.getRandomFn(t),n="#007abc",a={mainColor_hsl:this.getColor(e(),n),complementColor_hsl:this.getColor(e(),n)};return a.mainColor="hsl( "+a.mainColor_hsl[0]+","+a.mainColor_hsl[1]+"% ,"+a.mainColor_hsl[2]+"%  )",a.complementColor="hsl( "+a.complementColor_hsl[0]+","+a.complementColor_hsl[1]+"% ,"+a.complementColor_hsl[2]+"%  )",a.fadedColor="hsla( "+a.mainColor_hsl[0]+",10% ,"+a.mainColor_hsl[2]+"%, 1 )",a},getColor:function(t,e){e=e||"#007abc";var n=360*t,a=M()("#007abc").set("hsi.h",n).hsl();return a[1]=100*a[1],a[2]=100*a[2],a},get:function(t,e){var n=t;t=0;for(var a in n)t+=n.charCodeAt(a)*a;function i(){var e=1e4*Math.sin(t++);return e-Math.floor(e)}var r=50/(e=Math.max(2,Math.floor(5*i()))),s=this.getColor(i()),o=[[0,0,.5,.5,1,0],[0,0,.5,.5,0,1],[1,1,.5,.5,0,1],[1,1,.5,.5,1,0]],l=[];for(a=0;a<e;a++)for(var u=function(){var t=a*r,e=c*r;o.map(function(n){var a="hsl( "+s[0]+","+s[1]+"% ,"+s[2]+"%  )",o=Math.round(5*i()),u=n.map(function(n,a){return n*r+(a%2?t:e)});l.push("<polygon\n                  class='poligon poligon_".concat(o,"'\n                  points=\"")+u.join(" ")+'" stroke="transparent" fill="transparent" \n                  style=" strokeWidth: '+1/r+";\n                  fill: "+a+";\n                  opacity : "+i()+'; \n                  " />')})},c=0;c<e;c++)u();return"<svg style='position :relative;width: inherit; height: inherit;'> "+l.join("")+"</svg>"}};D.brand={getLogo:function(t,e,n){return V.get(t,n)},getBrand:function(t){return V.getBrand(t)},def:"\n    ",debug:{ub:V}};n(53);window.cu.bubbleBoard={init:function(){},def:"\n    ",debug:{ub:{}}};var E=window.cu,L={ctx:{},addItem:function(t){var e=this.getId();return t.id=e,this.mergeItem(e,t),e},getId:function(){return this.ctx.data.state.nextId++,"bubble_"+this.ctx.data.state.nextId},mergeItem:function(t,e){var n,a=this.ctx;a.data.result[t];a.changed={},this.appendTo(t,e);var i=a.data.result,r=a.changed;console.log(a.data);var s=a.data.versions;for(var o in r){s[o]||(s[o]=0),s[o]++;var l=i[o];l&&(l.isReady&&(void 0==n&&(n=l.completedAt),n>l.completedAt&&(n=l.completedAt)))}return void 0!==n&&this.rewindTo(n),this.ctx.tb.onchanged&&this.ctx.tb.onchanged(r),n},rewindTo:function(t){var e=this.ctx;for(var n in e.data.result){var a=e.data.result[n];a.isReady&&(a.completedAt>=t||a.createdAt>t)&&(a.isReady=!1,a.completedAt=0)}e.data.step=t},appendTo:function(t,e){var n=this.ctx,a=n.data.items[t],i=!1;for(var r in a||(n.data.step++,n.data.items[t]=a={},n.data.result[t]={createdAt:n.data.step},i=!0),e){var s=e[r];if("REMOVE"!=s||void 0===a[r])if(null!==s||void 0===a[r]){if(s){var o=a[r]?a[r].id:null;v.a.isString(s)&&"#"==s.charAt(0)&&(s={id:s.substring(1)}),void 0!==s.id&&("#"!=s.id&&""!=s.id||(s.id=null),s.id=s.id||o||this.getId(),a[r]={id:s.id}),s.id&&v.a.isObject(s)?(s.id!=o&&(i=!0),this.appendTo(s.id,s)):v.a.isObject(s)&&!v.a.isMatch(a[r],s)?(i=!0,a[r]=s):a[r]!=s&&(i=!0,a[r]=s)}}else delete a[r],i=!0;else delete a[r],i=!0}i&&(a.version&&(a.version=a.version?a.version+1:1),this.ctx.changed[t]=!0)},evalItems:function(t){this.ctx.affected={},this._evalItems(t),this.ctx.tb.onchanged&&this.ctx.tb.onchanged(this.ctx.affected)},_evalItems:function(t){if(!(t<=0)){var e=this.ctx,n=!1;for(var a in e.data.items){var i=e.data.items[a],r=e.data.result[a];if(!r||!r.isReady){var s=this.isCompleteValues(i,a);s&&(e.data.result[a]||(e.data.result[a]={}),this.evalItem(i,a,s,e.data.result[a]),e.data.result[a].isReady&&(n=!0))}}n&&this._evalItems(t-1)}},evalItem:function(t,e,n,a){var i=this.ctx;a.isReady=!0,a.values=n;var r=this.ctx.tb.getNode(t,n,a,i);r&&(a.node=r),a.isReady&&(i.data.step++,a.completedAt=i.data.step,this.ctx.affected[e]=!0)},isCompleteValues:function(t){var e=this.ctx,n={};for(var a in t){var i=t[a];if(i.id){var r=e.data.result[i.id];if(!r||!r.isReady)return!1;var s=r.node;t[a+"_path"]&&(s=v.a.get(s,t[a+"_path"])),n[a]=s}else n[a]=i}return n},init:function(t){var e=Object.create(this);return e.ctx=t,v.a.defaultsDeep(t,{data:{items:{},result:{},step:1,versions:{},trails:{},rels:{bellow:{},above:{},uses:{}},state:{nextId:8}},tb:{checkIfComplete:function(t){return t.type||t.tpl||t.node},getNode:function(t,e,n){return{val:e,x:t.tpl}}}}),t.master=e,e},evaluateflow:function(){this.evalItems(5)},getVersion:function(t){var e=this.ctx.data.items[t];return e?e.version:null}};E.bubbleFlow={run:function(t){return L.init(t)},init:function(){},def:"\n    ",debug:{ub:L}};var R=window.cu,U={},B={ctx:{},doubleCheck:function(t){var e=U.evaluate.setup({data:this.ctx.data,state:this.ctx.state}).target(t);for(var n in W)e.run(W[n])},check:function(t){var e=this.ctx.data.items[t],n=this.ctx.data.result[t],a=this.ctx.data.shaddow[t];a||(a=this.ctx.data.shaddow[t]={});var i=this.ctx.data.result,r=a.score={subs:{total:0,resolved:[],unresolved:[]}};for(var s in e)e[s].id&&(r.subs.total++,i[e[s].id]&&i[e[s].id].isReady?r.subs.resolved.push({slot:s,id:e[s].id}):r.subs.unresolved.push({slot:s,id:e[s].id}));if(n&&n.values&&n.values.tpl){var o=n.values.tpl;r.tplParams={total:0,defined:0,resolved:0,unresolved:[]};var l=o.mold.parameters;for(var u in l)r.tplParams.total++,n.values[u]||e[u]?r.tplParams.defined++:r.tplParams.unresolved.push(u)}},setup:function(t){var e=Object.create(this);return e.ctx=t,v.a.defaultsDeep(t,{data:{items:{},result:{},shaddow:{},trails:{}}}),e}};U.evaluate={target:function(t){var e=this.model||this,n=Object.create(e);return n.model=e,n.setup(),n.v.targetId=t,n},setup:function(t){return this._setup(t),this},_setup:function(t){t&&Object.assign(this,t),this.model&&this.model.shaft&&(this.shaft={}),this.v={result:{}}},get:function(t){if(!v.a.isString(t))return t;var e;this.v.targetId;return"values"==t&&(e=["result",this.v.targetId,"values"]),e="item"==t?["items",this.v.targetId]:[t,"id"],v.a.get(this.data,e)},getFull:function(t){var e=t[0],n=t[1],a=t[2];e||(e="items"),"item"==e&&(e="items"),n||(n=this.v.targetId);var i=[e,n];return a&&i.push(a),v.a.get(this.data,i.join("."))},fetch:function(t){for(var e in t)this.v[e]=this.getFull(t[e]);return this},it:function(t,e){t=this.get(t);var n={slot:this.v.slot,value:this.v.value,info:this.v.info,sub:this.v.sub};for(var a in this.v.slot=null,this.v.value=null,this.v.info=null,this.v.sub=null,t)this.v.slot=a,this.v.value=t[a],this.v.info=a,this.v.sub={},e(this,this.v);for(var a in n)this[a]=n[a]},run:function(t){try{t(this,this.v)}catch(e){if(e&&"notApplicable"==e.type)return;console.log(e)}this.v.result&&(this.data.trails[this.v.targetId]||(this.data.trails[this.v.targetId]={}),Object.assign(this.data.trails[this.v.targetId],this.v.result))},result:function(t,e){this.v.result[t]=e},check:function(t){for(var e in t){if("isCurrentItem"==t[e]){var n=this.state.currentItem.targetid;if(!n||this.v.targetId!=n)throw{type:"notApplicable",path:t[e]}}else{if(void 0===v.a.get(this.v,t[e]))throw{type:"notApplicable",path:t[e]}}}}},U.compile=Object.assign({},U.evaluate,{setup:function(t){return this._setup(t),this.clues={needes:{},provides:{},collections:[]},this},fetch:function(t){for(var e in t)this.clues.needes[e]={key:t[e]},this.v[e]={test:"test"};return this},check:function(t){},result:function(t,e){this.clues.provides[t]=e},it:function(t,e){this.clues.collections.push(t)},run:function(t){t(this,this.v)}});var W=[function(t,e){return t.fetch({item:["item"]}),e.score={total:0,resolved:[],unresolved:[]},t.it(e.item,function(t,e){var n=e.value;if(n.id){e.score.total++;var a=t.getFull(["result",n.id]);a&&a.isReady?e.score.resolved.push(n.id):e.score.unresolved.push(n.id)}}),t.result("subScore",e.score),{subScore:e.score}},function(t,e){t.fetch({values:["result","","values"],item:["item"],parameters:["result","","values.tpl.mold.parameters"]}),t.check(["values.tpl"]),e.score={total:0,defined:0,undefined:[]},e.params={},t.it(e.parameters,function(t,e){var n=e.slot;e.params[n]=!0,e.score.total++,e.item[n]||e.values[n]||e.score.undefined.push(n)}),t.it(e.parameters,function(t,e){var n=e.slot;e.params[n]=!0}),e.score.undefinedCount=e.score.undefined.length,e.score.definedCount=e.score.total-e.score.undefinedCount,t.result("tplParamsScore",e.score),t.result("tplParams",e.params)},function(t,e){t.fetch({trails:["trails"]}),t.check(["isCurrentItem"]),console.log("trails is currentItem",e.trails)}];R.bubbleGuns={setup:function(t){return B.setup(t)},init:function(){},def:"\n    ",debug:{ub:B}};var F=window.cu,N={ctx:{tb:{onchanged:function(t){},getNode:function(t,e,n,a){return F.bubbleTypes.dispatch.getNode(t,e,n,a)}},data:{state:{nextId:0}}}};F.bubbleTest={init:function(){},def:"\n    ",debug:{ub:N}};var K=window.cu,q={};q.dispatch={getNode:function(t,e,n,a){var i=e.type;if(i||(e.tpl?i="reactNode":e.node&&(i="dataNode")),i&&q[i])return q[i].getNode(t,e,n,a);n.isReady=!1}},q.tpl={getNode:function(t,e,n,a){delete e.type;var i=K.tplObjParse.run(e);return n.viewAs="object",i}},q.dataNode={getNode:function(t,e,n,a){return t.node}},q.reactNode={getNode:function(t,e,n,a){var i=e.tpl;if(i&&i.mold){var r=[],s=K.reactAssembler.run(i,e,function(t,e,n){var a=v.a.get(t,e);return void 0!==a?a:(r.push(e),"dummyvalue")});return r.length&&(s=[r,s]),n.viewAs="reactComponent",n.cues={pins:i.mold.pins},s}n.isReady=!1}},q.mirror={description:"",getNode:function(t,e,n,a){var i=a.data.items[t.model],r=e.data,s=v.a.cloneDeep(i);if(n.bubbles||(n.bubbles={}),n.cache||(n.cache={data:{}}),!v.a.isMatch(n.cache.data,r))for(var o in n.cache.data=r,s)"tpl"!=o&&s[o].id&&r[o]&&n.bubbles[o]&&a.master.mergeItem(n.bubbles[o].id,{data:r[o]});for(var o in s)if("tpl"!=o&&s[o].id&&r[o]){if(n.bubbles[o])s[o]={id:n.bubbles[o].id};else{var l=a.master.addItem({type:"mirror",data:r[o],model:s[o].id});n.bubbles[o]={id:l,model:s[o].id}}s[o]={id:n.bubbles[o].id}}else r[o]&&(s[o]=r[o]);s.id=t.id;var u=a.master.isCompleteValues(s);if(u)return n.mirror={},a.master.evalItem(t,t.id,u,n.mirror),n.mirror.viewAs&&(n.viewAs=n.mirror.viewAs),n.mirror.node;n.isReady=!1}};K.bubbleTypes={mirror:q.mirrorBubble,types:q,dispatch:q.dispatch,def:"\n    ",debug:{ub:{}}};n(1193),n(1303);var z=window.cu,H={ctx:{payload:{},tb:{}},run:function(t){var e=this.ctx.payload,n={ops:[],parameters:{},pins:{},tpl:{},comments:[]};return n.tpl=this.getTpl(t,[],n),this.ctx.payload=e,n},getTpl:function(t,e,n){if(v.a.isFunction(t)){var a=t.toString(),i=this.opValues(t.toString(),e,n,"makeFunction");return a==i?t:i}if(v.a.isObject(t)){var r={};for(var s in t){var o=s,l=void 0;if(-1!=o.indexOf("{")||-1!=o.indexOf(".")){var u={VALUE:t[s],PATH:s};o=o.replace(/[^\w]+/g,"_"),l=this.getTpl(u,e.concat(o),n),this.addOp(n,e.concat(o),{type:"pathSet",stage:10,path:e.concat(o)})}else l=this.getTpl(t[s],e.concat(s),n);r[o]=l}return r}if(v.a.isArray(t)){var c=[];for(var s in t)c.push(this.getTpl(t[s],e.concat(s),n));return c}return v.a.isString(t)?this.opValues(t,e,n,"concat"):t},addOp:function(t,e,n){n.stage||(n.stage=0),n.action&&(t.parameters[n.action]=n.path),t.ops.push(n)},addComment:function(t,e,n){var a={text:n,path:e};t.comments.push(a)},opValues:function(t,e,n,a){var i=this;if(!v.a.isString(t))return t;if(-1==t.indexOf("{"))return t;n.ops;var r=t.split(/(\{[^}\n\:\;]+)\}|(\$\$\w+)/g);return 0==(r=r.map(function(t,e){if(!t)return null;var n=t.charAt(0);if("{"==n)t=t.substring(1);else{if("$"!=n)return t;t=t.substring(2)}return{type:"value",action:t,firstChar:n}}).filter(function(t){return t})).length?null:1==r.length?((r=r[0]).type&&(r.path=e),v.a.isObject(r)&&this.addOp(n,r.path,r),r):a?(r=r.map(function(t,a){return t.type?(t.path=e.concat(a),t.index=a,t.concatParent=!0,t.stage=0,i.addOp(n,e,t),t):t}),this.addOp(n,e,{path:e,type:a,ops:r,stage:1}),r):r=r.map(function(t,a){return t.type?(t.path=e.concat(a),t.index=a,t.stage=0,i.addOp(n,e,t),t):t})}};z.parseObjIntoMold={run:function(t){return H.run(t)},init:function(){},def:"\n        @obj with string or .html slots \n        transform it into componentsObjects\n    ",debug:{ub:H}};var G=window.cu,Y={run:function(t){t=t.trim();var e=document.createElement("div");e.innerHTML=t;for(var n=[],a=0;a<e.childNodes.length;a++){var i=e.childNodes[a],r=this._spec(i);n.push(r)}return 1==n.length?n[0]:n},_spec:function(t){var e=this;if(3==t.nodeType)return t.nodeValue;for(var n={},a=0;a<t.attributes.length;a++){var i=t.attributes[a],r=i.name;-1!=r.indexOf("_")&&(r=r.replace(/\_(.)/g,function(t,e){return e.toUpperCase()})),n[r]=i.value}n.class&&(n.className=n.class,delete n.class),n.style&&(n.style=this._style(n.style));var s={type:"node",componentName:t.nodeName.toLowerCase(),props:n,children:null};if(n.htmlSlot)return n[n.htmlSlot]=t.innerHTML,s;0==Object.keys(n)&&(n=null);var o=[];return t.childNodes.forEach(function(t){o.push(e._spec(t))}),0==o.length&&(o=null),s.children=o,s},_style:function(t){t+=";";for(var e,n=/\s*([^:\s]+)\s*\:\s*([^;]+)\s*\;+/g,a={};e=n.exec(t);)a[e[1]]=e[2];return a}},$={run:function(t,e){var n=this,a={ops:[],pins:{},parameters:{},attrs:{},watchAttrs:e||[]};return v.a.isArray(t)?a.tpl=t.map(function(t,e){return n.iterate(t,[e],a)}):a.tpl=this.iterate(t,[],a),a.ops.sort(function(t,e){return t.stage-e.stage}),{ops:a.ops,tpl:a.tpl,pins:a.pins,parameters:a.parameters,attrs:a.attrs}},iterate:function(t,e,n){if(t){if(v.a.isString(t))return this.opValues(t,e,n,!1);t=this.handleObj(t,e,n);var a=e.concat(["children"]);for(var i in t.children)t.children[i]=this.iterate(t.children[i],a.concat(i),n);var r=e.concat(["props"]);for(var i in t.props)"style"!=i&&(t.props[i]=this.handleProp(t.props[i],r.concat(i),t,n));if(t.props&&t.props.style){var s=e.concat(["props","style"]);for(var i in t.props.style)t.props.style[i]=this.handleProp(t.props.style[i],s.concat(i),t,n)}return t.props&&t.props.pin&&(n.pins[t.props.pin]=e),t.props&&t.props.id&&(n.pins[t.props.id]=e),t.props&&n.watchAttrs.forEach(function(a){t.props[a]&&(n.attrs[a]||(n.attrs[a]=[]),n.attrs[a].push({path:e,value:t.props[a]}))}),t}},handleObj:function(t,e){return t},handleProp:function(t,e,n,a){return v.a.isString(t)?this.opValues(t,e,a,!0):t},addOp:function(t,e,n){n.stage||(n.stage=0),t.parameters[n.action]=n.path,t.ops.push(n)},prepareAction:function(t){return t},opValues:function(t,e,n,a){var i=this;if(!v.a.isString(t))return t;if(-1==t.indexOf("{"))return t;n.ops;var r=t.split(/(\{[^}\n\:\;]+)\}/g);return 0==(r=r.map(function(t,e){return""==t?null:"{"!==t.charAt(0)?t:(t=t.substring(1),{type:"value",action:i.prepareAction(t)})}).filter(function(t){return t})).length?null:1==r.length?((r=r[0]).type&&(r.path=e),v.a.isObject(r)&&this.addOp(n,r.path,r),r):a?(r=r.map(function(t,a){return t.type?(t.path=e.concat(a),t.index=a,t.concatParent=!0,t.stage=0,i.addOp(n,e,t),t):t}),this.addOp(n,e,{path:e,type:"concat",ops:r,stage:1}),r):r=r.map(function(t,a){return t.type?(t.path=e.concat(a),t.index=a,t.stage=0,i.addOp(n,e,t),t):t})}},J=function(t,e){var n=Y.run(t);return n=$.run(n,e)};G.parseStringIntoComp={run:function(t,e){return J(t,e)},def:"\n        @obj string \n        transform it into componentsObjects\n    "};var X=window.cu,Q={ctx:{nextUID:0},run:function(t){return(t||"uid")+"_"+this.ctx.nextUID++},makestr:function(t,e){if(v.a.isFunction(t))return t.toString();if(v.a.isString(t)){var n='"';return-1!=t.indexOf("\n")&&(n="`"),-1!=t.indexOf('"')&&(n="`"),"`"==n&&(t=(t=x.a.html(t,{indent_size:2,indent_level:e+1,preserve_newlines:!0,max_preserve_newlines:0,indent_inner_html:!0})).trimStart()),n+t+n}if(v.a.isArray(t)){var a=[];for(var i in t){var r=this.makestr(t[i],e+1);a.push(r)}return"["+a.join(",\n")+"]"}if(v.a.isObjectLike(t)){var s=[];for(var i in t){var o=i,l=this.makestr(t[i],e+1);o.match(/^[a-z0-9$_]+$/)||(o='"'+o+'"'),-1!=l.indexOf("\n")&&!1,s.push(o+":"+l)}return"{"+s.join(",")+"}"}return v.a.isNil(t)?"null":t.toString()},beautify:function(t){return x.a.js_beautify(t,{indent_size:2,indent_level:-1,max_preserve_newlines:1,preserve_newlines:!0})}};X.prettyScode={run:function(t){var e=Q.makestr(t,1);return Q.beautify(e)},def:"\n    ",debug:{ub:Q}};n(1304);var Z=function(t){function e(t){var n;return Object(o.a)(this,e),(n=Object(u.a)(this,Object(c.a)(e).call(this,t))).state={value:""},n.onChange=n.onChange.bind(Object(p.a)(Object(p.a)(n))),n}return Object(d.a)(e,t),Object(l.a)(e,[{key:"onChange",value:function(t){this.setState({value:t.target.value}),this.props.onChange&&this.props.onChange(t)}},{key:"componentWillReceiveProps",value:function(t){void 0!==t.value&&void 0!==t.value.text&&this.setState({value:t.value.text})}},{key:"render",value:function(){var t=Object.assign({},this.props,{value:this.state.value,onChange:this.onChange});return i.a.createElement("input",t,null)}}]),e}(a.Component),tt=n(25),et=n(40),nt=function(t){function e(t){var n;return Object(o.a)(this,e),(n=Object(u.a)(this,Object(c.a)(e).call(this,t))).ref=i.a.createRef(),n.state={id:"salut"},n}return Object(d.a)(e,t),Object(l.a)(e,[{key:"componentDidMount",value:function(){this.makeTree(),this.drawTree(this.props.graph)}},{key:"makeTree",value:function(){this.svg=tt.select(this.ref.current).append("svg"),this.d3cola=et.d3adaptor(tt).avoidOverlaps(!0),this.svg.append("svg:defs").append("svg:marker").attr("id","end-arrow").attr("viewBox","0 -5 10 10").attr("refX",6).attr("markerWidth",3).attr("markerHeight",3).attr("orient","auto").append("svg:path").attr("d","M0,-5L10,0L0,5").attr("fill","#000")}},{key:"drawTree",value:function(t){console.log("drawtree",t);var e=g()(this.ref.current).height(),n=g()(this.ref.current).width();for(var a in t.nodes)t.nodes[a].radius||(t.nodes[a].radius=10*Math.random()+5);var i=0,r=0,s=n,o=e;t.nodes.forEach(function(t){t.height=t.width=3*t.radius});var l=t.nodes.slice(0),u={x:i,y:r,fixed:!0},c=t.nodes.push(u)-1,d={x:i+s,y:r+o,fixed:!0},p=t.nodes.push(d)-1,h=[];for(a=0;a<l.length;a++){var f=l[a].radius;h.push({axis:"x",type:"separation",left:c,right:a,gap:f}),h.push({axis:"y",type:"separation",left:c,right:a,gap:f}),h.push({axis:"x",type:"separation",left:a,right:p,gap:f}),h.push({axis:"y",type:"separation",left:a,right:p,gap:f})}this.svg.attr("width",n).attr("height",e).style("margin-left",0),this.d3cola.size([n,e]),this.d3cola.nodes(t.nodes).links(t.links).constraints(h).avoidOverlaps(!0).linkDistance(60,.5).size([n,e]).flowLayout("y",10).symmetricDiffLinkLengths(5).start(10,20,20);var v=this.svg.selectAll(".link").data(t.links).enter().append("svg:path").attr("class","link"),m=this.svg.selectAll(".node").data(t.nodes).enter().append("circle").attr("class","node").attr("r",function(t){return t.radius}).style("fill",function(t){return"#007abc"}).call(this.d3cola.drag),b=this.svg.selectAll("text").data(t.nodes).enter().append("text").text(function(t){return t.name}).attr("text-anchor","middle");this.d3cola.on("tick",function(){m.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),b.attr("dx",function(t){return t.x}).attr("dy",function(t){return t.y}),v.attr("d",function(t){return"M"+t.target.x+","+t.target.y+"L"+t.source.x+","+t.source.y})})}},{key:"componentWillReceiveProps",value:function(t){console.log("will componentWillReceiveProps",t),this.drawTree(t.graph)}},{key:"render",value:function(){return i.a.createElement("div",{ref:this.ref,id:"#"+this.props.id,style:{height:"100%",width:"100%"}})}}]),e}(a.Component),at=(a.Component,n(48)),it=n.n(at),rt=function(t){function e(t){var n;return Object(o.a)(this,e),(n=Object(u.a)(this,Object(c.a)(e).call(this,t))).ref=i.a.createRef(),n.state={id:"salut"},n}return Object(d.a)(e,t),Object(l.a)(e,[{key:"componentDidMount",value:function(){this.makeTree(),this.drawTree(this.props.graph)}},{key:"makeTree",value:function(){var t=this,e=this.ref.current;this.nodes=new it.a.DataSet,this.edges=new it.a.DataSet;this.network=new it.a.Network(e,{nodes:this.nodes,edges:this.edges},{layout:{randomSeed:2},autoResize:!0,height:"100%",width:"100%"}),this.network.on("click",function(e){var n=t.network.getNodeAt(e.pointer.DOM);console.log(n,t.props),n&&t.props.onClick&&t.props.onClick(n)})}},{key:"drawTree",value:function(t){console.log("drawtree",t);g()(this.ref.current).height(),g()(this.ref.current).width();this.nodes.update(t.nodes),this.edges.clear(),this.edges.add(t.edges)}},{key:"componentWillReceiveProps",value:function(t){console.log("will componentWillReceiveProps",t),this.drawTree(t.graph)}},{key:"render",value:function(){return i.a.createElement("div",{ref:this.ref,id:"#"+this.props.id,style:{height:"100%",width:"100%"}})}}]),e}(a.Component),st=window.cu,ot={myinput:Z,mapdiagram:nt,treemap:rt},lt={makeComponent:function(t,e){var n=this;if(!t)return null;if(v.a.isString(t))return t;if(v.a.isArray(t))return t.map(function(t,e){return n.makeComponent(t,e)});if(!t.componentName)return null;var a=null;t.children&&(a=t.children.map(function(t,e){return n.makeComponent(t,e)}));var r=null;t.props&&(r=v.a.cloneDeep(t.props)),r&&!r.key&&(r.key=e),r||(r={key:e}),"style"==t.componentName&&(a=[v.a.flattenDeep(a).join("")]);var s,o=t.componentName;ot[o]&&(o=ot[o]);try{s=i.a.createElement(o,r,a)}catch(l){console.error(l),s="error"}return s}};st.reactUtils={makeComponent:function(t){return lt.makeComponent(t,1)},def:"\n    ",debug:{ub:lt}};var ut=window.cu,ct={ctx:{nextUID:0},createStore:function(t,e,n){if(t&&t.cache.store)return t.cache.store;var a=function(t){return function(n){var a=n.target.value;e.set(t,a)}},i=function(t){return function(n){if(e[t])return e[t](n)}},r=function(t){return function(n){var a=n.target,i=g()(a).attr(t[1]);if(void 0===i&&(a=g()(a).parents("["+t[1]+"]"),i=g()(a[0]).attr(t[1])),n.stopPropagation(),e[t[0]])return e[t[0]](i,n)}},s=function(t){return function(n){if(e[t])return e[t](n)}},o={};for(var l in n.change)o[l]=a(n.change[l]);for(var l in n.run)o[l]=i(n.run[l]);for(var l in n.runWith)o[l]=r(n.runWith[l]);for(var l in n.runWithParam)o[l]=s(n.runWithParam[l]);return t&&(t.cache.store=o),o}};ut.store={run:function(t){return ct.run(t)},get:function(t,e,n){return ct.createStore(t,e,n)},def:"\n    ",debug:{ub:ct}};var dt=window.cu,pt={ctx:{payload:{data:{items:{},subs:{}},src:{getItem:function(t){},getSubs:function(t){}},tpls:[],registerTpl:function(t,e){this.tpls.push(t.path)},cases:[function(t){if(!t.obj.item){var e=t.obj.id,n=pt.ctx.payload.data.items[e];return n||(n={text:O.a.company.catchPhrase(),id:e},pt.ctx.payload.setter&&pt.ctx.payload.setter(["items",e],v.a.cloneDeep(n))),t.obj.item=n,"applied"}},function(t){if(!t.obj.subs&&t.obj.item&&t.obj.level<4){var e=t.obj,n=t.obj.id,a=pt.ctx.payload.data.subs[n];if(!a&&!pt.ctx.payload.generated){a={};for(var i=0;i<4;i++){var r=O.a.random.uuid(),s=null;1==e.level&&(s=O.a.random.arrayElement([null,"columns"]));var o={id:r,level:t.obj.level+1,tpl:s};a[r]=o}pt.ctx.payload.setter&&pt.ctx.payload.setter(["subs",n],v.a.cloneDeep(a))}return a||(a={}),t.obj.subs=a,t.subs=a,"applied"}}]},tb:{}},run:function(t,e){var n=this.ctx.payload;this.ctx.payload.attrs=e||[];var a=this.it(t,[]);return this.ctx.payload=n,a},it:function(t,e){var n={oldPayload:null,obj:t,sub:t,master:this,path:e,values:{},ops:[]};for(var a in this.prepare(n),n.subs){var i=this.it(n.subs[a],e.concat([a]));n.values[a]=i}return this.integrate(n)},addPayload:function(t,e){t.oldPayload||(t.oldPayload=this.ctx.payload,this.ctx.payload=Object.create(this.ctx.payload)),Object.assign(this.ctx.payload,e)},prepare:function(t){for(var e=this.ctx.payload.cases,n=!0,a=0;n&&a<5;)for(var i in n=!1,a++,e){if("applied"==(0,e[i])(t)){n=!0,!0;break}}},integrate:function(t){if(t.ops.length)for(var e in t.ops){var n=t.ops[e];this.ctx.payload[n.name](n.args,this)}return t.oldPayload&&(this.ctx.payload=t.oldPayload),t.obj}};dt.testDataGenerator={run:function(t,e,n,a){return pt.ctx.payload.data=e,pt.ctx.payload.setter=a,pt.ctx.payload.generated=n,pt.run({id:t||"root",level:0},[])},init:function(){pt.ctx.tb.parser=dt.tplObjParse,pt.ctx.tb.reactAssembler=dt.reactAssembler},def:"\n    ",debug:{ub:pt}};var ht=window.cu,ft={ctx:{tb:{}},run:function(t){var e=t;return e=this.ctx.tb.parser.run(e,["comp"])}};ht.testMolds={run:function(t){return ft.run(t,[])},init:function(){ft.ctx.tb.parser=ht.tplObjParse,ft.ctx.tb.reactAssembler=ht.reactAssembler},def:"\n    ",debug:{ub:ft}};var vt=window.cu,mt={ctx:{tb:{},wallet:{}},run:function(t){var e=t;return e=this.ctx.tb.parser.run(e,["comp"])},parseTpl:function(t){return this.ctx.tb.parser.run(t,["comp"])},renderTpl:function(t,e,n){return this.ctx.tb.reactAssembler.run(t,e,n)},assembleTpl:function(t,e){return v.a.isString(t)&&(t=v.a.get(this.ctx.payload.molds,t)),this.ctx.tb.reactAssembler.run(t,e,function(t,e){var n=v.a.get(t,e);return n.node?n.node:n})},iterateBubbles:function(t,e){if(void 0==e&&(e=0),!(e&&e>5)){t=t||this.ctx.payload.bubbles;for(var n=!1,a=0;a<t.length;a++){var i=t[a];if(!i.isReady){var r=!0;for(var s in i)!i[s].tpl||(i[s].isRegistered||(i[s].isRegistered=!0,this.addBubble(i[s])),i[s].isReady)||(r=!1);if(r){var o=mt.assembleTpl(i.tpl,i);i.node=o,i.isReady=!0,i.computedAtStep=this.ctx.payload.step++,n=!0}}}n&&this.iterateBubbles(t,e+1)}},addBubble:function(t){t.uid=vt.uids.run("bubble"),t.addedAtStep=this.ctx.payload.step,this.ctx.payload.bubbles.push(t)},start:function(t){this.ctx.payload={bubbles:[],molds:t,step:0}}},gt={x:"\n            <div><input id='order' syncwith={value} />\n            {value} \n            <div id='menu'> </div>\n            <div id='bar'> </div>\n            <div id='window' > {content}</div>\n            </div>\n        ",y:"salut {#test} salutare din alt template "};window.salut={value:"elefant"};vt.testTplAssembing={run:function(){return mt.start(mt.parseTpl(v.a.cloneDeep(gt))),mt.addBubble({tpl:"x",value:"salutare",value_setter:function(){console.log("setting")},content:{tpl:"y","#test":"yo"}}),mt.iterateBubbles(),mt.ctx.payload.bubbles[0].node},init:function(){mt.ctx.tb.parser=vt.tplObjParse,mt.ctx.tb.reactAssembler=vt.reactAssembler},def:"\n    ",debug:{ub:mt}};var bt=window.cu,wt={ctx:{payload:{tpls:{},registerTpl:function(t,e,n){e.obj.uid=bt.uids.run(),e.obj.mold.props&&(e.obj.mold.props.tplId=e.obj.uid),this.tpls[t.path.join(".")]=e.obj.uid}},tb:{}},run:function(t,e){var n=this.ctx.payload;this.ctx.payload.attrs=e;var a=this.it(t,[]);return this.ctx.payload=n,a},it:function(t,e){var n={oldPayload:null,obj:t,sub:t,master:this,path:e,values:t,ops:[]};for(var a in this.prepare(n),n.sub){var i=this.it(n.sub[a],e.concat(a));n.values[a]=i}return this.integrate(n)},addPayload:function(t,e){t.oldPayload||(t.oldPayload=this.ctx.payload,this.ctx.payload=Object.create(this.ctx.payload)),Object.assign(this.ctx.payload,e)},prepare:function(t){for(var e=this,n={isString:function(t){return t.obj&&t.obj.trim},isUnparsedTpl:function(t){return t.obj&&t.obj.html&&!t.obj.mold},isCollection:function(t){return t.obj&&t.obj.isCollection},isObjTpl:function(t){return t.obj&&t.obj.VALUE}},a={isString:function(t){return t.values=t.obj={html:t.obj},t.sub=[],"applied"},isUnparsedTpl:function(t){t.sub=[];var n=Object.assign({},t.obj,{mold:e.ctx.tb.parseHtml.run(t.obj.html,e.ctx.payload.attrs)});return t.values=t.obj=n,t.ops.push({name:"registerTpl",path:t.path}),"applied"},isCollection:function(t){var e={};for(var n in t.obj)"isCollection"!=n&&(e[n]={VALUE:t.obj[n]});return t.values={},t.sub=e,"applied"},isObjTpl:function(t){t.sub=[];var n=Object.assign({},t.obj,{mold:e.ctx.tb.parseObj.run(t.obj.VALUE,e.ctx.payload.attrs)});return t.values=t.obj=n,t.ops.push({name:"registerTpl",path:t.path}),"applied"}},i=!0,r=0;i&&r<5;)for(var s in i=!1,r++,a){if((0,n[s])(t))if("applied"==(0,a[s])(t)){i=!0,!0;break}}},integrate:function(t){if(t.ops.length)for(var e in t.ops){var n=t.ops[e];this.ctx.payload[n.name](n,t,this)}return t.oldPayload&&(this.ctx.payload=t.oldPayload),t.values}};bt.tplObjParse={run:function(t,e){return wt.run(t,e)},init:function(){wt.ctx.tb.parseHtml=bt.parseStringIntoComp,wt.ctx.tb.parseObj=bt.parseObjIntoMold},def:"\n        @obj with string or .html slots \n        transform it into componentsObjects\n    ",debug:{ub:wt}};var _t=window.cu,yt={ctx:{tb:{},payload1:{tplsMapping:["map","topic","item","entry"],defaultTpl:"item",usedGlobalStyles:{},addSubs:function(t,e,n){e.obj.subs=e.values;var a=e.obj,i=[];for(var r in e.values){var s=e.values[r];s.nodes&&s.nodes.card&&i.push(s.nodes.card)}i&&(e.obj.nodes.content=n.ctx.payload.useTemplate(a.tpl+".content",{subs:i}));var o=e.obj.nodes;e.obj.nodes.card=n.ctx.payload.useTemplate(a.tpl+".card",o)},useTemplate:function(t,e,n){if(!n)for(var a=t.split("."),i=yt.ctx.wallet.molds,r=0;r<a.length;r++){var s=a[r];if(i[s].globalStyle){var o=i[s].globalStyle.uid;this.usedGlobalStyles[o]={parent:i[s]}}if(!i[s])break;i=i[s]}var l=v.a.get(yt.ctx.wallet.molds,t);return yt.ctx.tb.reactAssembler.run(l,e)},cases:[function(t,e){if(!t.obj.data){var n=e.ctx.payload.tplsMapping[t.obj.level]||e.ctx.payload.defaultTpl,a={tpl:t.obj.tpl||n,data:t.obj.item,level:t.obj.level,nodes:{}};return t.subs=t.obj.subs,t.obj=a,t.ops.push({name:"addSubs",args:"subs"}),"applied"}},function(t,e){if(!t.obj.nodes.title){var n=t.obj,a=(yt.ctx.wallet.molds.item.title,{title:t.obj.data.text,level:t.obj.level});return t.obj.nodes.title=e.ctx.payload.useTemplate(n.tpl+".title",a),"applied"}}]}},getMolds:function(t){return this.ctx.tb.parser.run(t)},buildTpls:function(t){return this.ctx.tb.iterator.run(t,{payload:this.ctx.payload1})},addGlobalStyles:function(t,e){var n,a=[];e=e||this.ctx.payload1.usedGlobalStyles;var i=function(t){return"[tplid='"+n[t].uid+"']"},r=function(t,e){return n[e]?i(e):"*"==e?Object.keys(n).filter(function(t){return"globalStyle"!=t}).map(function(t){return i(t)}).join(","):v.a.get(t,e)},s={color:"red"};for(var o in e){n=e[o].parent;var l=yt.ctx.tb.reactAssembler.run(n.globalStyle,s,r);a.push(l)}return a.length&&(t=[t,a]),t}};_t.treeCardsBuilder={run:function(t){var e=yt.ctx.wallet={molds:t.molds,repo:t.data};Object.assign(yt.ctx.payload1,{tplsMapping:t.mappings.tplsMapping,defaultTpl:t.mappings.defaultTpl,usedGlobalStyles:{}}),e.tpls=yt.buildTpls(e.repo);var n=e.tpls.nodes.card;return n=yt.addGlobalStyles(n)},init:function(){yt.ctx.tb.parser=_t.tplObjParse,yt.ctx.tb.reactAssembler=_t.reactAssembler,yt.ctx.tb.iterator=_t.treeIterator},def:"\n    ",debug:{ub:yt}};var xt=window.cu,kt={ctx:{},run:function(t,e){var n=this.ctx.payload;this.ctx.payload.attrs=e;var a=this.it(t,[]);return this.ctx.payload=n,a},it:function(t,e){var n={oldPayload:null,obj:t,sub:t,master:this,path:e,values:{},ops:[]};for(var a in this.prepare(n),n.subs){var i=this.it(n.subs[a],e.concat([a]));n.values[a]=i}return this.integrate(n)},addPayload:function(t,e){t.oldPayload||(t.oldPayload=this.ctx.payload,this.ctx.payload=Object.create(this.ctx.payload)),Object.assign(this.ctx.payload,e)},prepare:function(t){for(var e=this.ctx.payload.cases,n=!0,a=0;n&&a<5;)for(var i in n=!1,a++,e){if("applied"==(0,e[i])(t,this)){n=!0,!0;break}}},integrate:function(t){if(t.ops.length)for(var e in t.ops){var n=t.ops[e];this.ctx.payload[n.name](n.args,t,this)}return t.oldPayload&&(this.ctx.payload=t.oldPayload),t.obj}};xt.treeIterator={run:function(t,e){var n=Object.create(kt);return n.ctx=e,e.payload||(e.payload={cases:[]}),n.run(t,[])},init:function(){},def:"\n    ",debug:{ub:kt}};var Ot=window.cu,It={ctx:{nextUID:0},run:function(t){return(t||"uid")+"_"+this.ctx.nextUID++}};Ot.uids={run:function(t){return It.run(t)},def:"\n    ",debug:{ub:It}};var Pt=window.cu;for(var Ct in Pt.DataManager=window.DataManager,Pt)Pt[Ct].init&&Pt[Ct].init();for(var Ct in Pt.tests={wallet:{test:{},pins:{},pending:[]},pin:function(t,e){this.wallet.pins[t]=e},get:function(t){var e=v.a.get(this.wallet.pins,t);return e||(e=v.a.get(this.wallet.test,t)),e}},Pt)Pt[Ct].test&&Pt.tests.wallet.pending.push(Ct);for(var Tt=0;Tt<5&&Pt.tests.wallet.pending.length;){var At=Pt.tests.wallet.pending.shift();Tt++;var jt={},St=void 0;try{St=Pt[At].test(jt)}catch(qt){console.log("error when running ",At,qt)}if("pending"!=St){if(console.group("test for ",At),Pt.tests.wallet.test[At]=jt,St&&console.log(St),Object.keys(jt))for(var At in jt)console.log(At,jt[At]);console.groupEnd()}else Pt.tests.wallet.pending.push(At)}Pt.tests.wallet.pending.length&&console.error("error with tests : ");var Mt=P,Dt=n(74),Vt=n.n(Dt);n(1311),window.fns={};window.$=g.a;window.ctxpins={};var Et=window.DataManager;Et.newAPI=!0;_.init(Et);window.$=g.a;var Lt=window.myUB={};Et.setCombined("fnsub",{loader:{get:function(){var t=Lt;t.fnsub&&t.fnsub.isReady||(this.make(t,"fnsub","ub.fnsub",{old:t.fnsub}),this.setupAll(t)),t.fnsub.makeUb("mapview","ub.mapView",{"tb.db":"db",state:"antsDbState"}),t.fnsub.makeUb("antsDbState","ub.antsDbState",{"tb.db":"db"}),t.fnsub.makeUb("bridgeLoader","ub.loaders.bridge",{"tb.db":"db"}),t.fnsub.makeUb("searchLoader","ub.loaders.search",{"tb.db":"db"}),t.fnsub.makeUb("hudView","ub.loaders.hud",{"tb.db":"db"}),t.fnsub.makeUb("db","ub.db",{}),t.fnsub.makeUb("afterRenderActions","ub.afterRenderActions",{}),t.fnsub.makeUb("shop","ub.actionshops",{"tb.db":"db"}),t.fnsub.setupAll()},setupAll:function(t){for(var e in t)t[e].goSetup&&this.setup(t,t[e]);return!0},make:function(t,e,n,a){var i=Object.create(Et.getValue(n));i.goSetup=!0,i.extra=a,i.uid=Mt.uids.run(),t[e]?v.a.merge(t[e],i):t[e]=i},setup:function(t,e){delete e.goSetup;var n={};for(var a in e.extra){var i=v.a.isString(e.extra[a])?v.a.get(t,e.extra[a]):e.extra[a];i||(i={},v.a.set(t,e.extra[a],i)),v.a.set(n,a,i)}e.setup&&e.setup(n),e.isReady=!0},autostart:!0}}),Et.setCombined("ub.afterRenderActions",{setup:function(t){v.a.merge(this,t),this.wallet={actions:[]}},add:function(t){this.wallet.actions.push(t)},runAll:function(){var t=this.wallet.actions;for(var e in this.wallet.actions=[],t)this[t[e]]&&this[t[e]]()},scrollIntoViewSelected:function(){var t=g()(".content.selected").get(0);t&&t.scrollIntoViewIfNeeded(!1)},alertAnimation:function(){g()("body.alert").length||(g()("body").addClass("alert"),window.setTimeout(function(){g()("body").removeClass("alert")},5e3))}}),Et.setCombined("ub.antsDbState",{setup:function(t){var e=this;v.a.merge(this,t),this.wallet={state:{prefix:"ants",id:"antsDbState",nextId:1}},Lt.fnsub.onready(this.tb.db).then(function(){return e.tb.db.loadItems(["antsDbState"])}).catch(function(){}).then(function(t){t[0]?(e.wallet.state=t[0],e.isReady=!0):e.tb.db.saveItems(e.uid,[e.wallet.state])})},getId:function(){return this.wallet.state.nextId++,this.tb.db.request_save(this.uid,[this.wallet.state],100),"ant_"+this.wallet.state.nextId},getTime:function(){return(new Date).getTime()}}),Lt.fnsub={subs:[],waiting:{},makeUb:function(t,e,n){this.subs.push([t,e,n])},onready:function(t){var e={},n=new Promise(function(t){e.resolve=t});return this.waiting[t.uid]||(this.waiting[t.uid]=[]),this.waiting[t.uid].push(e),n}},Et.setCombined("ub.antsDbState",{setup:function(t){var e=this;v.a.merge(this,t),this.wallet={state:{prefix:"ants",id:"antsDbState",nextId:1}},Lt.fnsub.onready(this.tb.db).then(function(){return e.tb.db.loadItems(["antsDbState"])}).catch(function(){}).then(function(t){t[0]?(e.wallet.state=t[0],e.isReady=!0):e.tb.db.saveItems(e.uid,[e.wallet.state])})},getId:function(){return this.wallet.state.nextId++,this.tb.db.request_save(this.uid,[this.wallet.state],100),"ant_"+this.wallet.state.nextId},getTime:function(){return(new Date).getTime()}}),Et.setCombined("ub.fnsub",{setup:function(t){v.a.merge(this,t),this.fns=t.fns||Lt,this.waiting=this.waiting||{};var e=!1;if(this.old&&this.old.subs){for(var n in this.old.subs){var a=this.old.subs[n];this.makeUb(a[0],a[1],a[2])}e=!0,delete this.subs}if(t.ubs){for(var n in t.ubs){var i=t.ubs[n];this.makeUb(i.name,i.path,i.extra)}e=!0}e&&this.setupAll()},detach:function(){var t=Mt.uids.run(),e="internal_"+t;this.makeUb(e,"ub.fnsub",{id:t,fns:{},parent:this}),this.setupAll();var n=this.fns[e];return this.fns[e].fns.fnsub=n,n.getFromParent("db"),n.fns},getFromParent:function(t){for(var e in v.a.isString(t)&&(t=[t]),t){var n=t[e]||e,a=this.parent.fns[n];this.fns[n]=a}},addUb:function(t){var e=this;return v.a.isArray(t)?(t.forEach(function(t){v.a.isString(t)||!t.name?e.getFromParent(t):e.makeUb(t.name,t.path,t.extra)}),void this.setupAll()):(this.makeUb(t.name,t.path,t.extra),this.setupAll(),this.fns[t.name])},addUbs:function(t){this.addUb(Object.values(t))},setupAll:function(){var t=this.fns;for(var e in t)t[e].goSetup&&this.setupUb(t[e]);return!0},makeUb:function(t,e,n,a){a=a||this.fns;var i=v.a.isString(e)?Object.create(Et.getValue(e)):e;i.goSetup=!0,i.extra=n,i.uid=a[t]&&a[t].id?a[t].uid:n.id||Mt.uids.run(),a[t]?v.a.merge(a[t],i):a[t]=i},setupUb:function(t,e){e=e||this.fns,delete t.goSetup;var n={};for(var a in t.extra){var i=v.a.isString(t.extra[a])?v.a.get(e,t.extra[a]):t.extra[a];i||(i={uid:Mt.uids.run()},v.a.set(e,t.extra[a],i)),v.a.set(n,a,i)}t.setup&&t.setup(n),t.isReady=!0,this.waiting[t.uid]&&(this.waiting[t.uid].forEach(function(t){t.resolve()}),this.waiting[t.uid]=[])},onready:function(t){if(t.isReady)return Promise.resolve();var e={},n=new Promise(function(t){e.resolve=t});return this.waiting[t.uid]||(this.waiting[t.uid]=[]),this.waiting[t.uid].push(e),n}}),Et.setCombined("ub.db",{setup:function(){this.db=Mt.db.run("thisdb"),this.timers={}},destroy:function(){this.db.destroy()},request_save:function(t,e,n){var a=this;this.timers[t]&&window.clearTimeout(this.timers[t]),this.timers[t]=window.setTimeout(function(){a.saveItems(t,e)},n||1e3)},saveItems:function(t,e){this.timers[t]&&window.clearTimeout(this.timers[t]);var n=v.a.isArray(e)?e:e.getItemsToSave(),a=[];for(var i in n)a.push(this.db.save(n[i],n[i].id));return Promise.all(a)},loadItems:function(t,e){var n=v.a.isArray(t)?t:t.getItemsToSave(),a=[];for(var i in e=e||{},n)e[i]?a.push(Promise.resolve(e[i])):a.push(this.db.load(n[i]));return Promise.all(a)},searchText:function(t){return this.db.searchText(t)},loadFilter:function(t,e,n){return this.db.loadfilter(t,e,n)},loadFromIndex:function(t){var e=t.selector,n=t.sortField,a=t.sortDir,i=t.count,r=t.index;return this.db.loadFromIndex(e,n,a,i,r)}}),Et.setCombined("actionShop.actions",{makePreview:{path:"actionshops.generatePreviewItem",opName:"main",guards:{},args:{id:"antId",items:"items",save:"save"},argsArray:{antId:"1"}},makeTreeMap:{path:"actionshops.makeTreeMap",opName:"main",guards:{},args:{id:"antId",items:"items"}}}),Et.setCombined("ub.actionshops",{setup:function(){this.shops={},this.ub=Lt.fnsub.detach()},go:function(t,e,n){var a=Et.getWallet("actionShop.actions")[t],i=a.path,r=a.opName,s={};for(var o in a.args){var l=a.args[o],u=v.a.get(e,o);void 0!==u&&v.a.set(s,l,u)}return this.run(i,r,s,n)},run:function(t,e,n,a){return this.get(t).run(e,n,a)},get:function(t){return this.shops[t]?this.shops[t]:this.createShop(t)},createShop:function(t,e){var n=Et.getValue(t);(n=v.a.cloneDeep(n)).setup=Mt.actionFlow.setupFlow;var a={name:t,path:n,extra:{"tb.db":"db"}};e&&v.a.merge(a.extra,e);var i=this.ub.fnsub.addUb(a);return this.shops[t]=i,i}}),Et.setCombined("ub.values",{setup:function(t){Object.assign(this,t)},set:function(t,e){v.a.set(this.data,t,e)},get:function(t){return v.a.get(this.data,t)},trigger:function(t,e,n){console.log("triggered",{name:t,value:e,partial:n}),this.set(t,e);var a=this.data.blockcfg.loaderPath;Et.markChangeOn(a,!1,!0)}}),Et.setCombined("actionsBundle.tree",{tree:{treeTemplate:{run:function(t,e){var n=[];this.processNode(t.data,t.tpl,n),e.actions.pinTo(t,n,e)},processNode:function(t,e,n){var a=Mt.moldAssembler.run(e,t);for(var i in t.subs)this.processNode(t.subs[i],e,n);return n.push(a),a}},makeTree:{run:function(t,e){var n=this.makeNode(t,t.startId,{startNode:!0},0);return e.actions.pinTo(t,n,e),n},makeNode:function(t,e,n,a){var i=t.rels[e],r={subs:{},item:t.items[e],info:n,count:0,level:a};if(!t.maxLevel||t.maxLevel>a)for(var s in i)r.subs[s]=this.makeNode(t,s,i[s],a+1),r.count++;return r}}}}),Et.setCombined("actionsBundle.generics",{isCollection:!0,fields:{field:function(t,e){var n=t.defaultValue||"";t.item&&t.item.fields&&t.item.fields[t.field]&&(n=t.item.fields[t.field]),e.actions.pinTo(t,n,e)}},ops:{ops:function(t,e){console.log("test"),e.master.run(t.ops)}},molds:{makeMold:function(t,e){var n=Mt.tplObjParse.run(v.a.cloneDeep(t.tpls));e.actions.pinTo(t,n,e)}}}),Et.setCombined("actionshops.card",{data:{tpls:{card:"<div>{title} {content}<div>",title:"<div> {item.title} </div>",item:"<div> {item.title} </div>"},content:"salut",item:{title:"elefant"}},opsCollection:{main:[{name:"salut",type:"runop",op:"makeCard",prefix:"temp"}],setup:{molds:{name:"molds",type:"makeMold",input:{tpls:"tpls"}},ops:{name:"makeCard",type:"combineMoldInOps",outcome:"card",input:{molds:"molds"},list:"card,title,item"}}},actions:{import:"actionsBundle.generics",my:{runop:function(t,e){e.master.run(t.op,t.value||{},{outcome:[function(t,e,n){console.log("DONE",t,e)}]},{prefix:t.prefix})},combineMoldInOps:function(t,e){var n=t.list.split(","),a={};n.forEach(function(e){a[e]=v.a.get(t.molds,e)});var i=[],r={};for(var s in a){var o=a[s],l={type:"useTpl",name:null,tpl:null,input:{}},u=s==t.outcome?"outcome":s;l.name=u,l.tpl=o;var c=o.mold.parameters;for(var s in c)l.input[s]=s,r[s]=!0;i.push(l)}for(var s in i)delete r[i[s].name];console.log(r),console.log("OPS",i),e.master.ctx.opsCollection[t.name]=i,console.log("master",e.master)}}}}),Et.setCombined("actionshops.generatePrview",{ops:[{name:"allmaps",type:"searchItems",filter:{type:"map"}},{name:"previewIds",type:"generatePreviewItems",input:{maps:"allmaps"}},{name:"previews",type:"loadItems",input:{ids:"previewIds"}},{type:"log",input:{maps:"allmaps",previewIds:"previewIds",no:"noPreviews"}},{name:"noPreviews",type:"getItemsWithsNoPreview",input:{previews:"previews",ids:"allmaps"}},{type:"iterateList",input:{items:"noPreviews"}}],actions:{import:"actionsBundle.generics",myx:{iterateList:function(t,e){var n=t.items,a=0;!function t(){if(!(++a>=n.length))return function(t){return new Promise(function(n){e.tb.generatePreview.run("main",t,{DONE:[function(t){console.log("done",t),n(t)}]})})}(n[a]).then(function(t){}).then(t)}()},generatePreviewItems:function(t,e){var n=t.maps.map(function(t){return"preview_"+t.id});return e.actions.pinTo(t,n,e),n},getItemsWithsNoPreview:function(t,e){var n=t.previews,a=t.ids,i=[];for(var r in n)n[r]||i.push({antId:a[r].id});e.actions.pinTo(t,i,e)}}}}),Et.setCombined("actionshops.getRecentPreview",{ops:[{name:"previewMaps",type:"loadFromIndex",selector:{type:"previewItem"},sortField:"updatedAt",sortDir:"desc",count:3,index:["updatedAt","type"],append:"items"},{type:"log",input:{items:"list",maps:"previewMaps",subitems:"subitems"}},{name:"subids",type:"selectIds",input:{src:"previewMaps"},paths:["","rels.allSubs","id"]},{name:"subitems",append:"items",type:"loadItems",input:{ids:"subids"}},{name:"list",type:"runopOnList",input:{subitems:"subitems",list:"previewMaps",repo:"items"},op:"map",result:"outcome"}],opsCollection:{line:[{name:"outcome",type:"useTpl",input:{item:"item",time:"time",tpl:"molds.line"}},{name:"time",type:"makeTime",input:{timestamp:"item.placedAt"}}],map:[{type:"debug"},{type:"log",input:{subitems:"subitems",content:"xcontent"}},{name:"outcome",type:"useTpl",input:{item:"item",tpl:"molds.map",content:"xcontent"}},{name:"subitems",type:"getSubitems",input:{items:"items",subs:"item.rels.allSubs"}},{name:"xcontent",type:"runopOnList",input:{list:"subitems"},op:"line",result:"outcome"}],setup:[{name:"molds",input:{tpls:"tpls"},type:"makeMold"}]},data:{tpls:{line:"<div class='adv_entry'><span class='time'>{time}</span> {item.text}</div>",map:"<div class='adv_map'>{item.text} <div class='content'> {content}</div></div>"}},actions:{molds:{makeMold:function(t,e){var n=Mt.tplObjParse.run(v.a.cloneDeep(t.tpls));e.actions.pinTo(t,n,e)}},myx:{debug:function(t,e){console.log("debug",e.privat.xcontent,e.ops)},getSubitems:function(t,e){var n=[];for(var a in t.subs)n.push(t.items[a]);n.sort(function(t,e){return e.placedAt-t.placedAt}),console.log("getSubitems",t.subs,n),e.actions.pinTo(t,n,e)},makeTime:function(t,e){var n=Vt()(t.timestamp).fromNow();e.actions.pinTo(t,n,e)},runop:function(t,e){return new Promise(function(n,a){console.log("runio",t.xcontent),e.master.run(t.op,{},{outcome:[function(t,e,a){n(e)}]},{privat:v.a.cloneDeep(t)})})},runopOnList:function(t,e){var n=[],a=t.list,i=(t.op,t.name,-1);(function r(){if(!(++i>=a.length)){var s=Object.assign({},v.a.cloneDeep(t),{item:a[i],index:i});return e.actions.runop(s,e).then(function(t){n.push(t)}).then(r)}})().then(function(){e.actions.pinTo(t,n,e)})},selectIds:function(t,e){for(var n=t.paths,a=[t.src],i=0;i<n.length;i++){var r=n[i],s=[];for(var o in a){var l=void 0;if(l=r?v.a.get(a[o],r):a[o]){var u=v.a.isObject(l)?v.a.values(l):l;s=s.concat(u)}}a=s}e.actions.pinTo(t,a,e)}}}}),window.moment=Vt.a,Et.setCombined("actionshops.getListWithoutPreview",{ops:[{name:"allmaps",type:"searchItems",filter:{type:"map"}},{name:"previewIds",type:"generatePreviewItems",input:{maps:"allmaps"}},{name:"noPreviews",extra:{withPreview:"withPreview"},type:"getItemsWithsNoPreview",input:{previews:"previews",ids:"allmaps"}},{name:"previews",type:"loadItems",input:{ids:"previewIds"}},{type:"log",input:{previews:"previews"}}],actions:{import:"actionsBundle.generics",myx:{generatePreviewItems:function(t,e){var n=t.maps.map(function(t){return"preview_"+t.id});return e.actions.pinTo(t,n,e),n},getItemsWithsNoPreview:function(t,e){var n=t.previews,a=t.ids,i=[],r=[];for(var s in n)n[s]?r.push(n[s]):i.push({antId:a[s].id});console.log("items without preview",{no:i,wt:r}),e.actions.pinTo(t,i,e)}}}}),Et.setCombined("actionshops.generatePreviewItem",{data:{antId:"ant_2",tpls:{obj:{isCollection:!0,preview:{"rels.allSubs":"{latestSubs}",text:"{text}",id:"preview_{mapId}",mapId:"{mapId}",summary:"{summary}",type:"previewItem",updatedAt:"{updatedAt}"}}}},x:{go:"getField",on:"",use:{item:"root"},field:"summary",defaultValue:""},ops:[{type:"log",input:{outcome:"previewAnt"}},{name:"root",append:"items",input:{id:"antId"},type:"loadItem"},{name:"subs",append:"items",input:{ids:"root.rels.allSubs"},type:"loadItems"},{name:"latest",extra:{date:"updatedAt"},type:"getLatestSubs",input:{root:"root",items:"subs"},count:4},{name:"summary",type:"field",input:{item:"root"},field:"summary",defaultValue:""},{name:"previewAnt",type:"useTpl",input:{text:"root.text",tpl:"molds.obj.preview",latestSubs:"latest",mapId:"antId"}},{type:"fn",input:{fn:"save",item:"previewAnt"}}],valuesChain:{antId:{unset:"root,subs,latest,summary,previewAnt",reset:{save:{value:function(t){}}}}},opsCollection:{setup:[{name:"molds",input:{tpls:"tpls"},type:"makeMold"}],test:[{type:"log",input:{outcome:"previewAnt"}},{name:"root.fields.summary",type:"staticValue",input:{root:"root",value:"summary"}}]},actions:{bundle:"actionsBundle.generics",items:{getLatestSubs:function(t,e){var n=t.items;n.sort(function(t,e){return e.placedAt-t.placedAt});var a,i=n.slice(0,t.count);a=i.length>0?i[0].placedAt:t.root.startedAt,t.extra.date&&e.actions.pinTo({pin:t.extra.date},a,e);var r={};for(var s in i)r[i[s].id]={id:i[s].id,position:s};e.actions.pinTo(t,r,e)}}}}),Et.setCombined("actionshops.makeTreeMap",{data:{antId:"ant_2",tpls:{main:"<treemap graph={graph} on_click={actions.select} />"}},ops:[{name:"root",append:"items",input:{id:"antId"},type:"loadItem"},{name:"subs",append:"items",input:{ids:"root.rels.allSubs"},type:"loadItems"},{type:"log",input:{items:"items",graph:"graph"}},{type:"useTpl",name:"nodes",input:{tpl:"molds.main",graph:"graph"}},{type:"getNodesVis",name:"graph",input:{_s:"subs",startId:"root.id",items:"items",subs:"root.rels.sub"}},{type:"getActions",name:"actions"}],valuesChain:{antId:{unset:"root,subs,graph,nodes",reset:{save:{value:function(t){}}}}},opsCollection:{setup:[{name:"molds",input:{tpls:"tpls"},type:"makeMold"}]},actions:{bundle:"actionsBundle.generics",items:{getActions:function(t,e){var n=Mt.store.get(null,Rt,{runWithParam:{select:"select"}});e.actions.pinTo(t,n,e)},getNodes:function(t,e){var n={nodes:[],links:[]};!function e(a,i,r){if(!(r>3)){var s=n.nodes.push({name:t.items[a].text,radius:Math.max(5,40-10*r)})-1;for(var o in null!==i&&n.links.push({target:s,source:i,value:1}),t.subs[a])e(o,s,r+1)}}(t.startId,null,0),console.log("graph",n),e.actions.pinTo(t,n,e)},getNodesVis:function(t,e){var n={nodes:[],edges:[]};!function e(a,i,r,s){n.nodes.length;var o=n.nodes.push({id:a,label:t.items[a].text});for(var l in null!==i&&n.edges.push({to:a,from:s}),t.subs[a])e(l,o,r+1,a)}(t.startId,null,0),n.seed=2,e.actions.pinTo(t,n,e)}}}});var Rt={showMindMap:function(t){Et.runOnLoader("antsView.formPanel.nodes","change",{id:t}),Et.set("workingant.viewState.path","antsView.formPanel.nodes"),Et.markChangeOn("workingant.viewState",!1,!0)},showhud:function(){var t=Et.getValue("workingant.viewState.path");t="antView.map.nodes"!==t?"map":"bridge",this.goToCard(t)},placeorder:function(t){13===t.which&&(Ut.place(),Et.set("workingant.data.input",{text:""}),Ut.restart())},set:function(t,e){Et.set(t,e)},parseinput:function(){var t=Et.getValue("workingant.data.input");v.a.isString(t)&&Ut.parse(t)},select:function(t){console.log("selecting",t),Ut.change({parent:t}),Et.set("repo.uistate.selected",t),g()("#order").focus(),Lt.afterRenderActions.add("scrollIntoViewSelected")},goToInfo:function(t){return Et.set("antsView.hudPanel.cfg.antId",t),this.goToCard("info"),!1},goToCard:function(t){var e={bridge:"antView.bridge.nodes",map:"antView.map.nodes",info:"antsView.hudPanel.nodes"}[t];"bridge"==t&&Lt.bridgeLoader.loadBridge(),Et.set("workingant.viewState.path",e)},selectMap:function(t){console.log("selecting map",t),Lt.mapview.loadMap(t),this.goToCard("map")}};Et.setTrigger("workingant.data.input","ada",{run:Rt.parseinput}),Et.setCombined("ub.menu",{setup:function(){},getAll:function(){return Et.getValue("data.menu")},set:function(t,e){Et.set(["data.menu",t].join("."),e)},showMenu:function(){this.set("isvisible",!0)},hideMenu:function(){this.set("isvisible",!1)},addEntries:function(){}}),Et.setCombined("ub.flow",{start:function(){this.wallet={step:{createdAt:(new Date).getTime()}}},parse:function(t){0==t.indexOf(".s")?(this.wallet.step.showSearch=!0,this.wallet.step.noPlace=!0):(this.wallet.step.showSearch=!1,this.wallet.step.noPlace=!1);var e=t.match(/^(\.[^\s]+\s+)*/),n=t.substr(e[0].length);e[0].trim().split(" ");this.wallet.step.editStartedAt||(this.wallet.step.firstCharAt=(new Date).getTime()),this.wallet.step.text=n},place:function(){this.wallet.text,Lt.antsDbState.getId(),this.wallet.step.createdAt,this.wallet.step.firstCharAt,(new Date).getTime(),this.getParent()}});var Ut={start:function(){this.wallet={step:{},actions:this.main,parser:this.parser}},restart:function(){var t=this.wallet.step;this.wallet={step:{parent:t.parent},startedAt:(new Date).getTime(),actions:this.main,parser:this.parser}},parse:function(t){this.wallet.parser.parse(this.wallet,t)},change:function(t){this.wallet.actions.change(this.wallet,t)},place:function(){this.wallet.actions.place(this.wallet)},parser:{parse:function(t,e){t.actions.change(t,{text:e,x:e.substr(1)})}},main:{place:function(t){if("destroy"!=t.step.text)if(0!=t.step.text.indexOf(".m"))if(0!=t.step.text.indexOf(".gi"))if(0!=t.step.text.indexOf(".e"))if(0!=t.step.text.indexOf(".i")){if(0==t.step.text.indexOf(".t")){var e=t.step.text.substr(2).trim(),n=Et.getWallet("repo.root").id;t.step.text=e,t.step.parent=n,t.step.selectItem=!0}this.add(t),Lt.afterRenderActions.add("alertAnimation")}else this.addInfo({text:t.step.text.substr(2).trim()},t);else this.changeItem({text:t.step.text.substr(2).trim()},t);else{var a=t.step.parent;if(!a)return;Rt.goToInfo(a)}else{var i=this.createMap(t.step.text.substr(2).trim());Rt.selectMap(i)}else Lt.db.destroy()},change:function(t,e){v.a.merge(t.step,e)},createMap:function(t){var e=Lt.antsDbState.getId(),n={id:e,text:t,startedAt:Lt.antsDbState.getTime(),type:"map",rels:{sub:{},allSubs:{}},mapId:e,parentId:e};return Lt.mapview.mergeItem(n.id,n),Et.set("repo.items."+n.id,n),n.id},changeItem:function(t,e){var n=e.step.parent;if(n){var a=Et.getWallet("repo.items."+n);v.a.merge(a,t),a.history||(a.history=[]),a.history.push({changeAt:Date.now()}),Lt.mapview.mergeItem(n,a),Et.set("repo.items."+n,a)}},addInfo:function(t,e){var n=e.step.parent,a=Et.getWallet("repo.root");if(n){var i=Lt.antsDbState.getId(),r={text:t,id:i,startedAt:e.startedAt,placedAt:(new Date).getTime(),mapId:a.id,parentId:n,targetId:i,type:"info"};console.log("Adding info to",n),Lt.mapview.mergeItem(n,{hasInfo:!0}),Lt.mapview.mergeItem(i,r),Lt.mapview.mergeRoot(v.a.set({},"rels.info."+n+"."+i,{id:i,parent:n})),Et.markChangeOn("repo.items",!1,!0,!0),Et.markChangeOn("repo.root",!1,!0)}},add:function(t){var e=t.step.parent,n=Et.getWallet("repo.root");e||(e=n.id),Et.getWallet("repo.state").nextId++;var a=Lt.antsDbState.getId(),i={text:t.step.text,id:a,startedAt:t.startedAt,placedAt:(new Date).getTime(),mapId:n.id,parentId:e};Lt.mapview.mergeItem(a,i),Lt.mapview.mergeRoot(v.a.set({},"rels.sub."+e+"."+a,{id:a,parent:e})),Lt.mapview.mergeRoot(v.a.set({},"rels.allSubs."+a,{id:a,parent:e})),Et.markChangeOn("repo.items",!1,!0,!0),Et.markChangeOn("repo.root",!1,!0),t.step.selectItem?Rt.select(a):Rt.select(e)}}};Ut.start(),Et.setCombined("ub.loaders.map",{load:function(t){var e=this,n=[t,"info_"+t];this.tb.db.loadItems(n).then(function(t){for(var n in t){t[n]&&(e.wallet.items[t[n].id]=t[n])}t[0]&&(e.wallet.root=t[0])}).then(function(){var t=e.wallet.root,n=v.a.get(t,"rels.allSubs")||{},a=Object.keys(n);return e.tb.db.loadItems(a)}).then(function(t){for(var n in t){var a=t[n];a&&(e.wallet.items[a.id]=a)}}).then(function(){Et.set("repo.items",e.wallet.items),Et.set("repo.root",e.wallet.root)})}}),Et.setCombined("ub.loaders.bridge",{setup:function(t){v.a.merge(this,t)},loadBridge:function(){var t={top:{notdb:!0,text:"top",id:"top"},recent:{notdb:!0,text:"recent",id:"recent"},all:{notdb:!0,text:"all",id:"all"},root:{notdb:!0,text:"",id:"root"}},e={sub:{root:{top:!0,recent:!0,all:!0},top:{},recent:{},all:{}}};t.root.rels=e,this.tb.db.loadFilter({type:"map"},10,"dateChanged").then(function(n){for(var a in n.docs){var i=n.docs[a];i.brand||(i.brand=Mt.brand.getBrand(i.id+i.startedAt)),t[i.id]=i,-1!=i.text.indexOf("ma")&&(e.sub.top[i.id]=!0),i.startedAt&&(e.sub.recent[i.id]={date:i.startedAt}),e.sub.all[i.id]=!0}}).then(function(){Et.setCombined("bridgeRepo",{items:t,root:t.root})})}}),Et.setCombined("ub.loaders.search",{setup:function(t){v.a.merge(this,t)},search:function(){var t={},e={sub:{root:{top:!0,recent:!0,all:!0},top:{},recent:{},all:{}}};t.root.rels=e,this.tb.db.loadFilter({type:"map"},10,"dateChanged").then(function(n){for(var a in n.docs){var i=n.docs[a];i.brand||(i.brand=Mt.brand.getBrand(i.id+i.startedAt)),t[i.id]=i,-1!=i.text.indexOf("ma")&&(e.sub.top[i.id]=!0),i.startedAt&&(e.sub.recent[i.id]={date:i.startedAt}),e.sub.all[i.id]=!0}}).then(function(){Et.setCombined("bridgeRepo",{items:t,root:t.root})})}}),Et.setCombined("ub.mapView",{setup:function(t){return this.wallet={items:{},root:{id:"ant1",text:"welcome",rels:{sub:{}},type:"map",notdb:!0},changed:{},state:{nextId:1}},this.wallet.items.ant1=this.wallet.root,v.a.merge(this,t),this},loadMap:function(t){var e=this,n=[t,"info_"+t],a=Et.getWallet("repo.root"),i=Promise.resolve();a.id!==t&&(a.notdb||(i=i.then(function(){return e.saveItems()})),i=i.then(function(){e.wallet.items={},e.wallet.root={id:t,notdb:!0,rels:{sub:{}}},e.wallet.items[t]=e.wallet.root,Et.set("repo.items",e.wallet.items),Et.set("repo.root",e.wallet.root)})),i.then(function(){return e.tb.db.loadItems(n)}).then(function(t){for(var n in t){t[n]&&(e.wallet.items[t[n].id]=t[n])}if(t[0]){var a=t[0];e.wallet.root=a,a.brand=Mt.brand.getBrand(a.id+a.startedAt);var i={logo:Mt.brand.getLogo(a.id+a.startedAt,10,5)};Mt.tplObjParse.run(i);Et.setCombined("customTpl",i)}}).then(function(){var t=e.wallet.root,n=v.a.get(t,"rels.allSubs")||{},a=Object.keys(n);return e.tb.db.loadItems(a)}).then(function(t){for(var n in t){var a=t[n];a&&(e.wallet.items[a.id]=a)}}).then(function(){Et.set("repo.items",e.wallet.items),Et.set("repo.root",e.wallet.root)})},getItemsToSave:function(){var t=this.wallet.changed;this.wallet.changed={};var e=[];for(var n in t)this.wallet.items[n].notdb||e.push(this.wallet.items[n]);return e},saveItems:function(){var t=this.getItemsToSave();return this.tb.db.saveItems(this.uid,t)},generateId:function(){return this.tb.state.getId()},mergeItem:function(t,e,n){return t||(t=this.generateId()),this.wallet.items[t]||(this.wallet.items[t]={id:t,createdAt:(new Date).getTime()}),v.a.merge(this.wallet.items[t],e),this.wallet.items[t].salut="test",n||this.makePreview(),this.triggerChange(t),t},mergeRoot:function(t){this.mergeItem(this.wallet.root.id,t)},makePreview:function(){var t=this;this.timerPreview&&window.clearTimeout(this.timerPreview),this.timerPreview=window.setTimeout(function(){Lt.shop.go("makePreview",{id:t.wallet.root.id,items:t.wallet.items,save:function(e){t.mergeItem(e.item.id,e.item,!0)}}),delete t.timerPreview},1)},triggerChange:function(t){this.wallet.changed[t]=!0,this.tb.db.request_save(this.uid,this,2e3)},setRel:function(t,e,n,a){v.a.set(this.wallet.root,["rels",t,e,n],a),this.triggerChange(this.wallet.root.id)}}),Et.setCombined("repo",{items:{},root:{id:"ant1",text:"welcome",rels:{sub:{}}},state:{nextId:2}}),Et.setCombined("antView.molds",{loader:{get:function(t){return Mt.tplObjParse.run(this.tpls)},tpls:{title:"<div >item : {value.text}</div>",item:"<div on_click={actions.select} antid={id}>item : {item.text}</div>",mapView:{logo:Mt.brand.getLogo(O.a.company.catchPhrase(),10,5),frame:'<div class=\'map\'>{title} {content}\n\n        <style>\n          .map { font-size : 15px; margin : 10px;\n            line-height: 26px;\n            background : {colors.background}\n            }\n          .map * { font-size : 17px !important}\n          .map .title { font-size : 17px !important;}\n          .topic>.text { \n              border-bottom : 1px solid {root.brand.fadedColor} ; \n              display : inline-block;\n              padding-left : 5px;\n              padding-right: 25px;\n            }\n          .topic { \n            margin-bottom : 5px;\n            margin-top : 20px;\n            position : sticky;\n            top : 25px;\n            background : {colors.background};\n            z-index : 100\n          }\n\n          .card { \n            margin-bottom : 30px;\n          }\n          .content { margin-left : 10px; padding-left : 10px;}\n\n          .mapviewtitle { position:sticky; top : -30px; margin-bottom : 20px; background : {background}; z-index:200; } \n          .logo { display : inline-block; width : 50px; height : 50px; }\n\n          .selected.title::before { content : "\u25cf"; display:inline-block; margin-right : 5px; margin-left:5px; color : {root.brand.mainColor}; font-size: 0.7em !important; }\n\n          .title:active { transition: all 0.4s ease; background : #333 !important; }\n          .selected.content { \n            border-left :  1px dotted {root.brand.fadedColor};\n            padding-left:25px;\n            margin-bottom: 15px;\n          }\n\n          .selected.content::after {\n            content: ">";\n            display: inline-block;\n            border-bottom: 1px dotted {root.brand.fadedColor} ;\n            overflow: hidden;\n            position: relative;\n            left: -25px;\n            padding-left : 10px;\n            top: 8px;\n            width: 20px;\n            margin: 0px;\n          }\n\n          .mapviewtitle { font-variant: petite-caps;}\n\n          polygon.poligon {\n            fill: {root.brand.mainColor} !important;\n          }\n\n          .handle { \n            display: inline-block;\n            font-variant: petite-caps;\n            font-size: 0.7em !important;\n            color: #999;          \n          }\n\n          .alert .poligon_2  {\n            animation: rotate_poligon 5s ease;\n          }\n          \n          @keyframes rotate_poligon {\n            0% {\n              opacity : auto\n            }\n            20% {\n              opacity : 0.2\n            }\n            70% {\n              opacity : 0.7\n            }\n            100% {\n              opacity : auto\n            }\n            \n          }\n\n          .crazy_animation { \n            transform-origin: center;\n            transform: rotate(360deg);\n            transform-box: fill-box;        \n          }\n\n          .info {\n            display: inline-block;\n            color: #ff8900;\n            border: 1px solid #ff8900;\n            text-align: -webkit-center;\n            width: 1.5em;\n            height: 1em;\n            border-radius: 10px;\n            margin-left: 5px;\n            overflow: hidden;\n            font-size: 0.6em !important;\n            vertical-align: middle;\n          }\n          .mindmap { \n            display : inline-block;\n            width : 30px;\n            height:30px;\n          }\n        </style>\n      </div>',title:"\n        <div class='mapviewtitle '> <div class='logo'>{logo}</div> \n          <span on_click={actions.select} antid={id} >{item.text}</span>\n          <span class='mindmap' on_click={actions.showMindMap} antid={id} >\u2708</span>\n        </div>"},map:{topic:"<div on_click={actions.select} antid={id} class='title topic {isSelected}'><span pin='title' class='text'>{handle} {item.text} </span></div>",item:"<div on_click={actions.select} antid={id} class='title item {isSelected}' pin='title'>{handle} {item.text}</div>",entry:"<div on_click={actions.select} antid={id} class='title entry {isSelected}' pin='title'>{handle} {item.text}</div>",other:"<div on_click={actions.select} antid={id} class='title {isSelected}' pin='title'>{handle} {item.text}</div>",card:"<div class='card reveal {isSelected}'>{title} <div id='content' class='content {isSelected}'>{content}</div>{afterContent}</div>",button:"<span class='button' on_click={actions.log}>?</span>",info:"<span class='info' on_click={actions.goToInfo}>^</span>"},handle:"<span class='handle'>{handle}</span>",bridgeTitle:"<div>{value.text}</div>",frame:"<div>{maptitle}{items}</div>",mapTitle:""}}}),Et.setCombined("antView.map",{nodes:{loader:{get:function(t,e){t.fetch({uistate:"repo.uistate",items:"repo.items",root:"repo.root",repo:"repo",molds:"antView.molds",customTpl:"customTpl"},e),e.rows=Object.values(e.items);return e.data={},e.actions=Mt.store.get(t,Rt,{runWith:{showMindMap:["showMindMap","antid"],select:["select","antid"],goToInfo:["goToInfo","antid"]}}),e.selected=e.uistate.selected,e.color="#007abc",e.otherTpl="map.other",e.moldsMap=["map.topic","map.item","map.entry"],e.cardMold="map.card",e.background="#eee",e.info=Mt.reactAssembler.run(e.molds.map.info,e),e.colors={background:"#eee"},e.body=this.getBody(e,e.root.id,e.root.rels.sub),e.body},setV:function(t,e,n){for(var a in n=n||{},t)void 0===n[a]&&(n[a]=e[a]),e[a]=t[a];return n},cleanV:function(t,e){for(var n in e)t[n]=e[n]},getBody:function(t,e,n){var a=this.getBodyList(t,e,n),i=t.customTpl.logo?Mt.reactAssembler.run(t.customTpl.logo,t):"",r=this.setV({logo:i,item:t.repo.root,id:t.repo.root.id},t,r),s=Mt.reactAssembler.run(t.molds.mapView.title,t);r=this.setV({content:a,title:s},t,r);var o=Mt.reactAssembler.run(t.molds.mapView.frame,t);return this.cleanV(t,r),o},getBodyList:function(t,e,n){var a=n[e];if(!a)return null;if(t.level>5)return null;var i=void 0!=t.level?t.level+1:0,r=[],s=this.setV({id:null,item:null,level:0,isSelected:null,content:null,title:null,handle:null,afterContent:null},t,s),o=1;for(var l in a){Object.assign(t,{id:l,item:t.items[l],level:i,isSelected:t.selected==l?"selected":"",count:o,afterContent:null});var u=this.getItem(t,n);r.push(u),o++}return this.cleanV(t,s),r},getHandle:function(t,e,n){var a;return void 0==(a=0==e?String.fromCharCode(64+n)+".":1==e?n+".":2==e?"\u25aa":"- ")?"":Mt.reactAssembler.run(t.molds.handle,{handle:a})},getItem:function(t,e){t.item;var n=t.mold;!n&&t.moldsMap&&(n=t.moldsMap[t.level]),n||(n=t.otherTpl);var a,i=v.a.get(t.molds,n);if(t.handle=this.getHandle(t,t.level,t.count),t.title=Mt.reactAssembler.run(i,t),t.item.hasInfo){var r,s=i.mold.pins.title;(r=s.length?v.a.get(t.title,s):t.title).children||(r.children=[]),r.children.push(t.info)}if(t.content=this.getBodyList(t,t.id,e),t.isSelected&&!t.content&&(t.content=[]),t.content){var o=v.a.get(t.molds,t.cardMold);a=Mt.reactAssembler.run(o,t)}else a=t.title;return a}}}}),Et.setCombined("antViewBridge.molds",{loader:{get:function(t){return Mt.tplObjParse.run(this.tpls)},tpls:{root:{bridge:"<div class='bridge'>{content}{advanceView} </div>",card:"<div class='card'><div class='title'><span>{item.text}</span></div> <div class='content'>{content}</div></div>",item:"<div class='title item' antid='{id}' on_click='{actions.select}' style='--color:{item.brand.mainColor}'>{item.text}</div>",style:"\n          <style>\n            .title { \n              margin-bottom : 5px;\n              padding-left : 4px;\n            }\n            .item.title::before { \n              color : var(--color);\n              content : '\ud834\udf07';\n              display : inline-block;\n              padding-right : 5px; \n            }\n\n            .item.title:active { transition: all 0.4s ease; background : #333 !important; }\n\n\n            .card {\n              margin : 20px 10px;\n            \n              border : 1px solid {brand.borderColor};\n\n              padding : 10px;\n            }\n            .bridge { font-size : 18px; margin : 10px;\n              line-height: 25px;\n              }\n\n            .card>.content { \n            }\n            .card>.title{\n              position: sticky;\n              top: 0px;\n              background : {brand.background};\n              padding-bottom : 10px;\n\n            }\n\n            @keyframes enter {\n              0% { opacity : 0.5; height : 0; overflow:hidden; transform : scaleY(0) translateY( 15px ); }\n              100% { opacity : 1; height:auto; overflow:hidden; transform : scaleY(1) translateY( 0px ); }\n            }\n\n            #easel div { animation: enter 0.5s ease; }\n\n            .card>.title>span{ \n              border-bottom : 1px solid {brand.borderColor};\n              width : fit-content;\n              padding-left: 5px;\n              padding-right : 24px;\n              padding-bottom : 5px;\n              display : inline-block;\n              font-variant: petite-caps;\n            }\n          </style>\n        "}}}}),Et.setCombined("antView.bridge",{nodes:{loader:{get:function(t,e){return t.fetch({items:"bridgeRepo.items",root:"bridgeRepo.root",repo:"bridgeRepo",molds:"antViewBridge.molds"},e),this.addVFn(e),e.tplSpecs={byLevel:["root.bridge","root.card","root.item"]},e.brand={borderColor:"#333",background:"#eee"},t.cache.advanceView||(t.cache.advanceView={value:["loading"]},Lt.shop.run("actionshops.getRecentPreview","main",{},{list:[function(e,n){t.cache.advanceView.value=n,Et.markChangeOn(t.path(),!1,!0)}]})),e.actions=Mt.store.get(t,Rt,{runWith:{select:["selectMap","antid"]}}),e.color="#007abc",e.otherTpl="map.other",e.moldsMap=[],e.defaultTpl={card:"root.card",title:"root.title"},e.cardMold="map.card",e.background="#eee",e.level=0,e.subs=e.root.rels.sub,e.id="root",e.item=e.root,e.advanceView=t.cache.advanceView.value,[this.makeItem(e),Mt.reactAssembler.run(e.molds.root.style,e)]},makeItem:function(t){var e=t.mold||t.tplSpecs.byLevel[t.level];e||console.error("no mold",t);var n=v.a.get(t.molds,e);if(n.mold.parameters.content){var a=t.subs[t.id],i=t.level+1;t.content=this.makeList(t,a,function(e,n){return{id:n,item:t.items[n],level:i}})}return Mt.reactAssembler.run(n,t)},makeList:function(t,e,n){var a=[];for(var i in t.stack(),e){t.set(n(e[i],i));var r=this.makeItem(t);a.push(r)}return t.clean(),a},addVFn:function(t){t.set=function(t){var e=this,n=e.memo;for(var a in t)void 0===n[a]&&(n[a]=e[a]),e[a]=t[a]},t.get=function(t){var e=this,n=e.memo;for(var a in t)void 0===n[a]&&(n[a]=e[a]),e[a]=t[a]},t.clean=function(){var t=this,e=t.memo;for(var n in e)t[n]=e[n];t.memo=t.stacks.pop()},t.stack=function(){var t=this;t.stacks||(t.stacks=[]),t.stacks.push(t.memo),t.memo={}}}}}}),Et.setCombined("dbSavings",{items:{}}),Et.setCombined("tb.persisitence",{setup:function(){var t=this;this.db=Mt.db.run("thisdb"),window.onbeforeunload=function(){return t.saveAll()},this.loadAll()},request_save:function(){var t=this;this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){t.saveAll()},6e4)},saveAll:function(){var t=Et.getValue("dbSavings").items,e=[];for(var n in t)e.push(this.saveitem(n,t[n]))},saveitem:function(t,e){var n=e.path||e,a=Et.getWallet(n);return this.db.save({repo:a},t)},loadAll:function(){var t=Et.getValue("dbSavings").items;for(var e in t)this.loaditem(e,t[e])},loaditem:function(t,e){var n=e.path||e,a=e.onload||null;this.db.load(t).then(function(t){t&&t.repo&&Et.set(n,t.repo),a&&Et.runOn(a[0],a[1])})},starter:{loader:{autostart:!0,get:function(t){return t.cache.done?1:(t.cache.done=!0,t.fetch({tb:"tb.persisitence"}).tb.setup(),1)}}}}),Et.setCombined("ui.molds",{loader:{get:function(t){return Mt.tplObjParse.run(this.tpls)},tpls:{main:"\n          <div id='frame'>\n            <div id='easel'>{view}</div>\n            {overPanel.frame}\n            <div id='bar'>\n              <div id='menu'>{menu}</div>\n              <myinput id='order' auto_complete=\"off\" value={order.value} on_key_press={order.place} on_change={order.change}></myinput>\n              <div id='bumb' on_click='{bumb.action}'>{picture}</div>\n            </div>\n          </div>\n          <style>\n            * { box-sizing : border-box; max-height: 40000em;}\n            body , window, html {\n              color : {textColor};\n              height : 100%; width : 100%; background : {background} }\n            #frame { height : 100%; width : 100%;}\n            #frame { display : flex; flex-direction : column; }\n            #easel { flex : 1; overflow : auto; }\n            #overPanel { position : absolute;left : 0; top : 0; z-index : 200;}\n            \n            #bar   { position : relative; border-top: 1px solid #999; width : 100%; flex-basis : {dim.barHeight}px ; display : flex;flex-direction:row; }\n            #menu  { position: absolute;  bottom: 50px; }\n            #order {  padding-left : 10px; outline: none; flex : 1; border : 0px none transparent; width: 100%;}\n            #bumb  { flex-basis : {dim.barHeight}px; background : {color} } \n\n\n            @keyframes salut {\n              0% { border : 0px solid red;}\n              100% { border : 10px solid red;}\n            }\n\n\n            @keyframes reveal {\n              0% { opacity : 0.7; transform : translateY( -5px ); }\n              100% { opacity : 1; transform : translateY( 0px ); }\n            }\n\n\n\n            @keyframes enter {\n              0% { opacity : 0.5; transform : translateY( 5px ); }\n              100% { opacity : 1; transform : translateY( 0px ); }\n            }\n\n            #easel>div { animation: enter 0.5s ease; }\n            .reveal { animation: enter 0.5s ease; }\n\n            </style>\n          \n  ",overPanel:"<div id='overPanel'>{overPanel.panel}</div>",bubbleitem:"<div on_click={selectitem} targetid={targetid}>{label}</div>",menuitem:"<div>{label}</div>"}}}),Et.setCombined("workingant",{data:{input:{text:""},currentView:"main",selected:""}}),Et.setCombined("antsFrame.ui",{loader:{paths:{molds:"ui.molds",orderText:"workingant.data",node:"antsFrame.prepare"},get:function(t,e){return t.fetch(this.paths,e),v.a.set(e.node,e.molds.main.mold.pins.order.concat(["props","value"]),e.orderText.input),e.node}}}),Et.setCombined("antsView.formPanel",{nodes:{loader:{change:function(t,e,n){t.cache.args=n,Lt.shop.go("makeTreeMap",{id:n.id,items:Et.getWallet("repo.items")},{nodes:[function(e,n){console.log("DONEDONE",n),t.cache.nodes=n,Et.markChangeOn(t.path(),!1,!0)}]})},get:function(t,e){t.fetch({items:"repo.items"},e),t.cache.loading||(t.cache.loading=!0,t.cache.nodes="loading",Lt.shop.go("makeTreeMap",{id:"ant_2"},{nodes:[function(e,n){console.log("DONEDONE",n),t.cache.nodes=n,Et.markChangeOn(t.path(),!1,!0)}]}));var n=Et.getVersion("repo.items");return t.cache.args&&t.cache.old&&t.cache.old.dependsOn["repo.items"].version!=n&&this.change(t,e,t.cache.args),t.cache.nodes},updateVersionsMap:!0}}}),Et.setCombined("workingant.viewState",{path:"antsView.formPanel.nodes"}),Et.setCombined("antsFrame.prepare",{loader:{paths:{molds:"ui.molds",data:"bubbles.data",repo:"repo",viewState:"workingant.viewState"},get:function(t,e){console.log("panel"),t.fetch(this.paths,e),t.fetch({view:e.viewState.path},e),console.log(e.view);var n=Mt.store.get(t,Rt,{change:{changeOrder:"workingant.data.input"},run:{bumbAction:"showhud",placeOrder:"placeorder"}});for(var a in e.dim={window:{height:"400",width:"200"},barHeight:"40"},e.data={label:"main",bubbleList:"TestList",order:{change:n.changeOrder,place:n.placeOrder},bumb:{action:n.bumbAction},dim:e.dim,view:e.view,color:"#999",background:"#eee",textColor:"#222",menu:[]},e.viewState.overPanel)e.viewState.overPanel[a]&&(e.data.overPanel=t.fetch({panel:e.viewState.overPanel[a]}),e.data.overPanel.frame=Mt.reactAssembler.run(e.molds.overPanel,e.data));return e.node=Mt.reactAssembler.run(e.molds.main,e.data),e.node},autostart:!0}}),Et.setCombined("test",{loader:{get:function(){Lt.bridgeLoader.loadBridge()},autostart:!0}}),Et.historyManager.recording=!1,Et.runToStart();var Bt=function(t){function e(t){var n;return Object(o.a)(this,e),(n=Object(u.a)(this,Object(c.a)(e).call(this,t))).path="antsFrame.ui",n.state={},n}return Object(d.a)(e,t),Object(l.a)(e,[{key:"componentDidMount",value:function(){var t=this;Et.setTrigger(this.path,"asd",{run:function(){t.setState({version:(new Date).getTime()})}})}},{key:"componentDidUpdate",value:function(){}},{key:"render",value:function(){var t=Et.getValue(this.path);return Mt.reactUtils.makeComponent(t||[])||"empty"}}]),e}(a.Component),Wt=function(t){function e(t){var n;return Object(o.a)(this,e),(n=Object(u.a)(this,Object(c.a)(e).call(this,t))).state={value:{scode:"salut"}},n}return Object(d.a)(e,t),Object(l.a)(e,[{key:"_style",value:function(){return"\n      html, window, body{ width : 100%; height : 100%; overflow : auto; padding: 0px; margin:0px;}\n      #root, .main { width : 100%; height : 100%;}\n      \n\n.node {\n  stroke: #fff;\n  stroke-width: 1.5px;\n}\n\n.link {\n  fill: none;\n  stroke: blue;\n  stroke-width: 1.5px;\n  opacity: 0.4;\n  marker-end: url(#end-arrow);\n}\n\n.adv_entry {     display: block;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  overflow: hidden;}\n.adv_entry>.time {     background: #a1a1a1;\n  display: inline-block;\n  border-radius: 5px;\n  padding: 4px 2px;\n  font-size: 0.4em;\n  line-height: 1em;\n }\n.adv_map>.content { }\n.adv_map { border : 1px solid #999; margin : 10px; padding : 10px;}\n    "}},{key:"render",value:function(){var t=this._style(),e=[i.a.createElement(Bt,{key:"1"})];return[i.a.createElement("style",{key:"style"},t),e]}}]),e}(a.Component),Ft=function(t){function e(t){return Object(o.a)(this,e),Object(u.a)(this,Object(c.a)(e).call(this,t))}return Object(d.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return i.a.createElement(Wt,null)}}]),e}(a.Component),Nt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Kt(t,e){navigator.serviceWorker.register(t).then(function(t){t.onupdatefound=function(){var n=t.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}}).catch(function(t){console.error("Error during service worker registration:",t)})}s.a.render(i.a.createElement(Ft,null),document.getElementById("root")),function(t){var e=new URL("/antstycoon",window.location.href);e.origin===window.location.origin?window.addEventListener("load",function(){var e="".concat("/antstycoon","/service-worker.js");Nt?(function(t,e){fetch(t).then(function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then(function(t){t.unregister().then(function(){window.location.reload()})}):Kt(t,e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e,t),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):Kt(e,t)}):console.error(e.origin)}()},132:function(t,e,n){t.exports=n(1312)},137:function(t,e,n){},41:function(t,e){var n={setup:function(t){var e=Object.create(this);return e.wallet={currentStack:{info:[{type:"startedWith",info:t}]},stacks:[]},e.recording=!0,e.wallet.stacks.push(e.wallet.currentStack),e},startStack:function(t){if(this.recording){var e={info:[],prevStack:this.wallet.currentStack,index:this.wallet.stacks.length,start:t};this.addInfo({type:"subStack",stack:e},!0),this.wallet.stacks.push(e),this.wallet.currentStack=e,t&&this.addInfo(t)}},addInfo:function(t,e){this.recording&&(e||(t=_.cloneDeep(t)),this.wallet.currentStack.info.push(t))},endStack:function(t){this.recording&&(t&&this.addInfo(t),this.wallet.currentStack=this.wallet.currentStack.prevStack)}},a={setup:function(){var t=Object.create(this);return t.state={ctx:{},gettingValue:{},wallet:{},meta:{},cache:{},version:{},loadersCache:{},triggers:{},currentVersion:1,dependencies:{},nextUID:1,agenda:{names:{},tasks:[]},pins:{},toStart:[],flags:{}},t.historyManager=n.setup(this),t},state:{gettingValue:{},wallet:{},meta:{},cache:{},version:{},loadersCache:{},triggers:{},currentVersion:1,dependencies:{},nextUID:1,agenda:{names:{},tasks:[]},pins:{},toStart:[],flags:{}},setCtx:function(t,e,n,a){var i=_.get(this.state.ctx,[t,"ctx"].join("."));i||_.set(this.state.ctx,[t,"ctx"].join("."),i={names:[]}),_.set(i,e,n),i.names.push({names:a,path:e})},getCtx:function(t,e){var n,a=_.get(this.state.ctx,[t,"ctx"].join("."));if(!a)return null;for(var i in a.names)if(-1!=a.names[i].names.indexOf(e)){n=a.names[i].path;break}return n?_.get(a,n):null},runOn:function(t,e,n){var a=this.getCtx(t,e);return a?a[e](n):null},runFn:function(t,e){var n=t.split("."),a=n.pop(),i=n.join("."),r=this.getValue(i);if(r[a])return _.isFunction(r[a])?r[a](e,t,this):_.isFunction(r[a].run)?r[a].run(e,t,this):void 0},getInfluenced:function(t){var e=[],n=_.get(this.state.dependencies,t+".DEP");if(!n)return[];for(var a in n)e.push(a),e=e.concat(this.getInfluenced(a));return e},getValue:function(t,e){var n=t.split("."),a=this.checkCache(t);if(a)return a;if(!e)for(var i=0;i<n.length;i++){var r=n.slice(0,i).join(".");if(this.state.gettingValue[r]){var s=this.state.gettingValue[r].partialResult,o=n.slice(i),l=_.get(s,o);if(void 0!==l)return l}}this.state.gettingValue[t]=!0;var u=this.makeList(t);return a=this.listToValue(u,t),delete this.state.gettingValue[t],void 0!==a&&this.setCache(t,a),a},setCache:function(t,e,n){this.state.cache[t]={value:e,shouldUpdate:n||!1,version:this.state.currentVersion}},checkCache:function(t,e){return this.state.cache[t]?e?this.state.cache[t].value:this.state.cache[t].shouldUpdate?null:this.state.cache[t].value:null},prepareCache:function(t){var e=this.state.loadersCache[t];e||(e=this.state.loadersCache[t]={old:{},contains:{},dependsOn:{}});var n={contains:e.contains||{},dependsOn:e.dependsOn||{}};return e.old=n,delete e.contains,delete e.dependsOn,n},diffCache:function(t,e){this.state.loadersCache[e]||(this.state.loadersCache[e]={});var n=this.state.loadersCache[e]||{},a=this.state.dependencies,i=function(t,e){var n=_.get(a,t+".DEP");n||_.set(a,t+".DEP",n={}),n[e]=!0},r=function(t,e){var n=_.get(a,t+".DEP");n&&delete n[e]},s=function(t,n){for(var a in t)n&&n[a]||i(a,e);for(var a in n)t&&t[a]||r(a,e)};s(n.contains,t.contains),s(n.dependsOn,t.dependsOn)},updateVersionsMap:function(t){var e=(this.state.loadersCache[t]||{}).dependsOn;for(var n in e){var a=this.getVersion(n);e[n].version=a,console.log("setting veriosn,",a,e[n].version)}},makeList:function(t){var e=[],n=t.substr?t.split("."):t,a=_.get(this.state.wallet,t);if(void 0!==a){if(!_.isObjectLike(a))return e.push({src:"wallet",value:a,path:[],srcPath:t,version:1}),e;a=_.cloneDeep(a),e.push({src:"wallet",value:a,path:[],srcPath:t,version:1})}for(var i=this.state.meta,r=0;r<n.length&&i;r++){if(i.loader){var s={src:"root",loader:i.loader,path:[],srcPath:n.slice(0,r),select:n.slice(r)};e.push(s)}i=i[n[r]]}var o=n;return function t(e,n,a){if(e){if(e.loader){var i={src:"sub",loader:e.loader,path:n,srcPath:o.concat(n)};a.push(i)}for(var r in e)"loader"!=r&&t(e[r],n.concat(r),a)}}(i,[],e),e},silentSet:function(t,e,n){this.historyManager.addInfo({type:"silentSet",path:t,value:e}),_.set(this.state.wallet,t,e),this.state.cache[t]&&(this.state.cache[t].shouldUpdate=!0),n||this.getAffectedPaths(t)},listToValue:function(t,e){if(1==t.length&&t[0].value)return t[0].value;var n={};this.state.gettingValue[e]={partialResult:n};for(var a=t,i=!0,r=0;i;){if(++r>5)return this.state.cache[e].shouldUpdate=!0,n;t=a,a=[],i=!1;for(var s=0;s<t.length;s++){var o=t[s],l=void 0;if(o.value)l=o.value;else if(o.loader)try{l=this.getFromLoader(o,n,e)}catch(u){"postpone"==u?(this.state.cache[e].shouldUpdate=!0,a.push(o),i=!0):console.error(u);continue}o.select&&(l=_.get(l,o.select)),o.path.length?_.set(n,o.path,l):0==Object.values(n).length?n=l:_.merge(n,l)}}return n},loadersCache:{},addLog:function(t,e,n,a){this.state.loadersCache[t]||(this.state.loadersCache[t]={version:this.state.currentVersion,cachedValue:{}});var i=this.state.loadersCache[t];i[e]||(i[e]={}),i[e][n]=a||!0},getFromLoader:function(t,e,n,a){var r,o=this,l=t.srcPath.join(".");try{var u={add:function(t,e){o.addLog(l,"dependsOn",t,{version:!0,name:e,path:t,srcPath:l})}},c=t.loader;if(c.prism)if(c.loadedPrism)c=c.loadedPrism;else{var d=this.getFromDispatch(c.prism);c.loadedPrism=d,c=d}if(c.load)return this.state.cache[l]?{}:(r=c.load(e,this,u,t.loader,t),_.set(this.state.wallet,l,r),this.state.cache[l]={loader:!0,value:{}},r);if(!a){var p=this.checkCache(l);if(p)return p}"sub"==t.src&&this.addLog(n,"contains",l);var h=this.prepareCache(l);if(c.get)try{var f=s.init(e,this,u,t.loader,t,this.state.loadersCache[l]);r=i.newAPI?c.get(f,f.v):c.get(f,this,u,t.loader,t,this.state.loadersCache[l])}catch(v){if(!v||"return"!=v.type)throw v;r=v.value}if("forceCache"===r)return this.checkCache(l,!0);void 0!==r&&(this.setCache(l,r),this.diffCache(h,l),c.updateVersionsMap&&this.updateVersionsMap(l),_.set(this.state.version,l+".version",this.state.currentVersion))}catch(v){console.error(v)}return c&&c.skipCache&&(this.state.cache[l].shouldUpdate=!0),r},runOnLoader:function(t,e,n){var a=t,i=_.get(this.state.meta,t);if(i&&(i=i.loader)[e]){var r=s.init({},this,{},i,{srcPath:a},this.state.loadersCache[a]);return i[e](r,r.v,n),null}},runUtils:function(t,e){var n=this.getValue(t);if(n&&n.run)return n.run.apply(n,e)},getWallet:function(t){return _.get(this.state.wallet,t)},mergeValue:function(t,e){var n=this;this.historyManager.addInfo({type:"mergeValue",path:t,value:e});var a=t?_.get(this.state.wallet,t):this.state.wallet;a||(a={},_.set(this.state.wallet,t,a));var i=[];this.state.currentVersion++;var r=_.isString(t)?t.split("."):t||[];1==r.length&&""==r[0]&&(r=[]);var s={addPath:function(t){var e=r.concat(t);i.push(e),_.set(n.state.version,e.join(".")+".version",n.state.currentVersion)}};for(var o in this.pauseAll(),_.isObjectLike(e)?this.setObObj(a,e,s,[]):console.log("it's not object"),i)this.updateVersionForAll(i[o]),this.getAffectedPaths(i[o].join("."));this.req_triggers()},pauseAll:function(){this.state.runningReqTriggers_timer&&(this.clearInterval(this.state.runningReqTriggers_timer),delete this.state.runningReqTriggers_timer),this.state.runningAgendaTriggers_timer&&(this.clearInterval(this.state.runningAgendaTriggers_timer),delete this.state.runningAgendaTriggers_timer)},setInterval:function(t,e,n){var a=!1;return window.requestAnimationFrame(function e(){a||(t(),window.requestAnimationFrame(e))}),function(){a=!0}},clearInterval:function(t){if(t)return t()},req_triggers:function(){var t=this;this.state.runningReqTriggers_timer||(this.state.runningReqTriggers_timer=this.setInterval(function(){t.asyncTriggers()},0,"triggers"))},asyncTriggers:function(){var t=Object.keys(this.affected);if(0==t.length)return this.clearInterval(this.state.runningReqTriggers_timer),this.affected_checked={},void delete this.state.runningReqTriggers_timer;this.affected_checked[t[0]]=this.affected[t[0]],delete this.affected[t[0]],this.lazy_checkTriggers(t[0])},req_Agenda:function(){var t=this;this.state.runningAgendaTriggers_timer||0!=this.state.agenda.tasks.length&&(this.state.runningAgendaTriggers_timer=this.setInterval(function(){t.asyncTriggersAgenda()},0,"agenda"))},asyncTriggersAgenda:function(){if(0==this.state.agenda.tasks.length)return this.clearInterval(this.state.runningAgendaTriggers_timer),void delete this.state.runningAgendaTriggers_timer;var t=this.state.agenda.tasks.shift();if(!t)return console.error(t);delete this.state.agenda.names[t.id],this.runTrigger(t,t.target,t.listener)},lazy_checkTriggers:function(t){if(this.state.triggers[t]){if(this.state.agenda.names[t])return;var e=this.state.triggers[t];for(var n in e){var a=e[n],i=a.id||t+"___"+n;this.state.agenda.names[n]||(a.path||(a.target=t),a.token||(a.listener=n),a.id||(a.id=i),this.state.agenda.names[i]=!0,this.state.agenda.tasks.push(a))}this.sortAgenda(),this.req_Agenda()}},sortAgenda:function(){this.state.agenda.tasks.sort(function(t,e){return e.salience?t.salience?t.salience-e.salience:-1:1})},setObObj:function(t,e,n,a){for(var i in e)void 0!==e[i]&&(_.isObjectLike(e[i])?(t[i]||(t[i]={}),this.setObObj(t[i],e[i],n,a.concat(i))):t[i]!=e[i]&&(t[i]=e[i],n.addPath(a.concat(i))))},appendToArray:function(t,e,n){var a=_.get(this.state.wallet,t);if(!a)return e=[e],this.set(t,e,!1,n);var i=a.length,r=_.isArray(t)?t:t.split(".");return r.push(i),this.set(r,e,!1,n)},setByLoader:function(t,e){_.isArray(t)&&(t=t.join("."));var n=_.get(this.state.meta,t);if(!n||!n.loader||!n.loader.set)return!1;var a=s.init({},this,{},n.loader,{},this.state.loadersCache[t]);return e=n.loader.set(a,e),!0},set:function(t,e,n,a){this.historyManager.startStack({type:"set",path:t,value:e});try{if(this.setByLoader(t,e))return;var i=n?this.state.meta:this.state.wallet;_.set(i,t,e),this.state.currentVersion++,this.updateVersionForAll(t.split(".")),_.set(this.state.version,t+".version",this.state.currentVersion);var r=_.isArray(t)?t.join("."):t;this.getAffectedPaths(r),this.req_triggers()}catch(s){console.error(s)}finally{this.historyManager.endStack()}},affected:{},affected_checked:{},affected_version:1,markChangeOn:function(t,e,n,a){n&&this.affected_version++,e||this.pauseAll(),a&&(this.state.currentVersion++,this.updateVersion(t)),this.getAffectedPaths(t),e||this.req_triggers()},getAffectedPaths:function(t){if(this.state.cache[t]&&(this.state.cache[t].shouldUpdate=!0),!this.affected[t]||this.affected[t].affected_version!=this.affected_version){this.affected[t]={affected_version:this.affected_version,version:this.state.currentVersion,state:1};var e=t.split("."),n=e[0];this.getAffectedPaths(e[0]);for(var a=1;a<e.length-1;a++)n+="."+e[a],this.getAffectedPaths(n);var i=this.getInfluenced(t);for(var a in i)this.getAffectedPaths(i[a])}},markChangedPaths:function(t){for(var e=t.split("."),n=e[0],a=1;a<e.length;a++)n+="."+e[a],this.state.cache[n]&&(this.state.cache[n].shouldUpdate=!0),this.checkTriggers(n),this.setUpdateFlag(n)},changedPaths:{},setUpdateFlag:function(t){var e=this.getInfluenced(t),n=this.state.cache;for(var a in e)n[e[a]]&&(n[e[a]].shouldUpdate=!0),this.setUpdateFlag(n[e[a]]),this.checkTriggers(e[a])},checkTriggers:function(t){this.state.triggers[t]&&this.runTriggers(this.state.triggers[t],t)},runTriggers:function(t,e){for(var n in t)this.runTrigger(t[n],e,n)},runTrigger:function(t,e,n){if(_.isFunction(t.run))return t.run(t,e,n);var a=_.get(this.state.wallet,t.run);return _.isFunction(a)?a(t,e,n):a.run?a.run(t,e,n):void 0},run:function(t,e){},fetchValues:function(t,e,n,a,i,r){for(var s in e)if("type"!=s){var o=e[s];if(_.isString(o)){if("$"==o.charAt(0)){var l=o.substr(2);i&&i.add(l,s),o=a.getValue(l)}else if(r){var u=o;i&&i.add(u,s),o=a.getValue(u)}}else"fullPath"==o.KEY&&(path=o.path.join("."),i&&i.add(path,s),o=a.getValue(path));if(void 0===o)throw"postpone";var c=s;t[c]=o,t.src||(t.src={}),t.src[c]={key:e[s],slot:s}}return t},setCombined:function(t,e){this.historyManager.startStack({type:"setCombined",path:t,value:e});var n={loaders:{},loadersPaths:[],basePath:t.split("."),value:e,pins:[],afterOp:[]},a=this.iterate(e,[],n);if(n.pins.length){var i={};for(var r in n.pins){var s=n.pins[r];i[s.value||s.path.slice(-1)[0]]={path:s.path,fullPath:n.basePath.concat(s.path)}}var o=_.get(this.state.pins,t+".pins");o||_.set(this.state.pins,t+".pins",o={}),_.merge(o,i)}if(n.afterOp.length)for(var r in n.afterOp){var l=n.afterOp[r];if("gluePin"==l.type){var u={KEY:"fullPath",path:o[l.pin].fullPath};l.isLoader?_.set(n.loaders,l.dest,u):_.set(e,l.dest,u)}else"flags"==l.type&&l.flags.hasVersion&&this.updateVersion(l.path)}if(a||this.set(t,e,!1,!0),n.hasLoaders)for(var r in this.set(t,n.loaders,!0,!0),n.loadersPaths){var c=n.loadersPaths[r];this.setCache(c.join("."),{},!0);var d=_.get(this.state.meta,c);d.loader&&d.loader.autostart&&this.state.toStart.push({path:c.join(".")})}this.historyManager.endStack()},runToStart:function(){for(var t=this.state.toStart;t.length;){var e=t.shift();this.getValue(e.path)}},buildModel:function(t,e){var n,a=t.MODEL;t=_.cloneDeep(t),-1!=a.indexOf(":")&&(n=a.split(":"),a=n.shift(),t.tokens=n);var i=this.getValue(a);i.handleTokens&&n&&i.handleTokens(t,n,e);var r=_.cloneDeep(i.modelObj);if(i.modelSpec){var s=i.modelSpec;if(s.ops)for(var o in s.ops){var l=s.ops[o];if("replaceValue"==l.type){var u=_.get(t,l.source);l.dest?_.set(r,l.dest,u):r=u}else if("eval"==l.type){var c=l.fn(t,l);console.log(c),_.set(t,l.dest,c)}}s.isLoader&&(r={loader:r})}return void 0!==t.pin&&(r.pin=t.pin),this.historyManager.addInfo({type:"buildModel",path:e,input:t,obj:r}),r},iterate:function(t,e,n){for(;t&&t.MODEL;){var a=this.buildModel(t,n.basePath.concat(e));for(var i in t)delete t[i];_.merge(t,a)}var r=!0;for(var i in t){var s=e.concat(i);if("pin"==i)n.pins.push({subPath:s,path:e,value:t[i]}),delete t[i];else if("loader"==i)this.setLoader(n.loaders,e,t[i],n.basePath,n),n.loadersPaths.push(n.basePath.concat(e)),delete t[i],n.hasLoaders=!0;else if("flags"==i)n.afterOp.push({type:"flags",path:n.basePath.concat(e).join("."),relPath:e,flags:t.flags});else if(_.isString(t[i])&&"%"==t[i].charAt(0))t[i]=this.getStaticValue(t[i],i,t,s,n),r=!1;else if(_.isObjectLike(t[i])){this.iterate(t[i],s,n)||(r=!1),r=!1}else r=!1}return r},getStaticValue:function(t,e,n,a,i){return"%PATH"==t?i.basePath.concat(a):(i.afterOp.push({type:"gluePin",dest:a,pin:t.substring(1)}),{KEY:"relative path"})},getUID:function(){return this.state.nextUID++},setTrigger:function(t,e,n){this.state.triggers[t]||(this.state.triggers[t]={}),this.state.triggers[t][e]=n},getTrigger:function(t,e){return this.state.triggers[t]?this.state.triggers[t][e]:null},remTrigger:function(t,e){this.state.triggers[t]&&delete this.state.triggers[t][e]},setLoader:function(t,e,n,a,i){if(_.isString(n)){var r=a.concat(e).join("."),s=this.getTrigger(n,r);s&&s.path&&this.remTrigger(s.path,r),this.setTrigger(n,r,{run:"base.updateLoader",loaderPath:n,destination:r}),n=this.getValue(n)}this.prepareLoader(n,a,e.concat("loader"),i),_.set(t,e.concat("loader"),n)},prepareLoader:function(t,e,n,a){this.deepTransformObj(t,[],function(t,e,i){if(_.isString(t)&&"%"==t.charAt(0))return"%PATH"==t?a.basePath.concat(n):(a.afterOp.push({type:"gluePin",dest:n.concat(i),pin:t.substring(1),isLoader:!0}),{x:12})})},deepTransformObj:function(t,e,n){if(t&&_.isObject(t))for(var a in t){var i=n(t[a],a,e.concat([a]));void 0===i?_.isObject(t[a])&&this.deepTransformObj(t[a],e.concat([a]),n):t[a]=i}},setMap:function(t){for(var e in t)this.setCombined(e,t[e])},getFromDispatch:function(t){return this.getValue(t)},getVersion:function(t){for(var e=t.split("."),n=-1,a=this.state.version,i=0;i<e.length;i++){var r=e[i];if(!a[r])return n;(a=a[r]).version&&(n=a.version)}return n},getVersionTree:function(t){var e=this.state.version;return _.get(e,t)},updateVersionForAll:function(t){for(var e=0;e<t.length;e++)_.set(this.state.version,t.slice(0,e).concat("version"),this.state.currentVersion)},updateVersion:function(t){_.set(this.state.version,t+".version",this.state.currentVersion)},objectDiff:function(t,e){return function t(e,n){if(!_.isObject(e)||!_.isObject(n))return{change:{from:e,to:n}};var a={},i=!1;for(var r in n)if(void 0===e[r])a[r]={change:{from:void 0,to:n[r],type:"added"}},i=!0;else if(_.isFunction(n[r])&&e[r]&&n[r].toString()!=e[r].toString())a[r]={change:{from:e[r],to:n[r],type:"function changed"}},i=!0;else if(_.isObject(n[r])){var s=t(e[r],n[r]);s&&(a[r]=s,i=!0)}else n[r]!=e[r]&&(a[r]={change:{from:e[r],to:n[r],type:"changed"}},i=!0);for(var r in e)void 0===n[r]&&(i=!0,a[r]={change:{from:e[r],to:null,type:"deleted"}});return i?a:null}(t,e)},act:function(t,e,n){var a=_.isObject(t)?t:this.getValue(t);n||(n=this.tb());var i=r.init(a,this,e,t,n);return i},tb:function(){var t=s.init({},this,null,{},{},{});return t}},i=a.setup(),r={master:null,actions:null,args:null,init:function(t,e,n,a,i){var r=Object.create(this);return r.master=e,r.actions=t,r.args=n,r.path=a,r.tb=i,r},run:function(t,e){return this.actions[t].apply(this.actions,[e,this.tb])}},s={master:null,logger:null,spec:null,step:null,cache:null,v:null,init:function(t,e,n,a,i,r){var s=Object.create(this);return Object.assign(s,{wallet:t,master:e,logger:n,spec:a,step:i,cache:r}),s.v={},s},act:function(t,e){var n=this.master.act(t,e,this);return n},go:function(t,e){return this.toolbox||(this.toolbox=i.getValue("toolBox")),this.toolbox[t]?this.toolbox[t].run?this.toolbox[t].run(e,this):_.isFunction(this.toolbox[t])?this.toolbox[t](e,this):void 0:(console.log("no ",t),null)},path:function(){return _.isArray(this.step.srcPath)?this.step.srcPath.join("."):this.step.srcPath},fetch:function(t,e){return this.run_fetch(t,e)},run_fetch:function(t,e,n){var a=this,i=!1;(_.isString(t)||t.KEY)&&(i=!0,t={SINGLEPATH:t});var r={};for(var s in this.master.fetchValues(r,t,this.wallet,this.master,{add:function(t,e){if(a.logger){var i="SINGLEPATH"!==e?(n||[]).concat(e):n||[];a.logger.add(t,i.join("."))}}},!0),r)if(r[s]&&"routes"==r[s].type){var o="SINGLEPATH"!=s?(n||[]).concat(s):n;r[s]=this.run_fetch(r[s],null,o)}else if(r[s]&&"value"==r[s].type);else if(r[s]&&_.isString(r[s])&&"$"==r[s].charAt(0)){var l="SINGLEPATH"!=s?(n||[]).concat(s):n;r[s]=this.run_fetch(r[s].substring(2),null,l)}if(i&&(r=r.SINGLEPATH),e){if(e.src){var u=r.src;delete r.src,_.merge(e.src,u)}return Object.assign(e,r),e}return r},pathOf:function(t){return(t=this.v.src[t]).key?t.key:_.isString(t)?t:void 0},set:function(t,e){for(var n=this.v,a=_.isString(t)?t.split("."):t,i=null,r=0;r<a.length;r++){var s=a[r];if(n.src&&n.src[s]&&(i={src:n.src[s],left:a.slice(r+1)}),!n[s])break;n=n[s]}if(i){var o=(_.isString(i.src.key)?i.src.key.split("."):i.src.key.path).concat(i.left).join(".");this.master.set(o,e)}},detach:function(){var t=Object.create(this);return t.v={},t.logger=null,t},feed:function(t){for(var e=this.master.getValue(t).init(),n=1;n<arguments.length;n++)e.in(arguments[n]);return e}};try{window.DataManager||(window.DataManager=i,window._DataManager=a)}catch(o){}},76:function(t,e,n){t.exports=n.p+"static/media/logo.06a44ff7.svg"},77:function(t,e,n){}},[[132,2,1]]]);
//# sourceMappingURL=main.0ed755dc.chunk.js.map