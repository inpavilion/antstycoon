{"version":3,"sources":["units/units/db.js","units/units/reactAssembler.js","components/CodeMirrorEditor.js","managers/KeyboardManager.js","managers/TimerManager.js","units/main.js","units/units/actionFlow.js","units/units/brand.js","units/units/bubbleBoard.js","units/units/bubbleFlow.js","units/units/bubbleGuns.js","units/units/bubbleTest.js","units/units/bubbleTypes.js","units/units/parseObjIntoMold.js","units/units/parseStringIntoComp.js","units/units/prettyScode.js","components/MyInput.js","components/TreeDiagram.js","components/TreeMap.js","units/units/reactUtils.js","units/units/store.js","units/units/testDataGenerator.js","units/units/testMolds.js","units/units/testTplAssembling.js","units/units/tplObjParse.js","units/units/treeCardsBuilder.js","units/units/treeIterator.js","units/units/uids.js","units/init.js","units/index.js","FlatAnt7.js","App.js","serviceWorker.js","index.js","../../data-department/dataManager.js","logo.svg"],"names":["lodash__WEBPACK_IMPORTED_MODULE_0__","__webpack_require__","lodash__WEBPACK_IMPORTED_MODULE_0___default","n","faker__WEBPACK_IMPORTED_MODULE_1__","faker__WEBPACK_IMPORTED_MODULE_1___default","pouchdb__WEBPACK_IMPORTED_MODULE_2__","pouchdb_find__WEBPACK_IMPORTED_MODULE_3__","pouchdb_quick_search__WEBPACK_IMPORTED_MODULE_4__","pouchdb_quick_search__WEBPACK_IMPORTED_MODULE_4___default","PouchDB","plugin","PouchDBFind","PouchDBQuickSearch","cu","window","ub","ctx","serialize","obj","item","_","cloneDeepWith","value","isFunction","TYPE","body","toString","createdAt","Date","now","deserialize","fn","eval","e","save","id","db","this","uid","generateUid","_id","console","log","get","then","doc","rev","_rev","put","i","catch","err","load","_this","cfg","state","nextId","prefix","init","name","auto_compaction","getTime","Math","random","Object","create","destroy","alert","loadfilter","selector","count","sort","find","partialTextSearch","word","query","emit","text","split","filter","length","forEach","element","type","map","mapId","parent","parentId","test","startKey","endKey","searchText","search","fields","include_docs","highlighting","loadFromIndex","sortField","sortDir","limit","$gt","set","createIndex","index","result","docs","x","y","obj2","run","def","debug","tb","model","data","getter","cloneDeep","mold","tpl","applyOps","ops","props","tplid","a","b","stage","path","newOps","op","action","join","myPath","slice","push","PATH","unset","VALUE","error","inputs","#color","#handle","#test2","#test1","#title","tests","pin","reactAssembler","moldAssembler","require","Component","DataManager","KeyboardManager","setup","isInitialized","$","on","evt","handleKey","setTrigger","layout","getValue","altKey","ctrlKey","metaKey","shiftKey","key","toLowerCase","comb","TimerManager","wallet","timers","start","delay","clearTimeout","timer","setTimeout","cancel","date","end","actionsBundle","saveItems","v","items","isArray","values","uids","actions","pinTo","append","appendById","loadItem","loadedItems","loadItems","setValue","ids","keys","searchItems","loadFilter","core","triggerRerun","val","running","shouldRerun","runAllOps","prepareOp","args","src","input","isString","undefined","partial","missing","OP","runOp","getUid","waitfor","master","opIsDone","ncOps","checkGuards","staticValue","privat","getFromPrivate","getValueWithPrefix","triggers","isPartial","guards","target","slot","generic","assembleObj","opState","isEqual","tpls","listTemplate","list","useTpl","flowGuards","makeTriggers","makeTrigger","guard","trigger","opt","opsCollection","valuesChain","open","temp","addTriggers","addActionsCollection","addMainOps","addValuesChains","chains","chain","collection","info","fetchCollection","addActions","assign","isCollection","merge","getAction","addOps","triggerCollection","concat","opName","extra","isTemp","changeData","getOpen","memo","applyValuesChain","reset","actionFlow","specs","setupFlow","opts","_this2","actionsFlow","refreshOpen","getRandomFn","str","seed","charCodeAt","sin","floor","getBrand","randomFn","baseBrand","brand","mainColor_hsl","getColor","complementColor_hsl","mainColor","complementColor","fadedColor","pastelColor","baseColor","hue","color","chroma","hsl","getRandom","scale","max","pointsStar","polies","_loop","j","poligonPoints","col","classname","round","points","getLogo","bubbleBoard","addItem","getId","mergeItem","minStep","changed","appendTo","results","versions","isReady","completedAt","rewindTo","onchanged","step","hasChanges","bubbleid","charAt","substring","isObject","isMatch","version","evalItems","affected","_evalItems","isCompleteValues","evalItem","node","getNode","bubble","defaultsDeep","trails","rels","bellow","above","uses","checkIfComplete","evaluateflow","getVersion","bubbleFlow","fns","doubleCheck","evaluate","checks","check","shaddow","score","subs","total","resolved","unresolved","tplParams","defined","parameters","param","targetId","_setup","shaft","fullPath","getFull","route","base","relPath","fetch","it","cb","oldValues","sub","paths","stateCurrentId","currentItem","targetid","compile","clues","needes","provides","collections","subScore","params","undefinedCount","definedCount","bubbleGuns","bubbleTypes","dispatch","bubbleTest","nodeType","tplObjParse","viewAs","dataNode","reactNode","neededValues","cues","pins","mirror","description","newItem","bubbles","cache","newId","newValues","mirrorBubble","types","payload","oldPayload","comments","getTpl","opValues","newValue","indexOf","replace","addOp","addComment","comment","finalOp","firstChar","concatParent","parseObjIntoMold","phase1","html","trim","nest","document","createElement","innerHTML","childNodes","el","spec","_spec","nodeValue","attributes","attr","all","char","toUpperCase","class","className","style","_style","componentName","nodeName","children","htmlSlot","child","match","reg","css","exec","phase2","attrs","watchAttrs","iterate","handleObj","childrenPath","subPath","handleProp","prepareAction","concatOp","_this3","parseStringIntoComp","nextUID","makestr","indent","usequouts","js_beautify","indent_size","indent_level","preserve_newlines","max_preserve_newlines","indent_inner_html","trimStart","lines","isObjectLike","isNil","beautify","prettyScode","MyInput","classCallCheck","possibleConstructorReturn","getPrototypeOf","call","onChange","bind","assertThisInitialized","setState","nextProps","React","MapDiagram","ref","createRef","makeTree","drawTree","graph","svg","d3","current","d3cola","webcola","avoidOverlaps","h","height","w","width","nodes","radius","pageBounds","realGraphNodes","topLeft","fixed","tlIndex","bottomRight","brIndex","constraints","nodeRadius","axis","left","right","gap","size","links","linkDistance","flowLayout","symmetricDiffLinkLengths","selectAll","enter","d","drag","titles","source","newprops","react_default","TreeMap","vis","DataSet","edges","network","Network","randomSeed","improvedLayout","hierarchical","autoResize","borderWidth","borderWidthSelected","border","background","font","strokeWidth","shape","shapeProperties","borderRadius","physics","stabilization","onlyDynamicEdges","adaptiveTimestep","event","stopPropagation","preventDefault","getNodeAt","pointer","DOM","onClick","blur","options","colors","main","pastel","setOptions","update","clear","add","focus","customComponents","myinput","mapdiagram","treemap","makeComponent","flattenDeep","component","reactUtils","tplComponent","createStore","hapi","store","parents","change","runWith","runWithParam","getItem","getSubs","registerTpl","cases","faker","company","catchPhrase","setter","level","generated","uuid","arrayElement","prepare","ret","integrate","addPayload","_case","testDataGenerator","parser","testMolds","parseTpl","renderTpl","assembleTpl","molds","iterateBubbles","shouldAssemble","isRegistered","addBubble","computedAtStep","addedAtStep","salut","testTplAssembing","value_setter","content","#test","tplId","isUnparsedTpl","isObjTpl","parseHtml","parseObj","_check","payload1","tplsMapping","defaultTpl","usedGlobalStyles","addSubs","card","useTemplate","skipGlobalStyle","root","globalStyle","title","getMolds","buildTpls","iterator","addGlobalStyles","gbs","styles","makeSelector","treeCardsBuilder","repo","mappings","treeIterator","mub","pending","passes","shift","group","groupEnd","ctxpins","newAPI","TimerManagerBuilder","myUB","setCombined","loader","fnsub","make","old","setupAll","makeUb","tb.db","goSetup","autostart","runAll","scrollIntoViewSelected","scrollIntoViewIfNeeded","alertAnimation","addClass","removeClass","onready","request_save","waiting","c","promise","Promise","resolve","setupRequired","ubs","detach","getFromParent","names","addUb","addUbs","setupUb","_this4","getItemsToSave","promises","makePreview","argsArray","antId","makeTreeMap","getStatisticsView","refresh","shops","go","actionName","getWallet","createShop","view","loaderPath","blockcfg","markChangeOn","tree","treeTemplate","processNode","makeNode","startId","startNode","maxLevel","field","defaultValue","makeMold","outcome","import","my","runop","combineMoldInOps","needed","maps","previewIds","no","previews","myx","iterateList","generatePreview","DONE","generatePreviewItems","getItemsWithsNoPreview","subitems","line","time","timestamp","xcontent","getSubitems","placedAt","makeTime","moment","fromNow","reject","runopOnList","opargs","selectIds","withPreview","preview","rels.allSubs","summary","updatedAt","use","latestSubs","bundle","getLatestSubs","latest","startedAt","position","slots","swot","strengths","weaknesses","opportunities","threats","linkedMap","linked","{id.4}","allSubs","{id.0}","{id.1}","{id.2}","{id.3}","{id.5}","ants","rel","subject","relAttr","toSave","swotId","generateIds","antsDbState","_s","getActions","select","getNodes","parentIndex","getNodesVis","label","to","from","showMindMap","runOnLoader","showhud","currentView","goToCard","placeorder","which","flow","place","restart","parseinput","prepareMenu","parse","checkTokenMatch","token","hasTail","tokens","checkToken","scout","msg","nextMatch","finalMatch","lastIndex","lastToken","menuHandling","setContent","skipFocus","afterRenderActions","goToInfo","bridge","bridgeLoader","loadBridge","selectMap","mapview","loadMap","makeSwot","shop","getAll","showMenu","hideMenu","addEntries","showSearch","noPlace","substr","editStartedAt","firstCharAt","getParent","prevStep","selectItem","addInfo","changeItem","createMap","ant","history","changeAt","hasInfo","mergeRoot","_this5","startIds","related","top","notdb","recent","_this6","is","isVisible","ant1","_this7","customTpl","logo","generateId","skipPreview","triggerChange","_this8","timerPreview","setRel","mapView","frame","topic","entry","other","button","handle","bridgeTitle","mapTitle","uistate","rows","selected","otherTpl","moldsMap","cardMold","getBody","setV","cleanV","getBodyList","isSelected","afterContent","getHandle","String","fromCharCode","moldName","titleMold","titlePath","addVFn","tplSpecs","byLevel","borderColor","advanceView","makeItem","makeList","stack","clean","stacks","pop","_this9","onbeforeunload","saveAll","loadAll","_this10","tosave","savings","saveitem","loaditem","onload","runOn","starter","done","overPanel","bubbleitem","menuitem","orderText","order","loading","dependsOn","updateVersionsMap","viewState","menu","changeOrder","bumbAction","placeOrder","dim","barHeight","bubbleList","bumb","textColor","panel","historyManager","recording","runToStart","Frame","_this11","_this12","components","FlatAnt","_this13","scode","FlatAnt7_Frame","App","FlatAnt7","isLocalhost","Boolean","location","hostname","registerValidSW","swUrl","config","navigator","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","ReactDOM","render","src_App_0","getElementById","publicUrl","URL","process","href","origin","addEventListener","response","contentType","headers","status","ready","unregister","reload","checkValidServiceWorker","currentStack","startStack","prevStack","skipClone","endStack","_DataManager","gettingValue","meta","loadersCache","currentVersion","dependencies","agenda","tasks","toStart","flags","setCtx","basePath","ctxPath","getCtx","runFn","fnName","targetPath","getInfluenced","influenced","dep","skipPartialValueCheck","checkCache","partialPath","partialResult","partialSlot","partialValue","listToValue","setCache","shouldUpdate","ignoreUpdates","prepareCache","contains","diffCache","oldCache","addDependency","remDependency","newC","oldC","depOn","walletValue","srcPath","rootPath","_item","_i","silentSet","skipPathAffected","getAffectedPaths","postponedSteps","hasSteps","snoozeCount","getFromLoader","addLog","lhs","rhs","cachedValue","xcache","requester","force","logger","prism","loadedPrism","getFromDispatch","_value","TB","skipCache","runUtils","apply","mergeValue","oldValue","changedPaths","addPath","pauseAll","setObObj","updateVersionForAll","req_triggers","runningReqTriggers_timer","clearInterval","runningAgendaTriggers_timer","setInterval","callback","stop","requestAnimationFrame","stopFn","asyncTriggers","affected_checked","lazy_checkTriggers","req_Agenda","asyncTriggersAgenda","runTrigger","listener","sortAgenda","taskA","taskB","salience","appendToArray","setVersion","setByLoader","isLoaders","strPath","affected_version","skipTrigger","incAffected","incVersion","updateVersion","markChangedPaths","checkTriggers","setUpdateFlag","runTriggers","fetchValues","onlyPaths","_path","_path2","KEY","loaders","loadersPaths","afterOp","isEmpty","currentPins","_pin","pinKey","isLoader","dest","hasVersion","hasLoaders","lPath","buildModel","modelName","MODEL","handleTokens","modelObj","modelSpec","_value2","newObj","setLoader","getStaticValue","getUID","getTrigger","remTrigger","listenerPath","oldTrigger","destination","prepareLoader","deepTransformObj","setMap","versionsTree","getVersionTree","objectDiff","oldObject","newObject","changes","oldO","newO","subChanges","act","ACT","toolbox","run_fetch","singlePath","SINGLEPATH","subPrefix","_subPrefix","pathOf","last_src","detached","feed","arguments","in","module","exports","p"],"mappings":"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","file":"static/js/main.36985239.chunk.js","sourcesContent":["import _ from \"lodash\"\nimport faker from \"faker\"\nimport PouchDB from \"pouchdb\"\nimport PouchDBFind from 'pouchdb-find';\nimport PouchDBQuickSearch from 'pouchdb-quick-search';\n\nPouchDB.plugin(PouchDBFind);\nPouchDB.plugin(PouchDBQuickSearch);\n\nvar cu = window.cu;\n\n\nvar ub = {\n\n    ctx: {},\n\n    serialize : function( obj ) {\n        let item = _.cloneDeepWith( obj, function ( value ) {\n            if ( _.isFunction( value ) ) return { TYPE : \"FN\", body : value.toString() };\n        })\n\n        if ( !item.createdAt ) item.createdAt = Date.now();\n\n        return item;\n    },\n\n    deserialize : function ( obj ) {\n        let item = _.cloneDeepWith( obj, function ( value ) {\n            if ( value && value.TYPE == \"FN\" ) {\n                let fn;\n                try  { \n                    eval( \"fn=\" + value.body )\n                } catch (e ) {\n\n                }\n                return fn;\n            } \n        })\n\n        return item;\n    },\n\n    save: function (value, id) {\n        var db = this.ctx.db;\n\n        let item = this.serialize( value );\n        if (!item.uid) item.uid = id || item.id || this.generateUid();\n        if (!item._id) item._id = item.uid;\n  \n        console.log( \"item\", item)\n        return db.get(item._id)\n          .then((doc) => {\n            let rev = doc.rev;\n            let _rev = doc._rev;\n\n            item.rev = rev;\n            item._rev = _rev;\n            return db.put(item).then( ( i)=> {\n            })\n          })\n          .catch(err => {\n            return db.put(item);\n          })\n\n\n\n    },\n\n\n\n    load: function (id) {\n        return this.ctx.db.get(id).catch( e => {\n            return null\n        })\n        .then ( item => {\n            if ( item ) item = this.deserialize( item );\n            return item;\n        })\n    },\n\n\n    generateUid : function ( ) {\n        this.cfg.state.nextId++;\n        return this.cfg.state.prefix + \"_\" + this.cfg.state.nextId;\n    },\n\n    init: function (name) {\n        let ctx = {\n            db: new PouchDB(name, {auto_compaction: true}),\n            state: {\n                prefix: new Date().getTime().toString() + \"_\" + Math.random().toString(),\n                nextId: 0,\n                id : \"state\"\n            }\n        }\n\n        let item = Object.create(this);\n\n        item.ctx = ctx;\n\n        item.load(\"state\").then(state => {\n            if ( state ) item.ctx.state = state\n            else item.save( item.ctx.state )\n        })\n\n        return item;\n    },\n\n    destroy : function ( ) {\n        this.ctx.db.destroy( ) \n            .then ( () => {\n\n                alert( \"done cleanup\")\n            })\n    },\n\n    loadfilter : function ( selector, count, sort ) {\n        return this.ctx.db.find( { selector });\n    },\n\n    partialTextSearch : function ( word ) { \n        return this.ctx.db.query( (doc, emit)=> {\n            if ( !doc.text ) return;\n            let tokens = doc.text.split( /\\s+/g );\n            tokens.filter( word => word.length > 2 ).forEach(element => {\n                emit( element, { type : doc.type, map : doc.mapId , parent : doc.parentId ,test : \"salut\"} )\n            });\n        }, {startKey : word, endKey : word + \"\\0\"})\n    },\n\n    searchText : function ( text ) {\n        return this.ctx.db.search( {\n            query: text ,\n            fields: ['title', 'text'],\n            include_docs: true,\n            highlighting: true\n          })\n    },\n\n    loadFromIndex : function ( selector, sortField, sortDir, limit, fields ) {\n        let db = this.ctx.db;\n        //let fields = _.uniq( Object.keys(sort).concat(Object.keys( selector )) );\n\n        if ( !selector[sortField] ) selector[sortField] = { $gt : null };\n        let sort = [_.set( {}, sortField, sortDir ? \"desc\" : \"asc\")]\n        return (\n            db.createIndex(\n                {index : {\n                    fields : fields\n                }}\n            )\n            .then ( (result)=>{\n                return result.name\n            })\n            .then( (index )=>{\n                //db.explain( {selector, limit, sort}) .then( (res)=> console.log( \"explain\", res ))\n                return db.find( {selector , limit, sort}).then( result => result.docs)\n            })\n        ) \n\n    }\n\n\n\n}\n\nvar test = (result) => {\n    result.obj = ub.serialize( {x : function ( ) {} , y : \"test\"})\n\n    result.obj2 = ub.deserialize( result.obj );\n\n    ub.init(\"testdb\")\n}\n\n\ncu.db = {\n    //test,\n    run: function (name) {\n        return ub.init(name);\n    },\n\n    def: `\n    `,\n\n    debug: {\n        ub: ub\n    }\n}","import _ from \"lodash\"\nvar cu = window.cu;\n\n\nvar ub = {\n\n    ctx: {\n        tb: {}\n    },\n\n    run: function (model, data, getter) {\n        model = _.cloneDeep(model);\n        let obj = model.mold.tpl;\n\n        this.applyOps(model.mold.ops, obj, data, getter);\n\n\n        if (obj.props)\n            obj.props.tplid = model.uid;\n\n\n        return obj;\n    },\n\n    applyOps: function (ops, obj, data, getter) {\n        let get = getter || _.get;\n\n        ops.sort( (a,b) => {\n            if ( a.stage != b.stage) return a.stage - b.stage;\n\n            return ( b.path.length - a.path.length )\n        } )\n\n        let newOps = [];\n        for (var i = 0; i < ops.length; i++) {\n\n            let op = ops[i];\n\n            if (op.type == \"value\") {\n                let value = get(data, op.action, op, newOps);\n                _.set(obj, op.path, value)\n            }\n            else if (op.type == \"computedValue\") {\n                let value = op.value;\n                _.set(obj, op.path, value)\n            }\n            else if (op.type == \"concat\") {\n                let value = get(obj, op.path, op, newOps).join(\"\");\n                _.set(obj, op.path, value)\n            }\n            else if (op.type == \"pathSet\") {\n                let value = get(obj, op.path, op, newOps);\n\n                let myPath = op.path.slice( 0, op.path.length - 1 );\n                myPath.push( value.PATH )\n                _.unset( obj, op.path )\n                _.set( obj, myPath.join(\".\"), value.VALUE );\n            }\n            else if (op.type == \"makeFunction\") {\n                let body = get(obj, op.path, op, newOps).join(\"\");\n                try {\n                    let fn;\n                    eval(\"fn=\" + body)\n\n                    _.set(obj, op.path, fn)\n                }\n                catch (e) {\n                    console.error ( \"makeFunction::\" + body)\n                }\n            }\n        }\n\n        if (newOps.length)\n            this.applyOps(newOps, obj, data, getter)\n    },\n\n\n}\n\n\nvar inputs = {\n    data: {\n        \"#color\": 12,\n        \"#handle\": \"handle\",\n        \"#test2\": \"test2\",\n        \"#test1\": \"test1\",\n        \"#title\": \"title it is\",\n    }\n}\n\nvar test = (result) => {\n\n    let mold = cu.tests.get(\"mold.x\");\n\n    if (!mold) return \"pending\";\n\n    let value = ub.run(mold, inputs.data);\n\n    result.value = value;\n    result.mold = mold;\n\n    cu.tests.pin(\"reactTree\", value)\n\n    //result.mold = value;\n}\n\ncu.reactAssembler = {\n    //test,\n\n    run: function (mold, data, getter) {\n        return ub.run(mold, data, getter)\n    },\n\n    init: function () {\n    },\n\n    def: `\n    `,\n\n    debug: {\n        ub: ub\n    }\n}\n\ncu.moldAssembler = cu.reactAssembler;","\nimport React, { Component } from 'react';\nimport { UnControlled as CodeMirror } from 'react-codemirror2'\nimport 'codemirror/lib/codemirror.css';\nrequire('codemirror/mode/javascript/javascript');\n\nclass CodeMirrorEditor extends Component {\n\n  constructor(props) {\n    super(props);\n\n    this.state = {};\n\n    this.changeValue = this.changeValue.bind(this);\n    this.changeCursor = this.changeCursor.bind(this);\n    this.isBlured = this.isBlured.bind(this);\n  }\n\n  changeValue(editor, data, value) {\n\n    if (!this.props || !this.props.valueChanged)\n      return;\n\n    //window.editor = editor;\n\n\n    let cursor = editor.getCursor();\n    if (data.origin != undefined) {\n      this.props.valueChanged({ scode: value, cursor: { line: cursor.line, ch: cursor.ch } });\n    }\n    else {\n      this.props.valueChanged({ scode: value })\n    }\n\n    this.setState({ caret: editor.cursorCoords(true, \"local\") })\n  }\n\n  changeCursor(editor, cursor) {\n    this.setState({ caret: editor.cursorCoords(true, \"local\") })\n\n    if (cursor.sticky == undefined) return;\n\n    if (!this.props || !this.props.valueChanged)\n      return;\n\n    this.props.valueChanged({ cursor: { line: cursor.line, ch: cursor.ch } });\n\n  }\n  isBlured() {\n    if (this.props.blured)\n      this.props.blured()\n  }\n\n  render() {\n\n    //this means that setting the value with null will delete the value from wallet ?!?\n    let text = this.props.data.scode || \"\";\n    if (!text.length) text = \"\";\n\n    let cursor = this.props.data.cursor;\n    if (!cursor || !cursor.ch) cursor = 0;\n\n    let popup;\n    let caret = this.state.caret || { right : 0, bottom : 0} \n    if (caret) {\n\n      let left = caret.right + 30;\n      let top = caret.bottom + 0;\n\n      popup = <div className=\"popup\" style={{ transform: \"translate(\" + left + \"px ,\" + top + \"px)\", zIndex: 100 }} > Salut  </div>\n    }\n    else popup = null;\n\n    let style = `\n      .popup { border : 1px solid #999; background : #bbb; padding : 10px; min-width:40px; width : 100px; transition : all 0.2s ease; }\n\n      .popup { opacity : 0.05; position : absolute;pointer-events: none;}\n    `\n    return <div style={{position:\"relative\"}}>\n      <style>{style}</style>\n      {popup}\n      <CodeMirror\n        value={text}\n\n        options={{\n          mode: 'javascript',\n          lineNumbers: true, \n          smartIndent : true,\n        }}\n\n        autoCursor={false}\n\n        cursor={cursor}\n        ///onBeforeChange={this.changeValue}\n        onChange={this.changeValue}\n        onCursor={this.changeCursor}\n        onBlur={this.isBlured}\n      />\n    </div>\n  }\n}\n\nexport default CodeMirrorEditor;","import React, { Component } from 'react';\nimport _ from \"lodash\";\nimport $ from \"jquery\";\nimport go from \"gojs\";\nimport \"../libs/dataManager\";\nvar DataManager = window.DataManager;\n\n\nvar KeyboardManager = {\n    setup: function () {\n        if (this.isInitialized) return;\n\n        $(\"body\").on(\"keydown\", (evt) => {\n            this.handleKey(evt)\n        })\n\n        DataManager.setTrigger(\"keyboardShortcuts.layout\", \"kbdManager\", {\n            run: () => {\n                this.load();\n            }\n        })\n        this.load();\n    },\n\n    load: function () {\n        let layout = DataManager.getValue(\"keyboardShortcuts.layout\");\n        this.layout = layout || {};\n    },\n\n    handleKey: function (evt) {\n        var name = [];\n        if (evt.altKey) name.push(\"alt\");\n        if (evt.ctrlKey) name.push(\"ctrl\");\n        if (evt.metaKey) name.push(\"meta\");\n        if (evt.shiftKey) name.push(\"shift\");\n\n        name.push(evt.key.toLowerCase())\n        let comb = name.join(\"+\");\n\n        if (this.layout[comb])\n            return this.run(this.layout[comb], comb)\n    },\n\n    run: function (action,comb) {\n        if (_.isFunction(action)) return action(comb, action);\n        else if (action.run)\n            return action.run(comb, action)\n    }\n}\n\nKeyboardManager.setup();\n\nexport default KeyboardManager","var TimerManager = {\n    init : function ( DataManager ) {\n      var item = Object.create( this );\n\n      item.DataManager = DataManager;\n      item.wallet = {timers : {} }\n      return item;\n    },\n    wallet: { timers: {} },\n  \n    start: function (name, action, delay) {\n      if (this.wallet.timers[name]) window.clearTimeout(this.wallet.timers[name]);\n  \n      var timer = window.setTimeout(() => {\n        this.cancel( name );\n        action(name, action, delay);\n      }, delay)\n  \n      this.wallet.timers[name] = timer;\n\n      let date = new Date();\n      this.DataManager.set(\"TimerManager.timer.\"  + name , { start : date.getTime(), end : date.getTime() + delay })\n    },\n  \n    cancel: function (name) {\n      if (this.wallet.timers[name]) window.clearTimeout(this.wallet.timers[name]);\n      delete this.wallet.timers[name]\n      this.DataManager.set(\"TimerManager.timer.\"  + name , \"\")\n\n    }\n  }\n\n  export {TimerManager};","\nvar cu = {}\n\nwindow.cu = cu;\n\nexport default cu;\n","import _ from \"lodash\"\nimport faker from \"faker\"\nvar cu = window.cu;\n\n\nvar actionsBundle = {}\n\nactionsBundle.db = {\n\n    saveItems : function ( op, v ) {\n\n        let items;\n        \n        if ( _.isArray( op.items ) ) items =op.items;\n        else if ( op.items.id ) items =  [op.items]\n        else items =  Object.values( op.items );\n\n        v.tb.db.saveItems( cu.uids.run() , items )\n            .then( result => {\n                console.log( \"saveItems\", result)\n                v.actions.pinTo(op, result, v)\n\n            })\n\n        \n        if (op.append)\n        v.actions.appendById({ path: op.append, value: items }, v)\n\n\n    },\n\n    loadItem: function (op, v) {\n\n        let promise;\n        let loadedItems;\n\n        if ( op.append && v.data[ op.append ]) {\n            loadedItems =  v.data[ op.append ];\n        }\n\n        v.tb.db.loadItems([op.id], loadedItems ).then(item => {\n\n            if (v.cancel) return;\n\n            if (op.append)\n                v.actions.appendById({ path: op.append, value: item }, v)\n\n\n            if (op.pin)\n                v.actions.setValue({ path: op.pin, value: item[0] }, v)\n\n        })\n    },\n\n    loadItems: function (op, v) {\n        let ids = _.isArray(op.ids) ? op.ids : Object.keys(op.ids);\n        let loadedItems;\n\n        if ( op.append && v.data[ op.append ]) {\n            loadedItems =  v.data[ op.append ];\n        }\n\n\n        v.tb.db.loadItems(ids, loadedItems).then(items => {\n\n            if (v.cancel) return;\n\n            if (op.append) {\n                v.actions.appendById({ path: op.append, value: items }, v)\n            }\n            if (op.pin)\n                v.actions.setValue({ path: op.pin, value: items }, v)\n        })\n    },\n\n\n    loadFromIndex : function ( op, v ) {\n        v.tb.db.loadFromIndex( op ).then( items => {\n\n            if (v.cancel) return;\n\n\n            if (op.append) {\n                v.actions.appendById({ path: op.append, value: items }, v)\n            }\n            if (op.pin)\n                v.actions.setValue({ path: op.pin, value: items }, v)\n        } )\n    },\n\n    searchItems: function (op, v) {\n        let filter = op.filter;\n\n        v.tb.db.loadFilter(filter).then(docs => {\n\n            let items = docs.docs;\n\n            if (v.cancel) return;\n\n\n\n            if (op.append) {\n                v.actions.appendById({ path: op.append, value: items }, v)\n            }\n            if (op.pin)\n                v.actions.setValue({ path: op.pin, value: items }, v)\n        })\n    },\n\n\n    searchText: function (op, v) {\n        this.tb.db.searchText(op.text).then(items => {\n\n            if (v.cancel) return;\n\n\n            if (op.pin)\n                v.actions.setValue({ path: op.pin, value: items }, v)\n        })\n    },\n\n}\nactionsBundle.core = {\n    triggerRerun: function (val, v) {\n        if (v.running) {\n            v.shouldRerun = true;\n        }\n        else {\n            v.actions.runAllOps({}, v);\n        }\n    },\n\n    prepareOp: function (op, v) {\n        let args = { src: {} };\n        for (var i in op.input) {\n            if (i == \"type\") args.type = op.input[i];\n            else if (!_.isString(op.input[i])) args[i] = op.input[i]\n            else {\n                args.src[i] = op.input[i];\n                let value = v.actions.getValue(op.input[i], v);\n                if (value === undefined) {\n                    if (!op.partial)\n                        return null;\n                    else {\n                        if (!args.missing) args.missing = [];\n                        args.missing.push(i);\n                    }\n                }\n                else args[i] = value;\n            }\n        }\n        for (var i in op) {\n            if (i != \"input\")\n                args[i] = op[i]\n        }\n\n        args.OP = op;\n\n        return args;\n    },\n    runOp: function (op, v) {\n        if (!op.uid) op.uid = v.actions.getUid(\"\", v);\n\n        if ( op.waitfor ) {\n\n            let satisfied = true;\n\n            for ( var i in op.waitfor ) {\n                let value = v.actions.getValue( op.waitfor[i], v );\n                if ( value === undefined ) return \"notcomplete\"\n            }\n        }\n\n        let args = v.actions.prepareOp(op, v);\n        if (args === null) {\n            return \"notcomplete\";\n        }\n\n        if (args.name) args.pin = args.name;\n\n\n        if ( args.partial && args.on && args.on.partial ) {\n            if ( args.on.partial.value !== undefined ){\n                v.actions.pinTo( args,args.on.partial.value, v );\n                return;\n            }\n        }\n\n        if (!v.actions[args.type]) {\n            console.error({ v, args, op })\n        }\n        let value = v.actions[args.type](args, v);\n\n        if (value === \"notcomplete\") return \"notcomplete\";\n    },\n\n    getUid: function (args, v) {\n        v.master.state.nextId++;\n        let id = \"op_\" + v.master.state.nextId;\n        return id;\n    },\n\n    opIsDone: function (op, v) {\n        if (op.partial) return false;\n        if (!op.pin) return false;\n\n        return _.get(v.data, op.pin) !== undefined;\n\n    },\n    runAllOps: function (args, v) {\n        v.ncOps = [];\n\n        v.running = true;\n        v.shouldRerun = false;\n\n        for (var i in v.ops) {\n            let op = v.ops[i];\n\n            let isDone = v.actions.opIsDone(op, v)\n            if (!isDone) {\n                let value = v.actions.runOp(op, v);\n\n                if (value === \"notcomplete\") v.ncOps.push(op)\n                else v.shouldRerun = true;\n            }\n        }\n\n        v.ops = v.ncOps;\n\n        v.running = false;\n\n        if (v.shouldRerun) {\n            v.shouldRerun = false;\n            this.runAllOps(args, v)\n        }\n\n        else {\n            if (v.ncOps.length == 0) {\n                v.actions.checkGuards({ path: \"DONE\" }, v)\n            }\n            else {\n                //console.log( \"pending\", {v})\n            }\n        }\n\n\n\n    },\n\n}\n\nactionsBundle.values = {\n    pinTo: function (args, value, v) {\n        if (args.pin) {\n            v.actions.setValue({ path: args.pin, value: value }, v)\n        }\n    },\n\n    staticValue: function (args, v) {\n        v.actions.pinTo(args, args.value, v)\n    },\n\n    getValue: function (path, v) {\n        if (v.privat) return this.getFromPrivate( path, v );\n        if (v.prefix) return this.getValueWithPrefix(path, v)\n        return _.get(v.data, path);\n    },\n\n    getFromPrivate : function ( path, v  ) {\n        let value = _.get( v.privat, path );\n        if ( value != undefined ) return value;\n\n        if (v.prefix) return this.getValueWithPrefix(path, v)\n\n        return _.get(v.data, path);\n    } ,\n\n    getValueWithPrefix: function (path, v) {\n        let value = _.get(v.data, v.prefix + \".\" + path);\n        if (value === undefined) value = _.get(v.data, path);\n        return value;\n    },\n\n\n    checkGuards: function (val, v) {\n\n        var triggers = v.triggers[val.path];\n\n        if (triggers) {\n\n            if (!_.isArray(triggers)) triggers = [triggers];\n\n            triggers.forEach(item => {\n                if (_.isFunction(item))\n                    item(val.path, val.value, val.isPartial, v)\n                else if (item.run)\n                    item.run(val.path, val.value, val.isPartial, v)\n\n            })\n\n        }\n\n        if (v.guards) {\n            var triggers = v.guards[val.path];\n\n            if (triggers) {\n\n                if (!_.isArray(triggers)) triggers = [triggers];\n\n                triggers.forEach(item => {\n                    if (_.isFunction(item))\n                        item(val.path, val.value, val.isPartial, v)\n                    else if (item.run)\n                        item.run(val.path, val.value, val.isPartial, v)\n\n                })\n            }\n        }\n\n    },\n\n\n    setValue: function (val, v) {\n        let path = val.path;\n\n        if (v.privat) {\n            _.set( v.privat, path, val.value )\n        }\n\n        else {\n            if (v.prefix) path = v.prefix + \".\" + val.path;\n\n            _.set(v.data, path, val.value);\n        }\n\n        this.checkGuards(val, v)\n\n        if (val.isPartial) return;\n\n        v.actions.triggerRerun({}, v)\n\n\n    },\n\n\n    appendById: function (val, v) {\n        let target = _.get(v.data, val.path);\n        if (!target) {\n            target = {};\n            _.set(v.data, val.path, target);\n        }\n\n        let value = val.value;\n        if ( value.id ) value = [value];\n\n        for (var i in value) {\n            if ( !value[i]) {\n                continue;\n            }\n            let slot = value[i].id\n            if ( !target[slot] )\n            target[slot] = value[i];\n        }\n\n\n        if (val.isPartial) return;\n\n        v.actions.triggerRerun({}, v)\n    },\n}\n\nactionsBundle.generic = {\n    log: function (val, v) {\n        let obj = {};\n        for (var i in val.OP.input) {\n            obj[i] = val[i]\n        }\n        console.log(\"log\", obj, v);\n    },\n\n    fn: function (op, v) {\n        if (!op.fn) return;\n        let result\n\n        if (op.fn.run)\n            result = op.fn.run(op, v);\n        else\n            result = op.fn(op, v);\n\n        if (result === \"notcomplete\") return result;\n\n        if (op.pin) {\n            v.actions.setValue({ path: op.pin, value: result }, v)\n        }\n    },\n\n    assembleObj: function (args, v) {\n        let obj = {};\n\n        for (var i in args.OP.input) {\n            obj[i] = args[i]\n        }\n\n        if (args.partial && args.pin && args.missing) {\n\n            if (!v.opState[args.uid]) v.opState[args.uid] = { missing: [] }\n\n\n            obj.partial = true;\n\n            if (_.isEqual(args.missing, v.opState[args.uid].missing)) {\n                return \"notcomplete\";\n            }\n            else\n                v.opState[args.uid].missing = args.missing;\n\n            v.actions.setValue({ path: args.pin, value: obj, isPartial: args.missing ? \"skipRerun\" : false }, v)\n        }\n\n        else if (args.pin && !args.missing)\n            v.actions.setValue({ path: args.pin, value: obj }, v)\n\n        if (args.missing) return \"notcomplete\";\n\n    },\n\n}\n\nactionsBundle.tpls = {\n    listTemplate: function (args, v) {\n        let list = [];\n\n        for (var i in args.list) {\n            let item = cu.moldAssembler.run(args.tpl, args.list[i]);\n            list.push(item)\n        }\n\n\n        if (args.pin) {\n            v.actions.setValue({ path: args.pin, value: list }, v)\n        }\n\n        return list;\n    },\n\n    useTpl: function (args, v) {\n        let list = [];\n        let isPartial = false;\n\n        let item = cu.moldAssembler.run(args.tpl, args, function (data, path) {\n            let value = _.get(data, path);\n            if (value === undefined) value = _.get(v.data, path);\n\n            if (value === undefined) {\n                value = \"\";\n                isPartial = true;\n            }\n\n            return value;\n        });\n\n        if (args.pin) {\n            v.actions.setValue({ path: args.pin, value: item, isPartial: isPartial }, v)\n        }\n\n\n        if (args.append) {\n            v.actions.appendById({ path: args.append, value: item }, v)\n        }\n\n        return item;\n    },\n}\n\nvar flowGuards = {\n\n    makeTriggers: function (guards) {\n\n        let triggers = {};\n\n        for (var i in guards)\n            triggers[i] = this.makeTrigger(i, guards[i])\n        return triggers;\n    },\n\n    makeTrigger: function (index, guard) {\n        let tb = guard.tb;\n        let name = guard.name;\n        let trigger = function (path, result, partial, v) {\n            let triggerName = name || path;\n            v.master.tb[tb].trigger(name, result, partial)\n        }\n        return trigger;\n    }\n}\nvar ub = {\n\n    setup: function (opt) {\n        let item = Object.create(this);\n\n        item.ctx = {\n            actions: {},\n            opsCollection: opt.opsCollection || {},\n            data: opt.data || {},\n            triggers: {},\n            valuesChain: {}\n        };\n\n        item.state = {\n            nextId: 1,\n            open: {},\n            temp : []\n        };\n\n        item.tb = opt.tb || {};\n\n        item.addTriggers(opt.triggers);\n\n        item.addActionsCollection(actionsBundle);\n\n        if (opt.actions)\n            item.addActionsCollection(opt.actions);\n\n\n        if (opt.ops)\n            item.addMainOps(opt.ops)\n\n        if (opt.guards)\n            item.addTriggers(flowGuards.makeTriggers(opt.guards));\n\n        if (opt.valuesChain)\n            item.addValuesChains(opt.valuesChain)\n        return item;\n    },\n\n    addValuesChains: function (chains) {\n        for (var i in chains) {\n            let chain = chains[i];\n            if (_.isString(chain.unset)) chain.unset = chain.unset.split(\",\");\n\n            this.ctx.valuesChain[i] = chain;\n        }\n    },\n    addActionsCollection: function (collection, info) {\n\n        for (var i in collection) {\n            if (_.isString(collection[i]))\n                this.fetchCollection(collection, i, collection[i])\n        }\n\n        for (var i in collection)\n            this.addActions(collection[i], Object.assign({}, info, { slot: i }))\n    },\n\n    fetchCollection: function (target, name, path) {\n        let values = _.cloneDeep(cu.DataManager.getValue(path));\n\n        if (values.isCollection) {\n            _.unset(target, name);\n            delete values.isCollection;\n\n            for (var i in values) {\n                if (_.isString(values[i]))\n                    this.fetchCollection(values, i, values[i])\n            }\n            _.merge(target, values)\n        }\n        else {\n            target[i] = values;\n        }\n    },\n\n    addActions: function (actions, info) {\n        const getAction = function (action) {\n            return function (args, v) {\n                return action.run(args, v)\n            }\n        }\n        for (var i in actions) {\n            let action = actions[i];\n            if (action.run) action = getAction(action)\n            this.ctx.actions[i] = action\n        }\n    },\n\n    addOps: function (name, ops) {\n        this.ctx.opsCollection[name] = ops;\n    },\n\n    addMainOps: function (ops) {\n        this.addOps(\"main\", ops)\n    },\n\n    addTriggers: function (triggerCollection) {\n        for (var i in triggerCollection) {\n            let triggers = triggerCollection[i];\n            if (!_.isArray(triggers)) triggers = [triggers];\n\n            if (this.ctx.triggers[i]) triggers = this.ctx.triggers[i].concat(triggers);\n\n            this.ctx.triggers[i] = triggers;\n\n        }\n    },\n\n    run: function (opName, values, guards, extra ,  isTemp) {\n\n        opName = opName || \"main\";\n\n        if (values)\n            this.changeData(values)\n\n        let ops = this.ctx.opsCollection[opName];\n\n        if (!ops) return;\n\n        let v = this.getOpen(opName, isTemp);\n        v.ops = ops;\n\n        delete v.guards;\n        if (guards) v.guards = guards;\n\n        if ( !v.memo ) v.memo = {}\n\n\n        _.merge( v, extra );\n        \n        if ( extra &&  extra.privat )\n            v.privat = extra.privat\n        else\n            delete v.privat\n\n        this.ctx.actions.runAllOps({}, v);\n    },\n\n    getOpen: function (name, isTemp ) {\n        if (!isTemp && this.state.open[name]) return this.state.open[name];\n\n        let v = {\n            master: this,\n            data: this.ctx.data,\n            actions: this.ctx.actions,\n            tb: this.tb,\n            triggers: this.ctx.triggers\n        }\n\n        if ( !isTemp )\n        this.state.open[name] = v;\n        else \n            this.state.temp.push( v )\n\n        return v;\n    },\n\n    cancel: function (name) {\n        let open = this.state.open[name];\n\n        open.cancel = true;\n\n        delete this.state.open[name];\n    },\n\n    changeData: function (data) {\n        for (var i in data) {\n            if (this.ctx.valuesChain[i])\n                this.applyValuesChain(i, data[i], this.ctx.valuesChain[i])\n        }\n\n        for (var i in data) {\n            let path = i;\n            let value = data[i];\n            if (value === null)\n                _.unset(this.ctx.data, path)\n            else\n                _.set(this.ctx.data, path, value)\n        }\n    },\n\n    applyValuesChain: function (path, value, chain) {\n        let unset = chain.unset\n        if (unset)\n            unset.forEach(slot => _.unset(this.ctx.data, slot))\n\n        if ( chain.reset ) {\n            for ( var i in chain.reset )\n            this.ctx.data[i] = chain.reset[ i ].value \n        }\n    }\n\n\n\n}\n\nvar test = (result) => {\n    let flow = ub.setup({\n        data: {},\n        ops: [\n            { pin: \"obj\", type: \"assembleObj\", input: { s1: \"salut\", s2: \"outcome\" } },\n            //{ type: \"log\", input: { salut: \"obj\" } },\n            { pin: \"salut\", type: \"fn\", fn: () => \"test\" + Math.random() },\n            { pin: \"outcome\", type: \"fn\", input: { a: \"salut\" }, fn: (v) => v.a + \" ready\" + Math.random() }\n        ],\n\n        xtriggers: {\n            \"outcome\": (path, value, partial) => { console.log(\"outcome\", { path, value, partial }) },\n            \"salut\": {\n                run: (path, value, partial) => { console.log(\"salut\", { path, value, partial }) },\n            },\n        }\n    });\n\n    flow.run(\"main\");\n\n    result.flow = flow;\n    result.data1 = _.cloneDeep(flow.ctx.data);\n\n\n    flow.changeData({ \"outcome\": null })\n\n    flow.run(\"main\");\n    result.data2 = _.cloneDeep(flow.ctx.data);\n\n}\n\ncu.actionFlow = {\n    //test,\n\n    setup: function (specs) {\n        return ub.setup(specs);\n    },\n\n    setupFlow: function (opts) {\n        _.merge(this, opts)\n\n        this.actionsFlow = cu.actionFlow.setup(this);\n\n        this.run = (name, value, guards,refreshOpen) => { this.actionsFlow.run(name, value, guards,refreshOpen) }\n\n        this.actionsFlow.run(\"setup\")\n        console.log(\"actionFlow\", this)\n    },\n    run: function () {\n        // return ub.run(name);\n    },\n\n    def: `\n    `,\n\n    debug: {\n        ub: ub\n    }\n}","import _ from \"lodash\"\nimport faker from \"faker\"\nimport chroma from \"chroma-js\"\nvar cu = window.cu;\n\n\n\nvar ub = {\n\n  getRandomFn: function (str) {\n    var seed = 0;\n    for (var i = 0 ; i <str.length; i++ ) {\n      seed += str.charCodeAt(i) * i\n    }\n    function getRandom() {\n      var x = Math.sin(seed++) * 10000;\n      return x - Math.floor(x);\n    }\n\n    return getRandom;\n\n  },\n\n  getBrand: function (uid) {\n    let randomFn = this.getRandomFn(uid);\n\n    let baseBrand = {\n      mainColor: \"#007abc\",\n      complementColor: \"\"\n    }\n\n    let brand = {\n      mainColor_hsl: this.getColor(randomFn(), baseBrand.mainColor),\n      complementColor_hsl: this.getColor(randomFn(), baseBrand.mainColor),\n    }\n\n    brand.mainColor = \"hsl( \" + brand.mainColor_hsl[0] + \",\" + brand.mainColor_hsl[1] + \"% ,\" + (brand.mainColor_hsl[2]) + \"%  )\"\n    brand.complementColor = \"hsl( \" + brand.complementColor_hsl[0] + \",\" + brand.complementColor_hsl[1] + \"% ,\" + (brand.complementColor_hsl[2]) + \"%  )\"\n\n    brand.fadedColor = \"hsla( \" + brand.mainColor_hsl[0] + \",\" + 10 + \"% ,\" + (brand.mainColor_hsl[2]) + \"%, 1 )\"\n    brand.pastelColor = \"hsla( \" + brand.mainColor_hsl[0] + \",\" + 50 + \"% ,\" + (80) + \"%, 1 )\"\n\n    return brand;\n  },\n\n  getColor: function (seed, baseColor) {\n\n    baseColor = baseColor || \"#007abc\";\n    let hue = seed * 360;\n    let color = chroma(\"#007abc\").set(\"hsi.h\", hue).hsl();\n\n    color[1] = color[1] * 100;\n    color[2] = color[2] * 100;\n\n    return color;\n  },\n  get: function (seed, count) {\n\n    var str = seed; //faker.lorem.sentence(10);\n    var seed = 0;\n    for (var i= 0; i<str.length; i++) {\n      seed += str.charCodeAt(i) * i\n    }\n    function getRandom() {\n      var x = Math.sin(seed++) * 10000;\n      return x - Math.floor(x);\n    }\n\n    count = Math.max(2, Math.floor((getRandom() * 5)))\n\n\n\n    let scale = 50 / count;\n\n    let color = this.getColor(getRandom());\n\n    let pointsStar = [\n      [0, 0, 0.5, 0.5, 1, 0],\n      [0, 0, 0.5, 0.5, 0, 1],\n      [1, 1, 0.5, 0.5, 0, 1],\n      [1, 1, 0.5, 0.5, 1, 0],\n    ]\n\n\n\n    let polies = [];\n    for (var i = 0; i < count; i++) {\n      for (var j = 0; j < count; j++) {\n        let lum = 10; //points[i][j];\n        let x = i * scale;\n        let y = j * scale;\n        let poly = pointsStar.map((poligonPoints) => {\n          let col = \"hsl( \" + color[0] + \",\" + color[1] + \"% ,\" + (color[2]) + \"%  )\";\n          let classname = Math.round(getRandom() * 5);\n          let points = poligonPoints.map((value, i) => {\n            return value * scale + (i % 2 ? x : y)\n          })\n          polies.push(`<polygon\n                  class='poligon poligon_${classname}'\n                  points=\"` + points.join(\" \") + `\" stroke=\"transparent\" fill=\"transparent\" \n                  style=\" strokeWidth: ` + (1 / scale) + `;\n                  fill: `+ col + `;\n                  opacity : `+ getRandom() + `; \n                  \" />`)\n\n        })\n      }\n    }\n\n    return \"<svg style='position :relative;width: inherit; height: inherit;'> \" + polies.join(\"\") + \"</svg>\"\n\n\n  }\n}\n\nvar test = (result) => {\n\n}\n\ncu.brand = {\n  //test,\n\n  getLogo: function (seed, scale, count) {\n    let logo = ub.get(seed, count);\n    return logo;\n  },\n\n  getBrand: function (uid) {\n    return ub.getBrand(uid);\n  },\n\n  def: `\n    `,\n\n  debug: {\n    ub: ub\n  }\n}","import _ from \"lodash\"\nimport faker from \"faker\"\nimport { types } from \"util\";\nvar cu = window.cu;\n\nvar ub = {\n}\n\n\nvar test = (result) => {\n\n}\n\ncu.bubbleBoard = {\n    //test,\n\n    init: function () {\n    },\n    def: `\n    `,\n\n    debug: {\n        ub: ub\n    }\n}","import _ from \"lodash\"\nimport faker from \"faker\"\nvar cu = window.cu;\n\n\n\nvar ub = {\n\n    ctx: {\n    },\n\n\n    addItem : function ( obj ) {\n        let id = this.getId();\n        obj.id = id;\n        this.mergeItem( id, obj );\n        return id;\n    },\n\n    getId : function ( ) {\n        this.ctx.data.state.nextId++;\n\n        let id = \"bubble_\" + this.ctx.data.state.nextId;\n\n        return id;\n    },\n    mergeItem: function (id, value) {\n        let ctx = this.ctx;\n        let result = ctx.data.result[id];\n\n\n        ctx.changed = {};\n\n        this.appendTo(id, value)\n\n        let minStep;\n        let results = ctx.data.result;\n        let changed = ctx.changed;\n\n        console.log( ctx.data );\n        let versions = ctx.data.versions;\n\n        for ( var i in changed ) {\n            if ( !versions[i] ) versions[i] = 0;\n            versions[i]++;\n            let result = results[ i ];\n            if ( !result ) continue;\n            if ( !result.isReady ) continue;\n            if ( minStep == undefined ) minStep = result.completedAt;\n            if ( minStep > result.completedAt ) minStep = result.completedAt;\n        }\n\n        if (minStep !== undefined) {\n            this.rewindTo(minStep)\n        }\n\n\n        if ( this.ctx.tb.onchanged)\n            this.ctx.tb.onchanged( changed )\n        \n        return minStep;\n    },\n\n    rewindTo: function (step) {\n        let ctx = this.ctx;\n        for (var id in ctx.data.result) {\n            let result = ctx.data.result[id];\n            if (result.isReady && (result.completedAt >= step || result.createdAt > step)) {\n                result.isReady = false;\n                result.completedAt = 0;\n            }\n        }\n\n        ctx.data.step = step;\n    },\n\n    appendTo: function (id, values) {\n        let ctx = this.ctx;\n        let item = ctx.data.items[id];\n        let hasChanges = false;\n\n        if (!item) {\n            ctx.data.step++;\n            ctx.data.items[id] = item = {}\n            ctx.data.result[id] = { createdAt: ctx.data.step }\n            hasChanges = true;\n        }\n\n        for (var slot in values) {\n            let value = values[slot];\n            if ( value == \"REMOVE\" && item[slot] !== undefined ) {\n                delete item[slot];\n                hasChanges = true;\n                continue;\n            }\n            if ( value === null && item[slot] !== undefined ) {\n                delete item[slot]\n                hasChanges = true;\n                continue;\n\n            }\n\n            if ( !value ) continue;\n\n            let bubbleid = item[slot] ? item[slot].id : null;\n            if (_.isString(value) && value.charAt(0) == \"#\") {\n                value = {id : value.substring(1) };\n            }\n\n            if ( value.id !== undefined) {\n                if ( value.id == \"#\"  || value.id==\"\" ) value.id = null;\n                value.id = value.id || bubbleid || this.getId();\n                item[slot] = { id: value.id };\n            }\n\n\n            if (value.id && _.isObject(value)) {\n                if ( value.id != bubbleid ) hasChanges = true;\n                this.appendTo(value.id, value)\n            }\n\n            else if ( _.isObject( value ) && !_.isMatch(item[slot], value )) {\n                hasChanges = true;\n                item[slot] = value;\n            }\n            else if ( item[slot]!=value) {\n                hasChanges = true;\n                item[slot] = value;\n            }\n\n        }\n\n        if( hasChanges ) {\n            if ( item.version ) {\n                item.version = item.version ? item.version+1 : 1;\n            }\n            this.ctx.changed[ id ] =true;\n        }\n    },\n\n    evalItems: function (count) {\n        this.ctx.affected = {};\n        this._evalItems( count );\n\n        if ( this.ctx.tb.onchanged)\n            this.ctx.tb.onchanged( this.ctx.affected )\n        \n    },\n\n    _evalItems : function ( count ) {\n\n        if (count<=0) return;\n\n        let ctx = this.ctx;\n\n        let hasChanges = false;\n\n        for (var id in ctx.data.items) {\n            let item = ctx.data.items[id];\n            let result = ctx.data.result[id];\n\n            if (result && result.isReady) continue;\n            let values = this.isCompleteValues(item, id);\n            if (values) {\n                if (!ctx.data.result[id]) ctx.data.result[id] = {};\n\n                this.evalItem(item, id, values, ctx.data.result[id]);\n                if ( ctx.data.result[id].isReady )\n                    hasChanges = true;\n            }\n        }\n\n\n        if (hasChanges) this._evalItems(count - 1);\n    },\n\n    evalItem: function (item, id, values, result) {\n        let ctx = this.ctx;\n\n        result.isReady = true;\n        result.values = values;\n\n        let node = this.ctx.tb.getNode(item, values, result, ctx);\n        if ( node ) \n            result.node = node;\n\n        if ( result.isReady ) {\n            ctx.data.step++;\n            result.completedAt = ctx.data.step;\n            this.ctx.affected[ id ] = true;\n        }\n\n    },\n\n    isCompleteValues(item) {\n        //if (!this.ctx.tb.checkIfComplete(item)) return false;\n\n        let ctx = this.ctx;\n\n        let values = {};\n\n        let bellow = [];\n\n        for (var slot in item) {\n            let value = item[slot];\n            if (value.id) {\n                let bubble = ctx.data.result[value.id];\n\n                if (!bubble || !bubble.isReady) return false;\n\n                let node = bubble.node;\n\n                if ( item[slot+\"_path\"]) {\n                    node = _.get( node, item[slot+\"_path\"] )\n                }\n\n                values[slot] = node;\n            }\n            else values[slot] = value\n        }\n\n        return values;\n    },\n\n    init: function (ctx) {\n        let item = Object.create(this);\n        item.ctx = ctx;\n\n        _.defaultsDeep(ctx, {\n            data : {\n                items : {},\n                result : {},\n                step : 1,\n                versions : {},\n                trails : {},\n                rels : {\n                    bellow : {},\n                    above  : {},\n                    uses   : {}\n                },\n\n                state : {\n                    nextId : 8\n                }\n            },  \n            tb: {\n                checkIfComplete: (item) => item.type || item.tpl || item.node,\n                getNode: (item, values, result) => { return { val: values, x: item.tpl } }\n            }\n        })\n\n        ctx.master = item; \n        return item;\n    },\n\n    evaluateflow : function () {\n        this.evalItems(5);\n    },\n\n    getVersion : function ( id ) {\n        let item = this.ctx.data.items[ id ];\n\n        if ( !item ) return null;\n        return item.version;\n    }\n}\n\nvar test = (result) => {\n    let ctx = {\n        data: {\n            items: {},\n            result: {},\n            versions : {},\n            ants : {},\n            step: 1,\n        }\n    }\n\n    let nub = ub.init(ctx);\n\n    nub.mergeItem(\"b1\", {\n        tpl: \"salut\",\n        testval: \"#\"\n    })\n\n    nub.mergeItem(\"b1\", {\n        tpl: \"salutare\",\n        testval: { x: 12, elefant: \"test\", tpl: \"test\" }\n    })\n\n    nub.evalItems(0);\n\n\n\n    nub.mergeItem(\"b1\", {\n        tpl: \"salutare\",\n        testval: { x: 12, elefant: \"test\", tpl: \"test\" }\n    })\n\n\n\n    nub.evalItems(0);\n\n\n    result.ctx = ctx;\n}\n\ncu.bubbleFlow = {\n    //test,\n\n\n    run: function (ctx) {\n        return ub.init( ctx );\n    },\n    init: function () {\n\n    },\n\n    def: `\n    `,\n\n    debug: {\n        ub: ub\n    }\n}","import _ from \"lodash\"\nimport faker from \"faker\"\nvar cu = window.cu;\n\nvar fns = {}\n\nvar ub = {\n\n    ctx: {\n    },\n\n    doubleCheck: function (id) {\n        let tb = fns.evaluate.setup({ data: this.ctx.data, state: this.ctx.state }).target(id);\n\n        for (var i in checks)\n            tb.run(checks[i])\n    },\n\n    check: function (id) {\n        let item = this.ctx.data.items[id];\n        let result = this.ctx.data.result[id];\n        let shaddow = this.ctx.data.shaddow[id];\n\n        if (!shaddow)\n            shaddow = this.ctx.data.shaddow[id] = {}\n\n        let results = this.ctx.data.result;\n\n        let score = shaddow.score = {\n            subs: {\n                total: 0,\n                resolved: [],\n                unresolved: []\n            },\n        };\n\n        for (var slot in item) {\n            if (item[slot].id) {\n                score.subs.total++;\n\n                if (results[item[slot].id] && results[item[slot].id].isReady)\n                    score.subs.resolved.push({ slot: slot, id: item[slot].id });\n                else\n                    score.subs.unresolved.push({ slot: slot, id: item[slot].id });\n\n            }\n        }\n\n        if (result && result.values && result.values.tpl) {\n            let tpl = result.values.tpl;\n            score.tplParams = { total: 0, defined: 0, resolved: 0, unresolved: [] }\n            let parameters = tpl.mold.parameters;\n\n            for (var param in parameters) {\n                score.tplParams.total++;\n                if (result.values[param] || item[param]) {\n                    score.tplParams.defined++;\n                }\n                else {\n                    score.tplParams.unresolved.push(param)\n                }\n            }\n        }\n\n    },\n\n    setup: function (ctx) {\n        let item = Object.create(this);\n\n        item.ctx = ctx;\n\n        _.defaultsDeep(ctx, {\n            data: {\n                items: {},\n                result: {},\n                shaddow: {},\n                trails: {}\n            }\n        })\n\n        return item;\n    }\n}\n\n\n\nfns.evaluate = {\n    target: function (id) {\n\n        let model = this.model || this;\n\n        var item = Object.create(model);\n\n        item.model = model;\n\n        item.setup();\n\n        item.v.targetId = id;\n\n        return item;\n    },\n    setup: function (opt) {\n        this._setup(opt);\n        return this;\n    },\n    _setup: function (opt) {\n        if (opt) Object.assign(this, opt)\n\n        if (this.model && this.model.shaft) {\n            this.shaft = {};\n        }\n\n        this.v = { result: {} };\n    },\n    get: function (key) {\n        if (!_.isString(key)) return key;\n        let id = this.v.targetId;\n\n        let fullPath;\n        if (key == \"values\")\n            fullPath = [\"result\", this.v.targetId, \"values\"]\n        if (key == \"item\")\n            fullPath = [\"items\", this.v.targetId]\n        else\n            fullPath = [key, \"id\"];\n        return _.get(this.data, fullPath)\n    },\n\n    getFull: function (route) {\n        let base = route[0];\n        let id = route[1];\n        let relPath = route[2];\n\n        if (!base) base = \"items\";\n        if (base == \"item\") base = \"items\";\n\n        if (!id) id = this.v.targetId;\n\n        let fullPath = [base, id]\n        if (relPath) fullPath.push(relPath);\n\n        return _.get(this.data, fullPath.join(\".\"))\n    },\n    fetch: function (map) {\n        for (var i in map) {\n            this.v[i] = this.getFull(map[i])\n        }\n        return this;\n    },\n\n    it: function (collection, cb) {\n        collection = this.get(collection);\n\n        //let subTb = Object.create( this );\n        //subTb.v  = Object.create( this.v )\n\n        //prepare\n        let subTb = this;\n        let oldValues = {\n            slot: subTb.v.slot,\n            value: subTb.v.value,\n            info: subTb.v.info,\n            sub: subTb.v.sub\n        }\n        subTb.v.slot = null;\n        subTb.v.value = null;\n        subTb.v.info = null;\n        subTb.v.sub = null;\n        for (var i in collection) {\n            subTb.v.slot = i;\n            subTb.v.value = collection[i];\n            subTb.v.info = i;\n            subTb.v.sub = {};\n            cb(subTb, subTb.v)\n        }\n\n        //cleanup\n        for (var i in oldValues)\n            subTb[i] = oldValues[i]\n\n    },\n\n    run: function (cb) {\n        try {\n            let result = cb(this, this.v)\n        } catch (e) {\n            if (e && e.type == \"notApplicable\") {\n                return;\n            }\n            console.log(e)\n        }\n\n        if (this.v.result) {\n\n            if (!this.data.trails[this.v.targetId]) {\n                this.data.trails[this.v.targetId] = {};\n            }\n            Object.assign(this.data.trails[this.v.targetId], this.v.result)\n        }\n    },\n\n    result: function (name, value) {\n        this.v.result[name] = value;\n    },\n\n    check: function (paths) {\n        for (var i in paths) {\n            let path = paths[i];\n\n            if (path == \"isCurrentItem\") {\n                let stateCurrentId = this.state.currentItem.targetid;\n                if (!stateCurrentId || this.v.targetId != stateCurrentId)\n                    throw { type: \"notApplicable\", path: paths[i] }\n            }\n            else {\n                let value = _.get(this.v, paths[i]);\n                if (value === undefined) throw { type: \"notApplicable\", path: paths[i] }\n            }\n        }\n    }\n}\n\nfns.compile = Object.assign({}, fns.evaluate, {\n    setup: function (opt) {\n        this._setup(opt);\n\n        this.clues = {\n            needes: {},\n            provides: {},\n            collections: []\n        }\n\n        return this;\n    },\n    fetch: function (map) {\n        for (var i in map) {\n            this.clues.needes[i] = { key: map[i] }\n            this.v[i] = { test: \"test\" }\n        }\n        return this;\n    },\n\n\n    check: function (check) {\n\n    },\n\n    result: function (name, value) {\n        this.clues.provides[name] = value;\n    },\n\n    it: function (collection, cb) {\n        this.clues.collections.push(collection)\n    },\n\n    run: function (cb) {\n        let result = cb(this, this.v);\n    }\n});\n\n\nvar checks = [\n\n    (tb, v) => {\n\n        tb.fetch({\n            item: [\"item\"]\n        })\n\n        v.score = {\n            total: 0,\n            resolved: [],\n            unresolved: []\n        }\n\n        tb.it(v.item, (tb, v) => {\n            let sub = v.value;\n            if (!sub.id) return;\n\n            v.score.total++;\n\n            let result = tb.getFull([\"result\", sub.id]);\n\n            if (!result || !result.isReady) v.score.unresolved.push(sub.id)\n            else v.score.resolved.push(sub.id)\n        })\n\n        tb.result(\"subScore\", v.score)\n        return { subScore: v.score }\n    },\n\n\n\n    (tb, v) => {\n\n        tb.fetch({\n            values: [\"result\", \"\", \"values\"],\n            item: [\"item\"],\n            parameters: [\"result\", \"\", \"values.tpl.mold.parameters\"]\n        })\n\n        tb.check([\n            \"values.tpl\"\n        ])\n\n        v.score = { total: 0, defined: 0, undefined: [] }\n        v.params = {};\n        tb.it(v.parameters, (tb, v) => {\n            let param = v.slot;\n            v.params[param] = true;\n            v.score.total++;\n            if (!v.item[param] && !v.values[param])\n                v.score.undefined.push(param)\n        })\n\n        tb.it(v.parameters, (tb, v) => {\n            let param = v.slot;\n            v.params[param] = true;\n        })\n\n\n        v.score.undefinedCount = v.score.undefined.length;\n        v.score.definedCount = v.score.total - v.score.undefinedCount;\n\n        tb.result(\"tplParamsScore\", v.score);\n        tb.result(\"tplParams\", v.params)\n    },\n\n\n\n    (tb, v) => {\n\n        tb.fetch(  {\n            trails : [\"trails\"],\n\n        })\n        tb.check([\n            \"isCurrentItem\"\n        ])\n\n        console.log(\"trails is currentItem\", v.trails);\n    }\n\n]\n\nvar test = (result) => {\n\n    ub.ctx.data = {\n        items: {\n            bubble1: {\n                slot1: \"salut\",\n                slot2: { id: \"bubble2\" }\n            },\n            bubble2: {\n                test: \"salut\"\n            }\n        },\n        result: {},\n        trails: {}\n    }\n\n    let tb = fns.evaluate.target(\"bubble1\");\n\n    tb.run(checks[0]);\n    tb.run(checks[1]);\n\n    result.tb = tb.v.result;\n    result.trails = ub.ctx.data.trails;\n}\n\ncu.bubbleGuns = {\n    //test,\n\n    setup: function (ctx) {\n        return ub.setup(ctx);\n    },\n    init: function () {\n\n    },\n    def: `\n    `,\n\n    debug: {\n        ub: ub\n    }\n}","import _ from \"lodash\"\nimport faker from \"faker\"\nimport { types } from \"util\";\nvar cu = window.cu;\n\nvar ub = {\n    ctx: {\n        tb: {\n\n            onchanged: function (changed) { },\n            getNode: function (item, values, result, ctx) {\n                return cu.bubbleTypes.dispatch.getNode(item, values, result, ctx)\n            }\n        },\n\n        data: {\n            state: {\n                nextId: 0\n            }\n        }\n    }\n}\n\n\nvar test = (result) => {\n    ub.ctx.data = { state: { nextId: 0 } };\n    ub.ctx.tb.guns = cu.bubbleGuns.setup(ub.ctx);\n    ub.ctx.tb.flow = cu.bubbleFlow.run(ub.ctx)\n\n    ub.ctx.tb.flow.mergeItem(\"item1\", {\n        id: \"item1\",\n        tpl: {\n            id: \"item2\",\n            type: \"tpl\",\n            main: \"<div style='border:1px solid #007abc'>{h1} {salut} {someothervalue}</div>\"\n        },\n        tpl_path: \"main\",\n        h1: \"noh\",\n        salut: {\n            id: \"item3\",\n            tpl: {\n                id: \"item4\",\n                type: \"tpl\",\n                main: \"<div style='border:1px solid #007abc'>{text}</div>\"\n            },\n            tpl_path: \"main\",\n            text: \"salutare\"\n        }\n    });\n\n\n    ub.ctx.tb.flow.mergeItem(\"item5\", {\n        id: \"item5\",\n        type: \"mirror\",\n        model: \"item1\",\n        data: {\n            id: \"item6\",\n            version: 1,\n            node: {\n                h1: \"hh1\",\n                salut: {\n                    text: \"hey\"\n                }\n            }\n        }\n    })\n\n\n\n    ub.ctx.tb.flow.evaluateflow();\n\n    ub.ctx.tb.flow.mergeItem(\"item6\", {\n        node: {\n            h1: \"hh11\",\n            salut: {\n                text: \"testchanged\"\n            }\n        }\n    })\n\n    ub.ctx.tb.flow.evaluateflow();\n\n\n    result.items = ub.ctx.data.items;\n    result.result = ub.ctx.data.result;\n    result.shaddow = ub.ctx.data.shaddow;\n    //result.item6_1 = ub.ctx.data.result.item5.mirror.node.children[0][0];\n    //result.item6_2 = ub.ctx.data.result.item5.mirror.node.children[0][2].children\n}\n\ncu.bubbleTest = {\n    //test,\n\n    init: function () {\n    },\n    def: `\n    `,\n\n    debug: {\n        ub: ub\n    }\n}","import _ from \"lodash\"\nimport faker from \"faker\"\nimport { types } from \"util\";\nvar cu = window.cu;\n\nvar type = {}\n\n\ntype.dispatch = {\n    getNode: function (item, values, result, ctx) {\n        let nodeType = values.type;\n        if (!nodeType) {\n            if (values.tpl) nodeType = \"reactNode\"\n\n            else if (values.node) nodeType = \"dataNode\"\n        }\n\n        if (nodeType && type[nodeType]) {\n            return type[nodeType].getNode(item, values, result, ctx)\n        }\n        else result.isReady = false;\n    }\n}\n\ntype.tpl = {\n    getNode: function (item, values, result, ctx) {\n        delete values.type;\n        let tpl = cu.tplObjParse.run(values);\n        result.viewAs = \"object\";\n        return tpl;\n    }\n}\n\ntype.dataNode = {\n    getNode: function (item, values, result, ctx) {\n        return item.node;\n    }\n}\n\ntype.reactNode = {\n    getNode: function (item, values, result, ctx) {\n\n        let tpl = values.tpl;\n        if (!tpl || !tpl.mold) {\n            result.isReady = false;\n            return;\n        }\n\n        let neededValues = [];\n        let node = cu.reactAssembler.run(tpl, values, (data, path, op) => {\n            let value = _.get(data, path);\n            if (value !== undefined) return value;\n            neededValues.push(path);\n            return \"dummyvalue\"\n        });\n\n        if (neededValues.length) {\n            node = [neededValues, node];\n        }\n        result.viewAs = \"reactComponent\"\n\n        result.cues = { pins: tpl.mold.pins }\n\n        return node;\n\n    }\n\n}\n\ntype.mirror = {\n\n    description: \"\",\n\n\n    getNode: function (item, values, result, ctx) {\n\n\n        let model = ctx.data.items[item.model];\n        let data = values.data;\n\n        let newItem = _.cloneDeep(model);\n\n        if (!result.bubbles) result.bubbles = {};\n        if (!result.cache) result.cache = { data: {} };\n\n        if (!_.isMatch(result.cache.data, data)) {\n            result.cache.data = data;\n\n            for (var i in newItem) {\n                if (i != \"tpl\" && newItem[i].id && data[i]) {\n                    if (result.bubbles[i]) {\n                        ctx.master.mergeItem(result.bubbles[i].id, { data: data[i] })\n                    }\n                }\n            }\n        }\n\n        for (var i in newItem) {\n            if (i != \"tpl\" && newItem[i].id && data[i]) {\n\n                if (result.bubbles[i]) {\n                    newItem[i] = { id: result.bubbles[i].id }\n                }\n                else {\n                    let newId = ctx.master.addItem({ type: \"mirror\", data: data[i], model: newItem[i].id })\n                    result.bubbles[i] = { id: newId, model: newItem[i].id };\n                }\n\n                newItem[i] = { id: result.bubbles[i].id }\n            }\n            else if (data[i]) {\n                newItem[i] = data[i]\n            }\n        }\n\n        newItem.id = item.id;\n\n        let newValues = ctx.master.isCompleteValues(newItem);\n\n        if (!newValues) {\n            result.isReady = false;\n            return;\n        }\n\n        result.mirror = {};\n        ctx.master.evalItem(item, item.id, newValues, result.mirror)\n        if (result.mirror.viewAs) result.viewAs = result.mirror.viewAs;\n        return result.mirror.node;\n    }\n}\n\nvar ub = {\n}\n\n\nvar test = (result) => {\n\n}\n\ncu.bubbleTypes = {\n    //test,\n\n    mirror: type.mirrorBubble,\n\n    types: type,\n    dispatch: type.dispatch,\n    def: `\n    `,\n\n    debug: {\n        ub: ub\n    }\n}","import _ from \"lodash\"\nimport { UV_UDP_REUSEADDR } from \"constants\";\nvar cu = window.cu;\n\n\nvar ub = {\n\n    ctx: {\n        payload: {\n        },\n\n        tb: {\n        }\n    },\n\n    run: function (obj) {\n        let oldPayload = this.ctx.payload;\n\n        let mold = {\n            ops: [],\n            parameters: {},\n            pins: {},\n            tpl: {},\n            comments : []\n        }\n\n        mold.tpl = this.getTpl(obj, [], mold)\n        this.ctx.payload = oldPayload;\n\n        return mold;\n    },\n\n    getTpl: function (obj, path, mold) {\n        if (_.isFunction(obj)) {\n            let str = obj.toString();\n            let result = this.opValues(obj.toString(), path, mold, \"makeFunction\");\n            if (str == result) return obj;\n            return result;\n        }\n        else if (_.isObject(obj)) {\n            let newValue = {};\n            for (var i in obj) {\n                let slot = i;\n                let value;\n                if ( slot.indexOf( \"{\") != -1 || slot.indexOf( \".\") != -1 ) {\n                    let x = {\n                        VALUE : obj[ i ], \n                        PATH  : i\n                    }\n\n                    slot = slot.replace(/[^\\w]+/g, \"_\" );\n                    value = this.getTpl(x, path.concat(slot), mold);\n\n                    this.addOp( mold, path.concat(slot), { type : \"pathSet\", stage : 20, path : path.concat(slot)  }  )\n                }\n                else \n                    value = this.getTpl(obj[i], path.concat(i), mold)\n\n                newValue[slot] = value;\n            }\n            return newValue;\n        }\n        else if (_.isArray(obj)) {\n            let newValue = [];\n            for (var i=0; i<obj.length; i++ )\n                newValue.push(this.getTpl(obj[i], path.concat(i), mold));\n            return newValue;\n        }\n        else if (_.isString(obj)) {\n            return this.opValues(obj, path, mold, \"concat\")\n        }\n        else return obj;\n    },\n\n    addOp: function (payload, path, op) {\n        if (!op.stage) op.stage = 0;\n        if (op.action)\n            payload.parameters[op.action] = op.path;\n        payload.ops.push(op)\n    },\n    addComment: function (payload, path, text) {\n        let comment = { text : text, path : path }\n        payload.comments.push(comment)\n    },\n\n    opValues: function (value, path, mold, finalOp) {\n        if (!_.isString(value)) return value;\n\n        /*\n        let comments = value.matchAll(/\\/\\/\\.\\:.+^/g);\n        for ( var i in comments )\n            this.addComment( mold, path, comments[i])\n        */\n\n        if (value.indexOf(\"{\") == -1) return value;\n\n\n        let ops = mold.ops;\n        let values = value.split(/(\\{[^}\\n\\:\\;]+)\\}|(\\$\\$\\w+)/g);\n        values = values.map((item, i) => {\n            if ( !item ) return null;\n\n            let firstChar = item.charAt(0);\n\n            if ( firstChar == \"{\") {\n                item = item.substring(1);\n            }\n            else if ( firstChar == \"$\") {\n                item = item.substring( 2 );\n            }\n            else return item;\n\n            let action = item;\n            return { type: \"value\", action , firstChar  };\n        })\n            .filter(item => item)\n\n\n        if (values.length == 0) return null;\n        else if (values.length == 1) {\n            values = values[0];\n            if (values.type) {\n                values.path = path;\n            }\n            if (_.isObject(values))\n                this.addOp(mold, values.path, values)\n            return values;\n        }\n        else if (!finalOp) {\n            values = values.map((item, i) => {\n                if (item.type) {\n                    item.path = path.concat(i);\n                    item.index = i;\n                    item.stage = 0;\n                    this.addOp(mold, path, item);\n\n                    return item;\n                }\n                else return item;\n            })\n            return values;\n        }\n        else {\n            values = values.map((item, i) => {\n                if (item.type) {\n                    item.path = path.concat(i);\n                    item.index = i;\n                    item.concatParent = true;\n                    item.stage = 0;\n\n                    this.addOp(mold, path, item);\n                    return item;\n                }\n                else return item;\n            })\n            this.addOp(mold, path, { path: path, type: finalOp, ops: values, stage: 1 });\n            return values;\n        }\n\n    }\n}\n\nvar test = (result) => {\n    var obj = {\n        /*\n        x: \"salut - {test} - ce mai faci ? \",\n        z: function () {\n            console.log(\"test\")\n        },\n        p: \"{test}\",\n        zz: function () {\n            //{test} used for calling salut\n            this.$$test.salut();\n            console.log(\"t{test}\")\n        },\n\n        \"test.{test}.test\" : \"salut\",\n        */\n        \"{test}\" : {\n            \"{test}\" : \"{test}\"\n        }\n    }\n\n    result.mold = ub.run(obj)\n\n\n    result.obj = cu.moldAssembler.run( result, { test : \"elefant\"} )\n}\n\ncu.parseObjIntoMold = {\n    //test,\n\n    run: function (obj) {\n        return ub.run(obj)\n    },\n\n    init: function () {\n    },\n\n    def: `\n        @obj with string or .html slots \n        transform it into componentsObjects\n    `,\n\n    debug: {\n        ub: ub\n    }\n}","import _ from \"lodash\"\nvar cu = window.cu;\n\n\nvar phase1 = {\n\n    run: function (html) {\n        html = html.trim();\n\n        let nest = document.createElement('div');\n        nest.innerHTML = html;\n\n        let specs = [];\n\n        for (var i = 0; i < nest.childNodes.length; i++) {\n            let el = nest.childNodes[i];\n\n            let spec = this._spec(el);\n\n            specs.push(spec);\n        }\n\n        return specs.length == 1 ? specs[0] : specs;\n    },\n\n\n    _spec: function (el) {\n\n        if (el.nodeType == 3) {\n            return el.nodeValue\n        }\n\n        let props = {};\n        for (var i = 0; i < el.attributes.length; i++) {\n            let attr = el.attributes[i];\n            let name = attr.name;\n            if (name.indexOf(\"_\") != -1) {\n                name = name.replace(/\\_(.)/g, (all, char) => { return char.toUpperCase() })\n            }\n            props[name] = attr.value;\n        }\n\n        if (props.class) {\n            props.className = props.class;\n            delete props.class;\n        }\n\n        if (props.style) {\n            props.style = this._style(props.style);\n        }\n\n\n        let spec = {\n          type: \"node\",\n          componentName: el.nodeName.toLowerCase(),\n          props: props,\n          children: null,\n      };\n\n        if ( props.htmlSlot ) {\n          props[ props.htmlSlot ] = el.innerHTML;\n          return spec;\n        }\n\n        if (Object.keys(props) == 0) props = null;\n\n        let children = []\n        el.childNodes.forEach(child => {\n            children.push(this._spec(child))\n        })\n        if (children.length == 0) children = null;\n        spec.children = children;\n\n        return spec;\n    },\n\n    _style: function (str) {\n        str = str + \";\";\n        let reg = /\\s*([^:\\s]+)\\s*\\:\\s*([^;]+)\\s*\\;+/g\n        let css = {};\n        let match;\n        while (match = reg.exec(str)) {\n            css[match[1]] = match[2]\n        }\n\n        return css;\n    },\n\n}\n\nvar phase2 = {\n    run: function (obj , attrs ) {\n      let payload = {\n        ops: [],\n        pins: {},\n        parameters : {},\n        attrs : {},\n        watchAttrs : attrs || []\n      }\n  \n      if ( _.isArray( obj ) )\n        payload.tpl = obj.map(( obj, i)  => this.iterate(obj, [i], payload) )\n      else \n        payload.tpl = this.iterate(obj, [], payload)\n\n      payload.ops.sort ( (a,b) => a.stage - b.stage )\n  \n      return { ops: payload.ops, tpl: payload.tpl, pins : payload.pins , parameters : payload.parameters, attrs : payload.attrs}\n    },\n    iterate: function (obj, path, payload) {\n      if (!obj) return;\n  \n      if (_.isString(obj)) {\n        return this.opValues(obj, path, payload, false);\n      }\n  \n      obj = this.handleObj(obj, path, payload);\n  \n      let childrenPath = path.concat([\"children\"])\n      for (var i in obj.children) {\n        obj.children[i] = this.iterate(obj.children[i], childrenPath.concat(i), payload)\n      }\n  \n      let subPath = path.concat([\"props\"])\n      for (var i in obj.props) {\n        if (i == \"style\") continue;\n        obj.props[i] = this.handleProp(obj.props[i], subPath.concat(i), obj, payload)\n      }\n  \n      if (obj.props && obj.props.style) {\n        let subPath = path.concat([\"props\", \"style\"])\n        for (var i in obj.props.style) {\n          obj.props.style[i] = this.handleProp(obj.props.style[i], subPath.concat(i), obj, payload)\n        }\n      }\n  \n      if (obj.props && obj.props.pin) {\n        payload.pins[ obj.props.pin ] = path;\n      }\n\n      if (obj.props && obj.props.id) {\n        payload.pins[ obj.props.id ] = path;\n      }\n\n      if ( obj.props )\n        payload.watchAttrs.forEach( attr => {\n            if ( !obj.props[attr] ) return ;\n            if ( !payload.attrs[attr] ) payload.attrs[ attr ] = [];\n            payload.attrs[ attr ].push({  path, value : obj.props[attr] } );\n        })\n  \n      return obj;\n    },\n  \n    handleObj: function (obj, path) {\n      return obj;\n    },\n  \n    handleProp: function (obj, path, parent, payload) {\n      if (!_.isString(obj)) return obj;\n  \n      return this.opValues(obj, path, payload, true)\n    },\n    addOp: function (payload, path, op) {\n\n        if ( !op.stage ) op.stage = 0;\n      payload.parameters[ op.action ] = op.path;\n      payload.ops.push(op)\n    },\n  \n    prepareAction: function (item) {\n      return item;\n    },\n    opValues: function (value, path, payload, concatOp) {\n      if (!_.isString(value)) return value;\n      if (value.indexOf(\"{\") == -1) return value;\n  \n      let ops = payload.ops;\n      let values = value.split(/(\\{[^}\\n\\:\\;]+)\\}/g);\n      values = values.map((item, i) => {\n        if (item == \"\") return null\n        if (item.charAt(0) !== \"{\") return item;\n  \n        item = item.substring(1);\n        let action = this.prepareAction(item)\n        return { type: \"value\", action: action };\n      })\n        .filter(item => item)\n  \n  \n      if (values.length == 0) return null;\n      else if (values.length == 1) {\n        values = values[0];\n        if (values.type) {\n          values.path = path;\n        }\n        if ( _.isObject( values ))\n          this.addOp(payload, values.path, values)\n        return values;\n      }\n      else if (!concatOp) {\n        values = values.map((item, i) => {\n          if (item.type) {\n            item.path = path.concat(i);\n            item.index = i;\n            item.stage = 0;\n            this.addOp(payload, path, item);\n  \n            return item;\n          }\n          else return item;\n        })\n        return values;\n      }\n      else {\n        values = values.map((item, i) => {\n          if (item.type) {\n            item.path = path.concat(i);\n            item.index = i;\n            item.concatParent = true;\n            item.stage = 0;\n\n            this.addOp(payload, path, item);\n            return item;\n          }\n          else return item;\n        })\n        this.addOp(payload, path, { path: path, type: \"concat\", ops: values, stage : 1 });\n        return values;\n      }\n  \n    }\n  \n  }\n\n\nvar ub = {\n    run : function ( html , attrs ) {\n        var result = phase1.run( html );\n        result = phase2.run( result, attrs );\n\n        return result;\n    }\n}\n\nvar test = (result) => {\n    result.output = ub.run( \"<div>Salut {#test} </div>\");\n}\n\ncu.parseStringIntoComp = {    \n    //test,\n\n    run: function (obj, attrs ) {\n        return ub.run(obj, attrs )\n    },\n    def: `\n        @obj string \n        transform it into componentsObjects\n    `\n}","import _ from \"lodash\"\nimport faker from \"faker\"\nimport js_beautify from \"js-beautify\"\nvar cu = window.cu;\n\n\n\nvar ub = {\n\n    ctx: {\n        nextUID : 0\n    },\n\n    run : function (name ) {\n        return (name || \"uid\" ) +\"_\"+ this.ctx.nextUID++;\n    },\n\n\n    makestr : function ( obj, indent ) {\n        if ( _.isFunction( obj ) ) return obj.toString();\n        if ( _.isString( obj ) ) {\n \n            let usequouts = '\"';\n            if ( obj.indexOf( \"\\n\") != -1 ) usequouts = \"`\";\n            if ( obj.indexOf('\"') != -1 ) usequouts = \"`\";\n            \n            if (usequouts == \"`\") {\n                obj = js_beautify.html( obj, { \n                    indent_size : 2,\n                    indent_level : indent + 1,\n                    preserve_newlines : true,\n                    max_preserve_newlines : 0,\n                    indent_inner_html: true,\n                } )\n\n                obj = obj.trimStart();\n            }\n            return usequouts + obj + usequouts\n        }\n        if ( _.isArray(obj)) {\n            let lines = [];\n            for ( var i= 0 ;i <obj.length;i ++ ) {\n                let value = this.makestr( obj[i] , indent + 1);\n\n                lines.push( value)\n            }\n\n            return \"[\" + lines.join(\",\\n\") + \"]\";\n        }\n\n        if ( _.isObjectLike(obj)) {\n            let lines = [];\n            let multiLine = false;\n            for ( var i in obj ) {\n                let slot = i;\n                let value = this.makestr( obj[i], indent + 1 );\n\n                if ( !slot.match( /^[a-z0-9$_]+$/) ) slot = '\"' + slot + '\"'\n\n                if ( value.indexOf(\"\\n\") != -1 ) multiLine = false;\n                lines.push( slot + \":\" + value )\n            }\n\n            return \"{\" + lines.join(\",\") + \"}\"\n        }\n        \n        if ( _.isNil( obj )) return \"null\"\n\n        return obj.toString();\n    },\n\n    beautify : function ( str ) {\n        return js_beautify.js_beautify( str, {\n            indent_size :2 ,\n            indent_level : -1, \n            max_preserve_newlines : 1,\n            preserve_newlines : true\n        } )\n    }\n}\n\nvar test = (result) => {\n\n    var obj = {\n        tpl : `<div>s\nce mai faci <span>\nsdf</span>\n        alut</div>`,\n        fn : function ( ) {\n\n        },\n        \"#b ce mai faci\" : \"\",\n        x : {\n            \"test\" : \"salut\" \n        }\n    }\n\n    result.str = ub.makestr( obj ,10 )\n    result.beuaty = js_beautify.js_beautify( result.str, {\n        indent_size :2 ,\n        indent_level : -1, \n        max_preserve_newlines : 1,\n        preserve_newlines : true\n    } )\n}\n\ncu.prettyScode = {\n    //test,\n\n    run: function (name) {\n        let str =  ub.makestr(name, 1)\n        return ub.beautify( str );\n    },\n    \n    def: `\n    `,\n\n    debug : {\n        ub : ub\n    }\n}","\nimport React, { Component } from 'react';\n\nclass MyInput extends Component {\n\n    constructor(props) {\n      super(props);\n\n      this.state = {\n        value : \"\"\n      }\n\n      this.onChange = this.onChange.bind( this );\n    }\n\n    onChange ( evt ) {\n      this.setState( {value : evt.target.value});\n\n      if ( this.props.onChange ) this.props.onChange( evt );\n    }\n  \n\n    componentWillReceiveProps(nextProps) {\n      if ( nextProps.value!==undefined && nextProps.value.text!==undefined) this.setState({value : nextProps.value.text})\n    }\n\n    render () {\n\n      let props = Object.assign({}, this.props, {value : this.state.value, onChange : this.onChange })\n      \n      return React.createElement(\"input\", props, null);\n    }\n  }\n\n  export default MyInput;","import React, { Component } from 'react';\nimport * as d3 from \"d3\";\nimport * as webcola from \"webcola\";\nimport $ from \"jquery\"\n\n\nexport default class MapDiagram extends Component {\n  constructor ( props ) {\n    super( props);\n    this.ref = React.createRef();\n\n    this.state = {\n      id : \"salut\"\n    }\n  }\n\n  componentDidMount() {\n    this.makeTree();\n\n    this.drawTree( this.props.graph )\n\n  }\n  makeTree ( ) {\n\n    this.svg = d3.select(this.ref.current)\n      .append(\"svg\")\n\n      this.d3cola = webcola.d3adaptor(d3)\n      .avoidOverlaps(true)\n\n\n      this.svg.append('svg:defs').append('svg:marker')\n      .attr('id', 'end-arrow')\n      .attr('viewBox', '0 -5 10 10')\n      .attr('refX', 6)\n      .attr('markerWidth', 3)\n      .attr('markerHeight', 3)\n      .attr('orient', 'auto')\n      .append('svg:path')\n      .attr('d', 'M0,-5L10,0L0,5')\n      .attr('fill', '#000');\n\n  }\n\n  drawTree(graph) {\n   \n\n\n    console.log( \"drawtree\", graph)\n    let h = $(this.ref.current).height();\n    let w = $(this.ref.current).width();\n\n\n\n\n    for ( var i in graph.nodes ) {\n      if ( !graph.nodes[i].radius ) graph.nodes[i].radius = Math.random() * 10 + 5;\n    }\n\n\n    var pageBounds = {\n      x: 0,\n      y: 0,\n      width: w,\n      height: h\n    }\n\n\n    var nodeRadius = 5;\n\n    graph.nodes.forEach(function (v) { v.height = v.width = 3 * v.radius; });\n\n\n    var realGraphNodes = graph.nodes.slice(0),\n     topLeft = { x: pageBounds.x, y: pageBounds.y, fixed: true },\n     tlIndex = graph.nodes.push(topLeft) - 1,\n     bottomRight = { x: pageBounds.x + pageBounds.width, y: pageBounds.y + pageBounds.height, fixed: true },\n     brIndex = graph.nodes.push(bottomRight) - 1,\n     constraints = [];\n    for (var i = 0; i < realGraphNodes.length; i++) {\n        let nodeRadius = realGraphNodes[i].radius;\n        constraints.push({ axis: 'x', type: 'separation', left: tlIndex, right: i, gap : nodeRadius });\n        constraints.push({ axis: 'y', type: 'separation', left: tlIndex, right: i , gap : nodeRadius});\n        constraints.push({ axis: 'x', type: 'separation', left: i, right: brIndex , gap : nodeRadius});\n        constraints.push({ axis: 'y', type: 'separation', left: i, right: brIndex, gap : nodeRadius});\n    }\n\n\n\n    this.svg\n      .attr(\"width\", w)\n      .attr(\"height\", h)\n      .style(\"margin-left\", 0);\n\n\n\n\n    this.d3cola.size([w,h]);\n\n\n    this.d3cola\n      .nodes(graph.nodes)\n      .links(graph.links)\n      .constraints( constraints )\n      .avoidOverlaps(true)\n      .linkDistance(60,0.5)\n      .size([w,h])\n      .flowLayout(\"y\", 10)\n      .symmetricDiffLinkLengths(5)\n      .start(10,20,20)\n\n\n    var path = this.svg.selectAll(\".link\")\n    .data(graph.links)\n    .enter().append('svg:path')\n    .attr('class', 'link');\n\n    var node = this.svg.selectAll(\".node\")\n      .data(graph.nodes)\n      .enter().append(\"circle\")\n      .attr(\"class\", \"node\")\n      .attr(\"r\", function (d) { return d.radius })\n      .style(\"fill\", function (d) { return \"#007abc\"; })\n      .call(this.d3cola.drag);\n\n    var titles = this.svg.selectAll(\"text\")\n    .data(graph.nodes)\n    .enter().append(\"text\")\n          .text(function (d) { return d.name; })\n          .attr(\"text-anchor\", \"middle\")\n\n    this.d3cola.on(\"tick\", function () {\n      node.attr(\"cx\", function (d) { return d.x; })\n        .attr(\"cy\", function (d) { return d.y; });\n\n        titles.attr(\"dx\", function (d) { return d.x })\n        .attr(\"dy\", function (d) { return d.y; });\n\n\n        path.attr('d', function (d) {\n          return 'M' + d.target.x + ',' + d.target.y + 'L' + d.source.x + ',' + d.source.y;\n        });\n  \n    });\n\n\n  }\n\n\n  componentWillReceiveProps ( newprops ) {\n    console.log( \"will componentWillReceiveProps\", newprops )\n    this.drawTree( newprops.graph )\n  }\n\n  render() {\n    return <div ref={this.ref} id={\"#\" + this.props.id} style={{height:\"100%\",width:\"100%\"}}></div>\n  }\n\n}\nclass TreeDiagram extends Component {\n    constructor(props) {\n      super(props);\n  \n      this.ref = React.createRef();\n    }\n    componentDidMount() {\n      this.drawTree();\n    }\n  \n    drawChart() {\n      const data = [12, 5, 6, 6, 9, 10];\n  \n      let h = 200;\n      let w = 200;\n  \n  \n      console.log(this.ref.current);\n      const svg = d3.select(this.ref.current)\n        .append(\"svg\")\n        .attr(\"width\", 200)\n        .attr(\"height\", 200)\n        .style(\"margin-left\", 10);\n  \n      svg.selectAll(\"rect\")\n        .data(data)\n        .enter()\n        .append(\"rect\")\n        .attr(\"x\", (d, i) => i * 70)\n        .attr(\"y\", (d, i) => h - 10 * d)\n        .attr(\"width\", 65)\n        .attr(\"height\", (d, i) => d * 10)\n        .attr(\"fill\", \"green\")\n    }\n  \n    drawTree() {\n      var  graph = {\n        \"nodes\": [{ \"name\": \"Toprato\" }, { \"name\": \"Fella\" }, { \"name\": \"Tirti\" }, { \"name\": \"LA Piu' Bella\" }, { \"name\": \"Deep Shadow 1-5-8\" }, { \"name\": \"Oobiscus\" }, { \"name\": \"Rioky\" }, { \"name\": \"Klashe\" }, { \"name\": \"Tau Beta\" }, { \"name\": \"311040\" }, { \"name\": \"Nevf Zotsamm\" }, { \"name\": \"Gnaron\" }, { \"name\": \"Green Dor\" }, { \"name\": \"Gravity\" }, { \"name\": \"Jurrawensaed\" }, { \"name\": \"Andrill Primus\" }, { \"name\": \"Ulti-Mad\" }, { \"name\": \"Jellyfish\" }, { \"name\": \"Yersa\" }, { \"name\": \"Therfady\" }, { \"name\": \"SC 09\" }, { \"name\": \"Glueck\" }, { \"name\": \"Fiddle\" }, { \"name\": \"LV-017\" }, { \"name\": \"Sardinle\" }, { \"name\": \"Latalava\" }, { \"name\": \"Penumbra\" }, { \"name\": \"Chi Qoppa\" }, { \"name\": \"Vopru Maufyb\" }, { \"name\": \"Onadha\" }, { \"name\": \"Muplita Furr\" }, { \"name\": \"Psi Epsilon\" }, { \"name\": \"Dimloon\" }, { \"name\": \"Tanned I\" }, { \"name\": \"Woolaris 10\" }, { \"name\": \"Semend\" }, { \"name\": \"Blacus\" }, { \"name\": \"Darknok\" }, { \"name\": \"Oastar Secundus\" }, { \"name\": \"Green One\" }, { \"name\": \"Kayin Minor A\" }, { \"name\": \"Arton\" }, { \"name\": \"Anerstis\" }, { \"name\": \"Lament\" }, { \"name\": \"Shaison\" }, { \"name\": \"Rekini-H-S6\" }, { \"name\": \"Darkless\" }, { \"name\": \"MBTP 20\" }, { \"name\": \"Yankee Quebec\" }, { \"name\": \"Shere Jauj-Bred\" }, { \"name\": \"Embalm\" }, { \"name\": \"Small Rock 4\" }, { \"name\": \"Libra-D-S3\" }, { \"name\": \"Dying Warmth\" }, { \"name\": \"Sofa\" }, { \"name\": \"Grobnor\" }, { \"name\": \"Forbidden 1\" }, { \"name\": \"Glimmer II\" }, { \"name\": \"Aleksis\" }, { \"name\": \"Relu\" }, { \"name\": \"Scoff\" }, { \"name\": \"Elas\" }, { \"name\": \"Great Crater\" }, { \"name\": \"Leuprekota\" }, { \"name\": \"Yetton\" }, { \"name\": \"Fheyhs\" }, { \"name\": \"Edriwoise\" }, { \"name\": \"Usque\" }, { \"name\": \"Surfatu\" }, { \"name\": \"Drumana\" }, { \"name\": \"Hausner\" }, { \"name\": \"Vitalis\" }, { \"name\": \"Hyacinta IV\" }, { \"name\": \"Revenge of the Lith\" }, { \"name\": \"Asclephyrus\" }, { \"name\": \"Little Friend VI\" }, { \"name\": \"Fontelitio\" }, { \"name\": \"Shinmien\" }, { \"name\": \"Nine\" }, { \"name\": \"Kalgash\" }]\n        ,\n        \"links\": [{ \"target\": 1, \"source\": 0, \"value\": 1 }, { \"target\": 2, \"source\": 0, \"value\": 1 }, { \"target\": 9, \"source\": 0, \"value\": 1 }, { \"target\": 11, \"source\": 0, \"value\": 1 }, { \"target\": 78, \"source\": 1, \"value\": 1 }, { \"target\": 3, \"source\": 2, \"value\": 1 }, { \"target\": 4, \"source\": 3, \"value\": 1 }, { \"target\": 5, \"source\": 4, \"value\": 1 }, { \"target\": 6, \"source\": 5, \"value\": 1 }, { \"target\": 10, \"source\": 6, \"value\": 1 }, { \"target\": 8, \"source\": 7, \"value\": 1 }, { \"target\": 11, \"source\": 7, \"value\": 1 }, { \"target\": 12, \"source\": 8, \"value\": 1 }, { \"target\": 18, \"source\": 9, \"value\": 1 }, { \"target\": 35, \"source\": 10, \"value\": 1 }, { \"target\": 13, \"source\": 12, \"value\": 1 }, { \"target\": 14, \"source\": 12, \"value\": 1 }, { \"target\": 15, \"source\": 12, \"value\": 1 }, { \"target\": 16, \"source\": 12, \"value\": 1 }, { \"target\": 17, \"source\": 12, \"value\": 1 }, { \"target\": 19, \"source\": 12, \"value\": 1 }, { \"target\": 20, \"source\": 12, \"value\": 1 }, { \"target\": 21, \"source\": 12, \"value\": 1 }, { \"target\": 23, \"source\": 12, \"value\": 1 }, { \"target\": 25, \"source\": 12, \"value\": 1 }, { \"target\": 26, \"source\": 12, \"value\": 1 }, { \"target\": 28, \"source\": 12, \"value\": 1 }, { \"target\": 29, \"source\": 12, \"value\": 1 }, { \"target\": 31, \"source\": 12, \"value\": 1 }, { \"target\": 24, \"source\": 13, \"value\": 1 }, { \"target\": 45, \"source\": 14, \"value\": 1 }, { \"target\": 22, \"source\": 15, \"value\": 1 }, { \"target\": 49, \"source\": 16, \"value\": 1 }, { \"target\": 30, \"source\": 18, \"value\": 1 }, { \"target\": 39, \"source\": 19, \"value\": 1 }, { \"target\": 40, \"source\": 20, \"value\": 1 }, { \"target\": 50, \"source\": 21, \"value\": 1 }, { \"target\": 27, \"source\": 22, \"value\": 1 }, { \"target\": 63, \"source\": 23, \"value\": 1 }, { \"target\": 72, \"source\": 24, \"value\": 1 }, { \"target\": 60, \"source\": 26, \"value\": 1 }, { \"target\": 68, \"source\": 27, \"value\": 1 }, { \"target\": 59, \"source\": 29, \"value\": 1 }, { \"target\": 32, \"source\": 31, \"value\": 1 }, { \"target\": 33, \"source\": 31, \"value\": 1 }, { \"target\": 34, \"source\": 31, \"value\": 1 }, { \"target\": 36, \"source\": 31, \"value\": 1 }, { \"target\": 37, \"source\": 31, \"value\": 1 }, { \"target\": 38, \"source\": 31, \"value\": 1 }, { \"target\": 58, \"source\": 32, \"value\": 1 }, { \"target\": 75, \"source\": 33, \"value\": 1 }, { \"target\": 41, \"source\": 34, \"value\": 1 }, { \"target\": 48, \"source\": 35, \"value\": 1 }, { \"target\": 76, \"source\": 36, \"value\": 1 }, { \"target\": 42, \"source\": 37, \"value\": 1 }, { \"target\": 44, \"source\": 38, \"value\": 1 }, { \"target\": 46, \"source\": 38, \"value\": 1 }, { \"target\": 47, \"source\": 38, \"value\": 1 }, { \"target\": 43, \"source\": 39, \"value\": 1 }, { \"target\": 57, \"source\": 40, \"value\": 1 }, { \"target\": 67, \"source\": 41, \"value\": 1 }, { \"target\": 74, \"source\": 42, \"value\": 1 }, { \"target\": 51, \"source\": 43, \"value\": 1 }, { \"target\": 52, \"source\": 48, \"value\": 1 }, { \"target\": 53, \"source\": 48, \"value\": 1 }, { \"target\": 54, \"source\": 48, \"value\": 1 }, { \"target\": 55, \"source\": 48, \"value\": 1 }, { \"target\": 56, \"source\": 48, \"value\": 1 }, { \"target\": 61, \"source\": 48, \"value\": 1 }, { \"target\": 62, \"source\": 48, \"value\": 1 }, { \"target\": 64, \"source\": 62, \"value\": 1 }, { \"target\": 65, \"source\": 62, \"value\": 1 }, { \"target\": 66, \"source\": 62, \"value\": 1 }, { \"target\": 69, \"source\": 62, \"value\": 1 }, { \"target\": 70, \"source\": 69, \"value\": 1 }, { \"target\": 71, \"source\": 69, \"value\": 1 }, { \"target\": 73, \"source\": 69, \"value\": 1 }, { \"target\": 77, \"source\": 69, \"value\": 1 }, { \"target\": 79, \"source\": 78, \"value\": 1 }]\n        ,\n        \"constraints\": [\n          { \"axis\": \"y\", \"left\": 0, \"right\": 1, \"gap\": 25 },\n          { \"axis\": \"y\", \"left\": 0, \"right\": 2, \"gap\": 25 },\n          { \"axis\": \"y\", \"left\": 0, \"right\": 9, \"gap\": 25 },\n          { \"axis\": \"y\", \"left\": 0, \"right\": 11, \"gap\": 25 },\n          { \"axis\": \"y\", \"left\": 1, \"right\": 78, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 2, \"right\": 3, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 3, \"right\": 4, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 4, \"right\": 5, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 5, \"right\": 6, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 6, \"right\": 10, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 7, \"right\": 8, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 7, \"right\": 11, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 8, \"right\": 12, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 9, \"right\": 18, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 10, \"right\": 35, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 13, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 14, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 15, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 16, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 17, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 19, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 20, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 21, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 23, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 25, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 26, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 28, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 29, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 12, \"right\": 31, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 13, \"right\": 24, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 14, \"right\": 45, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 15, \"right\": 22, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 16, \"right\": 49, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 18, \"right\": 30, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 19, \"right\": 39, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 20, \"right\": 40, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 21, \"right\": 50, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 22, \"right\": 27, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 23, \"right\": 63, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 24, \"right\": 72, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 26, \"right\": 60, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 27, \"right\": 68, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 29, \"right\": 59, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 31, \"right\": 32, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 31, \"right\": 33, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 31, \"right\": 34, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 31, \"right\": 36, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 31, \"right\": 37, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 31, \"right\": 38, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 32, \"right\": 58, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 33, \"right\": 75, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 34, \"right\": 41, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 35, \"right\": 48, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 36, \"right\": 76, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 37, \"right\": 42, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 38, \"right\": 44, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 38, \"right\": 46, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 38, \"right\": 47, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 39, \"right\": 43, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 40, \"right\": 57, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 41, \"right\": 67, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 42, \"right\": 74, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 43, \"right\": 51, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 48, \"right\": 52, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 48, \"right\": 53, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 48, \"right\": 54, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 48, \"right\": 55, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 48, \"right\": 56, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 48, \"right\": 61, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 48, \"right\": 62, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 62, \"right\": 64, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 62, \"right\": 65, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 62, \"right\": 66, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 62, \"right\": 69, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 69, \"right\": 70, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 69, \"right\": 71, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 69, \"right\": 73, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 69, \"right\": 77, \"gap\": 25 }, { \"axis\": \"y\", \"left\": 78, \"right\": 79, \"gap\": 25 }]\n      };\n  \n  \n      var graph = {\n        nodes : []\n      }\n  \n      for ( var i = 0; i< 5; i++ ) {\n        graph.nodes[ i ] = { name : \"node \" + i}\n      }\n  \n      graph.links = [\n        {source : 0, target : 1}, \n        {source : 1, target : 2}, \n        {source : 1, target : 3}, \n        {source : 0, target : 4}, \n        {source : 4, target : 3}\n      ] \n  \n  \n      let h = 200;\n      let w = 200;\n  \n  \n      for ( var i in graph.constraints )\n      graph.constraints[i].gap = 5;\n  \n      //var color = d3.scaleOrdinal(d3.schemeCategory20);\n  \n  \n  \n  \n      const svg = d3.select(this.ref.current)\n        .append(\"svg\")\n        .attr(\"width\", 400)\n        .attr(\"height\", 400)\n        .style(\"margin-left\", 0);\n      var nodeRadius = 5;\n  \n      graph.nodes.forEach(function (v) { v.height = v.width = 2 * nodeRadius; });\n  \n      console.log(webcola);\n  \n      var d3cola = webcola.d3adaptor(d3)\n        .avoidOverlaps(true)\n        .size([400, 400]);\n  \n  \n      d3cola\n        .nodes(graph.nodes)\n        .links(graph.links)\n        .flowLayout(\"y\", 50)\n        .symmetricDiffLinkLengths(20)\n        .start(1,1,1);\n  \n      // define arrow markers for graph links\n      svg.append('svg:defs').append('svg:marker')\n        .attr('id', 'end-arrow')\n        .attr('viewBox', '0 -5 10 10')\n        .attr('refX', 6)\n        .attr('markerWidth', 3)\n        .attr('markerHeight', 3)\n        .attr('orient', 'auto')\n        .append('svg:path')\n        .attr('d', 'M0,-5L10,0L0,5')\n        .attr('fill', '#000');\n  \n      var path = svg.selectAll(\".link\")\n        .data(graph.links)\n        .enter().append('svg:path')\n        .attr('class', 'link');\n  \n      var node = svg.selectAll(\".node\")\n        .data(graph.nodes)\n        .enter().append(\"circle\")\n        .attr(\"class\", \"node\")\n        .attr(\"r\", nodeRadius)\n        .style(\"fill\", function (d) { return \"red\"; })\n        //.call(d3cola.drag);\n  \n      node.append(\"title\")\n        .text(function (d) { return d.name; });\n  \n      d3cola.on(\"tick\", function () {\n        // draw directed edges with proper padding from node centers\n        path.attr('d', function (d) {\n          var deltaX = d.target.x - d.source.x,\n            deltaY = d.target.y - d.source.y,\n            dist = Math.sqrt(deltaX * deltaX + deltaY * deltaY),\n            normX = deltaX / dist,\n            normY = deltaY / dist,\n            sourcePadding = nodeRadius,\n            targetPadding = nodeRadius + 2,\n            sourceX = d.source.x + (sourcePadding * normX),\n            sourceY = d.source.y + (sourcePadding * normY),\n            targetX = d.target.x - (targetPadding * normX),\n            targetY = d.target.y - (targetPadding * normY);\n          return 'M' + sourceX + ',' + sourceY + 'L' + targetX + ',' + targetY;\n        });\n  \n        node.attr(\"cx\", function (d) { return d.x; })\n          .attr(\"cy\", function (d) { return d.y; });\n      });\n      // turn on overlap avoidance after first convergence\n      //cola.on(\"end\", function () {\n      //    if (!cola.avoidOverlaps()) {\n      //        graph.nodes.forEach(function (v) {\n      //            v.width = v.height = 10;\n      //        });\n      //        cola.avoidOverlaps(true);\n      //        cola.start();\n      //    }\n      //});\n  \n    }\n  \n    render() {\n      return <div ref={this.ref} id={\"#\" + this.props.id}></div>\n    }\n  \n  }","import React, { Component } from 'react';\nimport * as d3 from \"d3\";\nimport * as webcola from \"webcola\";\nimport $ from \"jquery\"\nimport vis from \"vis\"\n\n\nexport default class TreeMap extends Component {\n  constructor(props) {\n    super(props);\n    this.ref = React.createRef();\n\n    this.state = {\n      id: \"salut\"\n    }\n  }\n\n  componentDidMount() {\n    this.makeTree();\n\n    this.drawTree(this.props.graph)\n\n  }\n  makeTree() {\n    let node = this.ref.current;\n\n    this.nodes = new vis.DataSet();\n    this.edges = new vis.DataSet();\n    var options = {\n      layout: {\n        randomSeed: 0,\n        improvedLayout: true,\n        hierarchical: false\n\n      },\n      autoResize: true,\n\n      \"nodes\": {\n        \"borderWidth\": 1,\n        \"borderWidthSelected\": 2,\n        \"color\": {\n          \"border\": \"rgba(33,33,33,1)\",\n          \"background\": \"hsl( 91.49505396307129,100% ,41.20740124521036%  )\",\n        },\n        \"font\": {\n          \"color\": \"rgba(33,33,33,1)\",\n          \"size\": 12,\n          \"strokeWidth\": 1\n        },\n\n        \"shape\": \"box\",\n        \"shapeProperties\": {\n          \"borderRadius\": 2\n        },\n      },\n      \"edges\": {\n\n      },\n\n      physics: {\n        stabilization: {\n          onlyDynamicEdges: true\n        },\n        adaptiveTimestep: true,\n      },\n\n    };\n    this.network = new vis.Network(node, { nodes: this.nodes, edges: this.edges }, options);\n\n    this.network.on(\"click\", (params) => {\n      console.log(\"click\", params);\n\n      params.event.stopPropagation();\n      params.event.preventDefault();\n\n      let id = this.network.getNodeAt(params.pointer.DOM);\n      if (id && this.props.onClick) this.props.onClick(id)\n      else {\n        $(\"#order\").blur();\n      }\n      //console.log('click event, getNodeAt returns: ' + this.getNodeAt(params.pointer.DOM), params);\n    });\n\n\n  }\n\n  drawTree(graph) {\n\n    var options = {\n      layout: {\n        randomSeed: 0,\n        improvedLayout: true,\n        hierarchical: false\n\n      },\n      autoResize: true,\n\n      \"nodes\": {\n        \"borderWidth\": 1,\n        \"borderWidthSelected\": 2,\n        \"color\": {\n          \"border\": graph.colors.main,\n          \"background\": graph.colors.pastel,\n        },\n        \"font\": {\n          \"color\": \"rgba(33,33,33,1)\",\n          \"size\": 14,\n          \"strokeWidth\": 1\n        },\n\n        \"shape\": \"box\",\n        \"shapeProperties\": {\n          \"borderRadius\": 2\n        },\n      },\n      \"edges\": {\n\n      },\n\n      physics: {\n        stabilization: {\n          onlyDynamicEdges: true\n        },\n        adaptiveTimestep: true,\n      },\n\n    };\n\n    this.network.setOptions( options)\n\n    let h = $(this.ref.current).height();\n    let w = $(this.ref.current).width();\n\n    this.nodes.update(graph.nodes);\n    this.edges.clear();\n    this.edges.add(graph.edges);\n\n  }\n\n\n  componentWillReceiveProps(newprops) {\n    this.drawTree(newprops.graph)\n  }\n\n  render() {\n    const fn = function () {\n      $(\"#order\").focus();\n    }\n\n    return <div onClick={fn} ref={this.ref} id={\"#\" + this.props.id} style={{ height: \"100%\", width: \"100%\" }}></div>\n  }\n\n}\n","import _ from \"lodash\"\nimport faker from \"faker\"\nimport React, { Component } from 'react';\nimport MyInput from \"../../components/MyInput\"\nimport MapDiagram from \"../../components/TreeDiagram\"\nimport TreeMap from \"../../components/TreeMap\"\n\nvar cu = window.cu;\n\n\nvar customComponents = {\n  myinput : MyInput,\n  mapdiagram: MapDiagram,\n  treemap : TreeMap\n}\n\n\nvar ub = {\n\n    makeComponent : function (obj, i ) {\n        if (!obj) return null;\n        if (_.isString(obj)) return obj;\n        if (_.isArray(obj)) return obj.map((obj, i) => this.makeComponent(obj, i))\n        if ( !obj.componentName) return null;\n    \n        let children = null;\n        if (obj.children) children = obj.children.map((obj, i) => this.makeComponent(obj, i));\n    \n        let props = null;\n        if (obj.props) props = _.cloneDeep(obj.props);\n    \n        if (props && !props.key) props.key = i;\n        if (!props) props = { key: i }\n    \n        if (obj.componentName == \"style\") {\n          children = [_.flattenDeep(children).join(\"\")]\n        }\n    \n        let component = obj.componentName;\n        if (customComponents[component]) component = customComponents[component];\n    \n        var node;\n        try {\n          node = React.createElement(component, props, children)\n        } catch (e) {\n          console.error(e)\n          node = \"error\"\n        }\n        return node;\n        },\n\n}\n\nvar test = (result) => {\n}\n\ncu.reactUtils = {\n    //test,\n\n    makeComponent: function (tplComponent) {\n        return ub.makeComponent(tplComponent, 1)\n    },\n    \n    def: `\n    `,\n\n    debug : {\n        ub : ub\n    }\n}","import _ from \"lodash\"\nimport faker from \"faker\"\nimport $ from \"jquery\"\nvar cu = window.cu;\n\n\n\nvar ub = {\n\n    ctx: {\n        nextUID : 0\n    },\n\n    createStore : function ( tb, hapi, fns  ) {\n        if (tb && tb.cache.store ) return tb.cache.store;\n\n        let tpls = {\n          changeValueTpl : ( path ) =>  {\n            return function ( evt ) {\n              let value = evt.target.value;\n              hapi.set( path, value )\n            }\n          }, \n          runActionTpl : ( action ) => {\n            return function ( evt ) {\n              if ( hapi[action] ) return hapi[action]( evt );\n            }\n          },\n          runWithActionTpl : ( action ) => {\n            return function ( evt ) {\n                let target = evt.target;\n                let attr = $(target).attr( action[1])\n                if ( attr === undefined ) {\n                    target = $(target).parents(\"[\" + action[1] + \"]\")\n                    attr = $(target[0]).attr( action[1])\n\n                }\n\n              evt.stopPropagation();\n              if ( hapi[action[0]] ) return hapi[action[0]]( attr, evt );\n            }\n          },\n\n          runWithParam : ( action ) => {\n            return function ( param ) {\n            if ( hapi[action] ) return hapi[action]( param );\n          }          }\n\n        }\n\n\n        let store = {}\n  \n        for ( var i in fns.change ) {\n          store[i]  = tpls.changeValueTpl( fns.change[ i ])\n        }\n  \n  \n        for ( var i in fns.run ) {\n            store[i]  = tpls.runActionTpl( fns.run[ i ])\n          }\n\n          \n            \n        for ( var i in fns.runWith ) {\n          store[i]  = tpls.runWithActionTpl( fns.runWith[ i ])\n        }\n\n\n\n        for ( var i in fns.runWithParam ) {\n          store[i]  = tpls.runWithParam( fns.runWithParam[ i ])\n        }\n\n        if ( tb )\n          tb.cache.store = store;\n        return store;\n      }\n\n}\n\nvar test = (result) => {\n}\n\ncu.store = {\n    //test,\n\n    run: function (name) {\n        return ub.run(name);\n    },\n    get : function ( tb, hapi,  fns ) {\n        return ub.createStore( tb, hapi, fns )\n    },\n    \n    def: `\n    `,\n\n    debug : {\n        ub : ub\n    }\n}","import _ from \"lodash\"\nimport faker from \"faker\"\nvar cu = window.cu;\n\n\n\nvar ub = {\n\n    ctx: {\n        payload: {\n            data: {\n\n                items: {},\n                subs: {},\n            },\n\n            src: {\n                getItem: function (id) {\n\n                },\n\n                getSubs: function (id) {\n\n                }\n            },\n\n            tpls: [],\n            registerTpl: function (args, master) {\n                this.tpls.push(args.path);\n            },\n\n            cases: [\n                result => {\n                    let isApplicable = !result.obj.item;\n\n                    if (!isApplicable) return;\n\n                    let id = result.obj.id;\n                    let item = ub.ctx.payload.data.items[id]\n\n                    if (!item) {\n                        item = {\n                            text: faker.company.catchPhrase(),\n                            id: id\n                        }\n\n                        if (ub.ctx.payload.setter)\n                            ub.ctx.payload.setter([\"items\", id], _.cloneDeep(item) )\n                    }\n\n\n                    result.obj.item = item;\n                    return \"applied\";\n                },\n\n                result => {\n                    let isApplicable = !result.obj.subs && result.obj.item && result.obj.level < 4;\n                    if (!isApplicable) return;\n\n                    let obj = result.obj;\n\n                    let id = result.obj.id;\n\n                    let subs = ub.ctx.payload.data.subs[id];\n\n                    if (!subs && !ub.ctx.payload.generated) {\n                        subs = {};\n\n                        let count = 4;\n                        for (var i = 0; i < count; i++) {\n                            let id = faker.random.uuid();\n                            let tpl = null;\n                            if (obj.level == 1) tpl = faker.random.arrayElement([null, \"columns\"]);\n                            let sub = {\n                                id: id,\n                                level: result.obj.level + 1,\n                                tpl: tpl\n                            }\n\n                            subs[id] = sub;\n                        }\n\n                        if (ub.ctx.payload.setter)\n                            ub.ctx.payload.setter([\"subs\", id], _.cloneDeep( subs ) )\n\n                    }\n\n                    if ( !subs ) subs = {}\n\n                    result.obj.subs = subs;\n                    result.subs = subs;\n\n                    return \"applied\";\n                }\n            ]\n        },\n\n        tb: {\n            //parseHtml: cu.parseStringIntoComp\n        }\n    },\n\n    run: function (obj, attrs) {\n        let oldPayload = this.ctx.payload;\n\n        this.ctx.payload.attrs = attrs || [];\n\n        let mold = this.it(obj, []);\n\n        this.ctx.payload = oldPayload;\n\n        return mold;\n    },\n\n\n    it: function (obj, path) {\n        let oldPayload = null;\n        let result = {\n            oldPayload: null,\n\n            obj: obj,\n            sub: obj,\n\n            master: this,\n            path: path,\n            values: {},\n            ops: []\n        }\n\n        this.prepare(result);\n\n        for (var i in result.subs) {\n            let ret = this.it(result.subs[i], path.concat([i]));\n            result.values[i] = ret;\n        }\n\n        return this.integrate(result)\n    },\n\n    addPayload: function (result, obj) {\n        if (!result.oldPayload) {\n            result.oldPayload = this.ctx.payload;\n            this.ctx.payload = Object.create(this.ctx.payload);\n        }\n        Object.assign(this.ctx.payload, obj);\n    },\n\n    prepare: function (result) {\n\n        let cases = this.ctx.payload.cases;\n\n        let hasChanges = true;\n        let applied = false;\n        let count = 0;\n        while (hasChanges && count < 5) {\n            hasChanges = false;\n            count++;\n            for (var i in cases) {\n                let _case = cases[i];\n                let ret = _case(result);\n                if (ret == \"applied\") {\n                    hasChanges = true;\n                    applied = true;\n                    break;\n                }\n            }\n        }\n    },\n\n    integrate: function (result) {\n        if (result.ops.length) {\n            for (var i in result.ops) {\n                let op = result.ops[i];\n                this.ctx.payload[op.name](op.args, this)\n            }\n        };\n\n        if (result.oldPayload) this.ctx.payload = result.oldPayload;\n\n        return result.obj;\n    }\n}\n\nvar inputs = {\n    items: { level: 0 },\n    subs: {},\n}\nvar test = (result) => {\n    let value = ub.run(inputs.items);\n\n    result.x = value;\n\n\n    cu.tests.pin(\"testRepo\", value)\n    //result.mold = value;\n}\n\ncu.testDataGenerator = {\n    //test,\n\n    run: function (id, data, generated,  setter) {\n\n        ub.ctx.payload.data = data;\n        ub.ctx.payload.setter = setter;\n        ub.ctx.payload.generated = generated;\n\n        return ub.run({ id: id || \"root\", level: 0 }, [])\n    },\n\n    init: function () {\n        ub.ctx.tb.parser = cu.tplObjParse;\n        ub.ctx.tb.reactAssembler = cu.reactAssembler;\n    },\n\n    def: `\n    `,\n\n    debug: {\n        ub: ub\n    }\n}","import _ from \"lodash\"\nvar cu = window.cu;\n\n\nvar ub = {\n\n    ctx: {\n        tb : {}\n    },\n\n    run : function ( str ) {\n        let mold = str;\n        mold = this.ctx.tb.parser.run( mold , [\"comp\"] );\n\n        return mold;\n    },\n\n\n}\n\n\nvar inputs = {\n    tplTree : {\n        x : `<div> <div id='title' comp='salut' class='{#test1} {#test2}' style='color : {#color}'> {#handle} : {#title}\n        \n        \n            <style>\n                @input \n                .column  { x : 12; background : {styleforred}red;}\n            </style>\n        </div> `\n    }\n}\nvar test = (result) => {\n    let value = ub.run( inputs.tplTree);\n\n    result.x = value.x.mold;\n\n    cu.tests.pin( \"mold\", value)\n    //result.mold = value;\n}\n\ncu.testMolds = {\n    //test,\n\n    run: function (obj) {\n        return ub.run(obj, [])\n    },\n\n    init : function ( ) {\n        ub.ctx.tb.parser = cu.tplObjParse;\n        ub.ctx.tb.reactAssembler = cu.reactAssembler;\n    },\n    \n    def: `\n    `,\n\n    debug : {\n        ub : ub\n    }\n}","import _ from \"lodash\"\nimport $ from \"jquery\"\n\nvar cu = window.cu;\n\n\nvar ub = {\n\n    ctx: {\n        tb: {},\n\n        wallet: {}\n    },\n\n    run: function (str) {\n        let mold = str;\n        mold = this.ctx.tb.parser.run(mold, [\"comp\"]);\n\n        return mold;\n    },\n\n    parseTpl: function (obj) {\n        let mold = this.ctx.tb.parser.run(obj, [\"comp\"]);\n        return mold;\n    },\n\n    renderTpl: function (mold, data, getter) {\n        return this.ctx.tb.reactAssembler.run(mold, data, getter)\n    },\n\n    assembleTpl: function (mold, data) {\n        if (_.isString(mold)) mold = _.get(this.ctx.payload.molds, mold);\n        return this.ctx.tb.reactAssembler.run(mold, data, (data, path) => {\n            let value = _.get( data, path );\n            if ( value.node ) return value.node;\n            return value;\n        })\n    },\n\n\n    iterateBubbles: function (bubbles, count ) {\n        if ( count == undefined ) count = 0;\n\n        if ( count && count > 5 ) return;\n\n        bubbles = bubbles || this.ctx.payload.bubbles;\n\n        let changed = false;\n        for (var i = 0; i< bubbles.length; i++ ) {\n            let bubble = bubbles[i];\n\n            if ( bubble.isReady ) continue;\n\n\n            let shouldAssemble = true;\n\n            for (var j in bubble) {\n                if (bubble[j].tpl) {\n                    if ( !bubble[j].isRegistered ) {\n                        bubble[j].isRegistered = true;\n                        this.addBubble( bubble[j] )\n                    }\n                    if (!bubble[j].isReady) {\n                        shouldAssemble = false;\n                        continue;\n                    }\n                }\n            }\n\n            if (shouldAssemble) {\n                let node = ub.assembleTpl(bubble.tpl, bubble);\n                bubble.node = node;\n                bubble.isReady = true;\n                bubble.computedAtStep = this.ctx.payload.step++;\n                changed = true;\n            }\n        }\n        if ( changed)\n            this.iterateBubbles( bubbles, count+1)\n\n    },\n\n    addBubble: function (bubble) {\n        bubble.uid = cu.uids.run(\"bubble\");\n        bubble.addedAtStep = this.ctx.payload.step;\n        this.ctx.payload.bubbles.push(bubble);\n        //this.iterateBubbles();\n    },\n\n    start: function (molds) {\n        this.ctx.payload = {\n            bubbles: [],\n            molds: molds,\n            step : 0,\n        }\n    }\n\n}\n\n\nvar inputs = {\n    tplTree: {\n        x: `\n            <div><input id='order' syncwith={value} />\n            {value} \n            <div id='menu'> </div>\n            <div id='bar'> </div>\n            <div id='window' > {content}</div>\n            </div>\n        `,\n        y: \"salut {#test} salutare din alt template \"\n    }\n}\nvar test = (result) => {\n\n    ub.start(ub.parseTpl(_.cloneDeep(inputs.tplTree)));\n\n    ub.addBubble({\n        tpl: \"x\", \n        value : \"salutare\", \n        value_setter : () => { console.log( \"setting\")},\n        content : {\n            tpl : \"y\",\n            \"#test\" : \"yo\"\n        }\n    })\n\n    ub.iterateBubbles();\n\n    result.bubbles = ub.ctx.payload;\n    //cu.tests.pin( \"mold\", value)\n    //result.mold = value;\n    //return nodes;\n}\n\nlet data = window.salut = { value: \"elefant\" }\ncu.testTplAssembing = {\n    //test,\n\n    run: function () {\n        ub.start(ub.parseTpl(_.cloneDeep(inputs.tplTree)));\n\n        ub.addBubble({\n            tpl: \"x\", \n            value : \"salutare\", \n            value_setter : () => { console.log( \"setting\")},\n            content : {\n                tpl : \"y\",\n                \"#test\" : \"yo\"\n            }\n        })\n    \n        ub.iterateBubbles();\n    \n        //result.bubbles = ub.ctx.payload;\n        return ub.ctx.payload.bubbles[0].node;\n    },\n\n    init: function () {\n        ub.ctx.tb.parser = cu.tplObjParse;\n        ub.ctx.tb.reactAssembler = cu.reactAssembler;\n    },\n\n    def: `\n    `,\n\n    debug: {\n        ub: ub\n    }\n}","import _ from \"lodash\"\nvar cu = window.cu;\n\n\nvar ub = {\n\n    ctx: {\n        payload: {\n            tpls: {},\n            registerTpl: function (args, result, master) {\n\n                result.obj.uid = cu.uids.run();\n\n                if (result.obj.mold.props) result.obj.mold.props.tplId = result.obj.uid;\n                //this.tpls.push(args.path);\n\n                this.tpls[args.path.join(\".\")] = result.obj.uid;\n            }\n        },\n\n        tb: {\n            //parseHtml: cu.parseStringIntoComp\n        }\n    },\n\n    run: function (obj, attrs) {\n        let oldPayload = this.ctx.payload;\n\n        this.ctx.payload.attrs = attrs;\n\n        let mold = this.it(obj, []);\n\n        this.ctx.payload = oldPayload;\n\n        return mold;\n    },\n\n\n    it: function (obj, path) {\n        let oldPayload = null;\n        let result = {\n            oldPayload: null,\n\n            obj: obj,\n            sub: obj,\n\n            master: this,\n            path: path,\n            values: obj,\n            ops: []\n        }\n\n        this.prepare(result);\n\n        if ( _.isObject ( result.sub ))\n        for (var i in result.sub) {\n            let ret = this.it(result.sub[i], path.concat(i));\n            result.values[i] = ret;\n        }\n\n        return this.integrate(result)\n    },\n\n    addPayload: function (result, obj) {\n        if (!result.oldPayload) {\n            result.oldPayload = this.ctx.payload;\n            this.ctx.payload = Object.create(this.ctx.payload);\n        }\n        Object.assign(this.ctx.payload, obj);\n    },\n\n    prepare: function (result) {\n        let checks = {\n            isString: result => result.obj && result.obj.trim,\n            isUnparsedTpl: result => result.obj && result.obj.html && !result.obj.mold,\n            isCollection: result => result.obj && result.obj.isCollection,\n            isObjTpl: result => result.obj && result.obj.VALUE\n        }\n\n        let cases = {\n            \"isString\": (result) => {\n                result.values = result.obj = { html: result.obj };\n                result.sub = [];\n                return \"applied\";\n            },\n            \"isUnparsedTpl\": (result) => {\n                result.sub = [];\n                let obj = Object.assign({}, result.obj, {\n                    mold: this.ctx.tb.parseHtml.run(result.obj.html, this.ctx.payload.attrs)\n                })\n\n                result.values = result.obj = obj;\n\n                result.ops.push({ name: \"registerTpl\", path: result.path })\n                return \"applied\";\n            },\n            \"isCollection\": (result) => {\n                let sub = {};\n                for (var i in result.obj) {\n                    if (i == \"isCollection\") continue;\n                    sub[i] = { VALUE: result.obj[i] }\n                }\n                result.values = {};\n                result.sub = sub;\n                return \"applied\";\n            },\n            \"isObjTpl\": (result) => {\n                result.sub = [];\n                let obj = Object.assign({}, result.obj, {\n                    mold: this.ctx.tb.parseObj.run(result.obj.VALUE, this.ctx.payload.attrs)\n                })\n\n                result.values = result.obj = obj;\n\n                result.ops.push({ name: \"registerTpl\", path: result.path })\n                return \"applied\";\n            },\n        }\n\n        let hasChanges = true;\n        let applied = false;\n        let count = 0;\n        while (hasChanges && count < 5) {\n            hasChanges = false;\n            count++;\n            for (var i in cases) {\n                let _check = checks[i];\n                if (!_check(result)) continue;\n\n                let _case = cases[i];\n                let ret = _case(result);\n                if (ret == \"applied\") {\n                    hasChanges = true;\n                    applied = true;\n                    break;\n                }\n            }\n        }\n    },\n\n    integrate: function (result) {\n        if (result.ops.length) {\n            for (var i in result.ops) {\n                let op = result.ops[i];\n                this.ctx.payload[op.name](op, result, this)\n            }\n        };\n\n        if (result.oldPayload) this.ctx.payload = result.oldPayload;\n\n        return result.values;\n    }\n}\n\nvar test = (result) => {\n    let value = ub.run({\n        x: `\n        <div pin = \"test\" > \n        <input id=\"dalut\" test=\"{salut}\" />\n            <div> \n                    <div xid='x{#tes}'> \n                    </div>\n            </div>\n\n        </div>\n    `, y: {\n            a: {\n                b: `\n    \n        <div id='yo'> Salutare </div>\n    ` }\n        },\n\n        v: {\n\n            isCollection: true,\n            a: {\n                test: \"{x}\"\n            },\n            b : {\n                \"{x.test}\" : \"{x.test}\"\n            }\n        }\n    }, []);\n    //value = ub.it(value, []);\n\n    result.mold = value;\n}\n\ncu.tplObjParse = {\n    //test,\n\n    run: function (obj, attrs) {\n        return ub.run(obj, attrs)\n    },\n\n    init: function () {\n        ub.ctx.tb.parseHtml = cu.parseStringIntoComp;\n        ub.ctx.tb.parseObj = cu.parseObjIntoMold;\n    },\n\n    def: `\n        @obj with string or .html slots \n        transform it into componentsObjects\n    `,\n\n    debug: {\n        ub: ub\n    }\n}","import _ from \"lodash\"\nimport faker from \"faker\"\nvar cu = window.cu;\n\n\n\nvar ub = {\n\n    ctx: {\n        tb: {},\n        payload1: {\n            tplsMapping: [\n                \"map\",\n                \"topic\",\n                \"item\",\n                \"entry\"\n            ],\n            defaultTpl: \"item\",\n            usedGlobalStyles: {},\n\n\n            addSubs: function (args, result, master) {\n                result.obj.subs = result.values;\n                //console.log( arguments );\n\n                let obj = result.obj;\n                let content = [];\n                for (var i in result.values) {\n                    let item = result.values[i];\n                    if (item.nodes && item.nodes.card)\n                        content.push(item.nodes.card)\n                }\n\n                if (content) {\n                    result.obj.nodes.content = master.ctx.payload.useTemplate(obj.tpl + \".content\", { subs: content });\n                }\n\n                let data = result.obj.nodes;\n                result.obj.nodes.card = master.ctx.payload.useTemplate(obj.tpl + \".card\", data)\n\n            },\n\n            useTemplate: function (tpl, data, skipGlobalStyle) {\n\n                if (!skipGlobalStyle) {\n                    let route = tpl.split(\".\");\n                    let root = ub.ctx.wallet.molds;\n\n                    for (var i = 0; i < route.length; i++) {\n                        let step = route[i];\n                        if (root[step].globalStyle) {\n                            let id = root[step].globalStyle.uid;\n                            this.usedGlobalStyles[id] = { parent: root[step] };\n                        }\n                        if (root[step])\n                            root = root[step];\n                        else break;\n                    }\n                }\n\n                let mold = _.get(ub.ctx.wallet.molds, tpl); // .item.title;\n                return ub.ctx.tb.reactAssembler.run(mold, data)\n            },\n            cases: [\n                (result, master) => {\n\n                    let isApplicable = !result.obj.data\n                    if (!isApplicable) return;\n\n                    let tpls = master.ctx.payload.tplsMapping;\n\n                    let defaultTpl = tpls[result.obj.level] || master.ctx.payload.defaultTpl;\n\n\n                    let obj = {\n                        tpl: result.obj.tpl || defaultTpl,\n                        data: result.obj.item,\n                        level: result.obj.level,\n                        nodes: {}\n                    }\n\n                    result.subs = result.obj.subs;\n                    result.obj = obj;\n                    result.ops.push({ name: \"addSubs\", args: \"subs\" })\n\n                    return \"applied\"\n                },\n\n                (result, master) => {\n                    let isApplicable = !result.obj.nodes.title\n                    if (!isApplicable) return;\n\n                    let obj = result.obj;\n\n                    let mold = ub.ctx.wallet.molds.item.title;\n                    let values = {\n                        title: result.obj.data.text,\n                        level: result.obj.level\n                    }\n\n                    result.obj.nodes.title = master.ctx.payload.useTemplate(obj.tpl + \".title\", values);\n\n                    return \"applied\"\n                },\n\n\n            ]\n\n        },\n\n    },\n\n    getMolds: function (tpls) {\n        let molds = this.ctx.tb.parser.run(tpls);\n        return molds;\n    },\n\n\n    buildTpls: function (data) {\n        let node = this.ctx.tb.iterator.run(data, { payload: this.ctx.payload1 });\n        return node;\n    },\n\n    addGlobalStyles: function (nodes, gbs) {\n        let styles = [];\n        gbs = gbs || this.ctx.payload1.usedGlobalStyles\n\n\n        var parent;\n\n        let makeSelector = (path) => \"[tplid='\" + parent[path].uid + \"']\";\n\n        let getter = (data, path) => {\n            if (parent[path]) {\n                return makeSelector(path)\n            }\n            else if (path == \"*\")\n\n                return Object.keys(parent).filter(item => item != \"globalStyle\").map(item => makeSelector(item)).join(\",\")\n\n            return _.get(data, path)\n        }\n\n        let data = { color: \"red\" }\n        for (var i in gbs) {\n            parent = gbs[i].parent;\n            let style = ub.ctx.tb.reactAssembler.run(parent.globalStyle, data, getter)\n            styles.push(style)\n        }\n\n        if (styles.length) {\n            nodes = [nodes, styles];\n        }\n        return nodes;\n    }\n}\n\nvar input = {\n    tpls: {\n        map: {\n            title: \"<div class='title level{level}'>{title}</div>\",\n            content: \"<div>{subs}</div>\",\n            card: \"<div class='map'>{title} {content} </div>\",\n            style: `\n\n            `\n        },\n        topic: {\n            title: \"<div class='title level{level}'>{title}</div>\",\n            content: \"<div class='content'>{subs}</div>\",\n            card: \"<div class='topic'>{title} {content} </div>\"\n        },\n        item: {\n            title: \"<div class='title level{level}'>{title}</div>\",\n            content: \"<div class='content'>{subs}</div>\",\n            card: \"<div class='item'>{title} {content} </div>\",\n            style: `\n            \n            `\n        },\n        entry: {\n            title: \"<div class='title level{level}'>{title}</div>\",\n            content: \"<div class='content'>{subs}</div>\",\n            card: \"<div class='entry'>{title} {content} </div>\"\n        },\n\n        summart: {\n            title: \"<div class='title level{level}'>{title}</div>\",\n            content: \"<div class='content'>summary</div>\",\n            card: \"<div class='entry'>{title} {content} </div>\",\n            style: `\n            \n            `\n        },\n\n        columns: {\n            title: \"<div class='title level{level}'>{title}</div>\",\n            content: \"<div class='content'>{subs}</div>\",\n            card: \"<div class='columns'>{title} {content} </div>\",\n            globalStyle: `<style htmlSlot='content'>\n               {content} { display : flex; background : hsla(100, 50%, 70%, 0.4)}\n               {content}>* { flex-basis : 100px; padding :0px 10px; border-left : 1px solid red; }\n         \n            </style>`\n        },\n    }\n}\n\nvar test = (result) => {\n    let wallet = {\n        molds: ub.getMolds(input.tpls),\n        repo: cu.tests.get(\"testRepo\"),\n    }\n\n    ub.ctx.wallet = wallet;\n\n    wallet.tpls = ub.buildTpls(wallet.repo);\n\n    let card = wallet.tpls.nodes.card;\n    card = ub.addGlobalStyles(card)\n    cu.tests.pin(\"testRoot\", card)\n    Object.assign(result, wallet)\n}\n\ncu.treeCardsBuilder = {\n    //test,\n\n    run: function (obj) {\n\n        let wallet = ub.ctx.wallet = {\n            molds : obj.molds,\n            repo  : obj.data\n        };\n\n        Object.assign(ub.ctx.payload1, {\n            tplsMapping: obj.mappings.tplsMapping,\n            defaultTpl: obj.mappings.defaultTpl, \n            usedGlobalStyles: {},\n        });\n\n        wallet.tpls = ub.buildTpls(wallet.repo);\n\n        let card = wallet.tpls.nodes.card;\n        card = ub.addGlobalStyles(card)\n\n        return card;\n    },\n\n    init: function () {\n        ub.ctx.tb.parser = cu.tplObjParse;\n        ub.ctx.tb.reactAssembler = cu.reactAssembler;\n        ub.ctx.tb.iterator = cu.treeIterator;\n    },\n\n    def: `\n    `,\n\n    debug: {\n        ub: ub\n    }\n}","import _ from \"lodash\"\nimport faker from \"faker\"\nvar cu = window.cu;\n\n\n\nvar ub = {\n\n    ctx: {\n    },\n\n    run : function ( obj, attrs ) {\n        let oldPayload = this.ctx.payload;\n\n        this.ctx.payload.attrs = attrs;\n\n        let mold = this.it( obj, []);\n\n        this.ctx.payload = oldPayload;\n\n        return mold;\n    },\n\n\n    it: function (obj, path) {\n        let oldPayload = null;\n        let result = {\n            oldPayload: null,\n\n            obj: obj,\n            sub: obj,\n\n            master: this,\n            path: path,\n            values: {},\n            ops: []\n        }\n\n        this.prepare(result);\n\n        for (var i in result.subs) {\n            let ret = this.it(result.subs[i], path.concat([i]));\n            result.values[i] = ret;\n        }\n\n        return this.integrate(result)\n    },\n\n    addPayload: function (result, obj) {\n        if (!result.oldPayload) {\n            result.oldPayload = this.ctx.payload;\n            this.ctx.payload = Object.create(this.ctx.payload);\n        }\n        Object.assign(this.ctx.payload, obj);\n    },\n\n    prepare: function (result) {\n\n        let cases = this.ctx.payload.cases;\n\n        let hasChanges = true;\n        let applied = false;\n        let count = 0;\n        while (hasChanges && count < 5) {\n            hasChanges = false;\n            count++;\n            for (var i in cases) {\n                let _case = cases[i];\n                let ret = _case(result, this);\n                if (ret == \"applied\") {\n                    hasChanges = true;\n                    applied = true;\n                    break;\n                }\n            }\n        }\n    },\n\n    integrate: function (result) {\n        if (result.ops.length) {\n            for (var i in result.ops) {\n                let op = result.ops[i];\n                this.ctx.payload[op.name](op.args, result,  this)\n            }\n        };\n\n        if (result.oldPayload) this.ctx.payload = result.oldPayload;\n\n        return result.obj;\n    }\n}\n\nvar test = (result) => {\n}\n\ncu.treeIterator = {\n    //test,\n\n    run: function (obj, ctx ) {\n        let mub = Object.create( ub )\n        mub.ctx = ctx;\n        if ( !ctx.payload ) ctx.payload = { cases : [] }\n        return mub.run(obj, [])\n    },\n\n    init : function ( ) {\n        //ub.ctx.tb.parser = cu.tplObjParse;\n        //ub.ctx.tb.reactAssembler = cu.reactAssembler;\n    },\n    \n    def: `\n    `,\n\n    debug : {\n        ub : ub\n    }\n}","import _ from \"lodash\"\nimport faker from \"faker\"\nvar cu = window.cu;\n\n\n\nvar ub = {\n\n    ctx: {\n        nextUID : 0\n    },\n\n    run : function (name ) {\n        return (name || \"uid\" ) +\"_\"+ this.ctx.nextUID++;\n    },\n\n}\n\nvar test = (result) => {\n}\n\ncu.uids = {\n    //test,\n\n    run: function (name) {\n        return ub.run(name);\n    },\n    \n    def: `\n    `,\n\n    debug : {\n        ub : ub\n    }\n}","import _ from \"lodash\"\nimport \"../libs/dataManager\";\n\nvar cu = window.cu;\n\ncu.DataManager = window.DataManager;\n\nfor (var i in cu) {\n    if (cu[i].init) cu[i].init();\n}\n\n\n\ncu.tests = {\n    wallet: {\n        test: {},\n        pins: {},\n        pending: []\n    },\n    pin: function (name, value) {\n        this.wallet.pins[name] = value;\n    },\n    get: function (name) {\n        let value = _.get(this.wallet.pins, name);\n        if (!value) value = _.get(this.wallet.test, name);\n        return value;\n    }\n}\n\n\nfor (var i in cu) {\n    if (cu[i].test) {\n        cu.tests.wallet.pending.push(i);\n\n    }\n}\n\n\nlet passes = 0;\nwhile (passes < 5 && cu.tests.wallet.pending.length) {\n    let i = cu.tests.wallet.pending.shift();\n    passes++;\n    let result = {};\n    let ret;\n    try {\n        ret = cu[i].test(result);\n    } catch (e) {\n        console.log(\"error when running \", i, e)\n    }\n\n    if (ret == \"pending\") {\n        cu.tests.wallet.pending.push(i)\n        continue;\n    }\n    console.group(\"test for \", i)\n\n    cu.tests.wallet.test[i] = result;\n\n    if (ret) console.log(ret)\n    if (Object.keys(result)) {\n        for (var i in result) console.log(i, result[i])\n    }\n    console.groupEnd();\n}\n\nif (cu.tests.wallet.pending.length)\n    console.error(\"error with tests : \")\n\n\n","\nimport cu from './main.js';\nimport './units/actionFlow.js';\nimport './units/brand.js';\nimport './units/bubbleBoard.js';\nimport './units/bubbleFlow.js';\nimport './units/bubbleGuns.js';\nimport './units/bubbleTest.js';\nimport './units/bubbleTypes.js';\nimport './units/db.js';\nimport './units/parseObjIntoMold.js';\nimport './units/parseStringIntoComp.js';\nimport './units/prettyScode.js';\nimport './units/reactAssembler.js';\nimport './units/reactUtils.js';\nimport './units/store.js';\nimport './units/testDataGenerator.js';\nimport './units/testMolds.js';\nimport './units/testTplAssembling.js';\nimport './units/tplObjParse.js';\nimport './units/treeCardsBuilder.js';\nimport './units/treeIterator.js';\nimport './units/uids.js';\nimport './init.js';\nexport default cu;\n   ","import React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\nimport CodeMirrorEditor from \"./components/CodeMirrorEditor\";\nimport _ from \"lodash\";\nimport $ from \"jquery\";\nimport go from \"gojs\";\nimport \"./libs/dataManager\";\nimport KeyboardManager from \"./managers/KeyboardManager\"\nimport StaticManager from \"./managers/StaticManager\"\nimport { TimerManager as TimerManagerBuilder } from \"./managers/TimerManager\"\nimport PouchDB from \"pouchdb\"\nimport js_beautify from \"js-beautify\"\nimport faker from 'faker'\nimport cu from \"./units/\"\nimport moment from \"moment\"\nimport MapDiagram from \"./components/TreeDiagram\"\nimport { reject } from 'q';\n//import NaturalManager from \"./managers/NaturalManager\"\n\nvar fns = window.fns = {}\n\nwindow.$ = $;\n\nvar ctxpins = window.ctxpins = {};\n\nvar customComponents = {\n  codemirror: CodeMirrorEditor,\n  mapdiagram: MapDiagram,\n}\n\nvar DataManager = window.DataManager;\nDataManager.newAPI = true;\n\nvar TimerManager = TimerManagerBuilder.init(DataManager);\n\n//--------------------\nwindow.$ = $;\n\nvar pinedTasks = `\n`\n\n\nlet myUB = window.myUB = {};\n\nDataManager.setCombined(\"fnsub\", {\n  loader: {\n    get: function () {\n\n\n\n      let fns = myUB;\n\n      if (!fns.fnsub || !fns.fnsub.isReady) {\n        this.make(fns, \"fnsub\", \"ub.fnsub\", {\n          old: fns.fnsub\n        })\n\n        this.setupAll(fns);\n      }\n\n\n      fns.fnsub.makeUb(\"menuHandling\", \"ub.menuHandling\", {\n        \"tb.db\": \"db\",\n      })\n\n      fns.fnsub.makeUb(\"mapview\", \"ub.mapView\", {\n        \"tb.db\": \"db\",\n        \"state\": \"antsDbState\",\n      })\n\n      fns.fnsub.makeUb(\"antsDbState\", \"ub.antsDbState\", {\n        \"tb.db\": \"db\"\n      })\n\n\n      fns.fnsub.makeUb(\"bridgeLoader\", \"ub.loaders.bridge\", {\n        \"tb.db\": \"db\"\n      })\n\n      fns.fnsub.makeUb(\"searchLoader\", \"ub.loaders.search\", {\n        \"tb.db\": \"db\"\n      })\n\n\n      fns.fnsub.makeUb(\"hudView\", \"ub.loaders.hud\", {\n        \"tb.db\": \"db\"\n      })\n\n\n\n      fns.fnsub.makeUb(\"db\", \"ub.db\", {})\n\n      fns.fnsub.makeUb(\"afterRenderActions\", \"ub.afterRenderActions\", {})\n\n\n      fns.fnsub.makeUb(\"shop\", \"ub.actionshops\", {\n        \"tb.db\": \"db\"\n      });\n\n      fns.fnsub.setupAll();\n\n    },\n\n    setupAll: function (fns) {\n      for (var i in fns) {\n        if (fns[i].goSetup)\n          this.setup(fns, fns[i])\n      }\n\n      return true;\n    },\n\n    make: function (fns, name, path, extra) {\n      let obj = Object.create(DataManager.getValue(path));\n      obj.goSetup = true;\n      obj.extra = extra;\n      obj.uid = cu.uids.run();\n\n      if (fns[name]) _.merge(fns[name], obj)\n      else\n        fns[name] = obj;\n    },\n\n    setup: function (fns, obj) {\n      delete obj.goSetup;\n\n      let values = {};\n      for (var i in obj.extra) {\n        let target = _.isString(obj.extra[i]) ? _.get(fns, obj.extra[i]) : obj.extra[i];\n        if (!target) {\n          target = {};\n          _.set(fns, obj.extra[i], target)\n        }\n        _.set(values, i, target)\n      }\n\n      if (obj.setup)\n        obj.setup(values);\n\n      obj.isReady = true;\n    },\n\n    autostart: true\n\n  }\n})\n\n\n\nDataManager.setCombined(\"ub.afterRenderActions\", {\n  setup: function (opts) {\n    _.merge(this, opts);\n\n    this.wallet = {\n      actions: []\n    }\n  },\n\n  add: function (name) {\n    this.wallet.actions.push(name);\n  },\n\n  runAll: function () {\n    let actions = this.wallet.actions;\n    this.wallet.actions = [];\n\n    for (var i in actions) {\n      if (this[actions[i]])\n        this[actions[i]]();\n    }\n  },\n  scrollIntoViewSelected: function () {\n    let target = $(\".content.selected\").get(0);\n    if (target) target.scrollIntoViewIfNeeded(false);\n  },\n\n  alertAnimation: function () {\n    if ($(\"body.alert\").length) return;\n\n    $(\"body\").addClass(\"alert\");\n\n    window.setTimeout(() => {\n      $(\"body\").removeClass(\"alert\")\n    }, 5000)\n  }\n})\nDataManager.setCombined(\"ub.antsDbState\", {\n  setup: function (opts) {\n    _.merge(this, opts);\n\n    this.wallet = {\n      state: {\n        prefix: \"ants\",\n        id: \"antsDbState\",\n        nextId: 1\n      }\n    };\n\n    myUB.fnsub.onready(this.tb.db)\n      .then(() => {\n        return this.tb.db.loadItems([\"antsDbState\"])\n      })\n      .catch(() => {\n      })\n      .then((state) => {\n        if (!state[0]) {\n          this.tb.db.saveItems(this.uid, [this.wallet.state])\n        }\n        else {\n          this.wallet.state = state[0];\n          this.isReady = true;\n        }\n      })\n  },\n\n  getId: function () {\n    this.wallet.state.nextId++;\n    this.tb.db.request_save(this.uid, [this.wallet.state], 100)\n    return \"ant_\" + this.wallet.state.nextId;\n  },\n\n  getTime: function () {\n    return new Date().getTime();\n  }\n})\n\n\n\nmyUB.fnsub = {\n  subs: [],\n  waiting: {},\n  makeUb: function (a, b, c) {\n    this.subs.push([a, b, c])\n  },\n  onready: function (sub) {\n    let payload = {};\n    let promise = new Promise((resolve) => {\n      payload.resolve = resolve;\n    })\n\n    if (!this.waiting[sub.uid]) this.waiting[sub.uid] = [];\n\n    this.waiting[sub.uid].push(payload);\n\n    return promise;\n  }\n}\n\n\nDataManager.setCombined(\"ub.antsDbState\", {\n  setup: function (opts) {\n    _.merge(this, opts);\n\n    this.wallet = {\n      state: {\n        prefix: \"ants\",\n        id: \"antsDbState\",\n        nextId: 1\n      }\n    };\n\n    myUB.fnsub.onready(this.tb.db)\n      .then(() => {\n        return this.tb.db.loadItems([\"antsDbState\"])\n      })\n      .catch(() => {\n      })\n      .then((state) => {\n        if (!state[0]) {\n          this.tb.db.saveItems(this.uid, [this.wallet.state])\n        }\n        else {\n          this.wallet.state = state[0];\n          this.isReady = true;\n        }\n      })\n  },\n\n  getId: function () {\n    this.wallet.state.nextId++;\n    this.tb.db.request_save(this.uid, [this.wallet.state], 100)\n    return \"ant_\" + this.wallet.state.nextId;\n  },\n\n  getTime: function () {\n    return new Date().getTime();\n  }\n})\n\nDataManager.setCombined(\"ub.fnsub\", {\n  setup: function (opts) {\n\n    _.merge(this, opts)\n\n    this.fns = opts.fns || myUB;\n\n    this.waiting = this.waiting || {};\n\n    let setupRequired = false;\n\n    if (this.old && this.old.subs) {\n      for (var i in this.old.subs) {\n        let sub = this.old.subs[i];\n        this.makeUb(sub[0], sub[1], sub[2])\n      }\n      setupRequired = true;\n      delete this.subs;\n    }\n\n    if (opts.ubs) {\n      for (var i in opts.ubs) {\n        let ub = opts.ubs[i];\n        this.makeUb(ub.name, ub.path, ub.extra)\n      }\n      setupRequired = true;\n    }\n\n    if (setupRequired)\n      this.setupAll();\n  },\n\n\n  detach: function () {\n    let id = cu.uids.run();\n\n    let name = \"internal_\" + id;\n\n    this.makeUb(name, \"ub.fnsub\", {\n      id: id,\n      fns: {},\n      parent: this\n    });\n\n    this.setupAll();\n\n\n    let item = this.fns[name];\n\n    this.fns[name].fns.fnsub = item;\n\n    item.getFromParent(\"db\")\n    return item.fns;\n  },\n\n\n  getFromParent: function (names) {\n    if (_.isString(names)) {\n      names = [names]\n    }\n\n    for (var i in names) {\n      let name = names[i] || i;\n      let ub = this.parent.fns[name];\n\n      this.fns[name] = ub;\n    }\n  },\n  addUb: function (spec) {\n    if (_.isArray(spec)) {\n      spec.forEach(spec => {\n        if (_.isString(spec) || !spec.name) this.getFromParent(spec)\n        else this.makeUb(spec.name, spec.path, spec.extra)\n      });\n      this.setupAll();\n      return;\n    }\n    this.makeUb(spec.name, spec.path, spec.extra);\n    this.setupAll();\n\n    return this.fns[spec.name];\n  },\n  addUbs: function (spec) {\n    this.addUb(Object.values(spec));\n  },\n  setupAll: function () {\n    let fns = this.fns;\n    for (var i in fns) {\n      if (fns[i].goSetup)\n        this.setupUb(fns[i])\n    }\n\n    return true;\n  },\n\n  makeUb: function (name, path, extra, fns) {\n\n    fns = fns || this.fns;\n    let obj = _.isString(path) ? Object.create(DataManager.getValue(path)) : path;\n    obj.goSetup = true;\n    obj.extra = extra;\n    obj.uid = fns[name] && fns[name].id ? fns[name].uid : (extra.id || cu.uids.run());\n\n\n    if (fns[name]) _.merge(fns[name], obj)\n    else\n      fns[name] = obj;\n  },\n\n  setupUb: function (obj, fns) {\n    fns = fns || this.fns;\n    delete obj.goSetup;\n\n    let values = {};\n    for (var i in obj.extra) {\n      let target = _.isString(obj.extra[i]) ? _.get(fns, obj.extra[i]) : obj.extra[i];\n      if (!target) {\n        target = { uid: cu.uids.run() };\n        _.set(fns, obj.extra[i], target)\n      }\n      _.set(values, i, target)\n    }\n\n    if (obj.setup)\n      obj.setup(values);\n\n    obj.isReady = true;\n\n    if (this.waiting[obj.uid]) {\n      this.waiting[obj.uid].forEach(payload => {\n        payload.resolve()\n      })\n\n      this.waiting[obj.uid] = [];\n    }\n  },\n\n  onready: function (sub) {\n\n    if (sub.isReady) return Promise.resolve();\n\n    let payload = {};\n    let promise = new Promise((resolve) => {\n      payload.resolve = resolve;\n    })\n\n    if (!this.waiting[sub.uid]) this.waiting[sub.uid] = [];\n    this.waiting[sub.uid].push(payload);\n\n    return promise;\n  }\n\n\n});\n\nDataManager.setCombined(\"ub.db\", {\n  setup: function () {\n    this.db = cu.db.run(\"thisdb\");\n    this.timers = {};\n  },\n\n  destroy: function () {\n    this.db.destroy();\n  },\n  request_save: function (id, src, delay) {\n    if (this.timers[id]) window.clearTimeout(this.timers[id]);\n\n    this.timers[id] = window.setTimeout(() => {\n      this.saveItems(id, src)\n    }, delay || 1000)\n  },\n\n  saveItems: function (id, src) {\n    if (this.timers[id]) window.clearTimeout(this.timers[id]);\n\n    let items = (_.isArray(src)) ? src : src.getItemsToSave();\n    let promises = [];\n    for (var i in items) {\n      promises.push(this.db.save(items[i], items[i].id));\n    }\n\n    return Promise.all(promises)\n  },\n\n  loadItems: function (src, loadedItems) {\n    let items = (_.isArray(src)) ? src : src.getItemsToSave();\n    let promises = [];\n    loadedItems = loadedItems || {};\n\n    for (var i in items) {\n      if (loadedItems[items[i]]) {\n        promises.push(Promise.resolve(loadedItems[items[i]]))\n      }\n      else\n        promises.push(this.db.load(items[i]))\n\n    }\n\n    return Promise.all(promises);\n  },\n\n\n  searchText: function (text) {\n    return this.db.searchText(text)\n  },\n\n  loadFilter: function (filter, count, sort) {\n    return this.db.loadfilter(filter, count, sort)\n  },\n\n  loadFromIndex: function (params) {\n    let { selector, sortField, sortDir, count, index } = params;\n\n    return this.db.loadFromIndex(selector, sortField, sortDir, count, index);\n  }\n})\n\n\nDataManager.setCombined(\"actionShop.actions\", {\n  makePreview: {\n    path: \"actionshops.generatePreviewItem\",\n    opName: \"main\",\n    guards: {},\n    args: { id: \"antId\", items: \"items\", save: \"save\" },\n    argsArray: { antId: \"1\" }\n  },\n\n  makeTreeMap: {\n    path: \"actionshops.makeTreeMap\",\n    opName: \"main\",\n    guards: {},\n    args: { id: \"antId\", items: \"items\" }\n  },\n\n  getStatisticsView : {\n    path : \"actionshops.statisticsView\",\n    opName : \"main\",\n    guards : {},\n    args : {refresh : \"refresh\"}\n  }\n})\n\nDataManager.setCombined(\"ub.actionshops\", {\n  setup: function () {\n    this.shops = {};\n    this.ub = myUB.fnsub.detach();\n\n  },\n\n  go: function (actionName, args, guards) {\n    let actions = DataManager.getWallet(\"actionShop.actions\");\n    let action = actions[actionName];\n\n    let path = action.path;\n    let name = action.opName;\n    //let guards = action.guards;\n\n    let values = {};\n    for (var i in action.args) {\n      let slot = action.args[i];\n      let val = _.get(args, i);\n      if (val !== undefined)\n        _.set(values, slot, val)\n    }\n\n    return this.run(path, name, values, guards)\n  },\n  run: function (path, name, values, guards) {\n    let shop = this.get(path);\n\n    return shop.run(name, values, guards);\n  },\n  get: function (path) {\n    let shop;\n    if (this.shops[path]) {\n      shop = this.shops[path]\n    }\n    else {\n      shop = this.createShop(path)\n    }\n\n    return shop;\n  },\n\n  createShop: function (path, extra) {\n    let specs = DataManager.getValue(path);\n    specs = _.cloneDeep(specs);\n\n    specs.setup = cu.actionFlow.setupFlow;\n\n\n    let view = {\n      name: path,\n      path: specs,\n      extra: {\n        \"tb.db\": \"db\",\n      }\n    };\n\n    if (extra) {\n      _.merge(view.extra, extra);\n    }\n\n    let item = this.ub.fnsub.addUb(view)\n\n    this.shops[path] = item;\n\n    return item;\n  },\n\n})\n\n\n\nDataManager.setCombined(\"ub.values\", {\n  setup: function (opts) {\n    Object.assign(this, opts)\n  },\n\n  set: function (path, value) {\n    _.set(this.data, path, value)\n  },\n  get: function (path) {\n    return _.get(this.data, path);\n  },\n  trigger: function (name, value, partial) {\n    this.set(name, value);\n    let loaderPath = this.data.blockcfg.loaderPath\n    DataManager.markChangeOn(loaderPath, false, true);\n  }\n})\n\nDataManager.setCombined(\"actionsBundle.tree\", {\n  tree: {\n    treeTemplate: {\n      run: function (args, v) {\n        let items = [];\n\n        this.processNode(args.data, args.tpl, items);\n\n        v.actions.pinTo(args, items, v);\n      },\n      processNode: function (data, tpl, v) {\n        let item = cu.moldAssembler.run(tpl, data);\n\n        for (var i in data.subs) {\n          this.processNode(data.subs[i], tpl, v)\n        }\n\n        v.push(item);\n        return item;\n      }\n    },\n    makeTree: {\n      run: function (args, v) {\n        let result = this.makeNode(args, args.startId, { startNode: true }, 0);\n        v.actions.pinTo(args, result, v);\n        return result;\n      },\n\n      makeNode: function (v, id, info, level) {\n        let subs = v.rels[id];\n        let item = v.items[id];\n\n        let result = { subs: {}, item, info, count: 0, level };\n\n        if (!v.maxLevel || v.maxLevel > level)\n          for (var i in subs) {\n            result.subs[i] = this.makeNode(v, i, subs[i], level + 1);\n            result.count++;\n          }\n\n        return result;\n      }\n    },\n\n  }\n})\nDataManager.setCombined(\"actionsBundle.generics\", {\n  isCollection: true,\n  fields: {\n    field: function (args, v) {\n      let value = args.defaultValue || \"\";\n      if (args.item && args.item.fields && args.item.fields[args.field])\n        value = args.item.fields[args.field]\n\n      v.actions.pinTo(args, value, v)\n\n    },\n  },\n  ops: {\n    ops: function (args, v) {\n      v.master.run(args.ops)\n    }\n  },\n\n  molds: {\n    makeMold: function (args, v) {\n      let result = cu.tplObjParse.run(_.cloneDeep(args.tpls));\n      v.actions.pinTo(args, result, v);\n    }\n  },\n})\n\n\nDataManager.setCombined(\"actionshops.card\", {\n  data: {\n    tpls: {\n      card: \"<div>{title} {content}<div>\",\n      title: \"<div> {item.title} </div>\",\n      item: \"<div> {item.title} </div>\"\n    },\n\n    content: \"salut\",\n    item: {\n      title: \"elefant\"\n    }\n\n  },\n  opsCollection: {\n    main: [\n      { name: \"salut\", type: \"runop\", op: \"makeCard\", prefix: \"temp\" }\n    ],\n    setup: {\n      molds: { name: \"molds\", type: \"makeMold\", input: { tpls: \"tpls\" } },\n      ops: { name: \"makeCard\", type: \"combineMoldInOps\", outcome: \"card\", input: { molds: \"molds\" }, list: \"card,title,item\" }\n    }\n  },\n\n  actions: {\n    import: \"actionsBundle.generics\",\n    my: {\n\n      runop: function (args, v) {\n        v.master.run(args.op, args.value || {}, {\n          outcome: [\n            function (path, value, partial) {\n            }\n          ]\n        }, {\n            prefix: args.prefix\n          })\n      },\n      combineMoldInOps: function (args, v) {\n        let names = args.list.split(\",\");\n        let tpls = {};\n        names.forEach(name => {\n          tpls[name] = _.get(args.molds, name);\n        })\n\n        let ops = [];\n\n        let needed = {};\n\n        for (var i in tpls) {\n          let tpl = tpls[i];\n          let op = { type: \"useTpl\", name: null, tpl: null, input: {} }\n          let slot = i == args.outcome ? \"outcome\" : i;\n          op.name = slot;\n          op.tpl = tpl;\n\n          let params = tpl.mold.parameters;\n\n          for (var i in params) {\n            op.input[i] = i;\n            needed[i] = true;\n          }\n\n          ops.push(op)\n        }\n\n        for (var i in ops) {\n          delete needed[ops[i].name]\n        }\n\n        v.master.ctx.opsCollection[args.name] = ops;\n        ///v.actions.pinTo( args, ops, )\n      }\n    }\n  }\n})\n\n\nDataManager.setCombined(\"actionshops.generatePrview\", {\n  ops: [\n    { name: \"allmaps\", type: \"searchItems\", filter: { type: \"map\" } },\n    { name: \"previewIds\", type: \"generatePreviewItems\", input: { maps: \"allmaps\" } },\n    { name: \"previews\", type: \"loadItems\", input: { ids: \"previewIds\" } },\n    { type: \"log\", input: { maps: \"allmaps\", previewIds: \"previewIds\", no: \"noPreviews\" } },\n\n    { name: \"noPreviews\", type: \"getItemsWithsNoPreview\", input: { previews: \"previews\", ids: \"allmaps\" } },\n\n    { type: \"iterateList\", input: { items: \"noPreviews\" } }\n  ],\n\n  actions: {\n    import: \"actionsBundle.generics\",\n    myx: {\n      iterateList: function (args, v) {\n        let items = args.items;\n        let index = 0;\n\n        let cb = function (value) {\n          let prom = new Promise((resolve) => {\n            v.tb.generatePreview.run(\"main\", value, {\n              DONE: [\n                (value) => {\n                  resolve(value)\n                }\n              ]\n            })\n          })\n          return prom;\n        }\n\n        let fn = function () {\n          index++;\n          if (index >= items.length) return;\n          let value = items[index];\n          return cb(value).then((result) => {\n          }).then(fn);\n        }\n\n        fn();\n\n\n      },\n      generatePreviewItems: function (args, v) {\n        let ids = args.maps.map(map => { return \"preview_\" + map.id });\n\n        v.actions.pinTo(args, ids, v)\n        return ids;\n      },\n\n      getItemsWithsNoPreview: function (args, v) {\n        var previews = args.previews;\n        var ids = args.ids;\n\n        var items = [];\n\n        for (var i in previews)\n          if (!previews[i]) items.push({ antId: ids[i].id })\n\n\n        v.actions.pinTo(args, items, v)\n\n      }\n    }\n  },\n})\n\n\nDataManager.setCombined(\"actionshops.getRecentPreview\", {\n  ops: [\n    {\n      name: \"previewMaps\",\n      type: \"loadFromIndex\",\n      selector: { type: \"previewItem\" },\n      sortField: \"updatedAt\",\n      sortDir: \"desc\",\n      count: 3,\n      index: [\"updatedAt\", \"type\"],\n      append: \"items\"\n    },\n\n    { type: \"log\", input: { items: \"list\", maps: \"previewMaps\", subitems: \"subitems\" } },\n\n    { name: \"subids\", type: \"selectIds\", input: { src: \"previewMaps\" }, paths: [\"\", \"rels.allSubs\", \"id\"] },\n\n    { name: \"subitems\", append: \"items\", type: \"loadItems\", input: { ids: \"subids\" } },\n\n\n    { name: \"list\", type: \"runopOnList\", input: { subitems: \"subitems\", list: \"previewMaps\", repo: \"items\" }, op: \"map\", result: \"outcome\" }\n  ],\n\n  opsCollection: {\n    line: [\n      { name: \"outcome\", type: \"useTpl\", input: { item: \"item\", time: \"time\", tpl: \"molds.line\" } },\n      {\n        name: \"time\", type: \"makeTime\", input: { timestamp: \"item.placedAt\" }, partial: true\n        , on: { partial: { value: \"\" } }\n      },\n    ],\n\n    map: [\n      { type: \"debug\" },\n      { type: \"log\", input: { subitems: \"subitems\", content: \"xcontent\" } },\n      { name: \"outcome\", type: \"useTpl\", input: { item: \"item\", tpl: \"molds.map\", content: \"xcontent\" } },\n      { name: \"subitems\", type: \"getSubitems\", input: { items: \"items\", subs: \"item.rels.allSubs\" } },\n      { name: \"xcontent\", type: \"runopOnList\", input: { list: \"subitems\" }, op: \"line\", result: \"outcome\" },\n      //{ name: \"content\", type: \"listOfOps\", input: {} }\n    ],\n    setup: [\n      { name: \"molds\", input: { tpls: \"tpls\" }, type: \"makeMold\" },\n    ],\n  },\n\n  data: {\n    tpls: {\n      line: \"<div class='adv_entry'><span class='time'>{time}</span> {item.text}</div>\",\n      map: \"<div class='adv_map'>{item.text} <div class='content'> {content}</div></div>\"\n    }\n  },\n\n  actions: {\n    molds: {\n      makeMold: function (args, v) {\n        let result = cu.tplObjParse.run(_.cloneDeep(args.tpls));\n        v.actions.pinTo(args, result, v);\n      }\n    },\n    myx: {\n\n      debug: function (op, tb) {\n        console.log(\"debug\", tb.privat.xcontent, tb.ops)\n      },\n      getSubitems: function (op, v) {\n        let items = [];\n\n        for (var i in op.subs) {\n          items.push(op.items[i])\n        }\n\n        items.sort((a, b) => b.placedAt - a.placedAt)\n        v.actions.pinTo(op, items, v)\n      },\n      makeTime: function (op, v) {\n        let time = moment(op.timestamp).fromNow()\n        v.actions.pinTo(op, time, v);\n      },\n\n      runop: function (args, v) {\n        return new Promise((resolve, reject) => {\n\n          v.master.run(args.op, {},\n            {\n              outcome: [\n                function (path, value, partial) {\n                  resolve(value);\n                }\n              ],\n            },\n            {\n              privat: _.cloneDeep(args)\n            })\n        });\n      },\n\n      runopOnList: function (args, v) {\n        let values = [];\n\n        let list = args.list;\n\n        let xxx = (args.op + args.name)\n        let i = -1;\n\n        let fn = () => {\n          i++;\n          if (i >= list.length) return;\n\n          let opargs = Object.assign({}, _.cloneDeep(args), { item: list[i], index: i })\n\n          return v.actions.runop(opargs, v).then(value => {\n            values.push(value)\n          }).then(fn)\n        }\n\n\n        fn().then(() => {\n          v.actions.pinTo(args, values, v)\n\n        })\n\n      },\n\n\n      selectIds: function (op, v) {\n        let items = [];\n        let paths = op.paths;\n\n        let src = [op.src];\n\n        for (var j = 0; j < paths.length; j++) {\n          let path = paths[j];\n          let items = [];\n          for (var i in src) {\n            let value;\n            if (path) value = _.get(src[i], path)\n            else value = src[i];\n            if (value) {\n              let val = _.isObject(value) ? _.values(value) : value;\n              items = items.concat(val)\n            }\n          }\n          src = items;\n        }\n\n        v.actions.pinTo(op, src, v)\n      }\n    }\n  }\n})\n\nwindow.moment = moment;\n\nDataManager.setCombined(\"actionshops.getListWithoutPreview\", {\n  ops: [\n    { name: \"allmaps\", type: \"searchItems\", filter: { type: \"map\" } },\n    { name: \"previewIds\", type: \"generatePreviewItems\", input: { maps: \"allmaps\" } },\n    { name: \"noPreviews\", extra: { withPreview: \"withPreview\" }, type: \"getItemsWithsNoPreview\", input: { previews: \"previews\", ids: \"allmaps\" } },\n    { name: \"previews\", type: \"loadItems\", input: { ids: \"previewIds\" } },\n    { type: \"log\", input: { previews: \"previews\" } }\n\n  ],\n\n  actions: {\n    import: \"actionsBundle.generics\",\n    myx: {\n      generatePreviewItems: function (args, v) {\n        let ids = args.maps.map(map => { return \"preview_\" + map.id });\n\n        v.actions.pinTo(args, ids, v)\n        return ids;\n      },\n\n      getItemsWithsNoPreview: function (args, v) {\n        var previews = args.previews;\n        var ids = args.ids;\n\n        var items = [];\n        var withPreview = [];\n\n        for (var i in previews)\n          if (!previews[i]) items.push({ antId: ids[i].id })\n          else withPreview.push(previews[i])\n        v.actions.pinTo(args, items, v)\n\n      }\n    }\n  },\n})\n\nDataManager.setCombined(\"actionshops.generatePreviewItem\", {\n  data: {\n    antId: \"ant_2\",\n\n    tpls: {\n      obj: {\n        isCollection: true,\n        preview: {\n          \"rels.allSubs\": \"{latestSubs}\",\n          text: \"{text}\",\n          id: \"preview_{mapId}\",\n          mapId: \"{mapId}\",\n          summary: \"{summary}\",\n          type: \"previewItem\",\n          updatedAt: \"{updatedAt}\"\n        }\n      }\n    }\n  },\n\n  x: { go: \"getField\", on: \"\", use: { item: \"root\" }, field: \"summary\", defaultValue: \"\" },\n\n  ops: [\n    { type: \"log\", input: { outcome: \"previewAnt\" } },\n    { name: \"root\", append: \"items\", input: { id: \"antId\" }, type: \"loadItem\" },\n    { name: \"subs\", append: \"items\", input: { ids: \"root.rels.allSubs\" }, type: \"loadItems\" },\n    { name: \"latest\", extra: { date: \"updatedAt\" }, type: \"getLatestSubs\", input: { root: \"root\", items: \"subs\" }, count: 4 },\n    { name: \"summary\", type: \"field\", input: { item: \"root\" }, field: \"summary\", defaultValue: \"\" },\n    { name: \"previewAnt\", type: \"useTpl\", input: { text: \"root.text\", tpl: \"molds.obj.preview\", latestSubs: \"latest\", mapId: \"antId\" } },\n    //{ type: \"saveItems\", input: { items: \"previewAnt\" } },\n\n    { type: \"fn\", input: { fn: \"save\", item: \"previewAnt\" } },\n  ],\n\n  valuesChain: {\n    \"antId\": {\n      unset: \"root,subs,latest,summary,previewAnt\",\n      reset: {\n        save: { value: (value) => { } }\n      }\n    }\n  },\n\n  opsCollection: {\n    setup: [\n      { name: \"molds\", input: { tpls: \"tpls\" }, type: \"makeMold\" },\n    ],\n\n    test: [\n      { type: \"log\", input: { outcome: \"previewAnt\" } },\n\n      { name: \"root.fields.summary\", type: \"staticValue\", input: { root: \"root\", value: \"summary\" } },\n\n    ],\n  },\n  actions: {\n    bundle: \"actionsBundle.generics\",\n    items: {\n      getLatestSubs: function (args, v) {\n        let items = args.items;\n        items.sort((a, b) => b.placedAt - a.placedAt);\n        let latest = items.slice(0, args.count);\n\n        let date;\n        if (latest.length > 0) {\n          date = latest[0].placedAt;\n        }\n        else date = args.root.startedAt;\n\n        if (args.extra.date)\n          v.actions.pinTo({ pin: args.extra.date }, date, v)\n\n        let latestSubs = {};\n        for (var i in latest)\n          latestSubs[latest[i].id] = { id: latest[i].id, position: i }\n\n        v.actions.pinTo(args, latestSubs, v)\n      }\n    },\n  }\n});\n\n\n\n\nDataManager.setCombined(\"actionshops.makeSWOTentry\", {\n  data: {\n    slots: \"strength,weakness,opportunities,threats\".split(\".\"),\n    text: \"salut\",\n\n    tpls: {\n      isCollection: true,\n\n      swot: {\n        strengths: { id: \"{id.0}\" },\n        weaknesses: { id: \"{id.1}\" },\n        opportunities: { id: \"{id.2}\" },\n        threats: { id: \"{id.3}\" },\n        linkedMap: { id: \"{id.5}\" },\n        id: \"{id.4}\",\n        type: \"swot\",\n      },\n\n\n      map: {\n        id: \"{id.5}\",\n        text: \"{text}\",\n        type: \"map\",\n        rels: {\n          linked: {\n            \"{id.4}\": { id: \"{id.4}\", type: \"swot\" }\n          },\n          allSubs: {\n            \"{id.0}\": { id: \"{id.0}\" },\n            \"{id.1}\": { id: \"{id.1}\" },\n            \"{id.2}\": { id: \"{id.2}\" },\n            \"{id.3}\": { id: \"{id.3}\" },\n          },\n          sub: {\n            \"{id.5}\": {\n              \"{id.0}\": { id: \"{id.0}\" },\n              \"{id.1}\": { id: \"{id.1}\" },\n              \"{id.2}\": { id: \"{id.2}\" },\n              \"{id.3}\": { id: \"{id.3}\" },\n            }\n          }\n        }\n      },\n      ants: {\n        \"{id.0}\": { id: \"{id.0}\", text: \"Strength\" },\n        \"{id.1}\": { id: \"{id.1}\", text: \"Weaknesses\" },\n        \"{id.2}\": { id: \"{id.2}\", text: \"Opportunities\" },\n        \"{id.3}\": { id: \"{id.3}\", text: \"Threats\" },\n      },\n\n      rel: {\n        type: \"link\",\n        subject: \"{id.5}\",\n        target: \"{id.4}\",\n\n        rel: \"preview\",\n        relAttr: \"swot\",\n      }\n    },\n\n\n  },\n  ops: [\n\n    { name: \"id\", type: \"generateIds\", count: 6 },\n    { type: \"log\", input: { toSave: \"toSave\" } },\n    { type: \"log\", input: { \"id\": \"id\", map: \"map\", swot: \"swot\" } },\n\n    { name: \"swot\", append: \"toSave\", type: \"useTpl\", input: { tpl: \"molds.swot\", id: \"id\" } },\n    { name: \"map\", append: \"toSave\", type: \"useTpl\", input: { tpl: \"molds.map\", id: \"id\", text: \"text\" } },\n    { name: \"ants\", append: \"toSave\", type: \"useTpl\", input: { tpl: \"molds.ants\", id: \"id\" } },\n    { type: \"saveItems\", name: \"saveDone\", input: { items: \"toSave\", a: \"swot\", b: \"map\", c: \"ants\" } },\n\n    { type: \"log\", input: { map: \"map\", swot: \"swot\" } },\n\n    { type: \"log\", input: { swotId: \"swot.id\", mapId: \"map.id\" } },\n\n    { name: \"outcome\", type: \"assembleObj\", input: { id: \"map.id\" }, waitfor: [\"saveDone\"], }\n\n  ],\n\n  valuesChain: {\n    \"name\": {\n      unset: \"root,subs,graph,nodes\",\n      reset: {\n        save: { value: (value) => { } }\n      }\n    }\n  },\n\n  opsCollection: {\n    setup: [\n      { name: \"molds\", input: { tpls: \"tpls\" }, type: \"makeMold\" },\n    ],\n  },\n\n  actions: {\n    bundle: \"actionsBundle.generics\",\n    myx: {\n      generateIds: function (op, v) {\n        let ids = [];\n        for (var i = 0; i < op.count; i++) {\n          let id = myUB.antsDbState.getId();\n          ids.push(id)\n        }\n\n        v.actions.pinTo(op, ids, v)\n      }\n    }\n  }\n})\n\nDataManager.setCombined(\"actionshops.makeTreeMap\", {\n  data: {\n    antId: \"ant_2\",\n\n    tpls: {\n      main: \"<treemap graph={graph} on_click={actions.select} />\"\n    }\n  },\n  ops: [\n\n    { name: \"root\", append: \"items\", input: { id: \"antId\" }, type: \"loadItem\" },\n    { name: \"subs\", append: \"items\", input: { ids: \"root.rels.allSubs\" }, type: \"loadItems\" },\n    { type: \"log\", input: { subs: \"root.rels.allSubs\" } },\n    { type: \"useTpl\", name: \"nodes\", input: { tpl: \"molds.main\", graph: \"graph\" } },\n    { type: \"getNodesVis\", name: \"graph\", input: { _s: \"subs\", startId: \"root.id\", items: \"items\", subs: \"root.rels.sub\", brand: \"root.brand\" } },\n    { type: \"getActions\", name: \"actions\" },\n\n  ],\n\n  valuesChain: {\n    \"antId\": {\n      unset: \"root,subs,graph,nodes\"\n    }\n  },\n\n  opsCollection: {\n    setup: [\n      { name: \"molds\", input: { tpls: \"tpls\" }, type: \"makeMold\" },\n    ],\n  },\n  actions: {\n    bundle: \"actionsBundle.generics\",\n    items: {\n\n      getActions: function (op, v) {\n\n        var actions = cu.store.get(null, hapi, {\n          runWithParam: {\n            select: \"select\"\n          }\n        });\n\n\n        v.actions.pinTo(op, actions, v)\n      },\n      getNodes: function (op, v) {\n        let graph = {\n          nodes: [],\n          links: []\n        }\n        let fn = function (id, parentIndex, level) {\n          if (level > 3) return;\n          let index = graph.nodes.push({ name: op.items[id].text, radius: Math.max(5, 40 - level * 10) }) - 1;\n\n          if (parentIndex !== null)\n            graph.links.push({ target: index, source: parentIndex, value: 1 })\n          for (var i in op.subs[id]) {\n            fn(i, index, level + 1)\n          }\n        }\n\n        fn(op.startId, null, 0)\n        v.actions.pinTo(op, graph, v)\n      },\n      getNodesVis: function (op, v) {\n        let graph = {\n          nodes: [],\n          edges: []\n        }\n        let fn = function (id, parentIndex, level, parentId) {\n          if (level > 3) return;\n          let nodeId = graph.nodes.length + 1;\n          let index = graph.nodes.push({ id: id, label: op.items[id].text }); //name :  op.items[ id ].text ,radius : Math.max( 5, 40  - level * 10 ) } ) -1 ;\n\n          if (parentIndex !== null)\n            graph.edges.push({ to: id, from: parentId })//, value : 1})\n          for (var i in op.subs[id]) {\n            fn(i, index, level + 1, id)\n          }\n        }\n\n        fn(op.startId, null, 0)\n\n        graph.seed = 2;\n        graph.colors = {\n          main: op.brand.mainColor,\n          pastel: op.brand.pastelColor\n        }\n        v.actions.pinTo(op, graph, v)\n      }\n    },\n  }\n});\n\n\n\n\nDataManager.setCombined(\"actionshops.statisticsView\", {\n  data: {\n    tpls: {\n      main: \"<div>Salut</div>\"\n    }\n  },\n  ops: [\n    { type: \"log\", input: { all: \"nodes\" } },\n    { type: \"useTpl\", name: \"nodes\", input: { tpl: \"molds.main\"} },\n  ],\n\n  valuesChain: {\n    \"antId\": {\n      unset: \"nodes\"\n    },\n    \"refresh\" : {\n      unset : \"nodes\"\n    }\n  },\n\n  opsCollection: {\n    setup: [\n      { name: \"molds\", input: { tpls: \"tpls\" }, type: \"makeMold\" },\n    ],\n  },\n  actions: {\n    bundle: \"actionsBundle.generics\",\n    items: {\n\n    },\n  }\n});\n\n\n\n\nDataManager.setCombined(\"actionshops.swotPreview\", {\n  data: {\n    antId: \"ant_2\",\n\n    tpls: {\n      main: \"<treemap graph={graph} on_click={actions.select} />\"\n    }\n  },\n  ops: [\n\n    { name: \"root\", append: \"items\", input: { id: \"antId\" }, type: \"loadItem\" },\n\n  ],\n\n  valuesChain: {\n    \"antId\": {\n      unset: \"root,subs,graph,nodes\"\n    }\n  },\n\n  opsCollection: {\n    setup: [\n      { name: \"molds\", input: { tpls: \"tpls\" }, type: \"makeMold\" },\n    ],\n  },\n  actions: {\n    bundle: \"actionsBundle.generics\",\n    items: {\n\n      getActions: function (op, v) {\n\n        var actions = cu.store.get(null, hapi, {\n          runWithParam: {\n            select: \"select\"\n          }\n        });\n\n\n        v.actions.pinTo(op, actions, v)\n      },\n      getNodes: function (op, v) {\n        let graph = {\n          nodes: [],\n          links: []\n        }\n        let fn = function (id, parentIndex, level) {\n          if (level > 3) return;\n          let index = graph.nodes.push({ name: op.items[id].text, radius: Math.max(5, 40 - level * 10) }) - 1;\n\n          if (parentIndex !== null)\n            graph.links.push({ target: index, source: parentIndex, value: 1 })\n          for (var i in op.subs[id]) {\n            fn(i, index, level + 1)\n          }\n        }\n\n        fn(op.startId, null, 0)\n        v.actions.pinTo(op, graph, v)\n      },\n      getNodesVis: function (op, v) {\n        let graph = {\n          nodes: [],\n          edges: []\n        }\n        let fn = function (id, parentIndex, level, parentId) {\n          if (level > 3) return;\n          let nodeId = graph.nodes.length + 1;\n          let index = graph.nodes.push({ id: id, label: op.items[id].text }); //name :  op.items[ id ].text ,radius : Math.max( 5, 40  - level * 10 ) } ) -1 ;\n\n          if (parentIndex !== null)\n            graph.edges.push({ to: id, from: parentId })//, value : 1})\n          for (var i in op.subs[id]) {\n            fn(i, index, level + 1, id)\n          }\n        }\n\n        fn(op.startId, null, 0)\n\n        graph.seed = 2;\n        graph.colors = {\n          main: op.brand.mainColor,\n          pastel: op.brand.pastelColor\n        }\n        v.actions.pinTo(op, graph, v)\n      }\n    },\n  }\n});\n\n\n\n///2\n\nvar hapi = {\n\n  showMindMap: function (id) {\n    DataManager.runOnLoader(\"antsView.formPanel.nodes\", \"change\", { id: id })\n    DataManager.set(\"workingant.viewState.path\", \"antsView.formPanel.nodes\");\n    DataManager.markChangeOn(\"workingant.viewState\", false, true)\n\n  },\n\n  showhud: function () {\n    let currentView = DataManager.getValue(\"workingant.viewState.path\");\n\n    currentView = currentView !== \"antView.map.nodes\" ? \"map\" : \"bridge\"\n\n    this.goToCard(currentView);\n\n    //DataManager.set(\"workingant.viewState.path\", currentView);\n  },\n  placeorder: function (evt) {\n    if (evt.which !== 13) return;\n\n    flow.place();\n    DataManager.set(\"workingant.data.input\", { text: \"\" })\n    flow.restart();\n  },\n  set: function (path, value) {\n    DataManager.set(path, value)\n  },\n  parseinput: function () {\n\n    let text = DataManager.getValue(\"workingant.data.input\");\n\n    if (_.isString(text)) {\n      hapi.prepareMenu(text);\n      flow.parse(text)\n    }\n  },\n\n  prepareMenu: function (text) {\n    const type = (type) => ({ type: type })\n    const checkTokenMatch = (token, index, item) => {\n      console.log( \"item\", item.hasTail , item.tokens[index])\n      if (!item.tokens[index]) {\n        console.log( item.hasTail )\n        return item.hasTail;\n      }\n      if (item.tokens[index] != token) return false;\n      return true;\n    }\n\n    const checkToken = (token, index, item) => {\n      if (!item.tokens[index]) return { score: 1 };\n      if (item.tokens[index].indexOf && item.tokens[index].indexOf(token) == 0) return { score: 100 };\n      return { score: 1 };\n    }\n\n    let itemsSpecs = [\n      {\n        tokens: [\".m\"], \n        hasTail : true,\n        actions: [\n          {  },\n          { scout: \"maps\", msg: \"getting map #\" }\n        ]\n      }\n    ]\n\n    let tokens = text.split(/\\s+/);\n\n    let match = itemsSpecs;\n\n    for (var i = 0; i < tokens.length - 1; i++) {\n      let token = tokens[i];\n      let nextMatch = [];\n      for (var j in match) {\n        if (checkTokenMatch(token, i, match[j])) {\n          nextMatch.push(match[j])\n        }\n      }\n\n      match = nextMatch;\n    }\n\n\n    let finalMatch = [];\n    let lastIndex = tokens.length - 1;\n    let lastToken = tokens[lastIndex];\n\n    for (var i in match) {\n      let score = checkToken(lastToken, lastIndex, match[i]);\n      if (score)\n        finalMatch.push(match[i])\n    }\n\n    let items = [];\n\n    for (var i in finalMatch) {\n      let action = finalMatch[i].actions[lastIndex];\n      if (!action) continue;\n      if (action.msg) items.push(action.msg)\n    }\n\n    myUB.menuHandling.setContent( items );\n    console.log(items);\n  },\n\n  select: function (id, skipFocus) {\n\n    console.log(\"selecting\", id)\n    flow.change({ parent: id })\n    DataManager.set(\"repo.uistate.selected\", id)\n\n\n    if (skipFocus !== \"skip\")\n      $(\"#order\").focus();\n\n    myUB.afterRenderActions.add(\"scrollIntoViewSelected\")\n  },\n\n  goToInfo: function (id) {\n    DataManager.set(\"antsView.hudPanel.cfg.antId\", id);\n    //DataManager.set(\"workingant.viewState.overPanel.hud\", \"antsView.hudPanel.nodes\")\n    this.goToCard(\"info\");\n    return false;\n  },\n\n  goToCard: function (id) {\n    var cards = {\n      bridge: \"antView.bridge.nodes\",\n      map: \"antView.map.nodes\",\n      info: \"antsView.hudPanel.nodes\"\n    }\n\n    let path = cards[id];\n\n    if (id == \"bridge\") {\n      myUB.bridgeLoader.loadBridge();\n    }\n\n    DataManager.set(\"workingant.viewState.path\", path);\n\n  },\n\n  selectMap: function (id) {\n    console.log(\"selecting map\", id);\n    myUB.mapview.loadMap(id)\n    this.goToCard(\"map\");\n\n    this.select(id, \"skip\");\n  },\n\n  makeSwot: function (name) {\n    myUB.shop.run(\"actionshops.makeSWOTentry\", \"main\", { text: name }, {\n      outcome: [(path, value) => {\n        hapi.selectMap(value.id)\n      }]\n    })\n  }\n}\n\nwindow.hapi = hapi;\n\nDataManager.setTrigger(\"workingant.data.input\", \"ada\", {\n  run: hapi.parseinput\n})\n\n\nDataManager.setCombined(\"ub.menu\", {\n  setup: function () {\n\n  },\n\n  getAll: function () {\n    return DataManager.getValue(\"data.menu\");\n  },\n  set: function (path, value) {\n    DataManager.set([\"data.menu\", path].join(\".\"), value)\n  },\n  showMenu: function () {\n    this.set(\"isvisible\", true);\n  },\n  hideMenu: function () {\n    this.set(\"isvisible\", false);\n  },\n\n  addEntries: function () {\n\n  }\n})\n\nDataManager.setCombined(\"ub.flow\", {\n  start: function () {\n    this.wallet = {\n      step: { createdAt: new Date().getTime() },\n    }\n  },\n\n  parse: function (input) {\n    console.log(input);\n\n    if (input.indexOf(\".s\") == 0) {\n\n\n      this.wallet.step.showSearch = true;\n      this.wallet.step.noPlace = true;\n    }\n    else {\n      this.wallet.step.showSearch = false;\n      this.wallet.step.noPlace = false;\n    }\n\n    var result = input.match(/^(\\.[^\\s]+\\s+)*/)\n    var text = input.substr(result[0].length)\n    var dirs = result[0].trim().split(\" \");\n\n    if (!this.wallet.step.editStartedAt) this.wallet.step.firstCharAt = new Date().getTime();\n\n    this.wallet.step.text = text;\n  },\n\n  place: function () {\n    let ant = {\n      text: this.wallet.text,\n      id: myUB.antsDbState.getId(),\n      times: {\n        createdAt: this.wallet.step.createdAt,\n        firstCharAt: this.wallet.step.firstCharAt,\n        addedAt: new Date().getTime()\n      }\n    };\n\n    let parent = this.getParent();\n  }\n\n})\n\nvar flow = {\n\n  start: function () {\n    this.wallet = {\n      step: {},\n      actions: this.main,\n      parser: this.parser\n    }\n  },\n\n  restart: function () {\n    let prevStep = this.wallet.step;\n    this.wallet = {\n      step: {\n        parent: prevStep.parent\n      },\n      startedAt: new Date().getTime(),\n      actions: this.main,\n      parser: this.parser\n    }\n  },\n\n  parse: function (text) {\n    this.wallet.parser.parse(this.wallet, text)\n  },\n\n  change: function (values) {\n    this.wallet.actions.change(this.wallet, values)\n  },\n\n  place: function () {\n    this.wallet.actions.place(this.wallet)\n  },\n\n  parser: {\n    parse: function (wallet, text) {\n      wallet.actions.change(wallet, { text: text, x: text.substr(1) })\n    }\n  },\n\n  main: {\n    place: function (wallet) {\n      if (wallet.step.text == \"destroy\") {\n        myUB.db.destroy();\n        return;\n      }\n      else if (wallet.step.text.indexOf(\".swot\") == 0) {\n        let name = wallet.step.text.substring(5);\n        hapi.makeSwot(name);\n        return;\n      }\n      else if (wallet.step.text.indexOf(\".m\") == 0) {\n        let id = this.createMap(wallet.step.text.substr(2).trim());\n        hapi.selectMap(id);\n        return;\n      }\n      else if (wallet.step.text.indexOf(\".gi\") == 0) {\n        let id = wallet.step.parent;\n        if (!id) return;\n\n        //hapi.selectMap(id);\n        hapi.goToInfo(id);\n        return;\n      }\n      else if (wallet.step.text.indexOf(\".e\") == 0) {\n        let id = this.changeItem({ text: wallet.step.text.substr(2).trim() }, wallet);\n        return;\n      }\n      else if (wallet.step.text.indexOf(\".i\") == 0) {\n        this.addInfo({ text: wallet.step.text.substr(2).trim() }, wallet);\n        return;\n      }\n      else if (wallet.step.text.indexOf(\".t\") == 0) {\n        let text = wallet.step.text.substr(2).trim();\n        let root = DataManager.getWallet(\"repo.root\");\n        let parent = root.id;\n\n        wallet.step.text = text;\n        wallet.step.parent = parent;\n        wallet.step.selectItem = true;\n      }\n\n      this.add(wallet)\n\n      myUB.afterRenderActions.add(\"alertAnimation\");\n    },\n    change: function (wallet, values) {\n      _.merge(wallet.step, values)\n    },\n\n    createMap: function (name) {\n      let id = myUB.antsDbState.getId();\n      let ant = {\n        id: id,\n        text: name,\n        startedAt: myUB.antsDbState.getTime(),\n        type: \"map\",\n\n        rels: {\n          sub: {},\n          allSubs: {}\n        },\n        mapId: id,\n        parentId: id\n      }\n\n      myUB.mapview.mergeItem(ant.id, ant);\n      DataManager.set(\"repo.items.\" + ant.id, ant);\n\n      return ant.id;\n    },\n\n    changeItem: function (change, wallet) {\n      let id = wallet.step.parent;\n      if (!id) return;\n\n      let ant = DataManager.getWallet(\"repo.items.\" + id);\n\n      _.merge(ant, change);\n\n      if (!ant.history) ant.history = []\n      ant.history.push({ changeAt: Date.now() });\n\n      myUB.mapview.mergeItem(id, ant);\n      DataManager.set(\"repo.items.\" + id, ant);\n\n    },\n\n    addInfo: function (text, wallet) {\n\n      let parent = wallet.step.parent;\n      let root = DataManager.getWallet(\"repo.root\");\n\n      if (!parent)\n        return;\n\n\n      let id = myUB.antsDbState.getId();\n\n      let ant = {\n        text: text,\n        id: id,\n        startedAt: wallet.startedAt,\n        placedAt: new Date().getTime(),\n        mapId: root.id,\n        parentId: parent,\n        targetId: id,\n        type: \"info\"\n      }\n\n      myUB.mapview.mergeItem(parent, { hasInfo: true })\n      myUB.mapview.mergeItem(id, ant);\n      myUB.mapview.mergeRoot(_.set({}, \"rels.info.\" + parent + \".\" + id, { id: id, parent: parent }))\n\n      DataManager.markChangeOn(\"repo.items\", false, true, true);\n      DataManager.markChangeOn(\"repo.root\", false, true);\n\n\n      //DataManager.mergeValue(\"repo.items.\" + parent, { hasInfo: true })\n      //DataManager.set(\"repo.items.\" + id, ant);\n      //DataManager.set(\"repo.root.rels.info.\" + parent + \".\" + id, { id: id, parent: parent })\n    },\n\n    add: function (wallet) {\n\n      let parent = wallet.step.parent;\n      let root = DataManager.getWallet(\"repo.root\");\n\n      if (!parent) {\n        parent = root.id;\n      }\n\n      let state = DataManager.getWallet(\"repo.state\");\n      state.nextId++;\n\n      let id = myUB.antsDbState.getId();\n\n      let ant = {\n        text: wallet.step.text,\n        id: id,\n        startedAt: wallet.startedAt,\n        placedAt: new Date().getTime(),\n        mapId: root.id,\n        parentId: parent\n      }\n\n\n      let obj = {\n        \"{id}\": \"{ant}\",\n        \"{ant.mapId}.rels.sub.{ant.parentId}.{ant.id}\": { id: \"{ant.id}\", parent: \"{ant.parentId}\" },\n        \"{ant.mapId}.rels.allSubs.{ant.id}\": { id: \"{ant.id}\", parent: \"{ant.parentId}\" }\n      }\n\n      myUB.mapview.mergeItem(id, ant);\n      myUB.mapview.mergeRoot(_.set({}, \"rels.sub.\" + parent + \".\" + id, { id: id, parent: parent }))\n      myUB.mapview.mergeRoot(_.set({}, \"rels.allSubs.\" + id, { id: id, parent: parent }))\n\n      DataManager.markChangeOn(\"repo.items\", false, true, true);\n      DataManager.markChangeOn(\"repo.root\", false, true, true);\n\n      console.log(\"added\", id)\n      //DataManager.set(\"repo.items.\" + id, ant);\n      //DataManager.set(\"repo.root.rels.sub.\" + parent + \".\" + id, { id: id, parent: parent })\n      //DataManager.set(\"repo.root.rels.allSubs.\" + id, { id: id, parent: parent })\n\n\n      //DataManager.mergeItem( root.id + \"_state\", {lastItemId : id, changedAt : Date.now() }  )\n\n      if (wallet.step.selectItem) {\n        hapi.select(id);\n      }\n      else hapi.select(parent)\n    }\n  }\n}\nflow.start();\n\n\n\n\n\nDataManager.setCombined(\"ub.loaders.map\", {\n  load: function (id) {\n    let startIds = [id, \"info_\" + id]\n    this.tb.db.loadItems(startIds)\n      .then(items => {\n        for (var i in items) {\n          let item = items[i];\n          if (!item) continue;\n          this.wallet.items[items[i].id] = items[i];\n        }\n        if (items[0])\n          this.wallet.root = items[0];\n      })\n      .then(() => {\n        let root = this.wallet.root;\n        let related = _.get(root, \"rels.allSubs\") || {};\n        let ids = Object.keys(related);\n        return this.tb.db.loadItems(ids)\n      })\n      .then(items => {\n        for (var i in items) {\n          let item = items[i];\n          if (!item) continue;\n          this.wallet.items[item.id] = item;\n        }\n      })\n      .then(() => {\n        DataManager.set(\"repo.items\", this.wallet.items)\n        DataManager.set(\"repo.root\", this.wallet.root)\n\n        //notify;\n      })\n  },\n\n});\n\n\nDataManager.setCombined(\"ub.loaders.bridge\", {\n  setup: function (opts) {\n    _.merge(this, opts)\n  },\n\n  loadBridge: function () {\n    let items = {\n      top: {\n        notdb: true,\n        text: \"top\",\n        id: \"top\"\n      },\n      recent: {\n        notdb: true,\n        text: \"recent\",\n        id: \"recent\"\n      },\n      all: {\n        notdb: true,\n        text: \"all\",\n        id: \"all\"\n      },\n\n      root: {\n        notdb: true,\n        text: \"\",\n        id: \"root\"\n      }\n    };\n    let rels = {\n      sub: {\n        root: { top: true, recent: true, all: true },\n        top: {},\n        recent: {},\n        all: {}\n      }\n    }\n\n    items.root.rels = rels;\n\n    this.tb.db.loadFilter({ type: \"map\" }, 10, \"dateChanged\")\n      .then(result => {\n        for (var i in result.docs) {\n          let item = result.docs[i];\n          if (!item.brand) item.brand = cu.brand.getBrand(item.id + item.startedAt);\n\n          items[item.id] = item;\n\n          if (item.text.indexOf(\"ma\") != -1) {\n            rels.sub.top[item.id] = true;\n          }\n\n          if (item.startedAt) {\n            rels.sub.recent[item.id] = { date: item.startedAt }\n          }\n\n          rels.sub.all[item.id] = true;\n        }\n      })\n      .then(() => {\n\n        DataManager.setCombined(\"bridgeRepo\", {\n          items: items,\n          root: items.root\n        })\n      })\n  }\n})\n\n\nDataManager.setCombined(\"ub.loaders.search\", {\n  setup: function (opts) {\n    _.merge(this, opts)\n  },\n\n  search: function () {\n    let items = {\n\n    };\n    let rels = {\n      sub: {\n        root: { top: true, recent: true, all: true },\n        top: {},\n        recent: {},\n        all: {}\n      }\n    }\n\n    items.root.rels = rels;\n\n    this.tb.db.loadFilter({ type: \"map\" }, 10, \"dateChanged\")\n      .then(result => {\n        for (var i in result.docs) {\n          let item = result.docs[i];\n          if (!item.brand) item.brand = cu.brand.getBrand(item.id + item.startedAt);\n\n          items[item.id] = item;\n\n          if (item.text.indexOf(\"ma\") != -1) {\n            rels.sub.top[item.id] = true;\n          }\n\n          if (item.startedAt) {\n            rels.sub.recent[item.id] = { date: item.startedAt }\n          }\n\n          rels.sub.all[item.id] = true;\n        }\n      })\n      .then(() => {\n\n        DataManager.setCombined(\"bridgeRepo\", {\n          items: items,\n          root: items.root\n        })\n      })\n  }\n})\n\nDataManager.setCombined( \"ub.menuHandling\", {\n  setup : function ( args) {\n    _.merge(this, args)\n\n    $(\"body\").on(\"blur\", \"#bar\", () => {\n      window.setTimeout( () => {\n        if ( !$(\"#bar\").is(\":focus\") )\n          this.hideMenu();\n      },200)\n    });\n    return this;\n  },\n\n  showMenu : function ( ) {\n    DataManager.set( \"ui.menu.isVisible\", true)\n  },\n\n  hideMenu : function ( ) {\n    console.log( \"hiding menu\" );\n    DataManager.set( \"ui.menu.isVisible\", false )\n    DataManager.markChangeOn( \"ui.menu\", false, true )\n  },\n\n  setContent : function ( content ) {\n    DataManager.set(\"ui.menu\", { content, isVisible : true } )\n  },\n\n\n})\nDataManager.setCombined(\"ub.mapView\", {\n  setup: function (args) {\n    this.wallet = {\n      items: {},\n      root: {\n        id: \"ant1\",\n        text: \"welcome\",\n        rels: { sub: {} },\n        type: \"map\",\n        notdb: true,\n      },\n      changed: {},\n      state: { nextId: 1 }\n    };\n\n    this.wallet.items.ant1 = this.wallet.root;\n\n    _.merge(this, args)\n\n    return this;\n  },\n  loadMap: function (id) {\n\n    let startIds = [id, \"info_\" + id]\n\n    let root = DataManager.getWallet(\"repo.root\")\n\n    let start = Promise.resolve();\n\n    if (root.id !== id) {\n      if (!root.notdb)\n        start = start.then(() => this.saveItems());\n\n\n      start = start.then(() => {\n        this.wallet.items = {}\n        this.wallet.root = {\n          id: id,\n          notdb: true,\n          rels: { sub: {} },\n        }\n        this.wallet.items[id] = this.wallet.root;\n        DataManager.set(\"repo.items\", this.wallet.items)\n        DataManager.set(\"repo.root\", this.wallet.root)\n      })\n    }\n\n    start.then(() => this.tb.db.loadItems(startIds))\n      .then(items => {\n        for (var i in items) {\n          let item = items[i];\n          if (!item) continue;\n          this.wallet.items[items[i].id] = items[i];\n        }\n        if (items[0]) {\n          let item = items[0];\n          this.wallet.root = item;\n          if (true || !item.brand) item.brand = cu.brand.getBrand(item.id + item.startedAt)\n\n          let customTpl = {\n            logo: cu.brand.getLogo(item.id + item.startedAt, 10, 5)\n          }\n          let customMolds = cu.tplObjParse.run(customTpl);\n          DataManager.setCombined(\"customTpl\", customTpl);\n\n        }\n      })\n      .then(() => {\n        let root = this.wallet.root;\n        let related = _.get(root, \"rels.allSubs\") || {};\n        let ids = Object.keys(related);\n        return this.tb.db.loadItems(ids)\n      })\n      .then(items => {\n        for (var i in items) {\n          let item = items[i];\n          if (!item) continue;\n          this.wallet.items[item.id] = item;\n        }\n      })\n      .then(() => {\n        DataManager.set(\"repo.items\", this.wallet.items)\n        DataManager.set(\"repo.root\", this.wallet.root)\n\n        //notify;\n      })\n  },\n\n  getItemsToSave: function () {\n    let changed = this.wallet.changed;\n    this.wallet.changed = {};\n\n    let items = [];\n    for (var i in changed) {\n      if (!this.wallet.items[i]) continue;\n      if (this.wallet.items[i].notdb) continue;\n      items.push(this.wallet.items[i])\n    }\n    return items;\n  },\n  saveItems: function () {\n    let items = this.getItemsToSave();\n    return this.tb.db.saveItems(this.uid, items);\n  },\n  generateId: function () {\n    return this.tb.state.getId();\n  },\n  mergeItem: function (id, value, skipPreview) {\n    if (!id) id = this.generateId();\n    if (!this.wallet.items[id]) {\n      this.wallet.items[id] = { id: id, createdAt: new Date().getTime() };\n    }\n    _.merge(this.wallet.items[id], value);\n    this.wallet.items[id].salut = \"test\";\n\n    if (!skipPreview)\n      this.makePreview();\n\n    this.triggerChange(id);\n    return id;\n  },\n  mergeRoot: function (value) {\n    this.mergeItem(this.wallet.root.id, value)\n    console.log(\"root\", this.wallet.root == this.wallet.items[this.wallet.root.id])\n    return;\n  },\n\n  makePreview: function () {\n\n    if (this.timerPreview) window.clearTimeout(this.timerPreview)\n\n    this.timerPreview = window.setTimeout(() => {\n\n      if (this.wallet.root.rels)\n        console.log(this.wallet.root.rels.allSubs);\n      myUB.shop.go(\"makePreview\", {\n        id: this.wallet.root.id,\n        items: this.wallet.items,\n        save: (value) => {\n          this.mergeItem(value.item.id, value.item, true)\n        }\n\n      });\n\n      delete this.timerPreview;\n    }, 1)\n  },\n\n  triggerChange: function (id) {\n    this.wallet.changed[id] = true;\n    this.tb.db.request_save(this.uid, this, 2000);\n  },\n\n  setRel: function (rel, a, b, value) {\n    _.set(this.wallet.root, [\"rels\", rel, a, b], value);\n    this.triggerChange(this.wallet.root.id)\n  },\n\n})\nDataManager.setCombined(\"repo\", {\n  items: {},\n  root: {\n    id: \"ant1\",\n    text: \"welcome\",\n    rels: { sub: {} }\n  },\n  state: {\n    nextId: 2\n  }\n})\n\n\nDataManager.setCombined(\"antView.molds\", {\n  loader: {\n    get: function (tb) {\n      let molds = cu.tplObjParse.run(this.tpls);\n      return molds;\n    },\n    tpls: {\n      title: `<div >item : {value.text}</div>`,\n      item: `<div on_click={actions.select} antid={id}>item : {item.text}</div>`,\n      mapView: {\n        logo: cu.brand.getLogo(faker.company.catchPhrase(), 10, 5),\n\n        frame: `<div class='map'>{title} {content}\n\n        <style>\n          .map { font-size : 15px; margin : 10px;\n            line-height: 26px;\n            background : {colors.background}\n            }\n          .map * { font-size : 17px !important}\n          .map .title { font-size : 17px !important;}\n          .topic>.text { \n              border-bottom : 1px solid {root.brand.fadedColor} ; \n              display : inline-block;\n              padding-left : 5px;\n              padding-right: 25px;\n            }\n          .topic { \n            margin-bottom : 5px;\n            margin-top : 20px;\n            position : sticky;\n            top : 25px;\n            background : {colors.background};\n            z-index : 100\n          }\n\n          .card { \n            margin-bottom : 30px;\n          }\n          .content { margin-left : 10px; padding-left : 10px;}\n\n          .mapviewtitle { position:sticky; top : -30px; margin-bottom : 20px; background : {background}; z-index:200; } \n          .logo { display : inline-block; width : 50px; height : 50px; }\n\n          .selected.title::before { content : \"●\"; display:inline-block; margin-right : 5px; margin-left:5px; color : {root.brand.mainColor}; font-size: 0.7em !important; }\n\n          .title:active { transition: all 0.4s ease; background : #333 !important; }\n          .selected.content { \n            border-left :  1px dotted {root.brand.fadedColor};\n            padding-left:25px;\n            margin-bottom: 15px;\n          }\n\n          .selected.content::after {\n            content: \">\";\n            display: inline-block;\n            border-bottom: 1px dotted {root.brand.fadedColor} ;\n            overflow: hidden;\n            position: relative;\n            left: -25px;\n            padding-left : 10px;\n            top: 8px;\n            width: 20px;\n            margin: 0px;\n          }\n\n          .mapviewtitle { font-variant: petite-caps;}\n\n          polygon.poligon {\n            fill: {root.brand.mainColor} !important;\n          }\n\n          .handle { \n            display: inline-block;\n            font-variant: petite-caps;\n            font-size: 0.7em !important;\n            color: #999;          \n          }\n\n          .alert .poligon_2  {\n            animation: rotate_poligon 5s ease;\n          }\n          \n          @keyframes rotate_poligon {\n            0% {\n              opacity : auto\n            }\n            20% {\n              opacity : 0.2\n            }\n            70% {\n              opacity : 0.7\n            }\n            100% {\n              opacity : auto\n            }\n            \n          }\n\n          .crazy_animation { \n            transform-origin: center;\n            transform: rotate(360deg);\n            transform-box: fill-box;        \n          }\n\n          .info {\n            display: inline-block;\n            color: #ff8900;\n            border: 1px solid #ff8900;\n            text-align: -webkit-center;\n            width: 1.5em;\n            height: 1em;\n            border-radius: 10px;\n            margin-left: 5px;\n            overflow: hidden;\n            font-size: 0.6em !important;\n            vertical-align: middle;\n          }\n          .mindmap { \n            display : inline-block;\n            width : 30px;\n            height:30px;\n          }\n        </style>\n      </div>`,\n\n        title: `\n        <div class='mapviewtitle '> <div class='logo'>{logo}</div> \n          <span on_click={actions.select} antid={id} >{item.text}</span>\n          <span class='mindmap' on_click={actions.showMindMap} antid={id} >✈</span>\n        </div>`,\n      },\n\n\n      map: {\n        topic: \"<div on_click={actions.select} antid={id} class='title topic {isSelected}'><span pin='title' class='text'>{handle} {item.text} </span></div>\",\n        item: \"<div on_click={actions.select} antid={id} class='title item {isSelected}' pin='title'>{handle} {item.text}</div>\",\n        entry: \"<div on_click={actions.select} antid={id} class='title entry {isSelected}' pin='title'>{handle} {item.text}</div>\",\n        other: `<div on_click={actions.select} antid={id} class='title {isSelected}' pin='title'>{handle} {item.text}</div>`,\n        card: `<div class='card reveal {isSelected}'>{title} <div id='content' class='content {isSelected}'>{content}</div>{afterContent}</div>`,\n\n        button: \"<span class='button' on_click={actions.log}>?</span>\",\n        info: \"<span class='info' on_click={actions.goToInfo}>^</span>\",\n\n      },\n\n      handle: \"<span class='handle'>{handle}</span>\",\n\n      bridgeTitle: `<div>{value.text}</div>`,\n      frame: \"<div>{maptitle}{items}</div>\",\n\n      mapTitle: \"\"\n    }\n  }\n})\n\n\n\nDataManager.setCombined(\"antView.map\", {\n  nodes: {\n    loader: {\n      get: function (tb, v) {\n        tb.fetch({\n          uistate: \"repo.uistate\",\n          items: \"repo.items\",\n          root: \"repo.root\",\n          repo: \"repo\",\n          molds: \"antView.molds\",\n          customTpl: \"customTpl\"\n        }, v);\n\n        v.rows = Object.values(v.items);\n\n        let rows = [];\n\n        v.data = {}\n        v.actions = cu.store.get(tb, hapi, { runWith: { showMindMap: [\"showMindMap\", \"antid\"], select: [\"select\", \"antid\"], goToInfo: [\"goToInfo\", \"antid\"] } });\n\n        v.selected = v.uistate.selected;\n\n        v.color = \"#007abc\"\n        v.otherTpl = \"map.other\";\n        v.moldsMap = [\"map.topic\", \"map.item\", \"map.entry\"]\n        v.cardMold = \"map.card\";\n        v.background = \"#eee\";\n\n        //v.button = cu.reactAssembler.run(v.molds.map.button, v);\n        v.info = cu.reactAssembler.run(v.molds.map.info, v);\n\n        v.colors = {\n          background: \"#eee\"\n        }\n\n        v.body = this.getBody(v, v.root.id, v.root.rels.sub);\n        return v.body;\n      },\n\n      setV: function (value, v, memo) {\n        memo = memo || {};\n        for (var i in value) {\n          if (memo[i] === undefined)\n            memo[i] = v[i];\n          v[i] = value[i]\n        }\n\n        return memo;\n      },\n      cleanV: function (v, memo) {\n        for (var i in memo)\n          v[i] = memo[i];\n      },\n\n      getBody: function (v, id, sub) {\n        let list = this.getBodyList(v, id, sub);\n\n        let logo = v.customTpl.logo ? cu.reactAssembler.run(v.customTpl.logo, v) : \"\";\n        let memo = this.setV({ logo: logo, item: v.repo.root, id: v.repo.root.id }, v, memo)\n\n        let title = cu.reactAssembler.run(v.molds.mapView.title, v);\n        memo = this.setV({ content: list, title: title }, v, memo)\n        let node = cu.reactAssembler.run(v.molds.mapView.frame, v)\n        this.cleanV(v, memo);\n        return node;\n      },\n      getBodyList: function (v, id, sub) {\n        let related = sub[id];\n\n        if (!related) return null;\n        if (v.level > 5) return null;\n        let level = v.level != undefined ? v.level + 1 : 0\n\n        let list = [];\n        let memo = this.setV({\n          id: null,\n          item: null,\n          level: 0,\n          isSelected: null,\n          content: null,\n          title: null,\n          handle: null,\n          afterContent: null\n        }, v, memo);\n\n\n        let count = 1;\n        for (var i in related) {\n\n          Object.assign(v, {\n            id: i,\n            item: v.items[i],\n            level: level,\n            isSelected: v.selected == i ? \"selected\" : \"\",\n            count: count,\n            afterContent: null\n          })\n\n          let item = this.getItem(v, sub);\n          list.push(item);\n\n          count++;\n        }\n\n        this.cleanV(v, memo);\n        return list;\n      },\n\n      getHandle: function (v, level, count) {\n        let handle;\n        if (level == 0) {\n          handle = String.fromCharCode(64 + count) + \".\"\n        }\n\n        else if (level == 1) {\n          handle = count + \".\";\n        }\n        else if (level == 2) {\n          handle = \"▪\"\n        }\n        else {\n          handle = \"- \"\n        }\n\n        if (handle == undefined) return \"\";\n\n        let node = cu.reactAssembler.run(v.molds.handle, { handle: handle });\n\n        return node;\n      },\n\n      getItem: function (v, sub) {\n        let item = v.item;\n        let moldName = v.mold;\n        if (!moldName && v.moldsMap) {\n          moldName = v.moldsMap[v.level]\n        }\n\n        if (!moldName) moldName = v.otherTpl;\n        let titleMold = _.get(v.molds, moldName);\n\n\n        v.handle = this.getHandle(v, v.level, v.count);\n\n        v.title = cu.reactAssembler.run(titleMold, v);\n\n        /*\n        let titlePath = titleMold.mold.pins.title;\n        let title;\n        if (titlePath.length) title = _.get(v.title, titlePath);\n        else title = v.title;\n        if (!title.children) title.children = [];\n        title.children.push(v.button);\n        */\n\n        if (v.item.hasInfo) {\n\n          let titlePath = titleMold.mold.pins.title;\n          let title;\n          //v.title = _.cloneDeep( v.title );\n          if (titlePath.length) title = _.get(v.title, titlePath);\n          else title = v.title;\n          if (!title.children) title.children = [];\n\n\n          title.children.push(v.info)\n        }\n\n\n        v.content = this.getBodyList(v, v.id, sub);\n\n        if (v.isSelected && !v.content) v.content = [];\n\n\n        let node;\n        if (v.content) {\n          let cardMold = _.get(v.molds, v.cardMold);\n\n          node = cu.reactAssembler.run(cardMold, v)\n        }\n        else node = v.title;\n\n        return node;\n      },\n\n\n\n    }\n  }\n})\n\n\nDataManager.setCombined(\"antViewBridge.molds\", {\n  loader: {\n    get: function (tb) {\n      let molds = cu.tplObjParse.run(this.tpls);\n      return molds;\n    },\n    tpls: {\n      root: {\n        bridge: `<div class='bridge'>{content}{advanceView} </div>`,\n        card: `<div class='card'><div class='title'><span>{item.text}</span></div> <div class='content'>{content}</div></div>`,\n        item: `<div class='title item' antid='{id}' on_click='{actions.select}' style='--color:{item.brand.mainColor}'>{item.text}</div>`,\n        style: `\n          <style>\n            .title { \n              margin-bottom : 5px;\n              padding-left : 4px;\n            }\n            .item.title::before { \n              color : var(--color);\n              content : '𝌇';\n              display : inline-block;\n              padding-right : 5px; \n            }\n\n            .item.title:active { transition: all 0.4s ease; background : #333 !important; }\n\n\n            .card {\n              margin : 20px 10px;\n            \n              border : 1px solid {brand.borderColor};\n\n              padding : 10px;\n            }\n            .bridge { font-size : 18px; margin : 10px;\n              line-height: 25px;\n              }\n\n            .card>.content { \n            }\n            .card>.title{\n              position: sticky;\n              top: 0px;\n              background : {brand.background};\n              padding-bottom : 10px;\n\n            }\n\n            @keyframes enter {\n              0% { opacity : 0.5; height : 0; overflow:hidden; transform : scaleY(0) translateY( 15px ); }\n              100% { opacity : 1; height:auto; overflow:hidden; transform : scaleY(1) translateY( 0px ); }\n            }\n\n            #easel div { animation: enter 0.5s ease; }\n\n            .card>.title>span{ \n              border-bottom : 1px solid {brand.borderColor};\n              width : fit-content;\n              padding-left: 5px;\n              padding-right : 24px;\n              padding-bottom : 5px;\n              display : inline-block;\n              font-variant: petite-caps;\n            }\n          </style>\n        `\n      },\n    }\n  }\n})\n\n\nDataManager.setCombined(\"antView.bridge\", {\n  nodes: {\n    loader: {\n      get: function (tb, v) {\n        tb.fetch({\n          items: \"bridgeRepo.items\",\n          root: \"bridgeRepo.root\",\n          repo: \"bridgeRepo\",\n          molds: \"antViewBridge.molds\"\n        }, v);\n\n\n        this.addVFn(v);\n\n        v.tplSpecs = {\n          byLevel: [\"root.bridge\", \"root.card\", \"root.item\"],\n\n        }\n\n        v.brand = {\n          borderColor: \"#333\",\n          background: \"#eee\"\n        }\n\n        if (!tb.cache.advanceView) {\n          tb.cache.advanceView = { value: [\"loading\"] };\n\n          myUB.shop.run(\"actionshops.getRecentPreview\", \"main\", {}, {\n            list: [(path, value) => {\n              tb.cache.advanceView.value = value;\n              DataManager.markChangeOn(tb.path(), false, true);\n            }]\n          })\n\n        }\n        v.actions = cu.store.get(tb, hapi, { runWith: { select: [\"selectMap\", \"antid\"] } });\n\n\n        v.color = \"#007abc\"\n        v.otherTpl = \"map.other\";\n        v.moldsMap = []\n        v.defaultTpl = {\n          card: \"root.card\",\n          title: \"root.title\"\n        }\n        v.cardMold = \"map.card\";\n        v.background = \"#eee\";\n        v.level = 0;\n        v.subs = v.root.rels.sub;\n\n        v.id = \"root\";\n        v.item = v.root;\n        v.advanceView = tb.cache.advanceView.value;\n\n        let node = this.makeItem(v);\n\n        let style = cu.reactAssembler.run(v.molds.root.style, v)\n\n        return [node, style];\n      },\n\n      makeItem: function (v) {\n        let moldName = v.mold || v.tplSpecs.byLevel[v.level];\n        if (!moldName) console.error(\"no mold\", v);\n        let mold = _.get(v.molds, moldName);\n\n        let params = mold.mold.parameters;\n\n\n        if (params.content) {\n          let collection = v.subs[v.id];\n          let level = v.level + 1;\n          v.content = this.makeList(v, collection, (value, i) => {\n            return {\n              id: i,\n              item: v.items[i],\n              level: level\n            }\n          })\n        }\n\n\n        let node = cu.reactAssembler.run(mold, v)\n\n        return node;\n      },\n\n\n      makeList: function (v, collection, prepare) {\n        let list = [];\n        v.stack();\n\n        for (var i in collection) {\n          v.set(prepare(collection[i], i));\n          let node = this.makeItem(v);\n          list.push(node);\n        }\n\n        v.clean();\n\n        return list;\n      },\n\n\n\n      addVFn: function (v) {\n        v.set = function (value) {\n          let v = this;\n          let memo = v.memo;\n          for (var i in value) {\n            if (memo[i] === undefined)\n              memo[i] = v[i];\n            v[i] = value[i]\n          }\n\n        }\n\n        v.get = function (value) {\n          let v = this;\n          let memo = v.memo;\n          for (var i in value) {\n            if (memo[i] === undefined)\n              memo[i] = v[i];\n            v[i] = value[i]\n          }\n        }\n\n        v.clean = function () {\n          let v = this;\n          let memo = v.memo;\n\n          for (var i in memo)\n            v[i] = memo[i];\n\n          v.memo = v.stacks.pop();\n        }\n\n        v.stack = function () {\n\n          let v = this;\n\n          if (!v.stacks) v.stacks = [];\n\n          v.stacks.push(v.memo);\n\n          v.memo = {};\n        }\n\n\n      },\n\n\n    }\n  }\n})\n\nDataManager.setCombined(\"dbSavings\", {\n  items: {\n    /*\n    repoitems: { path: \"repo.items\", onload: [\"repo\", \"evaluateflow\"] },\n    bubblestate: \"repo.state\",\n    antsitems: \"repo.ants\",\n    */\n  }\n})\n\nDataManager.setCombined(\"tb.persisitence\", {\n  setup: function () {\n    this.db = cu.db.run(\"thisdb\");\n    window.onbeforeunload = () => { return this.saveAll() };\n    this.loadAll();\n\n  },\n\n  request_save: function () {\n    if (this.timer) window.clearTimeout(this.timer);\n\n    this.timer = window.setTimeout(() => {\n      this.saveAll()\n    }, 60000)\n  },\n\n  saveAll: function () {\n    let tosave = DataManager.getValue(\"dbSavings\").items\n    let savings = []\n    for (var i in tosave) {\n      savings.push(this.saveitem(i, tosave[i]))\n    }\n\n  },\n  saveitem: function (id, target) {\n    let path = target.path || target;\n    let repo = DataManager.getWallet(path);\n    return this.db.save({ repo }, id)\n  },\n\n  loadAll: function () {\n    let tosave = DataManager.getValue(\"dbSavings\").items;\n\n    for (var i in tosave)\n      this.loaditem(i, tosave[i]);\n  },\n\n  loaditem: function (id, target) {\n    let path = target.path || target;\n    let onload = target.onload || null;\n    this.db.load(id).then((items) => {\n      if (items && items.repo) DataManager.set(path, items.repo)\n      if (onload) DataManager.runOn(onload[0], onload[1])\n    })\n  },\n\n  starter: {\n    loader: {\n      autostart: true,\n      get: (tb) => {\n        if (tb.cache.done) return 1;\n        tb.cache.done = true;\n        let v = tb.fetch({ tb: \"tb.persisitence\" });\n        v.tb.setup();\n\n        return 1;\n      }\n    }\n  }\n\n})\n\n\n\n\nDataManager.setCombined(\"ui.molds\", {\n  loader: {\n    get: function (tb) {\n      let molds = cu.tplObjParse.run(this.tpls);\n      return molds;\n    },\n    tpls: {\n      main: `\n          <div id='frame'>\n            <div id='easel'>{view}</div>\n            {overPanel.frame}\n            <div id='bar'>\n              <div id='menu'>{menu}</div>\n              <myinput id='order' auto_complete=\"off\" value={order.value} on_key_press={order.place} on_change={order.change}></myinput>\n              <div id='bumb' on_click='{bumb.action}'>{picture}</div>\n            </div>\n          </div>\n          <style>\n            * { box-sizing : border-box; max-height: 40000em;}\n            body , window, html {\n              color : {textColor};\n              height : 100%; width : 100%; background : {background} }\n            #frame { height : 100%; width : 100%;}\n            #frame { display : flex; flex-direction : column; }\n            #easel { flex : 1; overflow : auto; }\n            #overPanel { position : absolute;left : 0; top : 0; z-index : 200;}\n            \n            #bar   { position : relative; border-top: 1px solid #999; width : 100%; flex-basis : {dim.barHeight}px ; display : flex;flex-direction:row; }\n            #menu  { position: absolute;  bottom: 50px; }\n            #order {  padding-left : 10px; outline: none; flex : 1; border : 0px none transparent; width: 100%;}\n            #bumb  { flex-basis : {dim.barHeight}px; background : {color}; transition : all 1s ease-out; } \n            #bumb:active {transition : none; background : red; transform : scale ( 10 )}\n\n            @keyframes salut {\n              0% { border : 0px solid red;}\n              100% { border : 10px solid red;}\n            }\n\n\n\n\n            @keyframes reveal {\n              0% { opacity : 0.7; transform : translateY( -5px ); }\n              100% { opacity : 1; transform : translateY( 0px ); }\n            }\n\n\n\n            @keyframes enter {\n              0% { opacity : 0.5; transform : translateY( 5px ); }\n              100% { opacity : 1; transform : translateY( 0px ); }\n            }\n\n            #easel>div { animation: enter 0.5s ease; }\n            .reveal { animation: enter 0.5s ease; }\n\n            </style>\n          \n  `,\n\n      overPanel: \"<div id='overPanel'>{overPanel.panel}</div>\",\n      bubbleitem: `<div on_click={selectitem} targetid={targetid}>{label}</div>`,\n\n      menuitem: `<div>{label}</div>`\n\n    }\n  }\n})\n\nDataManager.setCombined(\"workingant\", {\n  data: {\n    input: { text: \"\" },\n    currentView: 'main',\n\n    selected: \"\"\n  }\n})\n\n\nDataManager.setCombined(\"antsFrame.ui\", {\n  loader: {\n    paths: { molds: \"ui.molds\", orderText: \"workingant.data\", node: \"antsFrame.prepare\" },\n    get: function (tb, v) {\n\n      tb.fetch(this.paths, v);\n\n      _.set(v.node, v.molds.main.mold.pins.order.concat([\"props\", \"value\"]), v.orderText.input)\n\n      return v.node;\n    }\n  }\n\n})\n\nDataManager.setCombined(\"antsView.formPanel\", {\n  nodes: {\n    loader: {\n      change: function (tb, v, args) {\n        console.log( args, tb );\n\n        tb.cache.args = args;\n\n        //tb.cache.nodes = \"loading\";\n\n        let wallet = DataManager.getWallet(\"repo.items\");\n        let wallet2 = DataManager.getWallet(\"repo.root\")\n\n\n        myUB.shop.go(\"makeTreeMap\", {\n          id: args.id,\n          items: DataManager.getWallet(\"repo.items\")\n        }, {\n            nodes: [\n              function (path, value) {\n                tb.cache.nodes = value;\n                DataManager.markChangeOn(tb.path(), false, true)\n              }\n            ]\n          });\n\n\n      },\n      get: function (tb, v) {\n\n        tb.fetch({ items: \"repo.items\" }, v);\n\n        if (!tb.cache.loading) {\n          tb.cache.loading = true;\n\n          tb.cache.nodes = \"loading\";\n\n          myUB.shop.go(\"makeTreeMap\", {\n            id: \"ant_2\",\n          }, {\n              nodes: [\n                function (path, value) {\n                  tb.cache.nodes = value;\n                  DataManager.markChangeOn(tb.path(), false, true)\n                }\n              ]\n            });\n\n\n        }\n\n        let version = DataManager.getVersion(\"repo.items\");\n        if (tb.cache.args && tb.cache.old && tb.cache.old.dependsOn && tb.cache.old.dependsOn[\"repo.items\"] && tb.cache.old.dependsOn[\"repo.items\"].version != version) {\n          this.change(tb, v, tb.cache.args)\n        }\n\n\n        return tb.cache.nodes;\n      },\n      updateVersionsMap: true,\n    }\n  }\n})\n\nDataManager.setCombined(\"workingant.viewState\", {\n  path: \"antView.map.nodes\"\n})\n\nDataManager.setCombined(\"antsFrame.prepare\", {\n  loader: {\n    paths: { molds: \"ui.molds\", data: \"bubbles.data\", repo: \"repo\", viewState: \"workingant.viewState\", \n  \n  menu : \"ui.menu\"},\n    get: function (tb, v) {\n      tb.fetch(this.paths, v);\n\n      tb.fetch({ view: v.viewState.path }, v)\n\n      let store = cu.store.get(tb, hapi,\n        { change: { changeOrder: \"workingant.data.input\" }, run: { bumbAction: \"showhud\", placeOrder: \"placeorder\" } });\n\n      v.dim = {\n        window: {\n          height: \"400\",\n          width: \"200\",\n        },\n        barHeight: \"45\"\n      }\n\n      v.data = {\n        label: \"main\",\n        bubbleList: \"TestList\",\n        order: {\n          change: store.changeOrder,\n          place: store.placeOrder\n        },\n        bumb: {\n          action: store.bumbAction\n        },\n        dim: v.dim,\n\n        view: v.view,\n\n        color: \"#999\",\n        background: \"#eee\",\n        textColor: \"#222\",\n\n        menu: []\n      }\n\n      if ( v.menu && v.menu.isVisible ) v.data.menu = v.menu.content;\n\n\n      for (var i in v.viewState.overPanel) {\n        if (v.viewState.overPanel[i]) {\n          v.data.overPanel = tb.fetch({ panel: v.viewState.overPanel[i] })\n          v.data.overPanel.frame = cu.reactAssembler.run(v.molds.overPanel, v.data)\n        }\n      }\n\n      v.node = cu.reactAssembler.run(v.molds.main, v.data)\n      return v.node;\n    },\n    autostart: true\n  }\n})\n\n\n\nDataManager.setCombined(\"test\", {\n  loader: {\n    get: function () {\n      //myUB.mapview.loadMap(\"ant1\")\n      myUB.bridgeLoader.loadBridge();\n    },\n    autostart: true\n  }\n})\n\n///2\n\n\n//DataManager = window._DataManager.setup();\nDataManager.historyManager.recording = false;\nDataManager.runToStart();\n//------------------\n\n\n\nclass Frame extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {}\n  }\n\n  path = \"antsFrame.ui\"\n\n  componentDidMount() {\n    DataManager.setTrigger(this.path, \"asd\", {\n      run: () => {\n        this.setState({ \"version\": new Date().getTime() })\n      }\n    })\n  }\n\n  componentDidUpdate() {\n  }\n\n  render() {\n    let components = DataManager.getValue(this.path);\n    let node = cu.reactUtils.makeComponent(components || []) || \"empty\";\n    return node\n  }\n}\n\n\n\nclass FlatAnt extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      value: { scode: \"salut\" }\n    }\n  }\n\n  _style() {\n    return `\n      html, window, body{ width : 100%; height : 100%; overflow : auto; padding: 0px; margin:0px;}\n      #root, .main { width : 100%; height : 100%;}\n      \n\n.node {\n  stroke: #fff;\n  stroke-width: 1.5px;\n}\n\n.link {\n  fill: none;\n  stroke: blue;\n  stroke-width: 1.5px;\n  opacity: 0.4;\n  marker-end: url(#end-arrow);\n}\n\n.adv_entry {     display: block;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n  overflow: hidden;}\n.adv_entry>.time {     background: #a1a1a1;\n  display: inline-block;\n  border-radius: 5px;\n  padding: 4px 2px;\n  font-size: 0.4em;\n  line-height: 1em;\n }\n.adv_map>.content { }\n.adv_map { border : 1px solid #999; margin : 10px; padding : 10px;}\n\n    `\n\n  }\n\n  render() {\n    let style = this._style();\n    let components = [\n      //<TreeDiagram />,\n      <Frame key=\"1\"></Frame>\n    ]\n    return [\n\n      <style key='style'>{style}</style>,\n      components]\n      ;\n  }\n}\n\nexport default FlatAnt;\n","import React, { Component } from 'react';\nimport logo from './logo.svg';\nimport './App.css';\nimport CodeMirrorEditor from \"./components/CodeMirrorEditor\";\nimport _ from \"lodash\";\nimport $ from \"jquery\";\nimport go from \"gojs\";\nimport \"./libs/dataManager.js\";\n\nimport FlatAnt from \"./FlatAnt7\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n  }\n\n  render() {\n    let content = <FlatAnt />\n    return content;\n  }\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read http://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  //if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) \n  if ( true ) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      console.error( publicUrl.origin )\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit http://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See http://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: http://bit.ly/CRA-PWA\nserviceWorker.register();\n","var historyManager = {\n  setup: function setup(info) {\n    var item = Object.create(this);\n    item.wallet = {\n      currentStack: {\n        info: [{\n          type: \"startedWith\",\n          info: info\n        }]\n      },\n      stacks: []\n    };\n    item.recording = true;\n    item.wallet.stacks.push(item.wallet.currentStack);\n    return item;\n  },\n  startStack: function startStack(info) {\n    if (!this.recording) return;\n    var stack = {\n      info: [],\n      prevStack: this.wallet.currentStack,\n      index: this.wallet.stacks.length,\n      start: info\n    };\n    this.addInfo({\n      type: \"subStack\",\n      stack: stack\n    }, true);\n    this.wallet.stacks.push(stack);\n    this.wallet.currentStack = stack;\n    if (info) this.addInfo(info);\n  },\n  addInfo: function addInfo(info, skipClone) {\n    if (!this.recording) return;\n    if (!skipClone) info = _.cloneDeep(info);\n    this.wallet.currentStack.info.push(info);\n  },\n  endStack: function endStack(info) {\n    if (!this.recording) return;\n    if (info) this.addInfo(info);\n    this.wallet.currentStack = this.wallet.currentStack.prevStack;\n  }\n};\nvar _DataManager = {\n  setup: function setup() {\n    var item = Object.create(this);\n    item.state = {\n      ctx: {},\n      gettingValue: {},\n      wallet: {},\n      meta: {},\n      cache: {},\n      version: {},\n      loadersCache: {},\n      triggers: {},\n      currentVersion: 1,\n      dependencies: {},\n      nextUID: 1,\n      agenda: {\n        names: {},\n        tasks: []\n      },\n      pins: {},\n      toStart: [],\n      flags: {}\n    };\n    item.historyManager = historyManager.setup(this);\n    return item;\n  },\n  state: {\n    gettingValue: {},\n    wallet: {},\n    meta: {},\n    cache: {},\n    version: {},\n    loadersCache: {},\n    triggers: {},\n    currentVersion: 1,\n    dependencies: {},\n    nextUID: 1,\n    agenda: {\n      names: {},\n      tasks: []\n    },\n    pins: {},\n    toStart: [],\n    flags: {}\n  },\n  setCtx: function setCtx(basePath, ctxPath, value, names) {\n    var ctx = _.get(this.state.ctx, [basePath, \"ctx\"].join(\".\"));\n\n    if (!ctx) _.set(this.state.ctx, [basePath, \"ctx\"].join(\".\"), ctx = {\n      names: []\n    });\n\n    _.set(ctx, ctxPath, value);\n\n    ctx.names.push({\n      names: names,\n      path: ctxPath\n    });\n  },\n  getCtx: function getCtx(basePath, name) {\n    var ctx = _.get(this.state.ctx, [basePath, \"ctx\"].join(\".\"));\n\n    ;\n    if (!ctx) return null;\n    var ctxPath;\n\n    for (var i in ctx.names) {\n      if (ctx.names[i].names.indexOf(name) != -1) {\n        ctxPath = ctx.names[i].path;\n        break;\n      }\n    }\n\n    if (!ctxPath) return null;\n\n    var target = _.get(ctx, ctxPath);\n\n    return target;\n  },\n  runOn: function runOn(basePath, name, args) {\n    var target = this.getCtx(basePath, name);\n    if (!target) return null;\n    return target[name](args);\n  },\n  runFn: function runFn(path, args) {\n    var route = path.split(\".\");\n    var fnName = route.pop();\n    var targetPath = route.join(\".\");\n    var target = this.getValue(targetPath);\n    if (!target[fnName]) return undefined;\n\n    if (_.isFunction(target[fnName])) {\n      return target[fnName](args, path, this);\n    } else if (_.isFunction(target[fnName].run)) {\n      return target[fnName].run(args, path, this);\n    }\n  },\n  getInfluenced: function getInfluenced(path) {\n    var influenced = [];\n\n    var dep = _.get(this.state.dependencies, path + \".DEP\");\n\n    if (!dep) return [];\n\n    for (var i in dep) {\n      influenced.push(i);\n      influenced = influenced.concat(this.getInfluenced(i));\n    }\n\n    return influenced;\n  },\n  getValue: function getValue(path, skipPartialValueCheck) {\n    var route = path.split(\".\");\n    var value = this.checkCache(path);\n    if (value) return value;\n    if (!skipPartialValueCheck) for (var i = 0; i < route.length; i++) {\n      var partialPath = route.slice(0, i).join(\".\");\n\n      if (this.state.gettingValue[partialPath]) {\n        var partialResult = this.state.gettingValue[partialPath].partialResult;\n        var partialSlot = route.slice(i);\n\n        var partialValue = _.get(partialResult, partialSlot);\n\n        if (partialValue !== undefined) return partialValue;\n      }\n    }\n    this.state.gettingValue[path] = true;\n    var list = this.makeList(path);\n    value = this.listToValue(list, path);\n    delete this.state.gettingValue[path];\n\n    if (value !== undefined) {\n      // let shouldUpdate = (  list.length == 1 && list[0].src == \"wallet\" )\n      this.setCache(path, value); //, shouldUpdate);\n      //this.diffCache( oldCache, path );\n    }\n\n    return value;\n  },\n  setCache: function setCache(path, value, shouldUpdate) {\n    this.state.cache[path] = {\n      value: value,\n      shouldUpdate: shouldUpdate || false,\n      version: this.state.currentVersion\n    };\n  },\n  checkCache: function checkCache(path, ignoreUpdates) {\n    if (!this.state.cache[path]) return null;\n    if (ignoreUpdates) return this.state.cache[path].value;\n    if (this.state.cache[path].shouldUpdate) return null;\n    return this.state.cache[path].value;\n  },\n  prepareCache: function prepareCache(path) {\n    var cache = this.state.loadersCache[path];\n\n    if (!cache) {\n      cache = this.state.loadersCache[path] = {\n        old: {},\n        contains: {},\n        dependsOn: {}\n      };\n    }\n\n    var old = {\n      contains: cache.contains || {},\n      dependsOn: cache.dependsOn || {}\n    };\n    cache.old = old;\n    delete cache.contains;\n    delete cache.dependsOn;\n    return old;\n  },\n  diffCache: function diffCache(oldCache, path) {\n    if (!this.state.loadersCache[path]) this.state.loadersCache[path] = {};\n    var cache = this.state.loadersCache[path] || {};\n    var dependencies = this.state.dependencies;\n\n    var addDependency = function addDependency(a, b) {\n      var dep = _.get(dependencies, a + \".DEP\");\n\n      if (!dep) _.set(dependencies, a + \".DEP\", dep = {});\n      dep[b] = true; //_.set( dependencies, a + \".DEP\",dep );\n    };\n\n    var remDependency = function remDependency(a, b) {\n      var dep = _.get(dependencies, a + \".DEP\");\n\n      if (!dep) return;\n      delete dep[b];\n    };\n\n    var check = function check(newC, oldC) {\n      for (var i in newC) {\n        if (!oldC || !oldC[i]) addDependency(i, path);\n      }\n\n      for (var i in oldC) {\n        if (!newC || !newC[i]) remDependency(i, path);\n      }\n    };\n\n    check(cache.contains, oldCache.contains);\n    check(cache.dependsOn, oldCache.dependsOn);\n  },\n  updateVersionsMap: function updateVersionsMap(path) {\n    var cache = this.state.loadersCache[path] || {};\n    var depOn = cache.dependsOn;\n\n    for (var i in depOn) {\n      var currentVersion = this.getVersion(i);\n      depOn[i].version = currentVersion;\n    }\n  },\n  makeList: function makeList(path) {\n    var list = [];\n    var route = path.substr ? path.split(\".\") : path;\n\n    var walletValue = _.get(this.state.wallet, path);\n\n    if (walletValue !== undefined) {\n      if (!_.isObjectLike(walletValue)) {\n        list.push({\n          src: \"wallet\",\n          value: walletValue,\n          path: [],\n          srcPath: path,\n          version: 1\n        });\n        return list;\n      }\n\n      walletValue = _.cloneDeep(walletValue);\n      list.push({\n        src: \"wallet\",\n        value: walletValue,\n        path: [],\n        srcPath: path,\n        version: 1\n      });\n    }\n\n    var meta = this.state.meta;\n\n    for (var i = 0; i < route.length; i++) {\n      if (!meta) break;\n\n      if (meta.loader) {\n        var item = {\n          src: \"root\",\n          loader: meta.loader,\n          path: [],\n          srcPath: route.slice(0, i),\n          select: route.slice(i)\n        };\n        list.push(item);\n      }\n\n      meta = meta[route[i]];\n    }\n\n    var rootPath = route;\n\n    var iterate = function iterate(obj, route, list) {\n      if (!obj) return;\n\n      if (obj.loader) {\n        var _item = {\n          src: \"sub\",\n          loader: obj.loader,\n          path: route,\n          srcPath: rootPath.concat(route)\n        };\n        list.push(_item);\n      }\n\n      for (var _i in obj) {\n        if (_i == \"loader\") continue;\n        iterate(obj[_i], route.concat(_i), list);\n      }\n    };\n\n    iterate(meta, [], list);\n    return list;\n  },\n  silentSet: function silentSet(path, value, skipPathAffected) {\n    this.historyManager.addInfo({\n      type: \"silentSet\",\n      path: path,\n      value: value\n    });\n\n    _.set(this.state.wallet, path, value);\n\n    if (this.state.cache[path]) this.state.cache[path].shouldUpdate = true;\n    if (!skipPathAffected) this.getAffectedPaths(path);\n  },\n  listToValue: function listToValue(list, path) {\n    if (list.length == 1 && list[0].value) return list[0].value;\n    var result = {};\n    this.state.gettingValue[path] = {\n      partialResult: result\n    };\n    var postponedSteps = list;\n    var hasSteps = true;\n    var snoozeCount = 0;\n\n    while (hasSteps) {\n      snoozeCount++;\n\n      if (snoozeCount > 5) {\n        //console.log( \"postponed more than 5 times\", path, result, _.cloneDeep( this.state.gettingValue ) );\n        this.state.cache[path].shouldUpdate = true;\n        return result;\n      }\n\n      list = postponedSteps;\n      postponedSteps = [];\n      hasSteps = false;\n\n      for (var i = 0; i < list.length; i++) {\n        var step = list[i];\n        var value = void 0;\n\n        if (step.value) {\n          value = step.value;\n        } else if (step.loader) {\n          try {\n            value = this.getFromLoader(step, result, path);\n          } catch (e) {\n            if (e == \"postpone\") {\n              this.state.cache[path].shouldUpdate = true;\n              postponedSteps.push(step);\n              hasSteps = true;\n            } else {\n              console.error(e);\n            }\n\n            continue;\n          }\n        }\n\n        if (step.select) value = _.get(value, step.select);\n\n        if (step.path.length) {\n          _.set(result, step.path, value);\n        } else {\n          if (Object.values(result).length == 0) {\n            result = value;\n          } else //console.log( \"merging\" , _.cloneDeep( result ), value, result);\n            _.merge(result, value);\n        }\n      }\n    }\n\n    return result;\n  },\n  loadersCache: {},\n  addLog: function addLog(lhs, rel, rhs, value) {\n    if (!this.state.loadersCache[lhs]) this.state.loadersCache[lhs] = {\n      version: this.state.currentVersion,\n      cachedValue: {}\n    };\n    var xcache = this.state.loadersCache[lhs];\n    if (!xcache[rel]) xcache[rel] = {};\n    xcache[rel][rhs] = value || true;\n  },\n  getFromLoader: function getFromLoader(step, result, requester, force) {\n    var _this = this;\n\n    var srcPath = step.srcPath.join(\".\");\n    var value;\n\n    try {\n      var logger = {\n        add: function add(path, name) {\n          _this.addLog(srcPath, \"dependsOn\", path, {\n            version: true,\n            name: name,\n            path: path,\n            srcPath: srcPath\n          });\n        }\n      };\n      var loader = step.loader;\n\n      if (loader.prism) {\n        if (loader.loadedPrism) loader = loader.loadedPrism;else {\n          var loadedPrism = this.getFromDispatch(loader.prism);\n          loader.loadedPrism = loadedPrism;\n          loader = loadedPrism;\n        }\n      }\n\n      if (loader.load) {\n        if (this.state.cache[srcPath]) {\n          return {};\n        }\n\n        value = loader.load(result, this, logger, step.loader, step);\n\n        _.set(this.state.wallet, srcPath, value);\n\n        this.state.cache[srcPath] = {\n          loader: true,\n          value: {}\n        };\n        return value;\n      }\n\n      if (!force) {\n        var _value = this.checkCache(srcPath);\n\n        if (_value) return _value;\n      }\n\n      if (step.src == \"sub\") this.addLog(requester, \"contains\", srcPath);\n      var oldCache = this.prepareCache(srcPath);\n\n      if (loader.get) {\n        try {\n          var tb = TB.init(result, this, logger, step.loader, step, this.state.loadersCache[srcPath]);\n          if (DataManager.newAPI) value = loader.get(tb, tb.v);else value = loader.get(tb, this, logger, step.loader, step, this.state.loadersCache[srcPath]);\n        } catch (e) {\n          if (e && e.type == \"return\") {\n            value = e.value;\n          } else {\n            throw e;\n          }\n        }\n      }\n\n      if (value === \"forceCache\") {\n        return this.checkCache(srcPath, true);\n      } else if (value !== undefined) {\n        this.setCache(srcPath, value);\n        this.diffCache(oldCache, srcPath);\n        if (loader.updateVersionsMap) this.updateVersionsMap(srcPath);\n\n        _.set(this.state.version, srcPath + \".version\", this.state.currentVersion);\n      }\n    } catch (e) {\n      console.error(e);\n    }\n\n    if (loader && loader.skipCache) this.state.cache[srcPath].shouldUpdate = true;\n    return value;\n  },\n  runOnLoader: function runOnLoader(path, name, args) {\n    var srcPath = path;\n\n    var loader = _.get(this.state.meta, path);\n\n    if (!loader) return;\n    loader = loader.loader;\n    if (!loader[name]) return;\n\n    if (!this.state.loadersCache[srcPath]) {\n      this.state.loadersCache[srcPath] = {\n        contains: {},\n        dependsOn: {}\n      };\n    }\n\n    var tb = TB.init({}, this, {}, loader, {\n      srcPath: srcPath\n    }, this.state.loadersCache[srcPath]);\n    loader[name](tb, tb.v, args);\n    return null;\n  },\n  runUtils: function runUtils(path, args) {\n    var fn = this.getValue(path);\n    if (fn && fn.run) return fn.run.apply(fn, args);\n  },\n  getWallet: function getWallet(path) {\n    return _.get(this.state.wallet, path);\n  },\n  mergeValue: function mergeValue(path, value) {\n    var _this2 = this;\n\n    this.historyManager.addInfo({\n      type: \"mergeValue\",\n      path: path,\n      value: value\n    });\n    var oldValue = path ? _.get(this.state.wallet, path) : this.state.wallet; //this.getValue( path );\n\n    if (!oldValue) {\n      oldValue = {};\n\n      _.set(this.state.wallet, path, oldValue);\n    }\n\n    var changedPaths = [];\n    this.state.currentVersion++;\n    var route = _.isString(path) ? path.split(\".\") : path || [];\n    if (route.length == 1 && route[0] == \"\") route = [];\n    var fn = {\n      addPath: function addPath(relPath) {\n        var fullPath = route.concat(relPath);\n        changedPaths.push(fullPath);\n\n        _.set(_this2.state.version, fullPath.join(\".\") + \".version\", _this2.state.currentVersion);\n      }\n    };\n    this.pauseAll();\n\n    if (_.isObjectLike(value)) {\n      this.setObObj(oldValue, value, fn, []);\n    } else {\n      console.log(\"it's not object\");\n    }\n\n    for (var i in changedPaths) {\n      this.updateVersionForAll(changedPaths[i]);\n      this.getAffectedPaths(changedPaths[i].join(\".\"));\n    }\n\n    this.req_triggers();\n  },\n  pauseAll: function pauseAll() {\n    if (this.state.runningReqTriggers_timer) {\n      this.clearInterval(this.state.runningReqTriggers_timer);\n      delete this.state.runningReqTriggers_timer;\n    }\n\n    if (this.state.runningAgendaTriggers_timer) {\n      this.clearInterval(this.state.runningAgendaTriggers_timer);\n      delete this.state.runningAgendaTriggers_timer;\n    }\n  },\n  setInterval: function setInterval(callback, delay, name) {\n    var stop = false;\n\n    var fn = function fn() {\n      if (stop) return; //console.log( \"interval\", name );\n\n      callback();\n      window.requestAnimationFrame(fn);\n    };\n\n    window.requestAnimationFrame(fn);\n    return function () {\n      stop = true;\n    };\n  },\n  clearInterval: function clearInterval(stopFn) {\n    if (!stopFn) return;\n    return stopFn();\n  },\n  req_triggers: function req_triggers() {\n    var _this3 = this;\n\n    if (this.state.runningReqTriggers_timer) return; //if ( Object.keys( this.affected ).length == 0 ) return;\n\n    this.state.runningReqTriggers_timer = this.setInterval(function () {\n      //console.log( \"affected::\", _.cloneDeep(this.affected ) );\n      _this3.asyncTriggers();\n    }, 0, \"triggers\");\n  },\n  asyncTriggers: function asyncTriggers() {\n    var keys = Object.keys(this.affected);\n\n    if (keys.length == 0) {\n      this.clearInterval(this.state.runningReqTriggers_timer); //console.log( \"affected_checked\", this.affected_checked );\n\n      this.affected_checked = {};\n      delete this.state.runningReqTriggers_timer;\n      return;\n    } //console.log( \"checking\", keys[0 ] );\n\n\n    this.affected_checked[keys[0]] = this.affected[keys[0]];\n    delete this.affected[keys[0]];\n    this.lazy_checkTriggers(keys[0]);\n  },\n  req_Agenda: function req_Agenda() {\n    var _this4 = this;\n\n    if (this.state.runningAgendaTriggers_timer) return;\n    if (this.state.agenda.tasks.length == 0) return;\n    this.state.runningAgendaTriggers_timer = this.setInterval(function () {\n      _this4.asyncTriggersAgenda();\n    }, 0, \"agenda\");\n  },\n  asyncTriggersAgenda: function asyncTriggersAgenda() {\n    if (this.state.agenda.tasks.length == 0) {\n      this.clearInterval(this.state.runningAgendaTriggers_timer);\n      delete this.state.runningAgendaTriggers_timer;\n      return;\n    }\n\n    var trigger = this.state.agenda.tasks.shift();\n    if (!trigger) return console.error(trigger); //console.log( \"checking\", keys[0 ] );\n\n    delete this.state.agenda.names[trigger.id];\n    this.runTrigger(trigger, trigger.target, trigger.listener); //this.lazy_checkTriggers( keys[0] );\n  },\n  lazy_checkTriggers: function lazy_checkTriggers(path) {\n    if (this.state.triggers[path]) {\n      if (this.state.agenda.names[path]) return;\n      var triggers = this.state.triggers[path];\n\n      for (var i in triggers) {\n        var trigger = triggers[i];\n        var id = trigger.id || path + \"___\" + i;\n        if (this.state.agenda.names[i]) continue;\n        if (!trigger.path) trigger.target = path;\n        if (!trigger.token) trigger.listener = i;\n        if (!trigger.id) trigger.id = id;\n        this.state.agenda.names[id] = true;\n        this.state.agenda.tasks.push(trigger);\n      }\n\n      this.sortAgenda();\n      this.req_Agenda();\n    }\n  },\n  sortAgenda: function sortAgenda() {\n    this.state.agenda.tasks.sort(function (taskA, taskB) {\n      if (!taskB.salience) return 1;\n      if (!taskA.salience) return -1;\n      return taskA.salience - taskB.salience;\n    });\n  },\n  setObObj: function setObObj(target, source, fn, path) {\n    for (var i in source) {\n      if (source[i] === undefined) continue;else if (_.isObjectLike(source[i])) {\n        if (!target[i]) target[i] = {};\n        this.setObObj(target[i], source[i], fn, path.concat(i));\n      } else {\n        if (target[i] != source[i]) {\n          target[i] = source[i];\n          fn.addPath(path.concat(i));\n        }\n      }\n    }\n  },\n  appendToArray: function appendToArray(path, value, setVersion) {\n    var target = _.get(this.state.wallet, path);\n\n    if (!target) {\n      value = [value];\n      return this.set(path, value, false, setVersion);\n    }\n\n    var index = target.length;\n    var route = _.isArray(path) ? path : path.split(\".\");\n    route.push(index);\n    return this.set(route, value, false, setVersion);\n  },\n  setByLoader: function setByLoader(path, value) {\n    if (_.isArray(path)) path = path.join(\".\");\n\n    var prism = _.get(this.state.meta, path);\n\n    if (!prism || !prism.loader || !prism.loader.set) return false;\n    var tb = TB.init({}, this, {}, prism.loader, {}, this.state.loadersCache[path]);\n    value = prism.loader.set(tb, value);\n    return true;\n  },\n  set: function set(path, value, isLoaders, setVersion) {\n    this.historyManager.startStack({\n      type: \"set\",\n      path: path,\n      value: value\n    });\n\n    try {\n      if (this.setByLoader(path, value)) {\n        return;\n      }\n\n      var target = isLoaders ? this.state.meta : this.state.wallet;\n\n      _.set(target, path, value); //if ( setVersion ) {\n\n\n      this.state.currentVersion++; //}\n\n      this.updateVersionForAll(path.split(\".\"));\n\n      _.set(this.state.version, path + \".version\", this.state.currentVersion);\n\n      var strPath = _.isArray(path) ? path.join(\".\") : path;\n      this.getAffectedPaths(strPath);\n      this.req_triggers();\n    } catch (e) {\n      console.error(e);\n    } finally {\n      this.historyManager.endStack();\n    }\n  },\n  affected: {},\n  affected_checked: {},\n  affected_version: 1,\n  markChangeOn: function markChangeOn(path, skipTrigger, incAffected, incVersion) {\n    if (incAffected) this.affected_version++;\n    if (!skipTrigger) this.pauseAll();\n\n    if (incVersion) {\n      this.state.currentVersion++;\n      this.updateVersion(path);\n    }\n\n    this.getAffectedPaths(path); //console.log(Object.keys(this.affected), Object.keys(this.affected_checked));\n\n    if (!skipTrigger) this.req_triggers();\n  },\n  getAffectedPaths: function getAffectedPaths(path) {\n    if (this.state.cache[path]) {\n      this.state.cache[path].shouldUpdate = true;\n    }\n\n    if (this.affected[path] && this.affected[path].affected_version == this.affected_version) {\n      return;\n    }\n\n    this.affected[path] = {\n      affected_version: this.affected_version,\n      version: this.state.currentVersion,\n      state: 1\n    };\n    var route = path.split(\".\");\n    var strPath = route[0];\n    this.getAffectedPaths(route[0]);\n\n    for (var i = 1; i < route.length - 1; i++) {\n      strPath += \".\" + route[i];\n      this.getAffectedPaths(strPath);\n    }\n\n    var influenced = this.getInfluenced(path);\n\n    for (var i in influenced) {\n      this.getAffectedPaths(influenced[i]);\n    }\n  },\n  markChangedPaths: function markChangedPaths(path) {\n    //let influenced = this.getInfluenced( path );\n    var route = path.split(\".\");\n    var strPath = route[0];\n\n    for (var i = 1; i < route.length; i++) {\n      strPath += \".\" + route[i];\n      if (this.state.cache[strPath]) this.state.cache[strPath].shouldUpdate = true;\n      this.checkTriggers(strPath);\n      this.setUpdateFlag(strPath);\n    }\n  },\n  changedPaths: {},\n  setUpdateFlag: function setUpdateFlag(path) {\n    var influenced = this.getInfluenced(path);\n    var cache = this.state.cache;\n\n    for (var i in influenced) {\n      if (cache[influenced[i]]) {\n        cache[influenced[i]].shouldUpdate = true;\n      }\n\n      this.setUpdateFlag(cache[influenced[i]]);\n      this.checkTriggers(influenced[i]);\n    }\n  },\n  checkTriggers: function checkTriggers(path) {\n    if (this.state.triggers[path]) {\n      this.runTriggers(this.state.triggers[path], path);\n    }\n  },\n  runTriggers: function runTriggers(collection, path) {\n    for (var i in collection) {\n      this.runTrigger(collection[i], path, i);\n    }\n  },\n  runTrigger: function runTrigger(trigger, path, token) {\n    if (_.isFunction(trigger.run)) {\n      return trigger.run(trigger, path, token);\n    }\n\n    var fn = _.get(this.state.wallet, trigger.run);\n\n    if (_.isFunction(fn)) return fn(trigger, path, token);else if (fn.run) return fn.run(trigger, path, token);\n  },\n  run: function run(path, value) {},\n  fetchValues: function fetchValues(target, map, wallet, master, logger, onlyPaths) {\n    for (var i in map) {\n      if (i == \"type\") continue;\n      var value = map[i];\n\n      if (!value) {} else if (_.isString(value)) {\n        if (value.charAt(0) == \"$\") {\n          var _path = value.substr(2);\n\n          if (logger) logger.add(_path, i);\n          value = master.getValue(_path);\n        } else if (onlyPaths) {\n          var _path2 = value;\n          if (logger) logger.add(_path2, i);\n          value = master.getValue(_path2);\n        }\n      } else if (value.KEY == \"fullPath\") {\n        path = value.path.join(\".\");\n        if (logger) logger.add(path, i);\n        value = master.getValue(path);\n      }\n\n      if (value === undefined) {\n        console.log(i);\n        throw \"postpone\";\n      }\n\n      var slot = i;\n      target[slot] = value;\n      if (!target.src) target.src = {};\n      target.src[slot] = {\n        key: map[i],\n        slot: i\n      };\n    }\n\n    return target;\n  },\n  setCombined: function setCombined(path, value) {\n    this.historyManager.startStack({\n      type: \"setCombined\",\n      path: path,\n      value: value\n    });\n    var payload = {\n      loaders: {},\n      loadersPaths: [],\n      basePath: path.split(\".\"),\n      value: value,\n      pins: [],\n      afterOp: []\n    };\n    var isEmpty = this.iterate(value, [], payload);\n\n    if (payload.pins.length) {\n      var currentPins = {};\n\n      for (var i in payload.pins) {\n        var _pin = payload.pins[i];\n\n        var name = _pin.value || _pin.path.slice(-1)[0];\n\n        currentPins[name] = {\n          path: _pin.path,\n          fullPath: payload.basePath.concat(_pin.path)\n        };\n      }\n\n      var pins = _.get(this.state.pins, path + \".pins\");\n\n      if (!pins) _.set(this.state.pins, path + \".pins\", pins = {});\n\n      _.merge(pins, currentPins);\n    }\n\n    if (payload.afterOp.length) {\n      for (var i in payload.afterOp) {\n        var op = payload.afterOp[i];\n\n        if (op.type == \"gluePin\") {\n          var pin = pins[op.pin];\n          var pinKey = {\n            KEY: \"fullPath\",\n            path: pin.fullPath\n          };\n\n          if (op.isLoader) {\n            _.set(payload.loaders, op.dest, pinKey);\n          } else {\n            _.set(value, op.dest, pinKey);\n          }\n        } else if (op.type == \"flags\") {\n          if (op.flags.hasVersion) {\n            this.updateVersion(op.path);\n          }\n        }\n      }\n    }\n\n    if (!isEmpty) this.set(path, value, false, true);\n\n    if (payload.hasLoaders) {\n      //console.log( \"loaders\", payload.loadersPaths );\n      this.set(path, payload.loaders, true, true);\n\n      for (var i in payload.loadersPaths) {\n        var lPath = payload.loadersPaths[i];\n        this.setCache(lPath.join(\".\"), {}, true);\n\n        var loader = _.get(this.state.meta, lPath);\n\n        if (loader.loader && loader.loader.autostart) {\n          this.state.toStart.push({\n            path: lPath.join(\".\")\n          }); //this.getValue(lPath.join(\".\"));\n        } //console.log( \"loader\", loader );\n\n      }\n    }\n\n    this.historyManager.endStack();\n  },\n  runToStart: function runToStart() {\n    var toStart = this.state.toStart;\n\n    while (toStart.length) {\n      var item = toStart.shift();\n      this.getValue(item.path);\n    }\n  },\n  buildModel: function buildModel(input, path) {\n    var modelName = input.MODEL;\n    input = _.cloneDeep(input);\n    var tokens;\n\n    if (modelName.indexOf(\":\") != -1) {\n      tokens = modelName.split(\":\");\n      modelName = tokens.shift();\n      input.tokens = tokens;\n    }\n\n    var mold = this.getValue(modelName);\n\n    if (mold.handleTokens && tokens) {\n      mold.handleTokens(input, tokens, path);\n    }\n\n    var obj = _.cloneDeep(mold.modelObj);\n\n    if (mold.modelSpec) {\n      var spec = mold.modelSpec;\n\n      if (spec.ops) {\n        for (var i in spec.ops) {\n          var op = spec.ops[i];\n\n          if (op.type == \"replaceValue\") {\n            var value = _.get(input, op.source);\n\n            if (!op.dest) obj = value;else _.set(obj, op.dest, value);\n          } else if (op.type == \"eval\") {\n            var _value2 = op.fn(input, op);\n\n            console.log(_value2);\n\n            _.set(input, op.dest, _value2);\n          }\n        }\n      }\n\n      if (spec.isLoader) {\n        obj = {\n          loader: obj\n        };\n      }\n    }\n\n    if (input.pin !== undefined) obj.pin = input.pin;\n    this.historyManager.addInfo({\n      type: \"buildModel\",\n      path: path,\n      input: input,\n      obj: obj\n    });\n    return obj;\n  },\n  iterate: function iterate(obj, path, payload) {\n    while (obj && obj.MODEL) {\n      var newObj = this.buildModel(obj, payload.basePath.concat(path));\n\n      for (var i in obj) {\n        delete obj[i];\n      }\n\n      _.merge(obj, newObj); //really ? it was easier that way then to put inside the loop and on setCombined ? really ? \n      //yea, keeping the traditional approach\n\n    }\n\n    var isEmpty = true;\n\n    for (var i in obj) {\n      var subPath = path.concat(i);\n\n      if (i == \"pin\") {\n        payload.pins.push({\n          subPath: subPath,\n          path: path,\n          value: obj[i]\n        });\n        delete obj[i];\n      } else if (i == \"loader\") {\n        this.setLoader(payload.loaders, path, obj[i], payload.basePath, payload);\n        payload.loadersPaths.push(payload.basePath.concat(path));\n        delete obj[i];\n        payload.hasLoaders = true;\n      } else if (i == \"flags\") {\n        payload.afterOp.push({\n          type: \"flags\",\n          path: payload.basePath.concat(path).join(\".\"),\n          relPath: path,\n          flags: obj.flags\n        });\n      } else if (_.isString(obj[i]) && obj[i].charAt(0) == \"%\") {\n        obj[i] = this.getStaticValue(obj[i], i, obj, subPath, payload);\n        isEmpty = false;\n      } else if (_.isObjectLike(obj[i])) {\n        var subIsEmpty = this.iterate(obj[i], subPath, payload);\n\n        if (subIsEmpty) {//delete obj[ i ];\n        } else {\n          isEmpty = false;\n        }\n\n        isEmpty = false;\n      } else {\n        isEmpty = false;\n      }\n    }\n\n    return isEmpty;\n  },\n  getStaticValue: function getStaticValue(slot, index, obj, path, payload) {\n    if (slot == \"%PATH\") return payload.basePath.concat(path);else {\n      payload.afterOp.push({\n        type: \"gluePin\",\n        dest: path,\n        pin: slot.substring(1)\n      });\n      return {\n        KEY: \"relative path\"\n      };\n    }\n  },\n  getUID: function getUID() {\n    return this.state.nextUID++;\n  },\n  setTrigger: function setTrigger(target, listener, trigger) {\n    if (!this.state.triggers[target]) this.state.triggers[target] = {};\n    this.state.triggers[target][listener] = trigger;\n  },\n  getTrigger: function getTrigger(target, listener) {\n    if (!this.state.triggers[target]) return null;\n    return this.state.triggers[target][listener];\n  },\n  remTrigger: function remTrigger(target, listener) {\n    if (!this.state.triggers[target]) return;\n    delete this.state.triggers[target][listener];\n  },\n  setLoader: function setLoader(loaders, path, value, basePath, payload) {\n    if (_.isString(value)) {\n      var listenerPath = basePath.concat(path).join(\".\");\n      var oldTrigger = this.getTrigger(value, listenerPath);\n      if (oldTrigger && oldTrigger.path) this.remTrigger(oldTrigger.path, listenerPath);\n      this.setTrigger(value, listenerPath, {\n        run: \"base.updateLoader\",\n        loaderPath: value,\n        destination: listenerPath\n      });\n      value = this.getValue(value);\n    }\n\n    this.prepareLoader(value, basePath, path.concat(\"loader\"), payload);\n\n    _.set(loaders, path.concat(\"loader\"), value); //this.markChangeOn( path, true );\n\n  },\n  prepareLoader: function prepareLoader(loader, basePath, loaderPath, payload) {\n    this.deepTransformObj(loader, [], function (obj, slot, path) {\n      if (_.isString(obj) && obj.charAt(0) == \"%\") {\n        if (obj == \"%PATH\") {\n          return payload.basePath.concat(loaderPath);\n        }\n\n        payload.afterOp.push({\n          type: \"gluePin\",\n          dest: loaderPath.concat(path),\n          pin: obj.substring(1),\n          isLoader: true\n        });\n        return {\n          x: 12\n        };\n      }\n    });\n  },\n  deepTransformObj: function deepTransformObj(obj, path, test) {\n    if (!obj || !_.isObject(obj)) return;\n\n    for (var i in obj) {\n      var value = test(obj[i], i, path.concat([i]));\n\n      if (value !== undefined) {\n        obj[i] = value;\n        continue;\n      }\n\n      if (_.isObject(obj[i])) this.deepTransformObj(obj[i], path.concat([i]), test);\n    }\n  },\n  setMap: function setMap(map) {\n    for (var i in map) {\n      this.setCombined(i, map[i]);\n    }\n  },\n  getFromDispatch: function getFromDispatch(path) {\n    return this.getValue(path);\n  },\n  getVersion: function getVersion(path) {\n    var route = path.split(\".\");\n    var version = -1;\n    var versionsTree = this.state.version;\n\n    for (var i = 0; i < route.length; i++) {\n      var slot = route[i];\n      if (!versionsTree[slot]) return version;\n      versionsTree = versionsTree[slot];\n      if (versionsTree.version) version = versionsTree.version;\n    }\n\n    return version;\n  },\n  getVersionTree: function getVersionTree(path) {\n    var versionsTree = this.state.version;\n    return _.get(versionsTree, path);\n  },\n  updateVersionForAll: function updateVersionForAll(path) {\n    for (var i = 0; i < path.length; i++) {\n      _.set(this.state.version, path.slice(0, i).concat(\"version\"), this.state.currentVersion);\n      /*\n      \n      var node = _.get( this.state.version, path.slice(0,i) );\n      if ( !node ) break;\n      if ( node.version ) node.version = this.state.currentVersion;\n      */\n\n    }\n  },\n  updateVersion: function updateVersion(path) {\n    _.set(this.state.version, path + \".version\", this.state.currentVersion);\n  },\n  objectDiff: function difference(oldObject, newObject) {\n    function changes(oldO, newO) {\n      if (!_.isObject(oldO) || !_.isObject(newO)) return {\n        change: {\n          from: oldO,\n          to: newO\n        }\n      };\n      var result = {};\n      var hasChanges = false;\n\n      for (var i in newO) {\n        if (oldO[i] === undefined) {\n          result[i] = {\n            change: {\n              from: undefined,\n              to: newO[i],\n              type: \"added\"\n            }\n          };\n          hasChanges = true;\n        } else if (_.isFunction(newO[i]) && oldO[i] && newO[i].toString() != oldO[i].toString()) {\n          result[i] = {\n            change: {\n              from: oldO[i],\n              to: newO[i],\n              type: \"function changed\"\n            }\n          };\n          hasChanges = true;\n        } else if (_.isObject(newO[i])) {\n          var subChanges = changes(oldO[i], newO[i]);\n\n          if (subChanges) {\n            result[i] = subChanges;\n            hasChanges = true;\n          }\n        } else if (newO[i] != oldO[i]) {\n          result[i] = {\n            change: {\n              from: oldO[i],\n              to: newO[i],\n              type: \"changed\"\n            }\n          };\n          hasChanges = true;\n        }\n      }\n\n      for (var i in oldO) {\n        if (newO[i] === undefined) {\n          hasChanges = true;\n          result[i] = {\n            change: {\n              from: oldO[i],\n              to: null,\n              type: \"deleted\"\n            }\n          };\n        }\n      }\n\n      return hasChanges ? result : null;\n    }\n\n    return changes(oldObject, newObject);\n  },\n  act: function act(path, args, tb) {\n    var value = _.isObject(path) ? path : this.getValue(path);\n\n    if (!tb) {\n      tb = this.tb();\n    }\n\n    var act = ACT.init(value, this, args, path, tb);\n    return act;\n  },\n  tb: function tb() {\n    var tb = TB.init({}, this, null, {}, {}, {});\n    return tb;\n  }\n};\n\nvar DataManager = _DataManager.setup();\n\nvar ACT = {\n  master: null,\n  actions: null,\n  args: null,\n  init: function init(actions, master, args, path, tb) {\n    var item = Object.create(this);\n    item.master = master;\n    item.actions = actions;\n    item.args = args;\n    item.path = path;\n    item.tb = tb;\n    return item;\n  },\n  run: function run(name, args) {\n    return this.actions[name].apply(this.actions, [args, this.tb]);\n  }\n};\nvar TB = {\n  master: null,\n  logger: null,\n  spec: null,\n  step: null,\n  cache: null,\n  v: null,\n  init: function init(wallet, master, logger, spec, step, cache) {\n    var item = Object.create(this);\n    Object.assign(item, {\n      wallet: wallet,\n      master: master,\n      logger: logger,\n      spec: spec,\n      step: step,\n      cache: cache\n    });\n    item.v = {};\n    return item;\n  },\n  act: function act(path, args) {\n    var act = this.master.act(path, args, this);\n    return act;\n  },\n  go: function go(name, args) {\n    if (!this.toolbox) this.toolbox = DataManager.getValue(\"toolBox\");\n\n    if (!this.toolbox[name]) {\n      console.log(\"no \", name);\n      return null;\n    }\n\n    if (this.toolbox[name].run) return this.toolbox[name].run(args, this);else if (_.isFunction(this.toolbox[name])) return this.toolbox[name](args, this);\n  },\n  path: function path() {\n    return _.isArray(this.step.srcPath) ? this.step.srcPath.join(\".\") : this.step.srcPath;\n  },\n  fetch: function fetch(paths, target) {\n    return this.run_fetch(paths, target);\n  },\n  run_fetch: function run_fetch(paths, target, prefix) {\n    var _this5 = this;\n\n    var singlePath = false;\n\n    if (_.isString(paths) || paths.KEY) {\n      singlePath = true;\n      paths = {\n        SINGLEPATH: paths\n      };\n    }\n\n    var values = {};\n    this.master.fetchValues(values, paths, this.wallet, this.master, {\n      add: function add(path, slot) {\n        if (!_this5.logger) return;\n        var name = slot !== \"SINGLEPATH\" ? (prefix || []).concat(slot) : prefix || [];\n\n        _this5.logger.add(path, name.join(\".\"));\n      }\n    }, true);\n\n    for (var i in values) {\n      if (values[i] && values[i].type == \"routes\") {\n        var subPrefix = i != \"SINGLEPATH\" ? (prefix || []).concat(i) : prefix;\n        values[i] = this.run_fetch(values[i], null, subPrefix);\n      } else if (values[i] && values[i].type == \"value\") {//let subPrefix = i != \"SINGLEPATH\" ? (prefix || [] ).concat( i ) : prefix;\n        //values[ i ] = this.run_fetch( values[ i ], null, subPrefix )\n      } else if (values[i] && _.isString(values[i]) && values[i].charAt(0) == \"$\") {\n        var _subPrefix = i != \"SINGLEPATH\" ? (prefix || []).concat(i) : prefix;\n\n        values[i] = this.run_fetch(values[i].substring(2), null, _subPrefix);\n      }\n    }\n\n    if (singlePath) values = values.SINGLEPATH;\n\n    if (target) {\n      if (target.src) {\n        var src = values.src;\n        delete values.src;\n\n        _.merge(target.src, src);\n      }\n\n      Object.assign(target, values);\n      return target;\n    } else {\n      return values;\n    }\n  },\n  pathOf: function pathOf(path) {\n    var path = this.v.src[path];\n    if (path.key) return path.key;\n    if (_.isString(path)) return path;\n  },\n  set: function set(path, value) {\n    var target = this.v;\n    var route = _.isString(path) ? path.split(\".\") : path;\n    var last_src = null;\n\n    for (var i = 0; i < route.length; i++) {\n      var slot = route[i];\n\n      if (target.src && target.src[slot]) {\n        last_src = {\n          src: target.src[slot],\n          left: route.slice(i + 1)\n        };\n      }\n\n      if (!target[slot]) {\n        break;\n      }\n\n      target = target[slot];\n    }\n\n    if (last_src) {\n      var basePath = _.isString(last_src.src.key) ? last_src.src.key.split(\".\") : last_src.src.key.path;\n      var fullPath = basePath.concat(last_src.left).join(\".\");\n      this.master.set(fullPath, value);\n    }\n  },\n  detach: function detach() {\n    var detached = Object.create(this);\n    detached.v = {};\n    detached.logger = null;\n    return detached;\n  },\n  feed: function feed(path) {\n    var feedModel = this.master.getValue(path);\n    var feed = feedModel.init();\n    var start = 1;\n\n    for (var i = start; i < arguments.length; i++) {\n      feed.in(arguments[i]);\n    }\n\n    return feed;\n  }\n};\n\ntry {\n  if (!window.DataManager) {\n    window.DataManager = DataManager;\n    window._DataManager = _DataManager;\n  } //eval( 'export default DataManager' );\n\n} catch (e) {}","module.exports = __webpack_public_path__ + \"static/media/logo.06a44ff7.svg\";"],"sourceRoot":""}