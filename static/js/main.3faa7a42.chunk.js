(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{106:function(t,e,a){t.exports=a(1255)},111:function(t,e,a){},1171:function(t,e){},1173:function(t,e){},1206:function(t,e){},1207:function(t,e){},1253:function(module,__webpack_exports__,__webpack_require__){"use strict";var lodash__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(0),lodash__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_0__),faker__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(5),faker__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(faker__WEBPACK_IMPORTED_MODULE_1__),pouchdb__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(56),cu=window.cu,ub={ctx:{},serialize:function(t){return lodash__WEBPACK_IMPORTED_MODULE_0___default.a.cloneDeepWith(t,function(t){if(lodash__WEBPACK_IMPORTED_MODULE_0___default.a.isFunction(t))return{TYPE:"FN",body:t.toString()}})},deserialize:function deserialize(obj){var item=lodash__WEBPACK_IMPORTED_MODULE_0___default.a.cloneDeepWith(obj,function(value){if(value&&"FN"==value.TYPE){var fn;try{eval("fn="+value.body)}catch(e){}return fn}});return item},save:function(t,e){var a=this.ctx.db,n=this.serialize(t);return n.uid||(n.uid=e||n.id||this.generateUid()),n._id||(n._id=n.uid),a.get(n._id).then(function(t){var e=t.rev,i=t._rev;return n.rev=e,n._rev=i,a.put(n).then(function(t){})}).catch(function(t){return a.put(n)})},load:function(t){var e=this;return this.ctx.db.get(t).catch(function(t){return null}).then(function(t){return t&&(t=e.deserialize(t)),t})},generateUid:function(){return this.cfg.state.nextId++,this.cfg.state.prefix+"_"+this.cfg.state.nextId},init:function(t){var e={db:new pouchdb__WEBPACK_IMPORTED_MODULE_2__.a(t,{auto_compaction:!0}),state:{prefix:(new Date).getTime().toString()+"_"+Math.random().toString(),nextId:0,id:"state"}},a=Object.create(this);return a.ctx=e,a.load("state").then(function(t){t?a.ctx.state=t:a.save(a.ctx.state)}),a},destroy:function(){this.ctx.db.destroy().then(function(){alert("done cleanup")})}},test=function(t){t.obj=ub.serialize({x:function(){},y:"test"}),t.obj2=ub.deserialize(t.obj),ub.init("testdb")};cu.db={run:function(t){return ub.init(t)},def:"\n    ",debug:{ub:ub}}},1255:function(t,e,a){"use strict";a.r(e);var n=a(3),i=a.n(n),r=a(103),s=a.n(r),o=(a(111),a(16)),l=a(17),u=a(20),c=a(18),d=a(19),h=(a(60),a(61),a(11)),p=a(104);a(114);a(116);n.Component;var f=a(0),v=a.n(f),g=a(15),b=a.n(g),m=(a(40),a(41),window.DataManager),w={setup:function(){var t=this;this.isInitialized||(b()("body").on("keydown",function(e){t.handleKey(e)}),m.setTrigger("keyboardShortcuts.layout","kbdManager",{run:function(){t.load()}}),this.load())},load:function(){var t=m.getValue("keyboardShortcuts.layout");this.layout=t||{}},handleKey:function(t){var e=[];t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),t.shiftKey&&e.push("shift"),e.push(t.key.toLowerCase());var a=e.join("+");if(this.layout[a])return this.run(this.layout[a],a)},run:function(t,e){return v.a.isFunction(t)?t(e,t):t.run?t.run(e,t):void 0}};w.setup();var y={init:function(t){var e=Object.create(this);return e.DataManager=t,e.wallet={timers:{}},e},wallet:{timers:{}},start:function(t,e,a){var n=this;this.wallet.timers[t]&&window.clearTimeout(this.wallet.timers[t]);var i=window.setTimeout(function(){n.cancel(t),e(t,e,a)},a);this.wallet.timers[t]=i;var r=new Date;this.DataManager.set("TimerManager.timer."+t,{start:r.getTime(),end:r.getTime()+a})},cancel:function(t){this.wallet.timers[t]&&window.clearTimeout(this.wallet.timers[t]),delete this.wallet.timers[t],this.DataManager.set("TimerManager.timer."+t,"")}},_=(a(56),a(32)),x=a.n(_),j=(a(120),a(33),a(5)),k=a.n(j),O=(a(1168),{});window.cu=O;var S=O,A=a(105),T=a.n(A),P=window.cu,I={getColor:function(t){var e=360*t,a=T()("#007abc").set("hsi.h",e).hsl();return a[1]=100*a[1],a[2]=100*a[2],a},get:function(t,e){var a=t;t=0;for(var n in a)t+=a.charCodeAt(n)*n;function i(){var e=1e4*Math.sin(t++);return e-Math.floor(e)}var r=50/(e=Math.max(2,Math.floor(5*i()))),s=this.getColor(i()),o=[[0,0,.5,.5,1,0],[0,0,.5,.5,0,1],[1,1,.5,.5,0,1],[1,1,.5,.5,1,0]],l=[];for(n=0;n<e;n++)for(var u=function(){var t=n,e=c;o.map(function(a){var n="hsl( "+s[0]+","+s[1]+"% ,"+s[2]+"%  )",o=Math.round(5*i());l.push("<polygon\n                  class='poligon poligon_".concat(o,"'\n                  points=\"")+a.join(" ")+'" stroke="transparent" fill="transparent" \n                  style=" strokeWidth: '+1/r+";\n                  fill: "+n+";\n                  opacity : "+i()+"; \n                  transform: scale("+r+") translate( "+t+"px, "+e+'px)" />')})},c=0;c<e;c++)u();return"<svg> "+l.join("")+"</svg>"}};P.brand={getLogo:function(t,e,a){var n=I.get(t,a);return console.log(n),n},def:"\n    ",debug:{ub:I}};window.cu.bubbleBoard={init:function(){},def:"\n    ",debug:{ub:{}}};var C=window.cu,V={ctx:{},addItem:function(t){var e=this.getId();return t.id=e,this.mergeItem(e,t),e},getId:function(){return this.ctx.data.state.nextId++,"bubble_"+this.ctx.data.state.nextId},mergeItem:function(t,e){var a,n=this.ctx;n.data.result[t];n.changed={},this.appendTo(t,e);var i=n.data.result,r=n.changed;console.log(n.data);var s=n.data.versions;for(var o in r){s[o]||(s[o]=0),s[o]++;var l=i[o];l&&(l.isReady&&(void 0==a&&(a=l.completedAt),a>l.completedAt&&(a=l.completedAt)))}return void 0!==a&&this.rewindTo(a),this.ctx.tb.onchanged&&this.ctx.tb.onchanged(r),a},rewindTo:function(t){var e=this.ctx;for(var a in e.data.result){var n=e.data.result[a];n.isReady&&(n.completedAt>=t||n.createdAt>t)&&(n.isReady=!1,n.completedAt=0)}e.data.step=t},appendTo:function(t,e){var a=this.ctx,n=a.data.items[t],i=!1;for(var r in n||(a.data.step++,a.data.items[t]=n={},a.data.result[t]={createdAt:a.data.step},i=!0),e){var s=e[r];if("REMOVE"!=s||void 0===n[r])if(null!==s||void 0===n[r]){if(s){var o=n[r]?n[r].id:null;v.a.isString(s)&&"#"==s.charAt(0)&&(s={id:s.substring(1)}),void 0!==s.id&&("#"!=s.id&&""!=s.id||(s.id=null),s.id=s.id||o||this.getId(),n[r]={id:s.id}),s.id&&v.a.isObject(s)?(s.id!=o&&(i=!0),this.appendTo(s.id,s)):v.a.isObject(s)&&!v.a.isMatch(n[r],s)?(i=!0,n[r]=s):n[r]!=s&&(i=!0,n[r]=s)}}else delete n[r],i=!0;else delete n[r],i=!0}i&&(n.version&&(n.version=n.version?n.version+1:1),this.ctx.changed[t]=!0)},evalItems:function(t){this.ctx.affected={},this._evalItems(t),this.ctx.tb.onchanged&&this.ctx.tb.onchanged(this.ctx.affected)},_evalItems:function(t){if(!(t<=0)){var e=this.ctx,a=!1;for(var n in e.data.items){var i=e.data.items[n],r=e.data.result[n];if(!r||!r.isReady){var s=this.isCompleteValues(i,n);s&&(e.data.result[n]||(e.data.result[n]={}),this.evalItem(i,n,s,e.data.result[n]),e.data.result[n].isReady&&(a=!0))}}a&&this._evalItems(t-1)}},evalItem:function(t,e,a,n){var i=this.ctx;n.isReady=!0,n.values=a;var r=this.ctx.tb.getNode(t,a,n,i);r&&(n.node=r),n.isReady&&(i.data.step++,n.completedAt=i.data.step,this.ctx.affected[e]=!0)},isCompleteValues:function(t){var e=this.ctx,a={};for(var n in t){var i=t[n];if(i.id){var r=e.data.result[i.id];if(!r||!r.isReady)return!1;var s=r.node;t[n+"_path"]&&(s=v.a.get(s,t[n+"_path"])),a[n]=s}else a[n]=i}return a},init:function(t){var e=Object.create(this);return e.ctx=t,v.a.defaultsDeep(t,{data:{items:{},result:{},step:1,versions:{},trails:{},rels:{bellow:{},above:{},uses:{}},state:{nextId:8}},tb:{checkIfComplete:function(t){return t.type||t.tpl||t.node},getNode:function(t,e,a){return{val:e,x:t.tpl}}}}),t.master=e,e},evaluateflow:function(){this.evalItems(5)},getVersion:function(t){var e=this.ctx.data.items[t];return e?e.version:null}};C.bubbleFlow={run:function(t){return V.init(t)},init:function(){},def:"\n    ",debug:{ub:V}};var D=window.cu,M={},E={ctx:{},doubleCheck:function(t){var e=M.evaluate.setup({data:this.ctx.data,state:this.ctx.state}).target(t);for(var a in L)e.run(L[a])},check:function(t){var e=this.ctx.data.items[t],a=this.ctx.data.result[t],n=this.ctx.data.shaddow[t];n||(n=this.ctx.data.shaddow[t]={});var i=this.ctx.data.result,r=n.score={subs:{total:0,resolved:[],unresolved:[]}};for(var s in e)e[s].id&&(r.subs.total++,i[e[s].id]&&i[e[s].id].isReady?r.subs.resolved.push({slot:s,id:e[s].id}):r.subs.unresolved.push({slot:s,id:e[s].id}));if(a&&a.values&&a.values.tpl){var o=a.values.tpl;r.tplParams={total:0,defined:0,resolved:0,unresolved:[]};var l=o.mold.parameters;for(var u in l)r.tplParams.total++,a.values[u]||e[u]?r.tplParams.defined++:r.tplParams.unresolved.push(u)}},setup:function(t){var e=Object.create(this);return e.ctx=t,v.a.defaultsDeep(t,{data:{items:{},result:{},shaddow:{},trails:{}}}),e}};M.evaluate={target:function(t){var e=this.model||this,a=Object.create(e);return a.model=e,a.setup(),a.v.targetId=t,a},setup:function(t){return this._setup(t),this},_setup:function(t){t&&Object.assign(this,t),this.model&&this.model.shaft&&(this.shaft={}),this.v={result:{}}},get:function(t){if(!v.a.isString(t))return t;var e;this.v.targetId;return"values"==t&&(e=["result",this.v.targetId,"values"]),e="item"==t?["items",this.v.targetId]:[t,"id"],v.a.get(this.data,e)},getFull:function(t){var e=t[0],a=t[1],n=t[2];e||(e="items"),"item"==e&&(e="items"),a||(a=this.v.targetId);var i=[e,a];return n&&i.push(n),v.a.get(this.data,i.join("."))},fetch:function(t){for(var e in t)this.v[e]=this.getFull(t[e]);return this},it:function(t,e){t=this.get(t);var a={slot:this.v.slot,value:this.v.value,info:this.v.info,sub:this.v.sub};for(var n in this.v.slot=null,this.v.value=null,this.v.info=null,this.v.sub=null,t)this.v.slot=n,this.v.value=t[n],this.v.info=n,this.v.sub={},e(this,this.v);for(var n in a)this[n]=a[n]},run:function(t){try{t(this,this.v)}catch(e){if(e&&"notApplicable"==e.type)return;console.log(e)}this.v.result&&(this.data.trails[this.v.targetId]||(this.data.trails[this.v.targetId]={}),Object.assign(this.data.trails[this.v.targetId],this.v.result))},result:function(t,e){this.v.result[t]=e},check:function(t){for(var e in t){if("isCurrentItem"==t[e]){var a=this.state.currentItem.targetid;if(!a||this.v.targetId!=a)throw{type:"notApplicable",path:t[e]}}else{if(void 0===v.a.get(this.v,t[e]))throw{type:"notApplicable",path:t[e]}}}}},M.compile=Object.assign({},M.evaluate,{setup:function(t){return this._setup(t),this.clues={needes:{},provides:{},collections:[]},this},fetch:function(t){for(var e in t)this.clues.needes[e]={key:t[e]},this.v[e]={test:"test"};return this},check:function(t){},result:function(t,e){this.clues.provides[t]=e},it:function(t,e){this.clues.collections.push(t)},run:function(t){t(this,this.v)}});var L=[function(t,e){return t.fetch({item:["item"]}),e.score={total:0,resolved:[],unresolved:[]},t.it(e.item,function(t,e){var a=e.value;if(a.id){e.score.total++;var n=t.getFull(["result",a.id]);n&&n.isReady?e.score.resolved.push(a.id):e.score.unresolved.push(a.id)}}),t.result("subScore",e.score),{subScore:e.score}},function(t,e){t.fetch({values:["result","","values"],item:["item"],parameters:["result","","values.tpl.mold.parameters"]}),t.check(["values.tpl"]),e.score={total:0,defined:0,undefined:[]},e.params={},t.it(e.parameters,function(t,e){var a=e.slot;e.params[a]=!0,e.score.total++,e.item[a]||e.values[a]||e.score.undefined.push(a)}),t.it(e.parameters,function(t,e){var a=e.slot;e.params[a]=!0}),e.score.undefinedCount=e.score.undefined.length,e.score.definedCount=e.score.total-e.score.undefinedCount,t.result("tplParamsScore",e.score),t.result("tplParams",e.params)},function(t,e){t.fetch({trails:["trails"]}),t.check(["isCurrentItem"]),console.log("trails is currentItem",e.trails)}];D.bubbleGuns={setup:function(t){return E.setup(t)},init:function(){},def:"\n    ",debug:{ub:E}};var R=window.cu,U={ctx:{tb:{onchanged:function(t){},getNode:function(t,e,a,n){return R.bubbleTypes.dispatch.getNode(t,e,a,n)}},data:{state:{nextId:0}}}};R.bubbleTest={init:function(){},def:"\n    ",debug:{ub:U}};var N=window.cu,F={};F.dispatch={getNode:function(t,e,a,n){var i=e.type;if(i||(e.tpl?i="reactNode":e.node&&(i="dataNode")),i&&F[i])return F[i].getNode(t,e,a,n);a.isReady=!1}},F.tpl={getNode:function(t,e,a,n){delete e.type;var i=N.tplObjParse.run(e);return a.viewAs="object",i}},F.dataNode={getNode:function(t,e,a,n){return t.node}},F.reactNode={getNode:function(t,e,a,n){var i=e.tpl;if(i&&i.mold){var r=[],s=N.reactAssembler.run(i,e,function(t,e,a){var n=v.a.get(t,e);return void 0!==n?n:(r.push(e),"dummyvalue")});return r.length&&(s=[r,s]),a.viewAs="reactComponent",a.cues={pins:i.mold.pins},s}a.isReady=!1}},F.mirror={description:"",getNode:function(t,e,a,n){var i=n.data.items[t.model],r=e.data,s=v.a.cloneDeep(i);if(a.bubbles||(a.bubbles={}),a.cache||(a.cache={data:{}}),!v.a.isMatch(a.cache.data,r))for(var o in a.cache.data=r,s)"tpl"!=o&&s[o].id&&r[o]&&a.bubbles[o]&&n.master.mergeItem(a.bubbles[o].id,{data:r[o]});for(var o in s)if("tpl"!=o&&s[o].id&&r[o]){if(a.bubbles[o])s[o]={id:a.bubbles[o].id};else{var l=n.master.addItem({type:"mirror",data:r[o],model:s[o].id});a.bubbles[o]={id:l,model:s[o].id}}s[o]={id:a.bubbles[o].id}}else r[o]&&(s[o]=r[o]);s.id=t.id;var u=n.master.isCompleteValues(s);if(u)return a.mirror={},n.master.evalItem(t,t.id,u,a.mirror),a.mirror.viewAs&&(a.viewAs=a.mirror.viewAs),a.mirror.node;a.isReady=!1}};N.bubbleTypes={mirror:F.mirrorBubble,types:F,dispatch:F.dispatch,def:"\n    ",debug:{ub:{}}};a(1253);var B=window.cu,W={run:function(t){t=t.trim();var e=document.createElement("div");e.innerHTML=t;for(var a=[],n=0;n<e.childNodes.length;n++){var i=e.childNodes[n],r=this._spec(i);a.push(r)}return 1==a.length?a[0]:a},_spec:function(t){var e=this;if(3==t.nodeType)return t.nodeValue;for(var a={},n=0;n<t.attributes.length;n++){var i=t.attributes[n],r=i.name;-1!=r.indexOf("_")&&(r=r.replace(/\_(.)/g,function(t,e){return e.toUpperCase()})),a[r]=i.value}a.class&&(a.className=a.class,delete a.class),a.style&&(a.style=this._style(a.style));var s={type:"node",componentName:t.nodeName.toLowerCase(),props:a,children:null};if(a.htmlSlot)return a[a.htmlSlot]=t.innerHTML,s;0==Object.keys(a)&&(a=null);var o=[];return t.childNodes.forEach(function(t){o.push(e._spec(t))}),0==o.length&&(o=null),s.children=o,s},_style:function(t){t+=";";for(var e,a=/\s*([^:\s]+)\s*\:\s*([^;]+)\s*\;+/g,n={};e=a.exec(t);)n[e[1]]=e[2];return n}},q={run:function(t,e){var a=this,n={ops:[],pins:{},parameters:{},attrs:{},watchAttrs:e||[]};return v.a.isArray(t)?n.tpl=t.map(function(t,e){return a.iterate(t,[e],n)}):n.tpl=this.iterate(t,[],n),n.ops.sort(function(t,e){return t.stage-e.stage}),{ops:n.ops,tpl:n.tpl,pins:n.pins,parameters:n.parameters,attrs:n.attrs}},iterate:function(t,e,a){if(t){if(v.a.isString(t))return this.opValues(t,e,a,!1);t=this.handleObj(t,e,a);var n=e.concat(["children"]);for(var i in t.children)t.children[i]=this.iterate(t.children[i],n.concat(i),a);var r=e.concat(["props"]);for(var i in t.props)"style"!=i&&(t.props[i]=this.handleProp(t.props[i],r.concat(i),t,a));if(t.props&&t.props.style){var s=e.concat(["props","style"]);for(var i in t.props.style)t.props.style[i]=this.handleProp(t.props.style[i],s.concat(i),t,a)}return t.props&&t.props.pin&&(a.pins[t.props.pin]=e),t.props&&t.props.id&&(a.pins[t.props.id]=e),t.props&&a.watchAttrs.forEach(function(n){t.props[n]&&(a.attrs[n]||(a.attrs[n]=[]),a.attrs[n].push({path:e,value:t.props[n]}))}),t}},handleObj:function(t,e){return t},handleProp:function(t,e,a,n){return v.a.isString(t)?this.opValues(t,e,n,!0):t},addOp:function(t,e,a){a.stage||(a.stage=0),t.parameters[a.action]=a.path,t.ops.push(a)},prepareAction:function(t){return t},opValues:function(t,e,a,n){var i=this;if(!v.a.isString(t))return t;if(-1==t.indexOf("{"))return t;a.ops;var r=t.split(/(\{[^}\n\:\;]+)\}/g);return 0==(r=r.map(function(t,e){return""==t?null:"{"!==t.charAt(0)?t:(t=t.substring(1),{type:"value",action:i.prepareAction(t)})}).filter(function(t){return t})).length?null:1==r.length?((r=r[0]).type&&(r.path=e),v.a.isObject(r)&&this.addOp(a,r.path,r),r):n?(r=r.map(function(t,n){return t.type?(t.path=e.concat(n),t.index=n,t.concatParent=!0,t.stage=0,i.addOp(a,e,t),t):t}),this.addOp(a,e,{path:e,type:"concat",ops:r,stage:1}),r):r=r.map(function(t,n){return t.type?(t.path=e.concat(n),t.index=n,t.stage=0,i.addOp(a,e,t),t):t})}},K=function(t,e){var a=W.run(t);return a=q.run(a,e)};B.parseStringIntoComp={run:function(t,e){return K(t,e)},def:"\n        @obj string \n        transform it into componentsObjects\n    "};var z=window.cu,H={ctx:{nextUID:0},run:function(t){return(t||"uid")+"_"+this.ctx.nextUID++},makestr:function(t,e){if(v.a.isFunction(t))return t.toString();if(v.a.isString(t)){var a='"';return-1!=t.indexOf("\n")&&(a="`"),-1!=t.indexOf('"')&&(a="`"),"`"==a&&(t=(t=x.a.html(t,{indent_size:2,indent_level:e+1,preserve_newlines:!0,max_preserve_newlines:0,indent_inner_html:!0})).trimStart()),a+t+a}if(v.a.isArray(t)){var n=[];for(var i in t){var r=this.makestr(t[i],e+1);n.push(r)}return"["+n.join(",\n")+"]"}if(v.a.isObjectLike(t)){var s=[];for(var i in t){var o=i,l=this.makestr(t[i],e+1);o.match(/^[a-z0-9$_]+$/)||(o='"'+o+'"'),-1!=l.indexOf("\n")&&!1,s.push(o+":"+l)}return"{"+s.join(",")+"}"}return v.a.isNil(t)?"null":t.toString()},beautify:function(t){return x.a.js_beautify(t,{indent_size:2,indent_level:-1,max_preserve_newlines:1,preserve_newlines:!0})}};z.prettyScode={run:function(t){var e=H.makestr(t,1);return H.beautify(e)},def:"\n    ",debug:{ub:H}};var G=window.cu,Y={ctx:{tb:{}},run:function(t,e,a){var n=(t=v.a.cloneDeep(t)).mold.tpl;return this.applyOps(t.mold.ops,n,e,a),n.props&&(n.props.tplid=t.uid),n},applyOps:function(t,e,a,n){for(var i=n||v.a.get,r=[],s=0;s<t.length;s++){var o=t[s];if("value"==o.type){var l=i(a,o.action,o,r);v.a.set(e,o.path,l)}else if("computedValue"==o.type){var u=o.value;v.a.set(e,o.path,u)}else if("concat"==o.type){var c=i(e,o.path,o,r).join("");v.a.set(e,o.path,c)}}r.length&&this.applyOps(r,e,a,n)}};G.reactAssembler={run:function(t,e,a){return Y.run(t,e,a)},init:function(){},def:"\n    ",debug:{ub:Y}};var $=function(t){function e(t){var a;return Object(o.a)(this,e),(a=Object(u.a)(this,Object(c.a)(e).call(this,t))).state={value:""},a.onChange=a.onChange.bind(Object(h.a)(Object(h.a)(a))),a}return Object(d.a)(e,t),Object(l.a)(e,[{key:"onChange",value:function(t){this.setState({value:t.target.value}),this.props.onChange&&this.props.onChange(t)}},{key:"componentWillReceiveProps",value:function(t){void 0!==t.value&&void 0!==t.value.text&&this.setState({value:t.value.text})}},{key:"render",value:function(){var t=Object.assign({},this.props,{value:this.state.value,onChange:this.onChange});return i.a.createElement("input",t,null)}}]),e}(n.Component),J=window.cu,Q={myinput:$},X={makeComponent:function(t,e){var a=this;if(!t)return null;if(v.a.isString(t))return t;if(v.a.isArray(t))return t.map(function(t,e){return a.makeComponent(t,e)});if(!t.componentName)return null;var n=null;t.children&&(n=t.children.map(function(t,e){return a.makeComponent(t,e)}));var r=null;t.props&&(r=v.a.cloneDeep(t.props)),r&&!r.key&&(r.key=e),r||(r={key:e}),"style"==t.componentName&&(n=[v.a.flattenDeep(n).join("")]);var s,o=t.componentName;Q[o]&&(o=Q[o]);try{s=i.a.createElement(o,r,n)}catch(l){console.error(l),s="error"}return s}};J.reactUtils={makeComponent:function(t){return X.makeComponent(t,1)},def:"\n    ",debug:{ub:X}};var Z=window.cu,tt={ctx:{nextUID:0},createStore:function(t,e,a){if(t.cache.store)return t.cache.store;var n=function(t){return function(a){var n=a.target.value;e.set(t,n)}},i=function(t){return function(a){if(e[t])return e[t](a)}},r=function(t){return function(a){var n=a.target,i=b()(n).attr(t[1]);if(void 0===i&&(n=b()(n).parents("["+t[1]+"]"),i=b()(n[0]).attr(t[1])),e[t[0]])return e[t[0]](i,a)}},s={};for(var o in a.change)s[o]=n(a.change[o]);for(var o in a.run)s[o]=i(a.run[o]);for(var o in a.runWith)s[o]=r(a.runWith[o]);return t.cache.store=s,s}};Z.store={run:function(t){return tt.run(t)},get:function(t,e,a){return tt.createStore(t,e,a)},def:"\n    ",debug:{ub:tt}};var et=window.cu,at={ctx:{payload:{data:{items:{},subs:{}},src:{getItem:function(t){},getSubs:function(t){}},tpls:[],registerTpl:function(t,e){this.tpls.push(t.path)},cases:[function(t){if(!t.obj.item){var e=t.obj.id,a=at.ctx.payload.data.items[e];return a||(a={text:k.a.company.catchPhrase(),id:e},at.ctx.payload.setter&&at.ctx.payload.setter(["items",e],v.a.cloneDeep(a))),t.obj.item=a,"applied"}},function(t){if(!t.obj.subs&&t.obj.item&&t.obj.level<4){var e=t.obj,a=t.obj.id,n=at.ctx.payload.data.subs[a];if(!n&&!at.ctx.payload.generated){n={};for(var i=0;i<4;i++){var r=k.a.random.uuid(),s=null;1==e.level&&(s=k.a.random.arrayElement([null,"columns"]));var o={id:r,level:t.obj.level+1,tpl:s};n[r]=o}at.ctx.payload.setter&&at.ctx.payload.setter(["subs",a],v.a.cloneDeep(n))}return n||(n={}),t.obj.subs=n,t.subs=n,"applied"}}]},tb:{}},run:function(t,e){var a=this.ctx.payload;this.ctx.payload.attrs=e||[];var n=this.it(t,[]);return this.ctx.payload=a,n},it:function(t,e){var a={oldPayload:null,obj:t,sub:t,master:this,path:e,values:{},ops:[]};for(var n in this.prepare(a),a.subs){var i=this.it(a.subs[n],e.concat([n]));a.values[n]=i}return this.integrate(a)},addPayload:function(t,e){t.oldPayload||(t.oldPayload=this.ctx.payload,this.ctx.payload=Object.create(this.ctx.payload)),Object.assign(this.ctx.payload,e)},prepare:function(t){for(var e=this.ctx.payload.cases,a=!0,n=0;a&&n<5;)for(var i in a=!1,n++,e){if("applied"==(0,e[i])(t)){a=!0,!0;break}}},integrate:function(t){if(t.ops.length)for(var e in t.ops){var a=t.ops[e];this.ctx.payload[a.name](a.args,this)}return t.oldPayload&&(this.ctx.payload=t.oldPayload),t.obj}};et.testDataGenerator={run:function(t,e,a,n){return at.ctx.payload.data=e,at.ctx.payload.setter=n,at.ctx.payload.generated=a,at.run({id:t||"root",level:0},[])},init:function(){at.ctx.tb.parser=et.tplObjParse,at.ctx.tb.reactAssembler=et.reactAssembler},def:"\n    ",debug:{ub:at}};var nt=window.cu,it={ctx:{tb:{}},run:function(t){var e=t;return e=this.ctx.tb.parser.run(e,["comp"])}};nt.testMolds={run:function(t){return it.run(t,[])},init:function(){it.ctx.tb.parser=nt.tplObjParse,it.ctx.tb.reactAssembler=nt.reactAssembler},def:"\n    ",debug:{ub:it}};var rt=window.cu,st={ctx:{tb:{},wallet:{}},run:function(t){var e=t;return e=this.ctx.tb.parser.run(e,["comp"])},parseTpl:function(t){return this.ctx.tb.parser.run(t,["comp"])},renderTpl:function(t,e,a){return this.ctx.tb.reactAssembler.run(t,e,a)},assembleTpl:function(t,e){return v.a.isString(t)&&(t=v.a.get(this.ctx.payload.molds,t)),this.ctx.tb.reactAssembler.run(t,e,function(t,e){var a=v.a.get(t,e);return a.node?a.node:a})},iterateBubbles:function(t,e){if(void 0==e&&(e=0),!(e&&e>5)){t=t||this.ctx.payload.bubbles;for(var a=!1,n=0;n<t.length;n++){var i=t[n];if(!i.isReady){var r=!0;for(var s in i)!i[s].tpl||(i[s].isRegistered||(i[s].isRegistered=!0,this.addBubble(i[s])),i[s].isReady)||(r=!1);if(r){var o=st.assembleTpl(i.tpl,i);i.node=o,i.isReady=!0,i.computedAtStep=this.ctx.payload.step++,a=!0}}}a&&this.iterateBubbles(t,e+1)}},addBubble:function(t){t.uid=rt.uids.run("bubble"),t.addedAtStep=this.ctx.payload.step,this.ctx.payload.bubbles.push(t)},start:function(t){this.ctx.payload={bubbles:[],molds:t,step:0}}},ot={x:"\n            <div><input id='order' syncwith={value} />\n            {value} \n            <div id='menu'> </div>\n            <div id='bar'> </div>\n            <div id='window' > {content}</div>\n            </div>\n        ",y:"salut {#test} salutare din alt template "};window.salut={value:"elefant"};rt.testTplAssembing={run:function(){return st.start(st.parseTpl(v.a.cloneDeep(ot))),st.addBubble({tpl:"x",value:"salutare",value_setter:function(){console.log("setting")},content:{tpl:"y","#test":"yo"}}),st.iterateBubbles(),st.ctx.payload.bubbles[0].node},init:function(){st.ctx.tb.parser=rt.tplObjParse,st.ctx.tb.reactAssembler=rt.reactAssembler},def:"\n    ",debug:{ub:st}};var lt=window.cu,ut={ctx:{payload:{tpls:{},registerTpl:function(t,e,a){e.obj.uid=lt.uids.run(),e.obj.mold.props&&(e.obj.mold.props.tplId=e.obj.uid),this.tpls[t.path.join(".")]=e.obj.uid}},tb:{}},run:function(t,e){var a=this.ctx.payload;this.ctx.payload.attrs=e;var n=this.it(t,[]);return this.ctx.payload=a,n},it:function(t,e){var a={oldPayload:null,obj:t,sub:t,master:this,path:e,values:t,ops:[]};for(var n in this.prepare(a),a.sub){var i=this.it(a.sub[n],e.concat(n));a.values[n]=i}return this.integrate(a)},addPayload:function(t,e){t.oldPayload||(t.oldPayload=this.ctx.payload,this.ctx.payload=Object.create(this.ctx.payload)),Object.assign(this.ctx.payload,e)},prepare:function(t){for(var e=this,a={isString:function(t){return t.obj&&t.obj.trim},isUnparsedTpl:function(t){return t.obj&&t.obj.html&&!t.obj.mold},isList:function(t){return!0}},n={isString:function(t){return t.values=t.obj={html:t.obj},t.sub=[],"applied"},isUnparsedTpl:function(t){t.sub=[];var a=Object.assign({},t.obj,{mold:e.ctx.tb.parseHtml.run(t.obj.html,e.ctx.payload.attrs)});return t.values=t.obj=a,t.ops.push({name:"registerTpl",path:t.path}),"applied"}},i=!0,r=0;i&&r<5;)for(var s in i=!1,r++,n){if((0,a[s])(t))if("applied"==(0,n[s])(t)){i=!0,!0;break}}},integrate:function(t){if(t.ops.length)for(var e in t.ops){var a=t.ops[e];this.ctx.payload[a.name](a,t,this)}return t.oldPayload&&(this.ctx.payload=t.oldPayload),t.values}};lt.tplObjParse={run:function(t,e){return ut.run(t,e)},init:function(){ut.ctx.tb.parseHtml=lt.parseStringIntoComp},def:"\n        @obj with string or .html slots \n        transform it into componentsObjects\n    ",debug:{ub:ut}};var ct=window.cu,dt={ctx:{tb:{},payload1:{tplsMapping:["map","topic","item","entry"],defaultTpl:"item",usedGlobalStyles:{},addSubs:function(t,e,a){e.obj.subs=e.values;var n=e.obj,i=[];for(var r in e.values){var s=e.values[r];s.nodes&&s.nodes.card&&i.push(s.nodes.card)}i&&(e.obj.nodes.content=a.ctx.payload.useTemplate(n.tpl+".content",{subs:i}));var o=e.obj.nodes;e.obj.nodes.card=a.ctx.payload.useTemplate(n.tpl+".card",o)},useTemplate:function(t,e,a){if(!a)for(var n=t.split("."),i=dt.ctx.wallet.molds,r=0;r<n.length;r++){var s=n[r];if(i[s].globalStyle){var o=i[s].globalStyle.uid;this.usedGlobalStyles[o]={parent:i[s]}}if(!i[s])break;i=i[s]}var l=v.a.get(dt.ctx.wallet.molds,t);return dt.ctx.tb.reactAssembler.run(l,e)},cases:[function(t,e){if(!t.obj.data){var a=e.ctx.payload.tplsMapping[t.obj.level]||e.ctx.payload.defaultTpl,n={tpl:t.obj.tpl||a,data:t.obj.item,level:t.obj.level,nodes:{}};return t.subs=t.obj.subs,t.obj=n,t.ops.push({name:"addSubs",args:"subs"}),"applied"}},function(t,e){if(!t.obj.nodes.title){var a=t.obj,n=(dt.ctx.wallet.molds.item.title,{title:t.obj.data.text,level:t.obj.level});return t.obj.nodes.title=e.ctx.payload.useTemplate(a.tpl+".title",n),"applied"}}]}},getMolds:function(t){return this.ctx.tb.parser.run(t)},buildTpls:function(t){return this.ctx.tb.iterator.run(t,{payload:this.ctx.payload1})},addGlobalStyles:function(t,e){var a,n=[];e=e||this.ctx.payload1.usedGlobalStyles;var i=function(t){return"[tplid='"+a[t].uid+"']"},r=function(t,e){return a[e]?i(e):"*"==e?Object.keys(a).filter(function(t){return"globalStyle"!=t}).map(function(t){return i(t)}).join(","):v.a.get(t,e)},s={color:"red"};for(var o in e){a=e[o].parent;var l=dt.ctx.tb.reactAssembler.run(a.globalStyle,s,r);n.push(l)}return n.length&&(t=[t,n]),t}};ct.treeCardsBuilder={run:function(t){var e=dt.ctx.wallet={molds:t.molds,repo:t.data};Object.assign(dt.ctx.payload1,{tplsMapping:t.mappings.tplsMapping,defaultTpl:t.mappings.defaultTpl,usedGlobalStyles:{}}),e.tpls=dt.buildTpls(e.repo);var a=e.tpls.nodes.card;return a=dt.addGlobalStyles(a)},init:function(){dt.ctx.tb.parser=ct.tplObjParse,dt.ctx.tb.reactAssembler=ct.reactAssembler,dt.ctx.tb.iterator=ct.treeIterator},def:"\n    ",debug:{ub:dt}};var ht=window.cu,pt={ctx:{},run:function(t,e){var a=this.ctx.payload;this.ctx.payload.attrs=e;var n=this.it(t,[]);return this.ctx.payload=a,n},it:function(t,e){var a={oldPayload:null,obj:t,sub:t,master:this,path:e,values:{},ops:[]};for(var n in this.prepare(a),a.subs){var i=this.it(a.subs[n],e.concat([n]));a.values[n]=i}return this.integrate(a)},addPayload:function(t,e){t.oldPayload||(t.oldPayload=this.ctx.payload,this.ctx.payload=Object.create(this.ctx.payload)),Object.assign(this.ctx.payload,e)},prepare:function(t){for(var e=this.ctx.payload.cases,a=!0,n=0;a&&n<5;)for(var i in a=!1,n++,e){if("applied"==(0,e[i])(t,this)){a=!0,!0;break}}},integrate:function(t){if(t.ops.length)for(var e in t.ops){var a=t.ops[e];this.ctx.payload[a.name](a.args,t,this)}return t.oldPayload&&(this.ctx.payload=t.oldPayload),t.obj}};ht.treeIterator={run:function(t,e){var a=Object.create(pt);return a.ctx=e,e.payload||(e.payload={cases:[]}),a.run(t,[])},init:function(){},def:"\n    ",debug:{ub:pt}};var ft=window.cu,vt={ctx:{nextUID:0},run:function(t){return(t||"uid")+"_"+this.ctx.nextUID++}};ft.uids={run:function(t){return vt.run(t)},def:"\n    ",debug:{ub:vt}};var gt=window.cu;for(var bt in gt)gt[bt].init&&gt[bt].init();for(var bt in gt.tests={wallet:{test:{},pins:{},pending:[]},pin:function(t,e){this.wallet.pins[t]=e},get:function(t){var e=v.a.get(this.wallet.pins,t);return e||(e=v.a.get(this.wallet.test,t)),e}},gt)gt[bt].test&&gt.tests.wallet.pending.push(bt);for(var mt=0;mt<5&&gt.tests.wallet.pending.length;){var wt=gt.tests.wallet.pending.shift();mt++;var yt={},_t=void 0;try{_t=gt[wt].test(yt)}catch(Vt){console.log("error when running ",wt,Vt)}if("pending"!=_t){if(console.group("test for ",wt),gt.tests.wallet.test[wt]=yt,_t&&console.log(_t),Object.keys(yt))for(var wt in yt)console.log(wt,yt[wt]);console.groupEnd()}else gt.tests.wallet.pending.push(wt)}gt.tests.wallet.pending.length&&console.error("error with tests : ");var xt=S,jt=(a(1254),window.fns={},window.ctxpins={},window.DataManager);jt.newAPI=!0;y.init(jt);window.$=b.a;var kt={showhud:function(){var t=jt.getValue("workingant.viewState.path");console.log(t),t="antView.map.nodes"==t?"antView.bridge.nodes":"antView.map.nodes",jt.set("workingant.viewState.path",t)},placeorder:function(t){13===t.which&&(Ot.place(),jt.set("workingant.data.input",{text:""}),Ot.restart())},set:function(t,e){jt.set(t,e)},parseinput:function(){var t=jt.getValue("workingant.data.input");v.a.isString(t)&&Ot.parse(t)},select:function(t){Ot.change({parent:t}),jt.set("repo.uistate.selected",t)}};jt.setTrigger("workingant.data.input","ada",{run:kt.parseinput}),jt.setCombined("ub.flow",{start:function(){this.wallet={step:{createdAt:(new Date).getTime()}}},parse:function(t){var e=t.match(/^(\.[^\s]+\s+)*/),a=t.substr(e[0].length);e[0].trim().split(" ");this.wallet.step.editStartedAt||(this.wallet.step.firstCharAt=(new Date).getTime()),this.wallet.step.text=a},place:function(){this.wallet.text,St.antsDbState.getId(),this.wallet.step.createdAt,this.wallet.step.firstCharAt,(new Date).getTime(),this.getParent()}});var Ot={start:function(){this.wallet={step:{},actions:this.main,parser:this.parser}},restart:function(){var t=this.wallet.step;this.wallet={step:{parent:t.parent},startedAt:(new Date).getTime(),actions:this.main,parser:this.parser}},parse:function(t){this.wallet.parser.parse(this.wallet,t)},change:function(t){this.wallet.actions.change(this.wallet,t)},place:function(){this.wallet.actions.place(this.wallet)},parser:{parse:function(t,e){t.actions.change(t,{text:e,x:e.substr(1)})}},main:{place:function(t){"destroy"!=t.step.text?this.add(t):St.db.destroy()},change:function(t,e){v.a.merge(t.step,e)},add:function(t){var e=t.step.parent;e||(e=jt.getWallet("repo.root").id);jt.getWallet("repo.state").nextId++;var a=St.antsDbState.getId(),n={text:t.step.text,id:a,startedAt:t.startedAt,placedAt:(new Date).getTime()};St.mapview.mergeItem(a,n),St.mapview.mergeRoot(v.a.set({},"rels.sub."+e+"."+a,{id:a,parent:e})),St.mapview.mergeRoot(v.a.set({},"rels.allSubs."+a,{id:a,parent:e})),jt.set("repo.items."+a,n),jt.set("repo.root.rels.sub."+e+"."+a,{id:a,parent:e}),jt.set("repo.root.rels.allSubs."+a,{id:a,parent:e})}}};Ot.start();var St=window.myUB={};jt.setCombined("fnsub",{loader:{get:function(){var t=St;t.fnsub&&t.fnsub.isReady||(this.make(t,"fnsub","ub.fnsub",{old:t.fnsub}),this.setupAll(t)),t.fnsub.makeUb("mapview","ub.mapView",{"tb.db":"db",state:"antsDbState"}),t.fnsub.makeUb("antsDbState","ub.antsDbState",{"tb.db":"db"}),t.fnsub.makeUb("db","ub.db",{}),t.fnsub.setupAll()},setupAll:function(t){for(var e in t)t[e].goSetup&&this.setup(t,t[e]);return!0},make:function(t,e,a,n){var i=Object.create(jt.getValue(a));i.goSetup=!0,i.extra=n,i.uid=xt.uids.run(),t[e]?v.a.merge(t[e],i):t[e]=i},setup:function(t,e){delete e.goSetup;var a={};for(var n in e.extra){var i=v.a.isString(e.extra[n])?v.a.get(t,e.extra[n]):e.extra[n];i||(i={},v.a.set(t,e.extra[n],i)),v.a.set(a,n,i)}e.setup&&e.setup(a),e.isReady=!0},autostart:!0}}),St.fnsub={subs:[],waiting:{},makeUb:function(t,e,a){this.subs.push([t,e,a])},onready:function(t){var e={},a=new Promise(function(t){e.resolve=t});return this.waiting[t.uid]||(this.waiting[t.uid]=[]),this.waiting[t.uid].push(e),a}},jt.setCombined("ub.antsDbState",{setup:function(t){var e=this;v.a.merge(this,t),this.wallet={state:{prefix:"ants",id:"antsDbState",nextId:1}},St.fnsub.onready(this.tb.db).then(function(){return e.tb.db.loadItems(["antsDbState"])}).catch(function(){}).then(function(t){console.log("state",t),t[0]?(console.log("state",t[0]),e.wallet.state=t[0],e.isReady=!0):(console.log("state",e.wallet.state),e.tb.db.saveItems(e.uid,[e.wallet.state]))})},getId:function(){return this.wallet.state.nextId++,this.tb.db.request_save(this.uid,[this.wallet.state],100),"ant_"+this.wallet.state.nextId}}),jt.setCombined("ub.fnsub",{setup:function(t){if(v.a.merge(this,t),this.fns=St,this.waiting=this.waiting||{},this.old.subs){for(var e in this.old.subs){var a=this.old.subs[e];this.makeUb(a[0],a[1],a[2])}this.setupAll(),delete this.subs}},setupAll:function(){var t=this.fns;for(var e in t)t[e].goSetup&&this.setupUb(t[e]);return!0},makeUb:function(t,e,a){var n=this.fns,i=Object.create(jt.getValue(e));i.goSetup=!0,i.extra=a,i.uid=n[t]&&n[t].id?n[t].uid:xt.uids.run(),n[t]?v.a.merge(n[t],i):n[t]=i},setupUb:function(t){var e=this.fns;delete t.goSetup;var a={};for(var n in t.extra){var i=v.a.isString(t.extra[n])?v.a.get(e,t.extra[n]):t.extra[n];i||(i={uid:xt.uids.run()},v.a.set(e,t.extra[n],i)),v.a.set(a,n,i)}t.setup&&t.setup(a),t.isReady=!0,this.waiting[t.uid]&&(this.waiting[t.uid].forEach(function(t){t.resolve()}),this.waiting[t.uid]=[])},onready:function(t){if(t.isReady)return Promise.resolve();var e={},a=new Promise(function(t){e.resolve=t});return this.waiting[t.uid]||(this.waiting[t.uid]=[]),this.waiting[t.uid].push(e),a}}),jt.setCombined("ub.db",{setup:function(){this.db=xt.db.run("thisdb"),this.timers={}},destroy:function(){this.db.destroy()},request_save:function(t,e,a){var n=this;this.timers[t]&&window.clearTimeout(this.timers[t]),this.timers[t]=window.setTimeout(function(){n.saveItems(t,e)},a||1e3)},saveItems:function(t,e){this.timers[t]&&window.clearTimeout(this.timers[t]);var a=v.a.isArray(e)?e:e.getItemsToSave(),n=[];for(var i in a)n.push(this.db.save(a[i],a[i].id));return Promise.all(n).then(function(){console.log("saved all",t)})},loadItems:function(t){var e=v.a.isArray(t)?t:t.getItemsToSave(),a=[];for(var n in e)a.push(this.db.load(e[n]));return Promise.all(a)}}),jt.setCombined("ub.mapView",{setup:function(t){return this.wallet={items:{},root:{id:"ant1",text:"the first map",rels:{sub:{}},type:"map"},changed:{},state:{nextId:1}},this.wallet.items.ant1=this.wallet.root,v.a.merge(this,t),this},loadMap:function(t){var e=this,a=[t,"info_"+t];this.tb.db.loadItems(a).then(function(t){for(var a in t){t[a]&&(e.wallet.items[t[a].id]=t[a])}t[0]&&(e.wallet.root=t[0])}).then(function(){var t=e.wallet.root,a=v.a.get(t,"rels.allSubs")||{},n=Object.keys(a);return e.tb.db.loadItems(n)}).then(function(t){for(var a in t){var n=t[a];n&&(e.wallet.items[n.id]=n)}}).then(function(){console.log("done",e.wallet),jt.set("repo.items",e.wallet.items),jt.set("repo.root",e.wallet.root)})},getItemsToSave:function(){var t=this.wallet.changed;this.wallet.changed={};var e=[];for(var a in t)e.push(this.wallet.items[a]);return e},saveItems:function(){var t=this.getItemsToSave();this.tb.db.saveItems(this.uid,t)},generateId:function(){return this.tb.state.getId()},mergeItem:function(t,e){return t||(t=this.generateId()),this.wallet.items[t]||(this.wallet.items[t]={id:t,createdAt:(new Date).getTime()}),v.a.merge(this.wallet.items[t],e),this.triggerChange(t),t},mergeRoot:function(t){v.a.merge(this.wallet.root,t),this.triggerChange(this.wallet.root.id)},triggerChange:function(t){this.wallet.changed[t]=!0,this.tb.db.request_save(this.uid,this)},setRel:function(t,e,a,n){v.a.set(this.wallet.root,["rels",t,e,a],n),this.triggerChange(this.wallet.root.id)}}),jt.setCombined("repo",{items:{},root:{id:"ant1",text:"the first map",rels:{sub:{}}},state:{nextId:2}}),jt.setCombined("antView.molds",{loader:{get:function(t){return xt.tplObjParse.run(this.tpls)},tpls:{title:"<div >item : {value.text}</div>",item:"<div on_click={actions.select} antid={id}>item : {item.text}</div>",mapView:{logo:xt.brand.getLogo(k.a.company.catchPhrase(),10,5),frame:'<div>{title} {content}\n        <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />\n        <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />\n        <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />\n        \n        <style>\n          .topic>.text { border-bottom : 1px solid {color} ; }\n          .content { margin-left : 1px; padding-left : 10px;}\n\n          .mapviewtitle { position:sticky; top : -30px; margin-bottom : 20px; background : {background};  } \n          .logo { display : inline-block;width : 50px; height : 50px; }\n\n          .selected.title { font-size : 19px;}\n\n          .selected.content { \n            border-left :  1px dotted red;\n          }\n\n          .selected.content::after {\n            content : "...";\n            display : block;\n          }\n\n          .mapviewtitle { font-variant: petite-caps;}\n        </style>\n      </div>',title:"\n        <div class='mapviewtitle '> <svg class='logo'>{logo}</svg> {item.text}</div>"},map:{topic:"<div on_click={actions.select} antid={id} class='title topic {isSelected}'><span class='text'>{handle} {item.text} &nbsp;&nbsp;&nbsp;&nbsp;</span></div>",item:"<div on_click={actions.select} antid={id} class='title item {isSelected}'>{handle} {item.text}</div>",entry:"<div on_click={actions.select} antid={id} class='title entry {isSelected}'>{handle} {item.text}</div>",other:"<div on_click={actions.select} antid={id} class='{isSelected}'>{item.text}</div>",card:"<div class='{isSelected}'>{title} <div id='content' class='content {isSelected}'>{content}</div></div>"},bridgeTitle:"<div>{value.text}</div>",frame:"<div>{maptitle}{items}</div>",mapTitle:""}}}),jt.setCombined("antView.map",{nodes:{loader:{get:function(t,e){t.fetch({uistate:"repo.uistate",items:"repo.items",root:"repo.root",repo:"repo",molds:"antView.molds"},e),e.rows=Object.values(e.items);return e.data={},e.actions=xt.store.get(t,kt,{runWith:{select:["select","antid"]}}),e.selected=e.uistate.selected,e.color="#007abc",e.otherTpl="map.other",e.moldsMap=["map.topic","map.item","map.entry"],e.cardMold="map.card",e.background="#000",e.body=this.getBody(e,e.root.id,e.root.rels.sub),e.body},setV:function(t,e,a){for(var n in a=a||{},t)void 0===a[n]&&(a[n]=e[n]),e[n]=t[n];return a},cleanV:function(t,e){for(var a in e)t[a]=e[a]},getBody:function(t,e,a){var n=this.getBodyList(t,e,a),i=xt.reactAssembler.run(t.molds.mapView.logo,t),r=this.setV({logo:i,item:t.repo.root},t,r),s=xt.reactAssembler.run(t.molds.mapView.title,t);r=this.setV({content:n,title:s},t,r);var o=xt.reactAssembler.run(t.molds.mapView.frame,t);return this.cleanV(t,r),o},getBodyList:function(t,e,a){var n=a[e];if(!n)return null;if(t.level>5)return null;var i=void 0!=t.level?t.level+1:0,r=[],s=this.setV({id:null,item:null,level:0,isSelected:null,content:null,title:null},t,s);for(var o in n){v.a.merge(t,{id:o,item:t.items[o],level:i,isSelected:t.selected==o?"selected":""});var l=this.getItem(t,a);r.push(l)}return this.cleanV(t,s),r},getItem:function(t,e){t.item;var a=t.mold;!a&&t.moldsMap&&(a=t.moldsMap[t.level]),a||(a=t.otherTpl);var n,i=v.a.get(t.molds,a);if(t.title=xt.reactAssembler.run(i,t),t.content=this.getBodyList(t,t.id,e),t.isSelected&&!t.content&&(t.content=[]),t.content){var r=v.a.get(t.molds,t.cardMold);n=xt.reactAssembler.run(r,t)}else n=t.title;return n}}}}),jt.setCombined("antView.bridge",{nodes:{loader:{get:function(t,e){t.fetch({items:"repo.items",molds:"antView.molds"},e),e.rows=Object.values(e.items);var a=[];for(var n in e.data={},e.items){e.data.path=n,e.data.value=e.items[n];var i=xt.reactAssembler.run(e.molds.bridgeTitle,e.data);a.push(i)}return console.log(a),a}}}}),jt.setCombined("dbSavings",{items:{}}),jt.setCombined("tb.persisitence",{setup:function(){var t=this;this.db=xt.db.run("thisdb"),window.onbeforeunload=function(){return t.saveAll()},this.loadAll()},request_save:function(){var t=this;this.timer&&window.clearTimeout(this.timer),this.timer=window.setTimeout(function(){t.saveAll()},6e4)},saveAll:function(){var t=jt.getValue("dbSavings").items,e=[];for(var a in t)e.push(this.saveitem(a,t[a]))},saveitem:function(t,e){var a=e.path||e,n=jt.getWallet(a);return this.db.save({repo:n},t)},loadAll:function(){var t=jt.getValue("dbSavings").items;for(var e in t)this.loaditem(e,t[e])},loaditem:function(t,e){var a=e.path||e,n=e.onload||null;this.db.load(t).then(function(t){t&&t.repo&&jt.set(a,t.repo),n&&jt.runOn(n[0],n[1])})},starter:{loader:{autostart:!0,get:function(t){return t.cache.done?1:(t.cache.done=!0,t.fetch({tb:"tb.persisitence"}).tb.setup(),1)}}}}),jt.setCombined("ui.molds",{loader:{get:function(t){return xt.tplObjParse.run(this.tpls)},tpls:{main:"\n          <div id='frame'>\n            <div id='easel'>{view}</div>\n            <div id='bar'>\n              <myinput id='order' value={order.value} on_key_press={order.place} on_change={order.change}></myinput>\n              <div id='bumb' on_click='{bumb.action}'>{picture}</div>\n            </div>\n          </div>\n          <style>\n            * { box-sizing : border-box}\n            body , window, html {\n              color : {textColor};\n              height : 100%; width : 100%; background : {background} }\n            #frame { height : 100%; width : 100%;}\n            #frame { display : flex; flex-direction : column; }\n            #easel { flex : 1; overflow : auto; }\n            #bar   { border-top: 1px solid #999; width : 100%; flex-basis : {dim.barHeight}px ; display : flex;flex-direction:row; }\n\n            #order {  outline: none; flex : 1; border : 0px none transparent; width: 100%;}\n            #bumb  { flex-basis : {dim.barHeight}px; background : {color} } \n\n          </style>\n          \n  ",bubbleitem:"<div on_click={selectitem} targetid={targetid}>{label}</div>"}}}),jt.setCombined("workingant",{data:{input:{text:""},currentView:"main",selected:""}}),jt.setCombined("antsFrame.ui",{loader:{paths:{molds:"ui.molds",orderText:"workingant.data",node:"antsFrame.prepare"},get:function(t,e){return t.fetch(this.paths,e),v.a.set(e.node,e.molds.main.mold.pins.order.concat(["props","value"]),e.orderText.input),e.node}}}),jt.setCombined("workingant.viewState",{path:"antView.map.nodes"}),jt.setCombined("antsFrame.prepare",{loader:{paths:{molds:"ui.molds",data:"bubbles.data",repo:"repo",viewState:"workingant.viewState"},get:function(t,e){t.fetch(this.paths,e),t.fetch({view:e.viewState.path},e);var a=xt.store.get(t,kt,{change:{changeOrder:"workingant.data.input"},run:{bumbAction:"showhud",placeOrder:"placeorder"}});return e.dim={window:{height:"400",width:"200"},barHeight:"50"},e.data={label:"main",bubbleList:"TestList",order:{change:a.changeOrder,place:a.placeOrder},bumb:{action:a.bumbAction},dim:e.dim,view:e.view,color:"#007abc",background:"#000",textColor:"#eee"},e.node=xt.reactAssembler.run(e.molds.main,e.data),e.node},autostart:!0}}),jt.setCombined("test",{loader:{get:function(){St.mapview.loadMap("ant1")},autostart:!0}}),jt.historyManager.recording=!1,jt.runToStart();var At=function(t){function e(t){var a;return Object(o.a)(this,e),(a=Object(u.a)(this,Object(c.a)(e).call(this,t))).path="antsFrame.ui",a.state={},a}return Object(d.a)(e,t),Object(l.a)(e,[{key:"componentDidMount",value:function(){var t=this;jt.setTrigger(this.path,"asd",{run:function(){t.setState({version:(new Date).getTime()})}})}},{key:"render",value:function(){var t=jt.getValue(this.path);return xt.reactUtils.makeComponent(t||[])||"empty"}}]),e}(n.Component),Tt=function(t){function e(t){var a;return Object(o.a)(this,e),(a=Object(u.a)(this,Object(c.a)(e).call(this,t))).state={value:{scode:"salut"}},a}return Object(d.a)(e,t),Object(l.a)(e,[{key:"_style",value:function(){return"\n      html, window, body{ width : 100%; height : 100%; overflow : auto; padding: 0px; margin:0px;}\n      #root, .main { width : 100%; height : 100%;}\n      \n    "}},{key:"render",value:function(){var t=this._style(),e=[i.a.createElement(At,{key:"1"})];return[i.a.createElement("style",null,t),e]}}]),e}(n.Component),Pt=function(t){function e(t){return Object(o.a)(this,e),Object(u.a)(this,Object(c.a)(e).call(this,t))}return Object(d.a)(e,t),Object(l.a)(e,[{key:"render",value:function(){return i.a.createElement(Tt,null)}}]),e}(n.Component),It=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ct(t,e){navigator.serviceWorker.register(t).then(function(t){t.onupdatefound=function(){var a=t.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}}).catch(function(t){console.error("Error during service worker registration:",t)})}s.a.render(i.a.createElement(Pt,null),document.getElementById("root")),function(t){if("serviceWorker"in navigator){if(new URL("/antstycoon",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var e="".concat("/antstycoon","/service-worker.js");It?(function(t,e){fetch(t).then(function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then(function(t){t.unregister().then(function(){window.location.reload()})}):Ct(t,e)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(e,t),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):Ct(e,t)})}}()},41:function(t,e){var a={setup:function(t){var e=Object.create(this);return e.wallet={currentStack:{info:[{type:"startedWith",info:t}]},stacks:[]},e.recording=!0,e.wallet.stacks.push(e.wallet.currentStack),e},startStack:function(t){if(this.recording){var e={info:[],prevStack:this.wallet.currentStack,index:this.wallet.stacks.length,start:t};this.addInfo({type:"subStack",stack:e},!0),this.wallet.stacks.push(e),this.wallet.currentStack=e,t&&this.addInfo(t)}},addInfo:function(t,e){this.recording&&(e||(t=_.cloneDeep(t)),this.wallet.currentStack.info.push(t))},endStack:function(t){this.recording&&(t&&this.addInfo(t),this.wallet.currentStack=this.wallet.currentStack.prevStack)}},n={setup:function(){var t=Object.create(this);return t.state={ctx:{},gettingValue:{},wallet:{},meta:{},cache:{},version:{},loadersCache:{},triggers:{},currentVersion:1,dependencies:{},nextUID:1,agenda:{names:{},tasks:[]},pins:{},toStart:[],flags:{}},t.historyManager=a.setup(this),t},state:{gettingValue:{},wallet:{},meta:{},cache:{},version:{},loadersCache:{},triggers:{},currentVersion:1,dependencies:{},nextUID:1,agenda:{names:{},tasks:[]},pins:{},toStart:[],flags:{}},setCtx:function(t,e,a,n){var i=_.get(this.state.ctx,[t,"ctx"].join("."));i||_.set(this.state.ctx,[t,"ctx"].join("."),i={names:[]}),_.set(i,e,a),i.names.push({names:n,path:e})},getCtx:function(t,e){var a,n=_.get(this.state.ctx,[t,"ctx"].join("."));if(!n)return null;for(var i in n.names)if(-1!=n.names[i].names.indexOf(e)){a=n.names[i].path;break}return a?_.get(n,a):null},runOn:function(t,e,a){var n=this.getCtx(t,e);return n?n[e](a):null},runFn:function(t,e){var a=t.split("."),n=a.pop(),i=a.join("."),r=this.getValue(i);if(r[n])return _.isFunction(r[n])?r[n](e,t,this):_.isFunction(r[n].run)?r[n].run(e,t,this):void 0},getInfluenced:function(t){var e=[],a=_.get(this.state.dependencies,t+".DEP");if(!a)return[];for(var n in a)e.push(n),e=e.concat(this.getInfluenced(n));return e},getValue:function(t,e){var a=t.split("."),n=this.checkCache(t);if(n)return n;if(!e)for(var i=0;i<a.length;i++){var r=a.slice(0,i).join(".");if(this.state.gettingValue[r]){var s=this.state.gettingValue[r].partialResult,o=a.slice(i),l=_.get(s,o);if(void 0!==l)return l}}this.state.gettingValue[t]=!0;var u=this.makeList(t);return n=this.listToValue(u,t),delete this.state.gettingValue[t],void 0!==n&&this.setCache(t,n),n},setCache:function(t,e,a){this.state.cache[t]={value:e,shouldUpdate:a||!1,version:this.state.currentVersion}},checkCache:function(t,e){return this.state.cache[t]?e?this.state.cache[t].value:this.state.cache[t].shouldUpdate?null:this.state.cache[t].value:null},prepareCache:function(t){var e=this.state.loadersCache[t];e||(e=this.state.loadersCache[t]={old:{},contains:{},dependsOn:{}});var a={contains:e.contains||{},dependsOn:e.dependsOn||{}};return e.old=a,delete e.contains,delete e.dependsOn,a},diffCache:function(t,e){this.state.loadersCache[e]||(this.state.loadersCache[e]={});var a=this.state.loadersCache[e]||{},n=this.state.dependencies,i=function(t,e){var a=_.get(n,t+".DEP");a||_.set(n,t+".DEP",a={}),a[e]=!0},r=function(t,e){var a=_.get(n,t+".DEP");a&&delete a[e]},s=function(t,a){for(var n in t)a&&a[n]||i(n,e);for(var n in a)t&&t[n]||r(n,e)};s(a.contains,t.contains),s(a.dependsOn,t.dependsOn)},updateVersionsMap:function(t){var e=(this.state.loadersCache[t]||{}).dependsOn;for(var a in e){var n=this.getVersion(a);e[a].version=n}},makeList:function(t){var e=[],a=t.substr?t.split("."):t,n=_.get(this.state.wallet,t);if(void 0!==n){if(!_.isObjectLike(n))return e.push({src:"wallet",value:n,path:[],srcPath:t,version:1}),e;n=_.cloneDeep(n),e.push({src:"wallet",value:n,path:[],srcPath:t,version:1})}for(var i=this.state.meta,r=0;r<a.length&&i;r++){if(i.loader){var s={src:"root",loader:i.loader,path:[],srcPath:a.slice(0,r),select:a.slice(r)};e.push(s)}i=i[a[r]]}var o=a;return function t(e,a,n){if(e){if(e.loader){var i={src:"sub",loader:e.loader,path:a,srcPath:o.concat(a)};n.push(i)}for(var r in e)"loader"!=r&&t(e[r],a.concat(r),n)}}(i,[],e),e},silentSet:function(t,e,a){this.historyManager.addInfo({type:"silentSet",path:t,value:e}),_.set(this.state.wallet,t,e),this.state.cache[t]&&(this.state.cache[t].shouldUpdate=!0),a||this.getAffectedPaths(t)},listToValue:function(t,e){if(1==t.length&&t[0].value)return t[0].value;var a={};this.state.gettingValue[e]={partialResult:a};for(var n=t,i=!0,r=0;i;){if(++r>5)return this.state.cache[e].shouldUpdate=!0,a;t=n,n=[],i=!1;for(var s=0;s<t.length;s++){var o=t[s],l=void 0;if(o.value)l=o.value;else if(o.loader)try{l=this.getFromLoader(o,a,e)}catch(u){"postpone"==u?(this.state.cache[e].shouldUpdate=!0,n.push(o),i=!0):console.error(u);continue}o.select&&(l=_.get(l,o.select)),o.path.length?_.set(a,o.path,l):0==Object.values(a).length?a=l:_.merge(a,l)}}return a},loadersCache:{},addLog:function(t,e,a,n){this.state.loadersCache[t]||(this.state.loadersCache[t]={version:this.state.currentVersion,cachedValue:{}});var i=this.state.loadersCache[t];i[e]||(i[e]={}),i[e][a]=n||!0},getFromLoader:function(t,e,a,n){var r,o=this,l=t.srcPath.join(".");try{var u={add:function(t,e){o.addLog(l,"dependsOn",t,{version:!0,name:e,path:t,srcPath:l})}},c=t.loader;if(c.prism)if(c.loadedPrism)c=c.loadedPrism;else{var d=this.getFromDispatch(c.prism);c.loadedPrism=d,c=d}if(c.load)return this.state.cache[l]?{}:(r=c.load(e,this,u,t.loader,t),_.set(this.state.wallet,l,r),this.state.cache[l]={loader:!0,value:{}},r);if(!n){var h=this.checkCache(l);if(h)return h}"sub"==t.src&&this.addLog(a,"contains",l);var p=this.prepareCache(l);if(c.get)try{var f=s.init(e,this,u,t.loader,t,this.state.loadersCache[l]);r=i.newAPI?c.get(f,f.v):c.get(f,this,u,t.loader,t,this.state.loadersCache[l])}catch(v){if(!v||"return"!=v.type)throw v;r=v.value}if("forceCache"===r)return this.checkCache(l,!0);void 0!==r&&(this.setCache(l,r),this.diffCache(p,l),c.updateVersionsMap&&this.updateVersionsMap(l),_.set(this.state.version,l+".version",this.state.currentVersion))}catch(v){console.error(v)}return c&&c.skipCache&&(this.state.cache[l].shouldUpdate=!0),r},runUtils:function(t,e){var a=this.getValue(t);if(a&&a.run)return a.run.apply(a,e)},getWallet:function(t){return _.get(this.state.wallet,t)},mergeValue:function(t,e){var a=this;this.historyManager.addInfo({type:"mergeValue",path:t,value:e});var n=t?_.get(this.state.wallet,t):this.state.wallet;n||(n={},_.set(this.state.wallet,t,n));var i=[];this.state.currentVersion++;var r=_.isString(t)?t.split("."):t||[];1==r.length&&""==r[0]&&(r=[]);var s={addPath:function(t){var e=r.concat(t);i.push(e),_.set(a.state.version,e.join(".")+".version",a.state.currentVersion)}};for(var o in this.pauseAll(),_.isObjectLike(e)?this.setObObj(n,e,s,[]):console.log("it's not object"),i)this.updateVersionForAll(i[o]),this.getAffectedPaths(i[o].join("."));this.req_triggers()},pauseAll:function(){this.state.runningReqTriggers_timer&&(this.clearInterval(this.state.runningReqTriggers_timer),delete this.state.runningReqTriggers_timer),this.state.runningAgendaTriggers_timer&&(this.clearInterval(this.state.runningAgendaTriggers_timer),delete this.state.runningAgendaTriggers_timer)},setInterval:function(t,e,a){var n=!1;return window.requestAnimationFrame(function e(){n||(t(),window.requestAnimationFrame(e))}),function(){n=!0}},clearInterval:function(t){if(t)return t()},req_triggers:function(){var t=this;this.state.runningReqTriggers_timer||(this.state.runningReqTriggers_timer=this.setInterval(function(){t.asyncTriggers()},0,"triggers"))},asyncTriggers:function(){var t=Object.keys(this.affected);if(0==t.length)return this.clearInterval(this.state.runningReqTriggers_timer),this.affected_checked={},void delete this.state.runningReqTriggers_timer;this.affected_checked[t[0]]=this.affected[t[0]],delete this.affected[t[0]],this.lazy_checkTriggers(t[0])},req_Agenda:function(){var t=this;this.state.runningAgendaTriggers_timer||0!=this.state.agenda.tasks.length&&(this.state.runningAgendaTriggers_timer=this.setInterval(function(){t.asyncTriggersAgenda()},0,"agenda"))},asyncTriggersAgenda:function(){if(0==this.state.agenda.tasks.length)return this.clearInterval(this.state.runningAgendaTriggers_timer),void delete this.state.runningAgendaTriggers_timer;var t=this.state.agenda.tasks.shift();if(!t)return console.error(t);delete this.state.agenda.names[t.id],this.runTrigger(t,t.target,t.listener)},lazy_checkTriggers:function(t){if(this.state.triggers[t]){if(this.state.agenda.names[t])return;var e=this.state.triggers[t];for(var a in e){var n=e[a],i=n.id||t+"___"+a;this.state.agenda.names[a]||(n.path||(n.target=t),n.token||(n.listener=a),n.id||(n.id=i),this.state.agenda.names[i]=!0,this.state.agenda.tasks.push(n))}this.sortAgenda(),this.req_Agenda()}},sortAgenda:function(){this.state.agenda.tasks.sort(function(t,e){return e.salience?t.salience?t.salience-e.salience:-1:1})},setObObj:function(t,e,a,n){for(var i in e)void 0!==e[i]&&(_.isObjectLike(e[i])?(t[i]||(t[i]={}),this.setObObj(t[i],e[i],a,n.concat(i))):t[i]!=e[i]&&(t[i]=e[i],a.addPath(n.concat(i))))},appendToArray:function(t,e,a){var n=_.get(this.state.wallet,t);if(!n)return e=[e],this.set(t,e,!1,a);var i=n.length,r=_.isArray(t)?t:t.split(".");return r.push(i),this.set(r,e,!1,a)},setByLoader:function(t,e){_.isArray(t)&&(t=t.join("."));var a=_.get(this.state.meta,t);if(!a||!a.loader||!a.loader.set)return!1;var n=s.init({},this,{},a.loader,{},this.state.loadersCache[t]);return e=a.loader.set(n,e),!0},set:function(t,e,a,n){this.historyManager.startStack({type:"set",path:t,value:e});try{if(this.setByLoader(t,e))return;var i=a?this.state.meta:this.state.wallet;_.set(i,t,e),this.state.currentVersion++,this.updateVersionForAll(t.split(".")),_.set(this.state.version,t+".version",this.state.currentVersion);var r=_.isArray(t)?t.join("."):t;this.getAffectedPaths(r),this.req_triggers()}catch(s){console.error(s)}finally{this.historyManager.endStack()}},affected:{},affected_checked:{},markChangeOn:function(t,e){this.getAffectedPaths(t),e||this.req_triggers()},getAffectedPaths:function(t){if(this.state.cache[t]&&(this.state.cache[t].shouldUpdate=!0),!this.affected[t]){this.affected[t]={version:this.state.currentVersion,state:1};var e=t.split("."),a=e[0];this.getAffectedPaths(e[0]);for(var n=1;n<e.length-1;n++)a+="."+e[n],this.getAffectedPaths(a);var i=this.getInfluenced(t);for(var n in i)this.getAffectedPaths(i[n])}},markChangedPaths:function(t){for(var e=t.split("."),a=e[0],n=1;n<e.length;n++)a+="."+e[n],this.state.cache[a]&&(this.state.cache[a].shouldUpdate=!0),this.checkTriggers(a),this.setUpdateFlag(a)},changedPaths:{},setUpdateFlag:function(t){var e=this.getInfluenced(t),a=this.state.cache;for(var n in e)a[e[n]]&&(a[e[n]].shouldUpdate=!0),this.setUpdateFlag(a[e[n]]),this.checkTriggers(e[n])},checkTriggers:function(t){this.state.triggers[t]&&this.runTriggers(this.state.triggers[t],t)},runTriggers:function(t,e){for(var a in t)this.runTrigger(t[a],e,a)},runTrigger:function(t,e,a){if(_.isFunction(t.run))return t.run(t,e,a);var n=_.get(this.state.wallet,t.run);return _.isFunction(n)?n(t,e,a):n.run?n.run(t,e,a):void 0},run:function(t,e){},fetchValues:function(t,e,a,n,i,r){for(var s in e)if("type"!=s){var o=e[s];if(_.isString(o)){if("$"==o.charAt(0)){var l=o.substr(2);i&&i.add(l,s),o=n.getValue(l)}else if(r){var u=o;i&&i.add(u,s),o=n.getValue(u)}}else"fullPath"==o.KEY&&(path=o.path.join("."),i&&i.add(path,s),o=n.getValue(path));if(void 0===o)throw"postpone";var c=s;t[c]=o,t.src||(t.src={}),t.src[c]={key:e[s],slot:s}}return t},setCombined:function(t,e){this.historyManager.startStack({type:"setCombined",path:t,value:e});var a={loaders:{},loadersPaths:[],basePath:t.split("."),value:e,pins:[],afterOp:[]},n=this.iterate(e,[],a);if(a.pins.length){var i={};for(var r in a.pins){var s=a.pins[r];i[s.value||s.path.slice(-1)[0]]={path:s.path,fullPath:a.basePath.concat(s.path)}}var o=_.get(this.state.pins,t+".pins");o||_.set(this.state.pins,t+".pins",o={}),_.merge(o,i)}if(a.afterOp.length)for(var r in a.afterOp){var l=a.afterOp[r];if("gluePin"==l.type){var u={KEY:"fullPath",path:o[l.pin].fullPath};l.isLoader?_.set(a.loaders,l.dest,u):_.set(e,l.dest,u)}else"flags"==l.type&&l.flags.hasVersion&&this.updateVersion(l.path)}if(n||this.set(t,e,!1,!0),a.hasLoaders)for(var r in this.set(t,a.loaders,!0,!0),a.loadersPaths){var c=a.loadersPaths[r];this.setCache(c.join("."),{},!0);var d=_.get(this.state.meta,c);d.loader&&d.loader.autostart&&this.state.toStart.push({path:c.join(".")})}this.historyManager.endStack()},runToStart:function(){for(var t=this.state.toStart;t.length;){var e=t.shift();this.getValue(e.path)}},buildModel:function(t,e){var a,n=t.MODEL;t=_.cloneDeep(t),-1!=n.indexOf(":")&&(a=n.split(":"),n=a.shift(),t.tokens=a);var i=this.getValue(n);i.handleTokens&&a&&i.handleTokens(t,a,e);var r=_.cloneDeep(i.modelObj);if(i.modelSpec){var s=i.modelSpec;if(s.ops)for(var o in s.ops){var l=s.ops[o];if("replaceValue"==l.type){var u=_.get(t,l.source);l.dest?_.set(r,l.dest,u):r=u}else if("eval"==l.type){var c=l.fn(t,l);console.log(c),_.set(t,l.dest,c)}}s.isLoader&&(r={loader:r})}return void 0!==t.pin&&(r.pin=t.pin),this.historyManager.addInfo({type:"buildModel",path:e,input:t,obj:r}),r},iterate:function(t,e,a){for(;t&&t.MODEL;){var n=this.buildModel(t,a.basePath.concat(e));for(var i in t)delete t[i];_.merge(t,n)}var r=!0;for(var i in t){var s=e.concat(i);if("pin"==i)a.pins.push({subPath:s,path:e,value:t[i]}),delete t[i];else if("loader"==i)this.setLoader(a.loaders,e,t[i],a.basePath,a),a.loadersPaths.push(a.basePath.concat(e)),delete t[i],a.hasLoaders=!0;else if("flags"==i)a.afterOp.push({type:"flags",path:a.basePath.concat(e).join("."),relPath:e,flags:t.flags});else if(_.isString(t[i])&&"%"==t[i].charAt(0))t[i]=this.getStaticValue(t[i],i,t,s,a),r=!1;else if(_.isObjectLike(t[i])){this.iterate(t[i],s,a)||(r=!1),r=!1}else r=!1}return r},getStaticValue:function(t,e,a,n,i){return"%PATH"==t?i.basePath.concat(n):(i.afterOp.push({type:"gluePin",dest:n,pin:t.substring(1)}),{KEY:"relative path"})},getUID:function(){return this.state.nextUID++},setTrigger:function(t,e,a){this.state.triggers[t]||(this.state.triggers[t]={}),this.state.triggers[t][e]=a},getTrigger:function(t,e){return this.state.triggers[t]?this.state.triggers[t][e]:null},remTrigger:function(t,e){this.state.triggers[t]&&delete this.state.triggers[t][e]},setLoader:function(t,e,a,n,i){if(_.isString(a)){var r=n.concat(e).join("."),s=this.getTrigger(a,r);s&&s.path&&this.remTrigger(s.path,r),this.setTrigger(a,r,{run:"base.updateLoader",loaderPath:a,destination:r}),a=this.getValue(a)}this.prepareLoader(a,n,e.concat("loader"),i),_.set(t,e.concat("loader"),a)},prepareLoader:function(t,e,a,n){this.deepTransformObj(t,[],function(t,e,i){if(_.isString(t)&&"%"==t.charAt(0))return"%PATH"==t?n.basePath.concat(a):(n.afterOp.push({type:"gluePin",dest:a.concat(i),pin:t.substring(1),isLoader:!0}),{x:12})})},deepTransformObj:function(t,e,a){if(t&&_.isObject(t))for(var n in t){var i=a(t[n],n,e.concat([n]));void 0===i?_.isObject(t[n])&&this.deepTransformObj(t[n],e.concat([n]),a):t[n]=i}},setMap:function(t){for(var e in t)this.setCombined(e,t[e])},getFromDispatch:function(t){return this.getValue(t)},getVersion:function(t){for(var e=t.split("."),a=-1,n=this.state.version,i=0;i<e.length;i++){var r=e[i];if(!n[r])return a;(n=n[r]).version&&(a=n.version)}return a},getVersionTree:function(t){var e=this.state.version;return _.get(e,t)},updateVersionForAll:function(t){for(var e=0;e<t.length;e++)_.set(this.state.version,t.slice(0,e).concat("version"),this.state.currentVersion)},updateVersion:function(t){_.set(this.state.version,t+".version",this.state.currentVersion)},objectDiff:function(t,e){return function t(e,a){if(!_.isObject(e)||!_.isObject(a))return{change:{from:e,to:a}};var n={},i=!1;for(var r in a)if(void 0===e[r])n[r]={change:{from:void 0,to:a[r],type:"added"}},i=!0;else if(_.isFunction(a[r])&&e[r]&&a[r].toString()!=e[r].toString())n[r]={change:{from:e[r],to:a[r],type:"function changed"}},i=!0;else if(_.isObject(a[r])){var s=t(e[r],a[r]);s&&(n[r]=s,i=!0)}else a[r]!=e[r]&&(n[r]={change:{from:e[r],to:a[r],type:"changed"}},i=!0);for(var r in e)void 0===a[r]&&(i=!0,n[r]={change:{from:e[r],to:null,type:"deleted"}});return i?n:null}(t,e)},act:function(t,e,a){var n=_.isObject(t)?t:this.getValue(t);a||(a=this.tb());var i=r.init(n,this,e,t,a);return i},tb:function(){var t=s.init({},this,null,{},{},{});return t}},i=n.setup(),r={master:null,actions:null,args:null,init:function(t,e,a,n,i){var r=Object.create(this);return r.master=e,r.actions=t,r.args=a,r.path=n,r.tb=i,r},run:function(t,e){return this.actions[t].apply(this.actions,[e,this.tb])}},s={master:null,logger:null,spec:null,step:null,cache:null,v:null,init:function(t,e,a,n,i,r){var s=Object.create(this);return Object.assign(s,{wallet:t,master:e,logger:a,spec:n,step:i,cache:r}),s.v={},s},act:function(t,e){var a=this.master.act(t,e,this);return a},go:function(t,e){return this.toolbox||(this.toolbox=i.getValue("toolBox")),this.toolbox[t]?this.toolbox[t].run?this.toolbox[t].run(e,this):_.isFunction(this.toolbox[t])?this.toolbox[t](e,this):void 0:(console.log("no ",t),null)},path:function(){return this.step.srcPath.join(".")},fetch:function(t,e){return this.run_fetch(t,e)},run_fetch:function(t,e,a){var n=this,i=!1;(_.isString(t)||t.KEY)&&(i=!0,t={SINGLEPATH:t});var r={};for(var s in this.master.fetchValues(r,t,this.wallet,this.master,{add:function(t,e){if(n.logger){var i="SINGLEPATH"!==e?(a||[]).concat(e):a||[];n.logger.add(t,i.join("."))}}},!0),r)if(r[s]&&"routes"==r[s].type){var o="SINGLEPATH"!=s?(a||[]).concat(s):a;r[s]=this.run_fetch(r[s],null,o)}else if(r[s]&&"value"==r[s].type);else if(r[s]&&_.isString(r[s])&&"$"==r[s].charAt(0)){var l="SINGLEPATH"!=s?(a||[]).concat(s):a;r[s]=this.run_fetch(r[s].substring(2),null,l)}if(i&&(r=r.SINGLEPATH),e){if(e.src){var u=r.src;delete r.src,_.merge(e.src,u)}return Object.assign(e,r),e}return r},pathOf:function(t){return(t=this.v.src[t]).key?t.key:_.isString(t)?t:void 0},set:function(t,e){for(var a=this.v,n=_.isString(t)?t.split("."):t,i=null,r=0;r<n.length;r++){var s=n[r];if(a.src&&a.src[s]&&(i={src:a.src[s],left:n.slice(r+1)}),!a[s])break;a=a[s]}if(i){var o=(_.isString(i.src.key)?i.src.key.split("."):i.src.key.path).concat(i.left).join(".");this.master.set(o,e)}},detach:function(){var t=Object.create(this);return t.v={},t.logger=null,t},feed:function(t){for(var e=this.master.getValue(t).init(),a=1;a<arguments.length;a++)e.in(arguments[a]);return e}};try{window.DataManager||(window.DataManager=i,window._DataManager=n)}catch(o){}},60:function(t,e,a){t.exports=a.p+"static/media/logo.06a44ff7.svg"},61:function(t,e,a){}},[[106,2,1]]]);
//# sourceMappingURL=main.3faa7a42.chunk.js.map